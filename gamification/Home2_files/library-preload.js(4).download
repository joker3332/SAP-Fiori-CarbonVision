//@ui5-bundle sap/ui/vbm/library-preload.js
/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5) (c) Copyright 2009-2012 SAP AG. All rights reserved
 */
sap.ui.predefine("sap/ui/vbm/Adapter", ["sap/ui/core/Element","jquery.sap.global","sap/base/Log","./library"],function(t,jQuery,e,i){"use strict";var a="sap.ui.vbm.Adapter";var n=t.extend("sap.ui.vbm.Adapter",{metadata:{library:"sap.ui.vbm",associations:{map:{type:"sap.ui.vbm.GeoMap"}},events:{submit:{parameters:{data:{type:"string"}}}}}});n.prototype.init=function(){this._eventHandlers=[];this._actions=[];this._mapConfiguration={};this._clusterVOs=new Map;this._dataTypes={};this._data={};this._idKeyMap={};this._propsAnomalies=new Map;this._propsAnomalies.set("pos","position");this._propsAnomalies.set("posarray","position");this._propsAnomalies.set("dragdata","dragData");this._routeProperties=["color","colorBorder","directionIndicator","dotcolor","dotwidth","dragdata","end","hotDeltaColor","labelBgColor","labelPos","labelText","lineDash","linewidth","posarray","selectColor","start","tooltip"];this._areaProperties=["key","color","colorBorder","posarray","selectColor","dragdata","VB:s","VB:c","hotScale","hotDeltaColor","borderDash","selectColor","fxdir","fxsize","entity","labelBgColor","labelBorderColor","labelPos","labelText","labelArrow","label","labelAlignment","tooltip"];this._spotProperties=["alignment","contentOffset","dragdata","fxdir","fxsize","hotDeltaColor","icon","image","labelBgColor","labelPos","labelText","pos","selectColor","tooltip","semanticType"]};n.prototype.exit=function(){this._actions.forEach(function(t){t.detach()});this._detachHandlers()};n.prototype.setMap=function(t){var e=this._map()||null;var i=sap.ui.getCore().byId(t instanceof sap.ui.vbm.GeoMap?t.getId():t);if(e!=i&&e!=null){this._detachHandlers();this.init()}this.setAssociation("map",t,true);if(i!=null){var a=new sap.ui.model.json.JSONModel;a.setSizeLimit(1e5);i.setModel(a)}};n.prototype._map=function(){return sap.ui.getCore().byId(this.getMap())};n.prototype._attachHandler=function(t,e,i){if(t in this.mEventRegistry&&this.mEventRegistry[t].length>0){return this}else{if(!i._eventHandlers.some(function(t){return t===e})){i._eventHandlers.push(e)}this.attachEvent(t,e,i);return this}};n.prototype._detachHandlers=function(){var t=this;var e=function(e){if(this.hasListeners(e)){var i=this.mEventRegistry[e];for(var a=0,n=i.length;a<n;a++){var r=t._eventHandlers.indexOf(i[a].fFunction);if(r!==-1){this.detachEvent(e,i[a].fFunction,i[a].oListener)}}}};var i=this._map();if(i!=null){var a=i.mEventRegistry;for(var n in a){if(a.hasOwnProperty(n)){e.call(i,n)}}var r=function(t){var i=t.mEventRegistry;for(var a in i){if(i.hasOwnProperty(a)){e.call(t,a)}}};i.getVos().forEach(r)}return this};n.prototype.load=function(t){var i=null;if(typeof t==="string"){try{i=JSON.parse(t)}catch(t){e.debug("attempt to load invalid JSON string","",a);return this}}else if(typeof t==="object"){i=t}if(!i){e.debug("nothing to load","",a);return this}if(!i.SAPVB){e.debug("invalid object supplied for load","",a);return this}if(i.SAPVB.Config){this._processConfiguration(i.SAPVB.Config)}if(i.SAPVB.Resources){this._processResources(i.SAPVB.Resources)}if(i.SAPVB.DataTypes){this._processDataTypes(i.SAPVB.DataTypes)}if(i.SAPVB.Clustering){this._processClusters(i.SAPVB.Clustering)}return(i.SAPVB.MapProviders?this._processMapProviders(i.SAPVB.MapProviders):Promise.resolve()).then(function(){if(i.SAPVB.MapLayerStacks){this._processMapLayerStacks(i.SAPVB.MapLayerStacks)}if(i.SAPVB.Scenes){this._processScenes(i.SAPVB.Scenes)}if(i.SAPVB.Data){this._processData(i.SAPVB.Data)}if(i.SAPVB.Actions){this._processActions(i.SAPVB.Actions)}if(i.SAPVB.Automation&&i.SAPVB.Automation.Call){this._processAutomation(i.SAPVB.Automation,i.SAPVB.Menus)}if(i.SAPVB.Windows){this._processDetailWindows(i)}}.bind(this))};n.prototype._processConfiguration=function(t){return this};n.prototype._processResources=function(t){if(t.Set){var e=this._map();e.destroyResources();[].concat(t.Set.Resource).forEach(function(t){e.addResource(new sap.ui.vbm.Resource({name:t.name,value:t.value}))},this)}return this};n.prototype._processDataTypes=function(t){if(t.Set){if(t.Set.name&&t.Set.type&&t.Set.type==="N"){[].concat(t.Set.N).foreach(function(t){this._dataTypes.forEach(function(e){if(e.name==t.name){e=t}})})}else{this._dataTypes=[].concat(t.Set.N)}}return this};n.prototype._processData=function(t){var e=function(t,e){var i=sap.ui.vbm.findInArray(this._dataTypes,function(t){return t.name==e});if(i==null||!i.A){return undefined}else{var a=sap.ui.vbm.findInArray(i.A,function(e){return e.alias==t});if(a!=null){return a.name}else{return undefined}}};var i=function(t){if(t.name&&t.E){this._data[t.name]=[].concat(t.E).map(function(i){var a={};for(var n in i){if(n!=="xmlns:VB"&&n!=="n.name"&&i.hasOwnProperty(n)){if(n==="VB:c"){a["changeable"]=i[n]}else if(n==="VB:s"){a["select"]=i[n]}else{var r=e.call(this,n,t.name);if(r!=null&&r!==""){a[r]=i[n]}else{a[n]=i[n]}}}}return a},this)}};var a=function(t){var i={};for(var a in t){if(a!=="xmlns:VB"&&a!=="n.name"&&t.hasOwnProperty(a)){if(a==="VB:c"){i["changeable"]=t[a]}else if(a==="VB:s"){i["select"]=t[a]}else{var n=e.call(this,a,t["n.name"]);if(n!=null&&n!==""){i[n]=t[a]}else{i[a]=t[a]}}}}if(!this._data[t["n.name"]]){this._data[t["n.name"]]=[]}if(this._data[t["n.name"]].some(function(e){return e.Key==t.K})){var r=sap.ui.vbm.findIndexInArray(this._data[t["n.name"]],function(e){return e.Key===t.K});if(r!==-1){this._data[t["n.name"]][r]=i}}else{this._data[t["n.name"]].push(i)}};if(t.Remove){[].concat(t.Remove).filter(function(t){return t.N&&t.N.E}).forEach(function(t){[].concat(t.N.E).forEach(function(e){var i=sap.ui.vbm.findIndexInArray(this._data[t.name],function(t){return t.Key===e.K});if(i!==-1){this._data[t.name].splice(i,1)}},this)},this)}if(t.Set&&typeof t.Set==="object"&&!jQuery.isEmptyObject(t.Set)){if(!Array.isArray(t.Set)&&!t.Set.name&&!t.Set.type){this._data={};if(t.Set.N!==null){[].concat(t.Set.N).forEach(i,this)}}else{[].concat(t.Set).filter(function(t){return t.name&&t.type}).map(function(t){return[].concat(t.N)}).reduce(function(t,e){return t.concat(e)}).map(function(t){var e=t.hasOwnProperty("E")&&t.E?[].concat(t.E):[];return e.map(function(e){e["n.name"]=t.name;return e})}).reduce(function(t,e){return t.concat(e)}).forEach(a,this)}}this._map().getModel().setData(this._data,false);return this};n.prototype._processMapProviders=function(t){if(t.Set&&t.Set.MapProvider){var i=[].concat(t.Set.MapProvider).map(function(t){return{name:t.name,tileX:t.tileX,tileY:t.tileY,minLOD:t.minLOD,maxLOD:t.maxLOD,copyright:t.copyright,MapBase:t.MapBase,copyrightImage:t.copyrightImage,copyrightLink:t.copyrightLink,description:t.description,projection:t.projection,resolution:t.resolution,retries:t.retries,type:t.type,Header:t.Header?[].concat(t.Header).map(function(t){return{name:t.name,value:t.value}}):t.Header,Source:t.Source?[].concat(t.Source).map(function(t){return{id:t.id,url:t.url}}):t.Source}});var n=function(t){return t&&t.url&&t.url.indexOf("google")!==-1};var r=i.map(function(t){return[].concat(t.Source)}).reduce(function(t,e){return t.concat(e)}).filter(n);if(r.length>0){var s=[];var o=r.reduce(function(t,e){var i=e.url.split("key=")[1];t[i]=t[i]||[];if(sap.ui.vbm.findIndexInArray(s,function(t){return t===i})===-1){s.push(i)}t[i].push(e);return t},{});var c=function(t){return new Promise(function(e,i){var a=new XMLHttpRequest;a.open("POST","https://www.googleapis.com/tile/v1/createSession?key="+t,true);a.setRequestHeader("Content-Type","application/json");a.onreadystatechange=function(){if(a.readyState==4){if(a.status==200){e(JSON.parse(a.responseText))}else{i(new Error(a.statusText))}}};var n={mapType:"terrain",language:"en-NZ",region:"nz",layerTypes:["layerRoadmap"],overlay:false,scale:"scaleFactor1x"};a.send(JSON.stringify(n))}).then(function(e){if(e&&e.session){o[t].forEach(function(t){t.url=t.url+"&session="+e.session})}},function(t){e.debug(t,"",a)})};return Promise.all(s.map(c)).then(function(){this._mapConfiguration.MapProvider=i;this._updateMapconfiguration()}.bind(this))}else{this._mapConfiguration.MapProvider=i;this._updateMapconfiguration();return Promise.resolve()}}return this};n.prototype._processMapLayerStacks=function(t){if(t.Set&&t.Set.MapLayerStack){this._mapConfiguration.MapLayerStacks=[];[].concat(t.Set.MapLayerStack).forEach(function(t){var e={name:t.name},i="true";if(t.MapLayer){e.MapLayer=[];[].concat(t.MapLayer).forEach(function(t){var a={name:t.name,refMapProvider:t.refMapProvider,opacity:t.opacity,colBkgnd:t.colBkgnd,singleBMP:t.singleBMP||"false"};i=a.singleBMP!=="true"?"false":i;e.MapLayer.push(a)});e.singleBMP=t.singleBMP||i}this._mapConfiguration.MapLayerStacks.push(e)},this);this._updateMapconfiguration()}return this};n.prototype._updateMapconfiguration=function(){if(this._mapConfiguration.MapProvider&&this._mapConfiguration.MapLayerStacks){this._map().setMapConfiguration(this._mapConfiguration)}return this};n.prototype._ui5Id=function(t){return this._map().getId()+"-"+t};n.prototype._processScenes=function(t){if(t.Set&&t.Set.SceneGeo){var i=this._map();if(t.Set.SceneGeo.initialStartPosition){i.setCenterPosition(t.Set.SceneGeo.initialStartPosition)}if(t.Set.SceneGeo.initialZoom){i.setZoomlevel(Math.floor(t.Set.SceneGeo.initialZoom))}if(t.Set.SceneGeo.refMapLayerStack){i.setRefMapLayerStack(t.Set.SceneGeo.refMapLayerStack)}var n=t.Set.SceneGeo.VO;i.destroyVos();if(!n){return this}n.forEach(function(t){if(this._clusterVOs.has(t.id)){return}var n,r,s=[],o={};function c(e,i){for(var a in t){var n=a.indexOf(".bind");var r=n!==-1?a.substring(0,n):a;if(e.indexOf(r)!==-1){r=i.get(r)||r;var c=t[a];if(n!==-1){c=t[a].substring(t[a].indexOf(".")+1);s.push(c)}o[r]=n!==-1?"{"+c+"}":c}}}function u(){if(t.DragSource&&r.getMetadata().hasAggregation("dragSource")){[].concat(t.DragSource.DragItem).forEach(function(t){r.addDragSource(new sap.ui.vbm.DragSource({type:t.type}))})}if(t.DropTarget&&r.getMetadata().hasAggregation("dropTarget")){[].concat(t.DropTarget.DropItem).forEach(function(t){r.addDropTarget(new sap.ui.vbm.DropTarget({type:t.type}))})}}switch(t.type){case"{00100000-2012-0004-B001-64592B8DB964}":c(this._spotProperties,this._propsAnomalies);n=new sap.ui.vbm.Spot(o);r=new sap.ui.vbm.Spots(this._ui5Id(t.id));u();break;case"{00100000-2012-0004-B001-C46BD7336A1A}":c(this._routeProperties,this._propsAnomalies);n=new sap.ui.vbm.Route(o);r=new sap.ui.vbm.Routes(this._ui5Id(t.id));u();break;case"{00100000-2012-0004-B001-F311DE491C77}":c(this._areaProperties,this._propsAnomalies);n=new sap.ui.vbm.Area(o);r=new sap.ui.vbm.Areas(this._ui5Id(t.id));u();break;case"{00100000-2014-0004-BDA8-87B904609063}":case"{00100000-2014-0004-B001-9F1B43BE944A}":case"{00100000-2013-0004-B001-7EB3CCC039C4}":case"{00100000-2013-0004-B001-686F01B57873}":case"{00100000-2012-0004-B001-BFED458C3076}":case"{00100000-2012-0004-B001-383477EA1DEB}":case"{388951f5-a66b-4423-a5ad-e0ee13c2246f}":default:e.debug("unsupported VO type",t.type,a);return}var f=sap.ui.vbm.findIndexInArray(this._dataTypes,function(e){return e.name===t.datasource});if(f!==-1){var p=this._dataTypes[f];n.bindProperty("key",{path:p.key});s.push(p.key);var h=[];p.A.forEach(function(t){if(s.indexOf(t.name)===-1){h.push(t.name);var e=new sap.ui.core.CustomData({key:t.name,value:"{"+t.name+"}"});n.addCustomData(e)}});if(h.length){r.setCustomProperties(h)}r.bindAggregation("items",{path:"/"+t.datasource+"",template:n})}else{r.addItem(n)}i.addVo(r)}.bind(this))}else if(t.Merge&&t.Merge.SceneGeo&&t.Merge.SceneGeo.refMapLayerStack){this._map().setRefMapLayerStack(t.Merge.SceneGeo.refMapLayerStack)}return this};function r(t,e){Object.assign(this,t);this._adapter=e;if(!this.refVO){this.refVO="General"}}r.prototype.attach=function(){var t=false;this._listener=this._adapter;this._handler=this._adapter._handler;if(this.refVO==="Map"||this.refVO==="General"){this._target=this._adapter._map()}else{var i=this._adapter._ui5Id(this.refVO);this._target=sap.ui.vbm.findInArray(this._adapter._map().getVos(),function(t){return t.getId()===i});if(!this._target){this._target=this._adapter._clusterVOs.get(this.refVO);t=!!this._target}}if(!this._target){e.warning("unable to attach action",this.id,a);return false}switch(this.refEvent){case"Click":this._event="click";if(t){this._listener=this;this._handler=function(t){this._adapter._handler(t,this)}}break;case"ContextMenu":this._event="contextMenu";if(t){this._listener=this;this._handler=function(t){this._adapter._handler(t,this)}}break;case"DoubleClick":this._event="click";this._handler=this._adapter._clickHandler;if(t){this._listener=this;this._handler=function(t){this._adapter._clickHandler(t,this)}}break;case"Drop":this._event="drop";break;case"CreateComplete":this._event="createComplete";break;case"Select":this._event="select";break;case"KeyPress":if(this._target!==this._adapter._map()){return false}this._event="keyDown";this._target.setKeyEventDelay(250);this._target.setAllowKeyEventRepeat(false);this._handler=this._adapter._getKeyboardHandler(this.name);break;default:if(this.refEvent&&this.name){e.info("No UI5 event found to attach action to. Falling through to default vbi event handling.",this.name,a);this._event=this.name}else{e.error("Action invalid. No refEvent or name supplied.",this,a);return false}}this._target.attachEvent(this._event,this._handler,this._listener);this._target.invalidate();return true};r.prototype.detach=function(){if(this._target&&this._event&&this._handler&&this._listener){this._target.detachEvent(this._event,this._handler,this._listener);this._target.invalidate();this._target=this._event=this._handler=this._listener=undefined}};n.prototype._removeAction=function(t){var e=this._actions[t];e.detach();this._actions.splice(t,1);if(e.refEvent==="DoubleClick"){var i=sap.ui.vbm.findInArray(this._actions,function(t){return t.refVO===e.refVO&&t.refEvent==="Click"});if(i){i.attach()}}};n.prototype._addAction=function(t){var i=new r(t,this);if(t.refEvent==="Click"){if(this._actions.some(function(e){return e.refVO===t.refVO&&e.refEvent==="DoubleClick"},this)){this._actions.push(i);return}}else if(t.refEvent==="DoubleClick"){var n=sap.ui.vbm.findInArray(this._actions,function(e){return e.refVO===t.refVO&&e.refEvent==="Click"},this);if(n){n.detach()}}if(i.attach()){this._actions.push(i)}else{e.info("unable to attach action",t.id,a)}};n.prototype._processActions=function(t){var i,n;if(t.Remove){if(t.Remove.Action){i=[].concat(t.Remove.Action)}else{i=[].concat(t.Remove)}i.forEach(function(t){n=sap.ui.vbm.findIndexInArray(this._actions,function(e){return e.id===t.id});if(n!==-1){this._removeAction(n)}else{e.info("remove of nonexistent action",t.id,a)}},this)}if(t.Set){if(t.Set.Action){i=[].concat(t.Set.Action)}else{i=[].concat(t.Set)}i.forEach(function(t){n=sap.ui.vbm.findIndexInArray(this._actions,function(e){return e.id===t.id});if(n!==-1){this._removeAction(n)}this._addAction(t)},this)}return this};n.prototype._getKeyboardHandler=function(t){return function(e){var i=e.mParameters;if(i.key=="Shift"||i.code==16||i.key=="Control"||i.code==17||i.key=="Alt"||i.code==18||i.key=="Meta"||i.code==91){return}var a={version:"2.0","xmlns:VB":"VB",Action:{name:t,Params:{Param:[{name:"code","#":i.code},{name:"shift","#":i.shift},{name:"ctrl","#":i.ctrl},{name:"alt","#":i.alt},{name:"meta","#":i.meta}]}}};this.fireSubmit({data:JSON.stringify(a)})}};n.prototype.idKeyMapGenerator=function(){this._map().getVos().map(function(t){return t.getItems()}).reduce(function(t,e){return t.concat(e)}).forEach(function(t){this._idKeyMap[t.getUniqueId()]=t.getKey()},this);return this};n.prototype._processAutomation=function(t,e){var i={};if(t.Call.handler==="CONTEXTMENUHANDLER"){var a=this;var n=this._map();if(t.Call.instance&&t.Call.instance.split(".").length==2){var r=this._map().getVos().map(function(t){return t.getItems()}).reduce(function(t,e){return t.concat(e)}).filter(function(e){return e.getKey()===t.Call.instance.split(".")[1]});if(r.length>0){n=r[0];t.Call.instance=n.getUniqueId();t.Call.object=a._ui5Id(t.Call.object)}}if(e.Set.Menu){[].concat(e.Set.Menu).forEach(function(t){a._attachHandler.call(n,t.action,function(t){var e;if(t.oSource===a._map()){e=t.getParameters();if(e.Action.object.startsWith(this._map().getId())){e.Action.object=e.Action.object.substr(this._map().getId().length+1)}if(e.id&&e.hasOwnProperty("id")){delete e.id}}else{e=t.getParameters().data;if(e.Action.object.startsWith(this._map().getId())){e.Action.object=e.Action.object.substr(this._map().getId().length+1)}e.Action.instance=e.Action.object+"."+t.oSource.getKey()}if(e.Data&&e.Data.Merge&&e.Data.Merge.N){[].concat(e.Data.Merge.N).forEach(function(t){if(t.name&&t.name.startsWith(this._map().getId())){t.name=t.name.substr(this._map().getId().length+1)}},this);var i=e.Data.Merge.N.map(function(t){return t.E}).reduce(function(t,e){return t.concat(e)}).map(function(t){return t.K});if(jQuery.isEmptyObject(this._idKeyMap)){this.idKeyMapGenerator()}if(i.some(function(t){return!this._idKeyMap.hasOwnProperty(t)},this)){this.idKeyMapGenerator()}var n=function(t){t.K=this._idKeyMap[t.K]};[].concat(e.Data.Merge.N).map(function(t){return t.E}).reduce(function(t,e){return t.concat(e)}).forEach(n,this)}this.fireSubmit({data:JSON.stringify(e)})},a)})}}i["Automation"]=t;i["Menus"]=e;var s={};s["SAPVB"]=i;this._map().load(s);return this};n.prototype._processClusters=function(t){this._clusterVOs.clear();if(t.Set){var i=this._map();i.destroyClusters();[].concat(t.Set.Cluster).forEach(function(t){var n=null;switch(t.type){case"distance":n=new sap.ui.vbm.ClusterDistance(t.id);if(t.distance){n.setDistance(parseFloat(t.distance))}break;case"grid":n=new sap.ui.vbm.ClusterGrid(t.id);if(t.limit){n.setLimit(parseInt(t.limit,10))}if(t.limitOnSum){n.setLimitTotal(parseInt(t.limitOnSum,10))}if(t.order){n.setOrderIndex(parseInt(t.order,10))}if(t.areabordersize){n.setCellSpacing(-parseInt(t.areabordersize,10))}if(t.distanceX&&t.distanceY){n.setGridSize(t.distanceX+";"+t.distanceY)}if(t.offsetX&&t.offsetY){n.setOffset(t.offsetX+";"+t.offsetY)}break;case"tree":n=new sap.ui.vbm.ClusterTree(t.id,{});break;default:e.debug("unsupported clustering type",t.type,a);break}if(n){if(t.rule){n.setRule(t.rule)}n.setTextSettings({textcolor:t.textcolor,textfont:t.textfont,textfontsize:t.textfontsize,textoffset:t.textoffset,textoffsetY:t.textoffsetY});n.setVizTemplate(new sap.ui.vbm.Cluster);i.addCluster(n)}this._clusterVOs.set(t.VO,n)},this)}return this};n.prototype._processDetailWindows=function(t){var e=this._map();var i=this;if(!t.SAPVB.Windows.Set&&!t.SAPVB.Windows.Remove){return this}if(t.SAPVB.Windows.Set&&t.SAPVB.Windows.Set.name){var a=function(t,e){return function(i){return i[t]===e}};var n=[].concat(t.SAPVB.Windows.Set).map(function(t){var i=e.getModel().getData();var n=t;for(var r in t.Window){if(t.Window.hasOwnProperty(r)){if(r.endsWith(".bind")){if(r.startsWith("pos")){var s=t.Window[r].split(".");if(s[0]in i){var o=sap.ui.vbm.findIndexInArray(i[s[0]],a("Key",s[1]));if(o!==-1){var c=i[s[0]][o];if(s[2]in c){delete n.Window[r];n.Window[r.split(".")[0]]=c[s[2]]}}}}}}}return n},this);t.SAPVB.Windows.Set=n;if(t.SAPVB.Scenes&&t.SAPVB.Scenes.Set&&t.SAPVB.Scenes.Set.name&&t.SAPVB.Scenes.Set.Scene&&t.SAPVB.Scenes.Set.Scene.VO){var r=[].concat(t.SAPVB.Scenes.Set.Scene.VO).map(function(n){var r=n;var s=function(t,e,i){return function(n){if(n.name&&n.type){var r=n[n.type];if(r.name===n.name){var s=sap.ui.vbm.findInArray([].concat(this._dataTypes),a("name",r.name));var o=sap.ui.vbm.findInArray([].concat(sap.ui.vbm.findInArray([].concat(s.N),a("name",i[2])).A),a("name",i[4])).alias;var c=[].concat(r.E)[i[1]];var u=[].concat(sap.ui.vbm.findInArray([].concat(c.N),a("name",i[2])).E)[i[3]];t[e.split(".")[0]]=u[o];delete t[e]}}}};for(var o in n){if(n.hasOwnProperty(o)){if(o.endsWith(".bind")){var c=n[o].split(".");if(t.SAPVB.Data&&t.SAPVB.Data.Set){[].concat(t.SAPVB.Data.Set).forEach(s(r,o,c),this)}}}}if(t.SAPVB.Actions&&t.SAPVB.Actions.Set){[].concat(t.SAPVB.Actions.Set).filter(function(t){return t.Action.refVO===r.id}).forEach(function(t){i._attachHandler.call(e,t.Action.name,i._handler,i)})}return r},this);t.SAPVB.Scenes.Set.Scene.VO=r}}e.load(t);return this};n.prototype._handler=function(t,e){if(t.oSource instanceof sap.ui.vbm.ClusterBase){var i=t.getParameters().instance.getKey();var a=t.getParameters().event;var n=this._map().mVBIContext.GetMainScene();if(i&&a&&n){var r=n.GetEventVPCoords(a);var s=n.GetPosFromVPPoint([r[0],r[1],0]);var o=this._map().getInfoForCluster(i,sap.ui.vbm.ClusterInfoType.NodeInfo);t.getParameters().data={version:"2.0","xmlns:VB":"VB",id:t.oSource.getId(),Action:{id:e.id,name:e.name,object:e.refVO,instance:i,Params:{Param:[{name:"x","#":r[0].toString()},{name:"y","#":r[1].toString()}]},AddActionProperties:{AddActionProperty:[{name:"pos","#":s[0].toString()+";"+s[1].toString()+";0.0"},{name:"vos","#":o.cnt}]}}};this.fireSubmit({data:JSON.stringify(t.getParameters().data)})}}else{var c=t.getParameters();var u=c.data?c.data:c;if(u.Action&&!u.Action.object){this.fireSubmit({data:JSON.stringify(u)});return}if(u.Action.object.startsWith(this._map().getId())){u.Action.object=u.Action.object.substr(this._map().getId().length+1)}if(u.Action&&u.Action.object){var f="Route",p="Link";var h=[u.Action.object];if(u.Action.object===f){h.push(p);u.Action.object=p}var d=sap.ui.vbm.findInArray(this._actions,function(t){return h.indexOf(t.refVO)!=-1&&u.Action.name.toLowerCase()===t.refEvent.toLowerCase()});if(d){u.Action.id=d.id;u.Action.name=d.name;if(u.Action.instance){u.Action.instance=u.Action.object+"."+c.instance.getKey()}var l=[];if(u.Action.Params){u.Action.Params.Param.forEach(function(t){if(t.name==="strSource"){l.push(t)}});if(l.length){if(jQuery.isEmptyObject(this._idKeyMap)){this.idKeyMapGenerator()}else if(l.some(function(t){return!this._idKeyMap.hasOwnProperty(t["#"].split(".")[1])},this)){this.idKeyMapGenerator()}l.forEach(function(t){var e=t["#"].split(".");t["#"]=e[0]+"."+this._idKeyMap[e[1]]},this)}}if(u.Data&&u.Data.Merge&&u.Data.Merge.N){[].concat(u.Data.Merge.N).forEach(function(t){if(t.name&&t.name.startsWith(this._map().getId())){t.name=t.name.substr(this._map().getId().length+1)}},this);var m=u.Data.Merge.N.map(function(t){return t.E}).reduce(function(t,e){return t.concat(e)}).map(function(t){return t.K});if(jQuery.isEmptyObject(this._idKeyMap)){this.idKeyMapGenerator()}if(m.some(function(t){return!this._idKeyMap.hasOwnProperty(t)},this)){this.idKeyMapGenerator()}var v=function(t){t.K=this._idKeyMap[t.K]};[].concat(u.Data.Merge.N).map(function(t){return t.E}).reduce(function(t,e){return t.concat(e)}).forEach(v,this)}[].concat(d.AddActionProperty||[]).forEach(function(t){var e=u.Action.AddActionProperties.AddActionProperty||[];var i=sap.ui.vbm.findInArray([].concat(e),function(e){return e.name===t.name});if(!i){switch(t.name){case"zoom":e.push({name:t.name,"#":this._map().getZoomlevel()});break;case"centerpoint":e.push({name:t.name,"#":this._map().getCenterPosition()});break;case"pitch":e.push({name:t.name,"#":"0.0"});break;case"yaw":e.push({name:t.name,"#":"0.0"});break;default:break}}},this);this.fireSubmit({data:JSON.stringify(u)})}}}this.timeout=undefined};n.prototype._clickHandler=function(t,e){if(this.timeout){clearTimeout(this.timeout);if(!e){t.getParameters().data.Action.name="doubleclick"}this._handler(t,e)}else{var i=e?sap.ui.vbm.findInArray(this._actions,function(t){return t.refVO===e.refVO&&t.refEvent==="Click"}):undefined;this.oEvent=jQuery.extend(true,{},t);this.timeout=setTimeout(this._handler.bind(this,this.oEvent,i),500)}};return n});
/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5) (c) Copyright 2009-2012 SAP AG. All rights reserved
 */
sap.ui.predefine("sap/ui/vbm/Adapter3D", ["sap/ui/core/Element","sap/ui/base/ManagedObjectObserver","sap/ui/unified/Menu","sap/ui/unified/MenuItem","sap/m/ResponsivePopover","sap/ui/vbm/Viewport","./adapter3d/ObjectFactory","./adapter3d/VBIJSONParser","./adapter3d/SceneBuilder","./adapter3d/Utilities","./adapter3d/DragDropHandler","sap/m/HBox","sap/m/VBox","sap/m/Link","sap/m/Button","sap/m/Text","sap/m/Image","./adapter3d/thirdparty/three","sap/base/Log","jquery.sap.global","./library"],function(e,t,i,o,n,r,s,a,c,l,p,h,u,d,v,f,_,m,y,jQuery,w){"use strict";var g=m.Vector2;var x=m.Vector3;var b=l.toBoolean;var C="sap.ui.vbm.Adapter3D";var A;var D=e.extend("sap.ui.vbm.Adapter3D",{metadata:{library:"sap.ui.vbm",associations:{viewport:{type:"sap.ui.vbm.Viewport"}},events:{submit:{parameters:{data:{type:"string"}}}}}});var B=D.getMetadata().getParent().getClass().prototype;D.prototype.init=function(){if(B.init){B.init.call(this)}this._viewport=null;this._context={resources:new Map,config:new Map,dataTypes:[],data:{},windows:[],scenes:[],actions:[],voQueues:{toAdd:new Map,toUpdate:new Map,toRemove:new Map,clear:function(){this.toAdd.clear();this.toUpdate.clear();this.toRemove.clear()}},sceneQueues:{toAdd:[],toUpdate:[],toRemove:[],clear:function(){this.toAdd.length=0;this.toUpdate.length=0;this.toRemove.length=0}},windowQueues:{toAdd:[],toUpdate:[],toRemove:[],clear:function(){this.toAdd.length=0;this.toUpdate.length=0;this.toRemove.length=0}},setupView:undefined};this._update=Promise.resolve();this._parser=null;this._sceneBuilder=null;this._hoverInstance=null;this._hoverTimeOutId=null;this._clickTimerId=null;this._mouseDown=false;this._lastXY={x:0,y:0};this._viewportObserver=new t(this._observeChanges.bind(this));this._detail={popover:undefined,anchor:undefined,pending:undefined};this._raycaster=new m.Raycaster;this._dragDropHandler=null};D.prototype.exit=function(){if(this._clickTimerId){clearTimeout(this._clickTimerId);this._clickTimerId=null}if(this._hoverTimeOutId){clearTimeout(this._hoverTimeOutId);this._hoverTimeOutId=null}this._disconnectViewport();this._viewportObserver.disconnect();this._viewportObserver=null;if(this._dragDropHandler){this._dragDropHandler.destroy();this._dragDropHandler=null}if(this._sceneBuilder){this._sceneBuilder.destroy();this._sceneBuilder=null}if(this._parser){this._parser.destroy();this._parser=null}this._detail=null;this._context=null;this._raycaster=null;this._hoverInstance=null;if(B.exit){B.exit.call(this)}};D.prototype.setViewport=function(e){this.setAssociation("viewport",e,true);this._configureViewport()};D.prototype._configureViewport=function(){var e=sap.ui.getCore().byId(this.getViewport())||null;if(e!==this._viewport){this._disconnectViewport();this._viewport=e;this._connectViewport();var t=this._viewport.getOrbitControl();t.setConfig(this._context.config);t.setUtilities(l)}};D.prototype._connectViewport=function(){if(this._viewport){this._viewportObserver.observe(this._viewport,{destroy:true});this._viewport.addEventDelegate(A,this);this._dragDropHandler=new p(this)}};D.prototype._disconnectViewport=function(){if(this._viewport){this._dragDropHandler.destroy();this._dragDropHandler=null;this._viewport.removeEventDelegate(A);A.onBeforeRendering.call(this);this._viewportObserver.unobserve(this._viewport,{destroy:true});this._viewport=null}};D.prototype._observeChanges=function(e){if(e.type==="destroy"&&e.object===this._viewport){this._disconnectViewport()}};D.prototype.load=function(e){var t=this;t._configureViewport();if(!t._viewport){return Promise.reject()}var i=null;if(!t._parser){t._parser=new a(t._context)}if(!t._sceneBuilder){t._sceneBuilder=new c(t._context,t._viewport)}if(typeof e==="string"){try{i=JSON.parse(e)}catch(e){y.error("attempt to load invalid JSON string","",C);return Promise.resolve()}}else if(typeof e==="object"){i=e}if(!(i&&i.SAPVB)){y.error("attempt to load null","",C);return Promise.resolve()}t._viewport.setBusy(true);t._update=t._update.then(function(){t._parser.loadVBIJSON(i);return t._sceneBuilder.synchronize()}).then(function(){t._processAutomation(i);t._processDetailWindow();t._context.voQueues.toRemove.forEach(function(e){e.forEach(function(e){if(t._hoverInstance===e){t._hoverInstance=null}},t)},t);if(t._dragDropHandler){t._dragDropHandler.update()}t._viewport._resetBBox();t._viewport._updateCamera();t._context.voQueues.clear();t._context.sceneQueues.clear();t._context.windowQueues.clear();t._viewport.setBusy(false)});return t._update};D.prototype._processDetailWindow=function(e){var t=sap.ui.vbm.findInArray(this._context.windowQueues.toAdd,function(e){return e.type==="callout"});var i=t&&sap.ui.vbm.findInArray(this._context.scenes,function(e){return e.id===t.refScene});if(t&&i){this._closeDetailWindow();var o=this._createDetailWindow(t);this._fillDetailWindow(o,i);this._openDetailWindow(o,t)}};D.prototype._closeDetailWindow=function(){if(this._detail.popover){this._detail.popover.close();this._detail.popover.destroy();this._detail.popover=undefined}if(this._detail.anchor){this._detail.anchor.style.visibility="hidden"}};D.prototype._createDetailWindow=function(e){var t;if(e.caption!==""){var i=new sap.m.Text({width:"100%",textAlign:sap.ui.core.TextAlign.Center,text:e.caption,tooltip:e.caption});t=new sap.m.Bar({contentLeft:[i]})}var o=new sap.m.ResponsivePopover({placement:sap.m.PlacementType.Auto,showCloseButton:true,verticalScrolling:true,contentWidth:e.width+"px"});o.addStyleClass("sapUiVbmDetailWindow");if(t){o.setCustomHeader(t)}return o};D.prototype._getAnchor=function(e,t){if(!this._detail.anchor){var i=document.createElement("div");i.setAttribute("role",sap.ui.core.AccessibleRole.Note);i.classList.add("sapUiVbmDetailWindowAnchor");this._viewport.getDomRef().appendChild(i);this._detail.anchor=i}this._detail.anchor.style.left=e+"px";this._detail.anchor.style.top=t+"px";return this._detail.anchor};D.prototype._openDetailWindow=function(e,t){var i=t.pos.split(";");var o=new x(parseFloat(i[0]),parseFloat(i[1]),parseFloat(i[2]));if(!this._viewport.getDomRef()){if(this._detail.pending){this._detail.pending.popover.destroy()}this._detail.pending={world:o,popover:e}}else{var n=this._viewport.getDomRef().getBoundingClientRect();var r=this._viewport.worldToScreen(l.vbToThreeJs(o));r.x=l.clamp(r.x,5,n.width-5);r.y=l.clamp(r.y,5,n.height-5);e.openBy(this._getAnchor(r.x,r.y));e.attachAfterClose(function(){this._closeDetailWindow()}.bind(this));this._detail.popover=e}};D.prototype._openDetailPending=function(){if(this._detail.pending&&this._viewport.getDomRef()){var e=this._viewport.worldToScreen(l.vbToThreeJs(this._detail.pending.world));this._detail.pending.popover.openBy(this._getAnchor(e.x,e.y));this._detail.popover=this._detail.pending.popover;this._detail.pending=undefined}};D.prototype._fillDetailWindow=function(e,t){var i=function(e){var t;switch(e){case"1":t=sap.m.FlexJustifyContent.Start;break;case"2":t=sap.m.FlexJustifyContent.Center;break;case"4":t=sap.m.FlexJustifyContent.End;break;default:t=sap.m.FlexJustifyContent.Inherit;break}return t};var o=function(e){var t;switch(e.type){case"{00100000-2013-1000-1100-50059A6A47FA}":t=new f({text:e.vo.text,tooltip:e.vo.tooltip});t.addStyleClass("sapUiVbmDetailWindowBase sapUiVbmDetailWindowCaption");if(e.vo.level==="3"){t.addStyleClass("sapUiVbmDetailWindowCaption3")}break;case"{00100000-2013-1000-3700-AD84DDBBB31B}":t=new f({text:e.vo.text,tooltip:e.vo.tooltip});t.addStyleClass("sapUiVbmDetailwindowBase");break;case"{00100000-2013-1000-2400-D305F7942B98}":t=new d({text:e.vo.text,tooltip:e.vo.tooltip,href:e.vo.autoexecute?e.vo.reference:""});t.addStyleClass("sapUiVbmDetailWindowBase");break;case"{00100000-2013-1000-1200-855B919BB0E9}":t=new v({text:e.vo.text,tooltip:e.vo.tooltip});break;case"{00100000-2013-1000-2200-6B060A330B2C}":if(e.vo.image&&e.vo.image!==""){t=new _({src:l.makeDataUri(this._context.resources.get(e.vo.image)),tooltip:e.vo.tooltip})}break;default:y.error("attempt to create unknown element of detail window",e.type,C)}return t};var n=t.voGroups.map(function(e){return e.vos.map(function(t){return{type:e.type,vo:t}})}).reduce(function(e,t){return e.concat(t)}).sort(function(e,t){return parseInt(e.vo.top,10)-parseInt(t.vo.top,10)}).reduce(function(e,t){var i=t.vo.top?t.vo.top:"0";e[i]=e[i]||[];e[i].push(t);return e},{});var r=new u;for(var s in n){if(n.hasOwnProperty(s)){var a=new h({width:Math.max.apply(null,n[s].map(function(e){return parseInt(e.vo.right,10)}))+"px"});var c=0;n[s].sort(function(e,t){return parseInt(e.vo.left,10)-parseInt(t.vo.left,10)}).map(function(e){var t=[];if(parseInt(e.vo.left,10)-c>1){t.push(new h({width:parseInt(e.vo.left,10)-c+"px"}))}var n=new h({width:parseInt(e.vo.right,10)-parseInt(e.vo.left,10)+"px",justifyContent:i(e.vo.align)});c=parseInt(e.vo.right,10);n.addItem(o.bind(this)(e));t.push(n);return t},this).reduce(function(e,t){return e.concat(t)}).forEach(a.addItem,a);r.addItem(a)}}e.addContent(r)};D.prototype._processAutomation=function(e){var t=this;var n=function(e,r,s,a,c){var l=new o({text:r.text,enabled:r.disabled==="X"?false:true,startsSection:c,select:t._menuItemSelectionHandler.bind(t,r.id,s.instance,a,s.object)});if(r.MenuItem){var p=new i;c=false;[].concat(r.MenuItem).forEach(function(e){if(e.hasOwnProperty("Separator")){c=true}else{n(p,e,s,a,c);c=false}});l.setSubmenu(p)}e.addItem(l)};if(e&&e.SAPVB&&e.SAPVB.Automation&&e.SAPVB.Automation.Call&&e.SAPVB.Automation.Call){if(e.SAPVB.Automation.Call.handler&&e.SAPVB.Automation.Call.handler==="CONTEXTMENUHANDLER"){var r=[].concat(e.SAPVB.Automation.Call.Param).filter(function(e){return e.name==="x"});var s=[].concat(e.SAPVB.Automation.Call.Param).filter(function(e){return e.name==="y"});var a;if(r.length>0&&s.length>0){a=r[0]["#"]+" "+s[0]["#"]}if(e.SAPVB&&e.SAPVB.Menus&&e.SAPVB.Menus.Set){var c=[].concat(e.SAPVB.Menus.Set).filter(function(t){return t.Menu.id===e.SAPVB.Automation.Call.refID});if(c.length>0){var l=new i;var p=false;[].concat(c[0].Menu.MenuItem).forEach(function(t){if(t.hasOwnProperty("Separator")){p=true}else{n(l,t,e.SAPVB.Automation.Call,c[0].Menu.action,p);p=false}});var h=sap.ui.core.Popup.Dock;l.open(false,this._viewport,h.BeginTop,h.BeginTop,this._viewport,a,"fit fit")}}}}};D.prototype._menuItemSelectionHandler=function(e,t,i,o){var n={version:"2.0","xmlns:VB":"VB",Action:{id:e,instance:t,name:i,object:o}};this.fireSubmit({data:JSON.stringify(n)})};D.prototype._genericEventHandler=function(e,t){var i=l.parseKeyboardShortcut(this._context.config.has("HOME_VIEW")?this._context.config.get("HOME_VIEW"):"72");if(l.matchKeyboardShortcut(t,i)){this._viewport.applyCameraHome(false);return}var o=t.instance;var n=o?o.voGroup.id:t.voGroupId;var r=sap.ui.vbm.findInArray(this._context.actions,function(t){return t.refVO===n&&t.refEvent===e});if(r){var s=[];var a={version:"2.0","xmlns:VB":"VB",Action:{id:r.id,name:r.name,object:r.refVO,instance:o&&o.id?o.voGroup.datasource+"."+o.id:"",Params:{Param:s}}};if(r.name==="KEY_PRESS"){if(["Shift","Control","Alt","Meta"].indexOf(t.key)!==-1||[16,17,18,91].indexOf(t.code)!==-1){return}else{s.push({name:"code","#":t.keyCode},{name:"shift","#":t.shiftKey},{name:"ctrl","#":t.ctrlKey},{name:"alt","#":t.altKey},{name:"meta","#":t.metaKey})}}else if(t&&t.cursor){s.push({name:"x","#":t.cursor.x},{name:"y","#":t.cursor.y})}if(r.AddActionProperty){var c=[];[].concat(r.AddActionProperty).forEach(function(e){switch(e.name){case"pos":if(t.hitPoint){var i=l.threeJsToVb(t.hitPoint);c.push({name:e.name,"#":i.x.toFixed(5)+";"+i.y.toFixed(5)+";"+i.z.toFixed(5)})}break;case"zoom":var o=this._viewport._getCameraState();var n=this._sceneBuilder._getZoomFactor(o.position,o.target);c.push({name:e.name,"#":n.toFixed(5)});break;default:break}},this);if(c.length>0){a.Action.AddActionProperties={AddActionProperty:c}}}if(o&&e==="Click"&&t.selectionChanges){var p=o.voGroup.datasource,h;var u=l.getAttributeAlias(this._context,p,o.voGroup.keyAttributeName);a.Data={Merge:{N:[{name:o.voGroup.datasource,E:t.selectionChanges.selected.map(function(e){h={};h[u]=e.id||"";h["VB:s"]="true";return h}).concat(t.selectionChanges.deselected.map(function(e){h={};h[u]=e.id||"";h["VB:s"]="false";return h}))}]}}}this.fireSubmit({data:JSON.stringify(a)})}};D.prototype._propagateClick=function(e){this._genericEventHandler("Click",e)};D.prototype._propagateDoubleClick=function(e){this._genericEventHandler("DoubleClick",e)};D.prototype._propagateContextMenu=function(e){this._genericEventHandler("ContextMenu",e)};D.prototype._propagateKeyPress=function(e){this._genericEventHandler("KeyPress",e)};D.prototype._propogateHoverChange=function(e){this._genericEventHandler("HoverChange",e)};D.prototype._handleClick=function(e){var t=e.instance;y.trace("click","x: "+e.cursor.x+", y: "+e.cursor.y+", instance: "+(t?t.id:"")+", tooltip: "+(t?t.tooltip:""),C);this._extendEventWithSelection(e);if(e.selectionChanges){this._sceneBuilder.updateSelection(e.selectionChanges.selected,e.selectionChanges.deselected)}this._propagateClick(e)};D.prototype._handleDoubleClick=function(e){var t=e.instance;y.trace("double click","x: "+e.cursor.x+", y: "+e.cursor.y+", instance: "+(t?t.id:"")+", tooltip: "+(t?t.tooltip:""),C);this._propagateDoubleClick(e)};D.prototype._handleContextMenu=function(e){var t=e.instance;if(!t){e.voGroupId="Scene"}y.trace("context menu","x: "+e.cursor.x+", y: "+e.cursor.y+", instance: "+(t?t.id:"")+", tooltip: "+(t?t.tooltip:""),C);this._propagateContextMenu(e)};D.prototype._handleHover=function(e){var t;var i=e.instance||null;y.trace("hover","x: "+e.cursor.x+", y: "+e.cursor.y+", instance: "+(i?i.id:"")+", tooltip: "+(i?i.tooltip:""),C);if(i){t=i.tooltip;if(!t){t=i.text}}var o=this._viewport.getDomRef();if(o){if(t){o.setAttribute("title",t)}else{o.removeAttribute("title")}}if(i!==this._hoverInstance){clearTimeout(this._hoverTimeOutId);this._hoverTimeOutId=setTimeout(function(){this._propogateHoverChange(e);this._hoverTimeOutId=undefined}.bind(this),500);this._hoverInstance=i;this._sceneBuilder.updateHotInstance(this._hoverInstance)}};D.prototype._handleKeyPress=function(e){y.trace("keypress",e.key,C);this._propagateKeyPress(e)};D.prototype._getXY=function(e){var t=this._viewport.getDomRef().getBoundingClientRect();return{x:(e.pageX||e.originalEvent.pageX)-window.pageXOffset-t.left,y:(e.pageY||e.originalEvent.pageY)-window.pageYOffset-t.top}};D.prototype._hitTest=function(e){var t=this._viewport.getScene();var i=this._viewport.getCamera();var o=e.cursor||this._getXY(e);var n=this._viewport.getDomRef().getBoundingClientRect();var r=new g(o.x/n.width*2-1,-o.y/n.height*2+1);this._raycaster.layers.set(0);this._raycaster.setFromCamera(r,i);var s=this._raycaster.intersectObjects(t.children,true);if(s&&s.length>0){var a=s[0],c=a.object,l=null;if(c){if(c._instanceHitTest instanceof Function){l=c._instanceHitTest(a)}else{l=a.object._sapInstance}return{info:a,point:a.point,instance:l}}}else if(this._context.scene){s=this._viewport._intersectMapPlane(this._raycaster);if(s&&s.length>0){return{instance:null,info:s[0],point:s[0].point}}}return undefined};D.prototype._extendEventWithCursor=function(e){e.cursor=e.cursor||this._getXY(e)};D.prototype._extendEventWithInstance=function(e){this._extendEventWithCursor(e);var t=this._hitTest(e);if(t){e.instance=t.instance;e.hitPoint=t.point}else{e.instance=null}};var I=3;A={onkeydown:function(e){if(!e.originalEvent.repeat){this._handleKeyPress(e)}},oncontextmenu:function(e){this._extendEventWithInstance(e);if(this._skipClick){this._skipClick=false;this._handleHover(e)}else{this._handleContextMenu(e)}},onmousedown:function(e){if(this._hoverTimeOutId){clearTimeout(this._hoverTimeOutId);this._hoverTimeOutId=null}this._mouseDown=true;this._extendEventWithCursor(e);y.trace("mousedown","x: "+e.cursor.x+", y: "+e.cursor.y,C);this._lastXY.x=e.cursor.x;this._lastXY.y=e.cursor.y},onmouseup:function(e){this._mouseDown=false},onhover:function(e){if(this._mouseDown){this._extendEventWithCursor(e);y.trace("hover","x: "+e.cursor.x+", y: "+e.cursor.y,C);if(Math.abs(this._lastXY.x-e.cursor.x)>I||Math.abs(this._lastXY.y-e.cursor.y)>I){this._skipClick=true}}else{this._extendEventWithInstance(e);this._handleHover(e)}},onmouseout:function(e){this._extendEventWithInstance(e);delete e.instance;this._handleHover(e)},onBeforeRendering:function(e){if(this._onhoverProxy){this._viewport.$().off("wheel",this._onhoverProxy);this._viewport.$().off(sap.ui.Device.browser.msie||sap.ui.Device.browser.edge?"pointermove":"mousemove",this._onhoverProxy)}if(this._onpointerdownProxy){this._viewport.$().off("pointerdown",this._onpointerdownProxy)}if(this._onpointerupProxy){this._viewport.$().off("pointerup",this._onpointerupProxy)}},onAfterRendering:function(e){if(!this._onhoverProxy){this._onhoverProxy=A.onhover.bind(this)}this._viewport.$().on("wheel",this._onhoverProxy);this._viewport.$().on(sap.ui.Device.browser.msie||sap.ui.Device.browser.edge?"pointermove":"mousemove",this._onhoverProxy);if(sap.ui.Device.browser.msie||sap.ui.Device.browser.edge){if(!this._onpointerdownProxy){this._onpointerdownProxy=A.onmousedown.bind(this)}this._viewport.$().on("pointerdown",this._onpointerdownProxy);if(!this._onpointerupProxy){this._onpointerupProxy=A.onmouseup.bind(this)}this._viewport.$().on("pointerup",this._onpointerupProxy)}if(this._detail.anchor){this._viewport.getDomRef().appendChild(this._detail.anchor)}this._openDetailPending()}};A[sap.ui.Device.browser.msie||sap.ui.Device.browser.edge?"onclick":"ontap"]=function(e){y.trace("onclick","",C);this._extendEventWithInstance(e);if(this._skipClick){this._skipClick=false;this._handleHover(e)}else if(this._clickTimerId){clearTimeout(this._clickTimerId);this._clickTimerId=null;this._handleDoubleClick(e)}else{this._clickTimerId=setTimeout(function(){this._clickTimerId=null;this._handleClick(e)}.bind(this),200)}};var P=sap.ui.Device.os.macintosh?"metaKey":"ctrlKey";D.prototype._extendEventWithSelection=function(e){var t=e.instance;if(t){if(e.originalEvent.type==="click"){if(!(e[P]&&e.shiftKey)){var i;var o;if(e[P]){i="toggle";o=false}else if(e.shiftKey){i="select";o=false}else{i="select";o=true}e.selectionChanges=this._changeSelection(t,i,o)}}else{e.selectionChanges=this._changeSelection(t,"toggle",false)}}};D.prototype._changeSelection=function(e,t,i){var o=[];var n=[];var r=e.voGroup;var s=b(e["VB:s"]);var a;if(t==="select"){if(r.maxSel!=="0"){if(s){if(i){a=r.selected.indexOf(e);n=r.selected.splice(a+1).concat(r.selected.splice(0,a))}}else{if(i||r.maxSel==="1"){n=r.selected.splice(0)}r.selected.push(e);o=[e]}}}else if(t==="toggle"){if(s){if(r.minSel==="0"||r.selected.length>1){a=r.selected.indexOf(e);n=r.selected.splice(a,1)}}else if(r.maxSel!=="0"){if(r.maxSel==="1"){n=r.selected.splice(0)}r.selected.push(e);o=[e]}}o.forEach(function(e){e["VB:s"]="true"});n.forEach(function(e){e["VB:s"]="false"});return{selected:o,deselected:n}};return D});
/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5) (c) Copyright 2009-2012 SAP AG. All rights reserved
 */
sap.ui.predefine("sap/ui/vbm/AnalyticMap", ["./GeoMap","./VoBase","sap/ui/core/theming/Parameters","jquery.sap.global","sap/base/Log","./library","./AnalyticMapRenderer"],function(e,t,i,jQuery,o,r,n){"use strict";var a=e.extend("sap.ui.vbm.AnalyticMap",{metadata:{library:"sap.ui.vbm",properties:{},aggregations:{regions:{type:"sap.ui.vbm.Region",multiple:true,singularName:"region"}},events:{regionClick:{parameters:{code:{type:"string"}}},regionContextMenu:{parameters:{code:{type:"string"}}},regionSelect:{},regionDeselect:{}}},renderer:n});a.DefaultABAPGeoJSONURL="/sap/bc/vbi/geojson/L0.json";a.DefaultGeoJSONURL="media/analyticmap/L0.json";a.DefaultRegionColor=i&&i.get("_sap_ui_vbm_shared_ChoroplethRegionBG")?i.get("_sap_ui_vbm_shared_ChoroplethRegionBG"):"rgb(213,218,221)";a.DefaultRegionColorBorder=i&&i.get("_sap_ui_vbm_shared_ChoroplethRegionBorder")?i.get("_sap_ui_vbm_shared_ChoroplethRegionBorder"):"rgb(255,255,255)";a.DefaultRegionSelectColor="RHLSA(0;1;1;1)";a.DefaultHotDeltaColor="RHLSA(0;1;1;1.0)";a.AltBorderColor=i&&i.get("_sap_ui_vbm_shared_ChartDataPointBorderHoverSelectedColor")?i.get("_sap_ui_vbm_shared_ChartDataPointBorderHoverSelectedColor"):"#676767";var s=i&&i.get("_sap_ui_vbm_shared_ChartDataPointNotSelectedBackgroundOpacity")?i.get("_sap_ui_vbm_shared_ChartDataPointNotSelectedBackgroundOpacity"):"0.6";a.DefaultRegionNonSelectColor="RHLSA(0;1;1;"+s+")";a.prototype.exit=function(){e.prototype.exit.apply(this,arguments);this.detachEvent("submit",a.prototype.onAnalyticsSubmit,this)};a.prototype.onAfterRendering=function(){sap.ui.vbm.VBI.prototype.onAfterRendering.apply(this,arguments)};a.prototype.destroyRegions=function(){this.mbRegionsDirty=true;this.destroyAggregation("regions")};a.prototype.addRegion=function(e){this.mbRegionsDirty=true;this.addAggregation("regions",e)};a.prototype.removeRegion=function(e){this.mbRegionsDirty=true;this.removeAggregation("regions",e)};a.prototype.insertRegion=function(e,t){this.mbRegionsDirty=true;this.insertAggregation("regions",e,t)};a.prototype.removeAllRegions=function(){this.mbRegionsDirty=true;this.removeAllAggregation("regions")};a.prototype.destroyLegend=function(){this.mbLegendDirty=true;this.destroyAggregation("legend")};a.prototype.setLegend=function(e){this.mbLegendDirty=true;this.setAggregation("legend",e)};a.prototype.onAnalyticsSubmit=function(e){var t=JSON.parse(e.mParameters.data);var i,o,r;switch(t.Action.name){case"RGN_CONTEXTMENU":i=t.Action.instance.split(".")[1];r={code:i};if(o=this.findRegionInAggregation(i)){o.fireContextMenu(r)}this.fireRegionContextMenu(r);break;case"RGN_CLICK":i=t.Action.instance.split(".")[1];r={code:i};if(o=this.findRegionInAggregation(i)){o.fireClick(r)}this.fireRegionClick(r);if(t.Data&&t.Data.Merge){this.setSelectionPropFireSelect(t.Data.Merge)}break;default:break}};a.prototype.init=function(){this.mProperties.scaleVisible=false;e.prototype.init.apply(this,arguments);this.mbRegionsDirty=false;this.mbLegendDirty=false;this.mbThemingDirty=true;this.attachEvent("submit",a.prototype.onAnalyticsSubmit,this);this.createRegions()};a.prototype.createRegions=function(){var e=this.mColC=a.DefaultRegionColor;var t=this.mColCB=a.DefaultRegionColorBorder;function i(e,t,i,o,r,n,s,l){var g={};g.K=e;g.P=[];g.T=n;g.C=o;g.CB=r;g.HDC=a.DefaultHotDeltaColor;g.ACB=g.CB;g.G=s;g.S="false";g.XA=l;var p,h,u;for(var f=0,c=t.length;f<c;++f){h=t[f];u=[];for(var d=0,m=h.length;d<m;++d){p="";for(var y=0,C=h[d].length;y<C;++y){if(y){p+=";"}p+=h[d][y]}u.push(p)}g.P.push(u)}return g}var r=null,n=[],s,l="";n[0]=a.GeoJSONURL;var g=window.URI(a.DefaultABAPGeoJSONURL);g.addQuery("sap-language",sap.ui.getCore().getConfiguration().getLanguage());n[1]=g.toString();n[2]=sap.ui.resource("sap.ui.vbm",a.DefaultGeoJSONURL);for(var p=0;p<3;++p){l=n[p];if(!r&&l){s=jQuery.sap.syncGetJSON(l);if(s.statusCode===200&&s.data&&!s.error){r=s.data;break}}}if(!r){o.error("The GeoJSON file is invalid or could not be parsed.\r\nPlease contact your Administrator.",l,"sap.ui.vbm.AnalyticMap");return}var h=[];this.mRegionApplicationTable=h;this.mRegionBox=[];this.mNames=[];this.mRegionProps=[];var u,f,c,d;var m=r.features,y="",C;var b;var R;var v;for(var B=0,A=m.length;B<A;++B){C=[];R=[];v=[];b=[];var L=m[B];if(L.id2==="AQ"){continue}if(!L.id2){L.id2=L.id}if(L.properties&&L.properties.name){y=L.properties.name}else if(L.properties&&L.properties.NAME){y=L.properties.NAME}else{y=""}this.mNames[L.id2]=y;this.mRegionProps[L.id2]=L.properties;var _=L.geometry.coordinates;var S,D,M,T,P;var N,I;switch(L.geometry.type){case"Polygon":c=Number.MAX_VALUE;d=-Number.MAX_VALUE;u=Number.MAX_VALUE;f=-Number.MAX_VALUE;P=_.length;for(N=0;N<P;++N){S=_[N];C=[];for(I=0;I<S.length;++I){T=S[I];if(!N){if((D=T[0])<u){u=D}if(D>f){f=D}if((M=T[1])<c){c=M}if(M>d){d=M}}C.push(T[0],T[1],"0")}v.push(C)}R.push(v);b.push([u,f,c,d]);break;case"MultiPolygon":for(var G=0,V=_.length;G<V;++G){c=Number.MAX_VALUE;d=-Number.MAX_VALUE;u=Number.MAX_VALUE;f=-Number.MAX_VALUE;v=[];P=_[G].length;for(N=0;N<P;++N){S=_[G][N];C=[];for(I=0;I<S.length;++I){T=S[I];if(!N){if((D=T[0])<u){u=D}if(D>f){f=D}if((M=T[1])<c){c=M}if(M>d){d=M}}C.push(T[0],T[1],"0")}v.push(C)}b.push([u,f,c,d]);R.push(v)}break;default:continue}h.push(i(L.id2,R,L.geometry.type,e,t,y,L.id2,b));this.mRegionBox[L.id2]=window.VBI.MathLib.GetSurroundingBox(b)}};a.prototype.getRegionsTemplateObject=function(){return{id:"Region",type:"{00100000-2012-0004-B001-F311DE491C77}","entity.bind":"Regions.Entity",datasource:"Regions","posarraymulti.bind":"Regions.PosList","color.bind":"Regions.Color",selectColor:a.DefaultRegionSelectColor,nonSelectColor:a.DefaultRegionNonSelectColor,"colorBorder.bind":"Regions.BorderColor","tooltip.bind":"Regions.ToolTip","hotDeltaColor.bind":"Regions.HotDeltaColor","altBorderDeltaColor.bind":"Regions.AltBorderColor","select.bind":"Regions.VB:s","labelText.bind":"Regions.LT","labelPos.bind":"Regions.LP","labelBgColor.bind":"Regions.LBC","labelBorderColor.bind":"Regions.LBBC","labelArrow.bind":"Regions.AR","labelType.bind":"Regions.LabelType"}};a.prototype.getRegionsTypeObject=function(){var e=[{name:"Key",alias:"K",type:"string"},{name:"PosList",alias:"P",type:"vectorarraymulti"},{name:"ToolTip",alias:"T",type:"string"},{name:"Color",alias:"C",type:"color"},{name:"BorderColor",alias:"CB",type:"color"},{name:"HotDeltaColor",alias:"HDC",type:"string"},{name:"AltBorderColor",alias:"ACB",type:"color"},{name:"Entity",alias:"G",type:"string"},{name:"VB:s",alias:"S",type:"boolean"},{name:"LT",alias:"LT",type:"string"},{name:"LP",alias:"LP",type:"string"},{name:"LBC",alias:"LBC",type:"color"},{name:"LBBC",alias:"LBBC",type:"color"},{name:"AR",alias:"AR",type:"boolean"},{name:"LabelType",alias:"LabelType",type:"string"}];return{name:"Regions",minSel:"0",maxSel:"-1",key:"Key",A:e}};a.prototype.getRegionsDataObjects=function(){var e=[];var i=[];var o=[];var r=[];jQuery.extend(true,e,this.mRegionApplicationTable);if(!e.length){return null}var n=this.getRegionMap();for(var s=0,l=e.length,g,p,h;s<l;++s){p=e[s];if(g=n[p.K]){p.HDC="RHLSA(0;1.0;1.0;0.4)";p.ACB=a.AltBorderColor;if(h=g.getColor()){p.C=this.getPlugin()?window.VBI.Utilities.String2VBColor(h):h}if(h=g.getTooltip()){p.T=h}p.LT=g.getLabelText();p.S=g.getSelect();p.LP="0";p.LBC=g.getLabelBgColor();p.LBBC=g.getLabelBorderColor();p.AR=g.getLabelArrow();var u=g.getLabelType();var f=t.prototype.getLabelProps(u);if(f&&p.LT){if(f.LBC){p.LBC=f.LBC}if(f.LBBC){p.LBBC=f.LBBC}if(f.LIC){p.LIC=f.LIC}if(f.LICC){p.LICC=f.LICC}if(f.LICTC){p.LICTC=f.LICTC}}if(!p.LBC){p.LBC="rgba(255,255,255,1.0)"}if(p.LBBC==""){p.LBBC=p.LBC}i.push(p)}else{o.push(p)}}r=o.concat(i);return{name:"Regions",type:"N",E:r}};a.prototype.addRegionsActions=function(e){e.push({id:"AMap1",name:"RGN_CLICK",refScene:"MainScene",refVO:"Region",refEvent:"Click"});e.push({id:"AMap2",name:"RGN_CONTEXTMENU",refScene:"MainScene",refVO:"Region",refEvent:"ContextMenu"});return e};a.prototype.findSelected=function(e,t){var i=this.getRegions();if(!i){return null}var o=[];if(jQuery.type(t)=="object"){if(t.S==(e?"true":"false")){for(var r=0;r<i.length;++r){if(i[r].sId==t.K){o.push(i[r])}}}}else if(jQuery.type(t)=="array"){for(var n=0;n<t.length;++n){if(t[n].S==(e?"true":"false")){for(var a=0;a<i.length;++a){if(i[a].mProperties.code===t[n].K){o.push(i[a])}}}}}return o};a.prototype.setSelectionPropFireSelect=function(t){var i={};i.N=[];var o=t.N;for(var r=0;r<o.length;++r){var n=o[r];var a=n.E;var s,l;var g=false;if(n.name=="Regions"){s=[];l=[];var p=this.getRegionMap();for(var h=0;h<a.length;++h){var u=a[h];var f=u.S=="true"?true:false;var c=p[u.K];if(c){var d=c.getSelect();if(f!=d){c.setProperty("select",f,true);if(f&&this.mEventRegistry["regionSelect"]){s.push(c)}else if(!f&&this.mEventRegistry["regionDeselect"]){l.push(c)}}}else{g=true}}if(l.length){this.fireRegionDeselect({deselected:l})}if(s.length){this.fireRegionSelect({selected:s})}if(g){this.invalidate();this.mbForceDataUpdate=true}}else{i.N.push(n)}}if(i.N.length){e.prototype.setSelectionPropFireSelect.call(this,i)}};a.prototype.getSelectedItems=function(e){var t=[];if(!e){return null}for(var i=0;i<e.length;++i){if(e[i].name==="Regions"){var o=this.findSelected(true,e[i].E);if(o&&o.length){t=t.concat(o)}}else{var r=this.getAggregatorContainer(e[i].name);var n=r.findSelected(true,e[i].E);if(n&&n.length){t=t.concat(n)}}}return t};a.prototype.findRegionInAggregation=function(e){var t=this.getRegions();if(t){for(var i=0,o=t.length;i<o;++i){if(t[i].mProperties.code===e){return t[i]}}}return null};a.prototype.updateVOData=function(t,i,o,r,n){if(this.mbThemingDirty){this.applyTheming(this.mRegionApplicationTable)}t.push(this.getRegionsTemplateObject());r.push(this.getRegionsTypeObject());o.push({name:"Regions",type:"N"});i.push(this.getRegionsDataObjects());e.prototype.updateVOData.apply(this,arguments);this.addRegionsActions(n)};a.prototype.resetDirtyStates=function(){e.prototype.resetDirtyStates.apply(this,arguments);this.mbRegionsDirty=false};a.prototype.minimizeApp=function(t){e.prototype.minimizeApp.apply(this,arguments);var i,o;if(!this.getMapConfiguration()){(i=t)&&(i=i.SAPVB)&&(i=i.Scenes)&&((o=i.Set)||(o=i.Merge))&&(i=o.SceneGeo)&&i.refMapLayerStack&&(i.refMapLayerStack="")}return t};a.prototype.invalidate=function(t){if(t instanceof sap.ui.vbm.Region){this.mbRegionsDirty=true}e.prototype.invalidate.apply(this,arguments)};a.prototype.getRegionMap=function(){var e={};var t=this.getRegions();for(var i=0,o=t?t.length:0,r;i<o;++i){r=t[i];e[r.getCode()]=r}return e};a.prototype.zoomToRegions=function(e,t){if(t==undefined){t=.9999}var i=[];for(var o=0,r=e.length;o<r;++o){var n=this.mRegionBox[e[o]];if(n!=undefined){i.push(n)}}if(!i.length){return}var a=null;if(a=this.mVBIContext.GetMainScene()){a.ZoomToAreas(i,t)}};a.prototype.getRegionsInfo=function(e){var t=[];for(var i=0,r=e.length,n;i<r;++i){n=e[i];t[n]={};t[n].BBox=this.mRegionBox[n];t[n].Name=this.mNames[n];t[n].Properties=this.mRegionProps[n];t[n].Midpoint=[0,0];var a=this.mVBIContext.GetMainScene();if(a){var s=[];for(var l=0;l<this.mRegionApplicationTable.length;++l){if(this.mRegionApplicationTable[l].K===n){s=this.mRegionApplicationTable[l].XA;break}}if(s.length!=0){var g,p,h,u,f,c;if(s.length==1){g=s[0]}else{p=0;for(var d=0;d<s.length;++d){h=window.VBI.MathLib.DegToRad([s[d][0],s[d][2]]);u=window.VBI.MathLib.DegToRad([s[d][1],s[d][3]]);if(Math.abs(u[0]-h[0])>Math.PI)h[0]+=2*Math.PI;f=a.GetPointFromGeo(h,false);c=a.GetPointFromGeo(u,false);var m=Math.abs(c[0]-f[0])*Math.abs(c[1]-f[1])*.5;if(m>p){p=m;g=s[d]}}}if(g){h=window.VBI.MathLib.DegToRad([g[0],g[2]]);u=window.VBI.MathLib.DegToRad([g[1],g[3]]);if(Math.abs(u[0]-h[0])>Math.PI)h[0]+=2*Math.PI;f=a.GetPointFromGeo(h,false);c=a.GetPointFromGeo(u,false);var y=[(f[0]+c[0])*.5,(f[1]+c[1])*.5];t[n].Midpoint=window.VBI.MathLib.RadToDeg(a.GetGeoFromPoint(y))}else{o.error("Unable to calculate country mid point, box is empty",n,"sap.ui.vbm.AnalyticMap")}}else{o.error("Unable to calculate country mid point, region not found",n,"sap.ui.vbm.AnalyticMap")}}else{o.error("Unable to calculate country mid point, scene is empty",n,"sap.ui.vbm.AnalyticMap")}}return t};a.prototype.onThemeChanged=function(e){this.mbThemingDirty=true;this.invalidate()};a.prototype.applyTheming=function(e){if(sap.ui.core.theming&&i){var t=a.DefaultRegionColor;if(i.get("_sap_ui_vbm_shared_ChoroplethRegionBG")!=undefined){t=a.DefaultRegionColor=i.get("_sap_ui_vbm_shared_ChoroplethRegionBG")}var o=a.DefaultRegionColorBorder;if(i.get("_sap_ui_vbm_shared_ChoroplethRegionBorder")!=undefined){o=a.DefaultRegionColorBorder=i.get("_sap_ui_vbm_shared_ChoroplethRegionBorder")}if(this.getPlugin()){t=window.VBI.Utilities.String2VBColor(t);o=window.VBI.Utilities.String2VBColor(o)}if(t!=this.mColC||o!=this.mColCB){for(var r=0;r<e.length;++r){if(e[r].C===this.mColC){e[r].C=t}if(e[r].CB===this.mColCB){e[r].CB=o}}this.mColC=t;this.mColCB=o}this.mbThemingDirty=false}};a.prototype.isRegionSubscribed=function(e,t){if(t){var i=this.findRegionInAggregation(t);return i&&i.hasListeners(e)}return false};return a});
/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5) (c) Copyright 2009-2012 SAP AG. All rights reserved
 */
sap.ui.predefine("sap/ui/vbm/AnalyticMapRenderer", ["./GeoMapRenderer"],function(e){"use strict";var r={apiVersion:2};r.render=function(r,n){n.addStyleClass("sapUiVbmAnalyticMap");e.render(r,n)};return r},true);
/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5) (c) Copyright 2009-2012 SAP AG. All rights reserved
 */
sap.ui.predefine("sap/ui/vbm/Area", ["./VoBase","sap/base/Log","./library"],function(e,t,i){"use strict";var o=e.extend("sap.ui.vbm.Area",{metadata:{library:"sap.ui.vbm",properties:{position:{type:"string",group:"Misc",defaultValue:null},color:{type:"string",group:"Misc",defaultValue:null},colorBorder:{type:"string",group:"Misc"},borderDash:{type:"string",group:"Misc"}},events:{edgeClick:{edge:{type:"int"}},edgeContextMenu:{edge:{type:"int"}}}}});o.prototype.openDetailWindow=function(e,t,i){this.oParent.openDetailWindow(this,{caption:e,offsetX:t,offsetY:i},true)};o.prototype.openContextMenu=function(e){this.oParent.openContextMenu("Area",this,e)};o.prototype.getDataElement=function(){var t=e.prototype.getDataElement.apply(this,arguments);var i=this.oParent.mBindInfo;if(i.C){t.C=this.getColor()}if(i.CB){var o=this.getColorBorder();if(o!=undefined&&o!=""){t.CB=o}}if(i.BD){var r=this.getBorderDash();if(r!=undefined&&r!=""){t.BD=r}}var n=this.getPosition();if(n.substring(0,1)==="["){n=n.replace(/\'/g,'"');t.PM=JSON.parse(n)}else{t.P=n}return t};o.prototype.handleChangedData=function(e){if(e.P){this.setPosition(e.P)}if(e.PM){t.error("Change of areas with multiple parts is not supported","","sap.ui.vbm.Area")}};return o});
/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5) (c) Copyright 2009-2012 SAP AG. All rights reserved
 */
sap.ui.predefine("sap/ui/vbm/Areas", ["./VoAggregation","sap/ui/unified/Menu","sap/base/Log","./library"],function(e,t,n,i){"use strict";var r="sap.ui.vbm.Areas";var a=e.extend("sap.ui.vbm.Areas",{metadata:{library:"sap.ui.vbm",properties:{posChangeable:{type:"boolean",group:"Misc",defaultValue:true}},defaultAggregation:"items",aggregations:{items:{type:"sap.ui.vbm.Area",multiple:true,singularName:"item"}},events:{edgeClick:{parameters:{instance:{type:"sap.ui.vbm.Area"},edge:{type:"int"}}},edgeContextMenu:{parameters:{instance:{type:"sap.ui.vbm.Area"},edge:{type:"int"}}}}}});a.prototype.getBindInfo=function(){var t=e.prototype.getBindInfo.apply(this,arguments);var n=this.getTemplateBindingInfo();t.C=n?n.hasOwnProperty("color"):true;t.CB=n?n.hasOwnProperty("colorBorder"):true;t.BD=n?n.hasOwnProperty("borderDash"):true;return t};a.prototype.getTemplateObject=function(){var t=e.prototype.getTemplateObject.apply(this,arguments);var i=this.mBindInfo=this.getBindInfo();var a=i.hasTemplate?this.getBindingInfo("items").template:null;t["type"]="{00100000-2012-0004-B001-F311DE491C77}";if(i.C){t["color.bind"]=t.id+".C"}else{t.color=a.getColor()}if(i.CB){t["colorBorder.bind"]=t.id+".CB"}else{t.colorBorder=a.getColorBorder()}if(i.BD){t["borderDash.bind"]=t.id+".BD"}else{t.borderDash=a.getBorderDash()}var s=this.getItems();if(s.length){if(s[0].getPosition().substring(0,1)==="["){t["posarraymulti.bind"]=t.id+".PM"}else{t["posarray.bind"]=t.id+".P"}}else{n.warning("items aggregation must not be empty!","",r)}return t};a.prototype.getTypeObject=function(){var t=e.prototype.getTypeObject.apply(this,arguments);var n=this.mBindInfo;var i=this.getPosChangeable().toString();t.A=t.A.concat([{changeable:i,name:"P",alias:"P",type:"vectorarray"},{changeable:i,name:"PM",alias:"PM",type:"vectorarraymulti"}]);if(n.C){t.A.push({name:"C",alias:"C",type:"color"})}if(n.CB){t.A.push({name:"CB",alias:"CB",type:"string"})}if(n.BD){t.A.push({name:"BD",alias:"BD",type:"string"})}return t};a.prototype.getActionArray=function(){var t=e.prototype.getActionArray.apply(this,arguments);var n=this.getId();if(this.mEventRegistry["click"]||this.isEventRegistered("click")){t.push({id:n+"1",name:"click",refScene:"MainScene",refVO:n,refEvent:"Click",AddActionProperty:[{name:"pos"}]})}if(this.mEventRegistry["contextMenu"]||this.isEventRegistered("contextMenu")){t.push({id:n+"2",name:"contextMenu",refScene:"MainScene",refVO:n,refEvent:"ContextMenu"})}if(this.mEventRegistry["drop"]||this.isEventRegistered("drop")){t.push({id:n+"3",name:"drop",refScene:"MainScene",refVO:n,refEvent:"Drop"})}if(this.mEventRegistry["edgeClick"]||this.isEventRegistered("edgeClick")){t.push({id:n+"7",name:"edgeClick",refScene:"MainScene",refVO:n,refEvent:"EdgeClick"})}if(this.mEventRegistry["edgeContextMenu"]||this.isEventRegistered("edgeContextMenu")){t.push({id:n+"8",name:"edgeContextMenu",refScene:"MainScene",refVO:n,refEvent:"EdgeContextMenu"})}return t};a.prototype.handleEvent=function(i){var a=i.Action.name;if(a=="edgeContextMenu"||a=="edgeClick"){var s="fire"+a[0].toUpperCase()+a.slice(1);var o;if(o=this.findInstance(i.Action.instance)){var p={data:i,edge:parseInt(i.Action.Params.Param["2"]["#"],10)};if(a=="edgeContextMenu"){o.mClickPos=[i.Action.Params.Param[0]["#"],i.Action.Params.Param[1]["#"]];if(this.oParent.mVBIContext.m_Menus){this.oParent.mVBIContext.m_Menus.deleteMenu("DynContextMenu")}var g=new t;g.vbi_data={};g.vbi_data.menuRef="CTM";g.vbi_data.VBIName="DynContextMenu";p.menu=g}if(o.mEventRegistry[a]){o[s](p)}if(this.mEventRegistry[a]){p.instance=o;this[s](p)}}else{n.error("Instance for event not found","",r)}}else{e.prototype.handleEvent.apply(this,arguments)}};return a});
/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5) (c) Copyright 2009-2012 SAP AG. All rights reserved
 */
sap.ui.predefine("sap/ui/vbm/Box", ["./VoBase","./library"],function(t,e){"use strict";var o=t.extend("sap.ui.vbm.Box",{metadata:{library:"sap.ui.vbm",properties:{position:{type:"string",group:"Misc",defaultValue:"0;0;0"},scale:{type:"string",group:"Misc",defaultValue:"1;1;1"},color:{type:"string",group:"Misc",defaultValue:"RGB(255;0;0)"},colorBorder:{type:"string",group:"Misc",defaultValue:"RGB(255;0;0)"}},events:{}}});o.prototype.openDetailWindow=function(t,e,o){this.oParent.openDetailWindow(this,{caption:t,offsetX:e,offsetY:o},true)};o.prototype.openContextMenu=function(t){this.oParent.openContextMenu("Box",this,t)};o.prototype.getDataElement=function(){var e=t.prototype.getDataElement.apply(this,arguments);var o=this.oParent.mBindInfo;if(o.P){e.P=this.getPosition()}if(o.S){e.S=this.getScale()}if(o.C){e.C=this.getColor()}if(o.CB){e.CB=this.getColorBorder()}return e};o.prototype.handleChangedData=function(t){if(t.P){this.setPosition(t.P)}if(t.S){this.setScale(t.S)}};return o});
/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5) (c) Copyright 2009-2012 SAP AG. All rights reserved
 */
sap.ui.predefine("sap/ui/vbm/Boxes", ["./VoAggregation","./library"],function(e,t){"use strict";var i=e.extend("sap.ui.vbm.Boxes",{metadata:{library:"sap.ui.vbm",properties:{posChangeable:{type:"boolean",group:"Misc",defaultValue:true},scaleChangeable:{type:"boolean",group:"Misc",defaultValue:true}},defaultAggregation:"items",aggregations:{items:{type:"sap.ui.vbm.Box",multiple:true,singularName:"item"}},events:{}}});i.prototype.getBindInfo=function(){var t=e.prototype.getBindInfo.apply(this,arguments);var i=this.getTemplateBindingInfo();t.C=i?i.hasOwnProperty("color"):true;t.CB=i?i.hasOwnProperty("colorBorder"):true;t.P=i?i.hasOwnProperty("position"):true;t.S=i?i.hasOwnProperty("scale"):true;return t};i.prototype.getTemplateObject=function(){var t=e.prototype.getTemplateObject.apply(this,arguments);var i=this.mBindInfo=this.getBindInfo();var r=i.hasTemplate?this.getBindingInfo("items").template:null;t["type"]="{00100000-2012-0004-B001-BFED458C3076}";if(i.P){t["pos.bind"]=t.id+".P"}else{t.pos=r.getPosition()}if(i.S){t["scale.bind"]=t.id+".S"}else{t.scale=r.getScale()}if(i.C){t["color.bind"]=t.id+".C"}else{t.color=r.getColor()}if(i.CB){t["colorBorder.bind"]=t.id+".CB"}else{t.colorBorder=r.getColorBorder()}return t};i.prototype.getTypeObject=function(){var t=e.prototype.getTypeObject.apply(this,arguments);var i=this.mBindInfo;if(i.P){t.A.push({changeable:this.getPosChangeable().toString(),name:"P",alias:"P",type:"vector"})}if(i.S){t.A.push({changeable:this.getScaleChangeable().toString(),name:"S",alias:"S",type:"vector"})}if(i.C){t.A.push({name:"C",alias:"C",type:"color"})}if(i.CB){t.A.push({name:"CB",alias:"CB",type:"color"})}return t};i.prototype.getActionArray=function(){var t=e.prototype.getActionArray.apply(this,arguments);var i=this.getId();if(this.mEventRegistry["click"]||this.isEventRegistered("click")){t.push({id:i+"1",name:"click",refScene:"MainScene",refVO:i,refEvent:"Click",AddActionProperty:[{name:"pos"}]})}if(this.mEventRegistry["contextMenu"]||this.isEventRegistered("contextMenu")){t.push({id:i+"2",name:"contextMenu",refScene:"MainScene",refVO:i,refEvent:"ContextMenu"})}if(this.mEventRegistry["drop"]||this.isEventRegistered("drop")){t.push({id:i+"3",name:"drop",refScene:"MainScene",refVO:i,refEvent:"Drop"})}return t};return i});
/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5) (c) Copyright 2009-2012 SAP AG. All rights reserved
 */
sap.ui.predefine("sap/ui/vbm/Circle", ["./VoBase","./library"],function(t,e){"use strict";var i=t.extend("sap.ui.vbm.Circle",{metadata:{library:"sap.ui.vbm",properties:{position:{type:"string",group:"Misc",defaultValue:"0;0;0"},radius:{type:"string",group:"Misc",defaultValue:"20"},color:{type:"string",group:"Misc",defaultValue:"RGBA(0,0,128,128)"},colorBorder:{type:"string",group:"Misc",defaultValue:"RGB(0,0,0)"},slices:{type:"string",group:"Misc",defaultValue:null}},events:{}}});i.prototype.openContextMenu=function(t){this.oParent.openContextMenu("Circle",this,t)};i.prototype.getDataElement=function(){var e=t.prototype.getDataElement.apply(this,arguments);var i=this.oParent.mBindInfo;if(i.P){e.P=this.getPosition()}if(i.R){e.R=this.getRadius()}if(i.C){e.C=this.getColor()}if(i.CB){e.CB=this.getColorBorder()}if(i.NS){e.NS=this.getSlices()}return e};i.prototype.handleChangedData=function(t){if(t.P){this.setPosition(t.P)}if(t.R){this.setRadius(t.R)}};return i});
/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5) (c) Copyright 2009-2012 SAP AG. All rights reserved
 */
sap.ui.predefine("sap/ui/vbm/Circles", ["./VoAggregation","./library"],function(e,t){"use strict";var i=e.extend("sap.ui.vbm.Circles",{metadata:{library:"sap.ui.vbm",properties:{posChangeable:{type:"boolean",group:"Misc",defaultValue:true},radiusChangeable:{type:"boolean",group:"Misc",defaultValue:true}},defaultAggregation:"items",aggregations:{items:{type:"sap.ui.vbm.Circle",multiple:true,singularName:"item"}},events:{}}});i.prototype.getBindInfo=function(){var t=e.prototype.getBindInfo.apply(this,arguments);var i=this.getTemplateBindingInfo();t.C=i?i.hasOwnProperty("color"):true;t.CB=i?i.hasOwnProperty("colorBorder"):true;t.P=i?i.hasOwnProperty("position"):true;t.NS=i?i.hasOwnProperty("slices"):true;t.R=i?i.hasOwnProperty("radius"):true;return t};i.prototype.getTemplateObject=function(){var t=e.prototype.getTemplateObject.apply(this,arguments);var i=this.mBindInfo=this.getBindInfo();var r=i.hasTemplate?this.getBindingInfo("items").template:null;t["type"]="{00100000-2013-0004-B001-7EB3CCC039C4}";if(i.P){t["pos.bind"]=t.id+".P"}else{t.pos=r.getPosition()}if(i.NS){t["slices.bind"]=t.id+".NS"}else{t.slices=r.getSlices()}if(i.C){t["color.bind"]=t.id+".C"}else{t.color=r.getColor()}if(i.CB){t["colorBorder.bind"]=t.id+".CB"}else{t.colorBorder=r.getColorBorder()}if(i.R){t["radius.bind"]=t.id+".R"}else{t.radius=r.getRadius()}return t};i.prototype.getTypeObject=function(){var t=e.prototype.getTypeObject.apply(this,arguments);var i=this.mBindInfo;if(i.P){t.A.push({changeable:this.getPosChangeable().toString(),name:"P",alias:"P",type:"vector"})}if(i.R){t.A.push({changeable:this.getRadiusChangeable().toString(),name:"R",alias:"R",type:"double"})}if(i.C){t.A.push({name:"C",alias:"C",type:"color"})}if(i.CB){t.A.push({name:"CB",alias:"CB",type:"color"})}if(i.NS){t.A.push({name:"NS",alias:"NS",type:"long"})}return t};i.prototype.getActionArray=function(){var t=e.prototype.getActionArray.apply(this,arguments);var i=this.getId();if(this.mEventRegistry["click"]||this.isEventRegistered("click")){t.push({id:i+"1",name:"click",refScene:"MainScene",refVO:i,refEvent:"Click",AddActionProperty:[{name:"pos"}]})}if(this.mEventRegistry["contextMenu"]||this.isEventRegistered("contextMenu")){t.push({id:i+"2",name:"contextMenu",refScene:"MainScene",refVO:i,refEvent:"ContextMenu"})}if(this.mEventRegistry["drop"]||this.isEventRegistered("drop")){t.push({id:i+"3",name:"drop",refScene:"MainScene",refVO:i,refEvent:"Drop"})}return t};return i});
/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5) (c) Copyright 2009-2012 SAP AG. All rights reserved
 */
sap.ui.predefine("sap/ui/vbm/Cluster", ["sap/ui/core/Control","jquery.sap.global","./library","./ClusterRenderer"],function(e,jQuery,t,r){"use strict";var o=e.extend("sap.ui.vbm.Cluster",{metadata:{library:"sap.ui.vbm",properties:{color:{type:"sap.ui.core.CSSColor",group:"Misc",defaultValue:null},icon:{type:"string",group:"Misc",defaultValue:null},text:{type:"string",group:"Misc",defaultValue:null},type:{type:"sap.ui.vbm.SemanticType",group:"Behavior",defaultValue:sap.ui.vbm.SemanticType.None}}},renderer:r});o.prototype.exit=function(){};o.prototype.init=function(){};o.prototype.onAfterRendering=function(){if(this.$oldContent.length>0){this.$().append(this.$oldContent)}if(this.getColor()&&this.getType()===sap.ui.vbm.SemanticType.None){var e=this.getId()+"-"+"backgroundcircle",t=e+"-"+"innercircle";var r=document.getElementById(e),o=document.getElementById(t);var n=jQuery(r).css("border-bottom-color");var i=this.string2rgba(n);i="rgba("+i[0]+","+i[1]+","+i[2]+","+.5+")";r.style.borderColor=i;o.style.borderColor=i}};o.prototype.onBeforeRendering=function(){this.$oldContent=sap.ui.core.RenderManager.findPreservedContent(this.getId())};o.prototype.string2rgba=function(e){var t;if(t=/^rgb\(([\d]+)[,;]\s*([\d]+)[,;]\s*([\d]+)\)/.exec(e)){return[+t[1],+t[2],+t[3],1,0]}else{return[94,105,110]}};return o});
/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5) (c) Copyright 2009-2012 SAP AG. All rights reserved
 */
sap.ui.predefine("sap/ui/vbm/ClusterBase", ["sap/ui/core/Element","sap/ui/core/theming/Parameters","./ClusterContainer","sap/ui/unified/Menu","jquery.sap.global","sap/base/Log","./library"],function(e,t,r,n,jQuery,i,a){"use strict";var o="sap.ui.vbm.ClusterBase";var s=e.extend("sap.ui.vbm.ClusterBase",{metadata:{library:"sap.ui.vbm",properties:{areaAlwaysVisible:{type:"boolean",group:"Appearance",defaultValue:false},areaColor:{type:"sap.ui.core.CSSColor",group:"Appearance",defaultValue:"rgba(200,0,0,0.2)"},areaColorBorder:{type:"sap.ui.core.CSSColor",group:"Appearance",defaultValue:"rgba(220,220,220,0.5)"},textProperty:{type:"string",group:"Misc",defaultValue:"text"},textSettings:{type:"object",group:"Appearance"},rule:{type:"string",group:"Misc",defaultValue:null}},defaultAggregation:"vizTemplate",aggregations:{vizTemplate:{type:"sap.ui.core.Control",multiple:false},vizVo:{type:"sap.ui.vbm.Spot",multiple:false},clusterVos:{type:"sap.ui.core.Control",multiple:true,visibility:"hidden",singularName:"clusterVo"},clusterContainers:{type:"sap.ui.vbm.ClusterContainer",multiple:true,visibility:"hidden",singularName:"clusterContainer"}},events:{click:{parameters:{clusterID:{type:"string"}}},contextMenu:{parameters:{clusterID:{type:"string"},menu:{type:"sap.ui.unified.Menu"}}}}}});s.prototype.openDetailWindow=function(e,t){var r=this.getParent();r.mDTWindowCxt.bUseClickPos=true;r.mDTWindowCxt.open=true;r.mDTWindowCxt.src=e;r.mDTWindowCxt.key=e.getKey();r.mDTWindowCxt.params=t;r.m_bWindowsDirty=true;r.invalidate()};s.prototype.openContextMenu=function(e,t,r){this.oParent.openContextMenu(e,t,r)};s.prototype.init=function(){this.mVizObjMap={};this.mContObjMap={};var e=t.get("sapUiFontFamily");this.setProperty("textSettings",{textcolor:"#000000",textfont:e?e:"Arial, Helvetica, sans-serif",textfontsize:"10"},true)};s.prototype.exit=function(){this.mVizObjMap=null;this.mContObjMap=null;if(this.oSpotAggr){this.oSpotAggr.destroy();this.oSpotAggr=null}};s.prototype.setTextSettings=function(e){var t=this.getTextSettings();jQuery.extend(t,e);return this.setProperty("textSettings",t)};s.prototype.getTemplateObject=function(){var e={};var t=this.getId();if(this.getVizTemplate()){e={id:t,type:"{00100000-2012-0004-B001-2297943F0CE6}",datasource:t}}else if(this.getVizVo()){this.oSpotAggr=new sap.ui.vbm.Spots({items:{path:"/",template:this.getVizVo()}});e=this.oSpotAggr.getTemplateObject();e.id=t}else{i.error("No visualization object given for cluster","",o)}return e};s.prototype.getActionArray=function(){if(this.oSpotAggr){var e=this.oSpotAggr.getActionArray(true);for(var t=0;t<e.length;++t){e[t].refVO=this.getId()}return e}else{return[]}};s.prototype.getClusterDefinition=function(){return jQuery.extend(this.getTextSettings(),{id:this.getId(),VO:this.getId(),rule:this.getRule(),areapermanent:this.getAreaAlwaysVisible().toString(),areabordersize:"2",areafillcol:this.getAreaColor(),areabordercol:this.getAreaColorBorder()})};s.prototype.handleContainerCreated=function(e){var t=e.mParameters.id;var r=this._getVizObjInst(t);if(r){var n=this.getParent().getInfoForCluster(t,sap.ui.vbm.ClusterInfoType.NodeInfo);if(!r.getBindingInfo("text")){r.setProperty(this.getTextProperty(),n.cnt.toString(),true)}if(!this.oDOMHandler){this.oDOMHander=new s._DOMHandler(this)}var i=e.getParameter("contentarea");i.addEventListener("click",this.oDOMHander);i.addEventListener("contextmenu",this.oDOMHander);i.addEventListener("touchstart",this.oDOMHander);i.addEventListener("touchend",this.oDOMHander);i.addEventListener("touchcancel",this.oDOMHander);var a;if(a=this.getParent()){var o=i.id;a.addRenderItem(r,o)}}};s.prototype.handleContainerDestroyed=function(e){var t=e.getParameter("contentarea");t.removeEventListener("click",this.oDOMHander);t.removeEventListener("contextmenu",this.oDOMHander);t.removeEventListener("touchstart",this.oDOMHander);t.removeEventListener("touchend",this.oDOMHander);t.removeEventListener("touchcancel",this.oDOMHander);this._removeVizObjInst(e.mParameters.id)};s.prototype.handleEvent=function(e){var t=e.Action.name;var r="fire"+t[0].toUpperCase()+t.slice(1);var a;if(a=this.getVizVo()){var s={data:e};var u=this.getParent().getInfoForCluster(e.Action.instance,sap.ui.vbm.ClusterInfoType.NodeInfo);a.setProperty("key",e.Action.instance,true);a.setProperty("position",u.pos[0]+";"+u.pos[1]+";0",true);switch(t){case"click":a.mClickGeoPos=e.Action.AddActionProperties.AddActionProperty[0]["#"];break;case"contextMenu":a.mClickPos=[e.Action.Params.Param[0]["#"],e.Action.Params.Param[1]["#"]];if(this.oParent.mVBIContext.m_Menus){this.oParent.mVBIContext.m_Menus.deleteMenu("DynContextMenu")}var p=new n;p.vbi_data={};p.vbi_data.menuRef="CTM";p.vbi_data.VBIName="DynContextMenu";s.menu=p;break;case"drop":var l=e.Action.Params.Param[0]["#"].split("|");var c=l[1];var g=l[2].split(".")[1];var h=this.getParent().getAggregatorContainer(c).findInstanceByKey(g);s.oDragSource=h;break;default:break}a[r](s);s.instance=a;this[r](s)}else{i.error("Instance for event not found","",o)}};s.prototype.findInstance=function(e){if(this.oSpotAggr){return this.getVizVo()}else{return this._getContainer(e)}};s.prototype._getVizObjInst=function(e){var t=this.mVizObjMap[e];if(!t){var r=this.getVizTemplate();if(r){t=this.mVizObjMap[e]=r.clone();t.mClusterId=e;this.addAggregation("clusterVos",t,true)}}return t};s.prototype._removeVizObjInst=function(e){var t=this.mVizObjMap[e];if(t){this.removeAggregation("clusterVos",t,true);this.mVizObjMap[e]=null}};s.prototype._getContainer=function(e){var t=this.mContObjMap[e];if(!t){t=this.mContObjMap[e]=new r({key:e});if(!this.oSpotAggr){t.setItem(this._getVizObjInst(e))}this.addAggregation("clusterContainers",t,true)}return t};s.prototype._removeContainer=function(e){var t=this.mContObjMap[e];if(t){this.removeAggregation("clusterContainers",t,true);this.mContObjMap[e]=null}};s.prototype._handleDOMEvent=function(e){var t=e.currentTarget.m_Key;var r=this.parent._getContainer(t);switch(e.type){case"click":this.parent.fireClick({instance:r,event:e});break;case"contextmenu":this.parent._onContextMenu(e,r);break;case"touchstart":r.touch=true;r.touchTime=Date.now();break;case"touchend":if(r.touch){r.touch=false;var n=(Date.now()-r.touchTime)/1e3;if(n<1){this.parent.fireClick({instance:r,event:e})}else{this.parent._onContextMenu(e,r)}}break;case"touch cancel":r.touch=false;break;default:break}};s.prototype._onContextMenu=function(e,t){var r={};var i=this.oParent.getDomRef();t.mClickPos=[e.clientX-i.offsetLeft,e.clientY-i.offsetTop];try{if(this.oParent.mVBIContext.m_Menus){this.oParent.mVBIContext.m_Menus.deleteMenu("DynContextMenu")}var a=new n;a.vbi_data={};a.vbi_data.menuRef="CTM";a.vbi_data.VBIName="DynContextMenu";r.menu=a;e.preventDefault();r.instance=t;r.event=e;this.fireContextMenu(r)}catch(e){}};s._DOMHandler=function(e){this.parent=e;this.handleEvent=e._handleDOMEvent;return this};return s});
/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5) (c) Copyright 2009-2012 SAP AG. All rights reserved
 */
sap.ui.predefine("sap/ui/vbm/ClusterContainer", ["./Container","./library"],function(t,e){"use strict";var n=t.extend("sap.ui.vbm.ClusterContainer",{metadata:{library:"sap.ui.vbm",properties:{},aggregations:{},events:{}}});n.prototype.init=function(){this._oItem=null};n.prototype.getPosition=function(){var t=this.getParent().getParent();var e=t.getInfoForCluster(this.getKey(),sap.ui.vbm.ClusterInfoType.NodeInfo);return e.pos[0]+";"+e.pos[1]+";0"};n.prototype.setPosition=function(){};n.prototype.getAlignment=function(){return 0};n.prototype.setAlignment=function(){};n.prototype.getItem=function(){return this._oItem};n.prototype.setItem=function(t){this._oItem=t;return this};n.prototype.getDataElement=function(){};n.prototype.handleChangedData=function(t){};return n});
/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5) (c) Copyright 2009-2012 SAP AG. All rights reserved
 */
sap.ui.predefine("sap/ui/vbm/ClusterDistance", ["./ClusterBase","./library"],function(t,e){"use strict";var i=t.extend("sap.ui.vbm.ClusterDistance",{metadata:{library:"sap.ui.vbm",properties:{distance:{type:"int",group:"Behavior",defaultValue:"128"}},aggregations:{},events:{}}});i.prototype.getClusterDefinition=function(){var e=t.prototype.getClusterDefinition.apply(this,arguments);e.type="distance";e.distance=this.getDistance().toString();return e};return i});
/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5) (c) Copyright 2009-2012 SAP AG. All rights reserved
 */
sap.ui.predefine("sap/ui/vbm/ClusterGrid", ["./ClusterBase","./library"],function(t,e){"use strict";var i=t.extend("sap.ui.vbm.ClusterGrid",{metadata:{library:"sap.ui.vbm",properties:{gridSize:{type:"string",group:"Behavior",defaultValue:"256;256"},limit:{type:"int",group:"Behavior",defaultValue:2},limitTotal:{type:"int",group:"Behavior",defaultValue:2},orderIndex:{type:"int",group:"Behavior",defaultValue:null},offset:{type:"string",group:"Appearance",defaultValue:"0;0"},cellSpacing:{type:"int",group:"Appearance",defaultValue:"4"}},aggregations:{},events:{}}});i.prototype.getClusterDefinition=function(){var e=t.prototype.getClusterDefinition.apply(this,arguments);e.type="grid";e.limit=this.getLimit().toString();e.limitOnSum=this.getLimitTotal().toString();e.order=this.getOrderIndex().toString();e.areabordersize=-this.getCellSpacing().toString();var i=this.getGridSize().split(";");e.distanceX=i[0];e.distanceY=i[1];var r=this.getOffset().split(";");e.offsetX=r[0];e.offsetY=r[1];return e};return i});
/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5) (c) Copyright 2009-2012 SAP AG. All rights reserved
 */
sap.ui.predefine("sap/ui/vbm/ClusterRenderer", ["sap/ui/core/IconPool"],function(e){"use strict";var i={apiVersion:2};i.render=function(i,s){i.openStart("div",s);i.attr("align","center");i.attr("role",sap.ui.core.AccessibleRole.Presentation);i.attr("tabindex","-1");i.class("sapUiVbicluster-main");i.openEnd();var r=s.getId()+"-"+"backgroundcircle";var t=r+"-"+"innercircle";var c=s.getColor();var a=s.getType();var n=s.getIcon();var o,l;if(n){l=e.getIconInfo(n)}else if(a==sap.ui.vbm.SemanticType.Error){l=e.getIconInfo("status-negative")}else if(a==sap.ui.vbm.SemanticType.Warning){l=e.getIconInfo("status-critical")}else if(a==sap.ui.vbm.SemanticType.Success){l=e.getIconInfo("status-positive")}else{l=e.getIconInfo("status-inactive")}if(l){o=l.content}var p,u,b,d;if(a==sap.ui.vbm.SemanticType.Error){p="sapUiVbicluster-backgroundcircle sapUiVbicluster-border-error";u="sapUiVbicluster-innercircle sapUiVbicluster-background-error";d="sapUiVbicluster-icon sapUiVbicluster-iconLight";b="sapUiVbicluster-textbox sapUiVbicluster-textbox-error"}else if(a==sap.ui.vbm.SemanticType.Warning){p="sapUiVbicluster-backgroundcircle sapUiVbicluster-border-warning";u="sapUiVbicluster-innercircle sapUiVbicluster-background-warning";d="sapUiVbicluster-icon sapUiVbicluster-iconLight";b="sapUiVbicluster-textbox sapUiVbicluster-textbox-warning"}else if(a==sap.ui.vbm.SemanticType.Success){p="sapUiVbicluster-backgroundcircle sapUiVbicluster-border-success";u="sapUiVbicluster-innercircle sapUiVbicluster-background-success sapUiVbicluster-inner-light";d="sapUiVbicluster-icon sapUiVbicluster-iconSuccess";b="sapUiVbicluster-textbox sapUiVbicluster-textbox-success"}else if(a==sap.ui.vbm.SemanticType.None&&c){p="sapUiVbicluster-backgroundcircle";u="sapUiVbicluster-innercircle sapUiVbicluster-inner-light";d="sapUiVbicluster-icon";b="sapUiVbicluster-textbox"}else{p="sapUiVbicluster-backgroundcircle sapUiVbicluster-border-default";u="sapUiVbicluster-innercircle sapUiVbicluster-background-default sapUiVbicluster-inner-light";d="sapUiVbicluster-icon sapUiVbicluster-iconDefault";b="sapUiVbicluster-textbox sapUiVbicluster-textbox-default"}var V=sap.ui.core.AccessibleRole.Presentation;var U=sap.ui.core.AccessibleRole.Img;var v=sap.ui.core.AccessibleRole.Description;i.openStart("div",r);i.class(p);if(a==sap.ui.vbm.SemanticType.None&&c){i.style("border-color",c)}i.attr("role",V);i.openEnd();i.openStart("div",t);i.class(u);if(a==sap.ui.vbm.SemanticType.None&&c){i.style("border-color",c)}i.attr("role",V);i.openEnd();if(o){var g=s.getId()+"-"+"icon";i.openStart("span",g);i.class(d);if(a==sap.ui.vbm.SemanticType.None&&c){i.style("color",c)}i.attr("role",U);i.openEnd();i.text(o);i.close("span")}i.close("div");if(s.getText()){var f=s.getId()+"-"+"textbox";i.openStart("div",f);i.class(b);if(a==sap.ui.vbm.SemanticType.None&&c){i.style("border-color",c)}i.attr("role",v);i.openEnd();i.openStart("div");i.openEnd();i.text(s.getText());i.close("div");i.close("div")}i.close("div");i.close("div")};return i},true);
/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5) (c) Copyright 2009-2012 SAP AG. All rights reserved
 */
sap.ui.predefine("sap/ui/vbm/ClusterTree", ["./ClusterBase","./library"],function(t,e){"use strict";var r=t.extend("sap.ui.vbm.ClusterTree",{metadata:{library:"sap.ui.vbm",properties:{animateClusterSplit:{type:"boolean",group:"Behavior",defaultValue:true}},aggregations:{},events:{}}});r.prototype.getClusterDefinition=function(){var e=t.prototype.getClusterDefinition.apply(this,arguments);e.type="tree";e.animation=this.getAnimateClusterSplit().toString();return e};return r});
/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5) (c) Copyright 2009-2012 SAP AG. All rights reserved
 */
sap.ui.predefine("sap/ui/vbm/Container", ["./VoBase","./library"],function(t,e){"use strict";var n=t.extend("sap.ui.vbm.Container",{metadata:{library:"sap.ui.vbm",properties:{position:{type:"string",group:"Misc",defaultValue:null},alignment:{type:"string",group:"Misc",defaultValue:"0"}},aggregations:{item:{type:"sap.ui.core.Control",multiple:false}},events:{}}});n.prototype.openContextMenu=function(t){this.getParent().openContextMenu("Container",this,t)};n.prototype.getDataElement=function(){var e=t.prototype.getDataElement.apply(this,arguments);var n=this.oParent.mBindInfo;e.IK=this.getUniqueId();if(n.P){e.P=this.getPosition()}if(n.AL){e.AL=this.getAlignment()}return e};n.prototype.handleChangedData=function(t){if(t.P){this.setPosition(t.P)}};return n});
/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5) (c) Copyright 2009-2012 SAP AG. All rights reserved
 */
sap.ui.predefine("sap/ui/vbm/Containers", ["./VoAggregation","sap/ui/unified/Menu","./library"],function(e,t,n){"use strict";var i=e.extend("sap.ui.vbm.Containers",{metadata:{library:"sap.ui.vbm",defaultAggregation:"items",aggregations:{items:{type:"sap.ui.vbm.Container",multiple:true,singularName:"item"}},events:{}}});i.prototype.getBindInfo=function(){var t=e.prototype.getBindInfo.apply(this,arguments);var n=this.getTemplateBindingInfo();t.P=n?n.hasOwnProperty("position"):true;t.AL=n?n.hasOwnProperty("alignment"):true;return t};i.prototype.getTemplateObject=function(){var t=e.prototype.getTemplateObject.apply(this,arguments);var n=this.mBindInfo=this.getBindInfo();var i=n.hasTemplate?this.getBindingInfo("items").template:null;t["type"]="{00100000-2012-0004-B001-2297943F0CE6}";t["key.bind"]=t.id+".IK";if(n.P){t["pos.bind"]=t.id+".P"}else{t.pos=i.getPosition()}if(n.AL){t["alignment.bind"]=t.id+".AL"}else{t.alignment=i.getAlignment()}return t};i.prototype.getTypeObject=function(){var t=e.prototype.getTypeObject.apply(this,arguments);var n=this.mBindInfo;t.A.push({name:"IK",alias:"IK",type:"key"});if(n.P){t.A.push({changeable:"true",name:"P",alias:"P",type:"vector"})}if(n.AL){t.A.push({name:"AL",alias:"AL",type:"string"})}return t};i.prototype.getActionArray=function(){var t=e.prototype.getActionArray.apply(this,arguments);var n=this.getId();if(this.mEventRegistry["click"]||this.isEventRegistered("click")){t.push({id:n+"1",name:"click",refScene:"MainScene",refVO:n,refEvent:"Click",AddActionProperty:[{name:"pos"}]})}if(this.mEventRegistry["contextMenu"]||this.isEventRegistered("contextMenu")){t.push({id:n+"2",name:"contextMenu",refScene:"MainScene",refVO:n,refEvent:"ContextMenu"})}return t};i.prototype.handleContainerCreated=function(e){var t=this.findInstance(e.mParameters.id);var n=t.getItem();if(n){var i=e.getParameter("contentarea");i.addEventListener("click",this,false);i.addEventListener("contextmenu",this,false);var a;if(a=this.getParent()){var r=i.id;a.addRenderItem(n,r)}}};i.prototype.handleContainerDestroyed=function(e){var t=e.getParameter("contentarea");t.removeEventListener("click",this,false);t.removeEventListener("contextmenu",this,false)};i.prototype.findInstance=function(e){var t=this.getItems();if(!t){return false}for(var n=0,i=this.aUniqueIdx.length;n<i;++n){if(this.aUniqueIdx[n]===e){return t[n]}}return null};i.prototype.handleEvent=function(e){var n=e.currentTarget.m_Key;var i=this.findInstance(n);switch(e.type){case"click":i.fireClick();this.fireClick({instance:i});break;case"contextmenu":var a={};var r=this.oParent.getDomRef().getBoundingClientRect();i.mClickPos=[e.clientX-r.left,e.clientY-r.top];try{if(this.oParent.mVBIContext.m_Menus){this.oParent.mVBIContext.m_Menus.deleteMenu("DynContextMenu")}var s=new t;s.vbi_data={};s.vbi_data.menuRef="CTM";s.vbi_data.VBIName="DynContextMenu";a.menu=s;e.preventDefault();i.fireContextMenu(a);a.instance=i;this.fireContextMenu(a)}catch(e){}break}};return i});
/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5) (c) Copyright 2009-2012 SAP AG. All rights reserved
 */
sap.ui.predefine("sap/ui/vbm/DragSource", ["sap/ui/core/Element","./library"],function(e,r){"use strict";var a=e.extend("sap.ui.vbm.DragSource",{metadata:{library:"sap.ui.vbm",properties:{type:{type:"string",group:"Misc",defaultValue:null}}}});return a});
/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5) (c) Copyright 2009-2012 SAP AG. All rights reserved
 */
sap.ui.predefine("sap/ui/vbm/DropTarget", ["sap/ui/core/Element","./library"],function(e,r){"use strict";var t=e.extend("sap.ui.vbm.DropTarget",{metadata:{library:"sap.ui.vbm",properties:{type:{type:"string",group:"Misc",defaultValue:null}}}});return t});
/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5) (c) Copyright 2009-2012 SAP AG. All rights reserved
 */
sap.ui.predefine("sap/ui/vbm/Feature", ["sap/ui/core/Element","./library"],function(e,t){"use strict";var n=e.extend("sap.ui.vbm.Feature",{metadata:{library:"sap.ui.vbm",properties:{color:{type:"sap.ui.core.CSSColor",group:"Appearance",defaultValue:null},featureId:{type:"string",group:"Misc",defaultValue:null}},events:{click:{},contextMenu:{parameters:{menu:{type:"sap.ui.unified.Menu"}}}}}});n.prototype.openDetailWindow=function(e,t,n){this.oParent.openDetailWindow(this,{caption:e,offsetX:t,offsetY:n})};n.prototype.openContextMenu=function(e){this.oParent.openContextMenu(this,e)};n.prototype.handleChangedData=function(e){};return n});
/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5) (c) Copyright 2009-2012 SAP AG. All rights reserved
 */
sap.ui.predefine("sap/ui/vbm/FeatureCollection", ["./GeoJsonLayer","jquery.sap.global","sap/base/Log","./library"],function(e,jQuery,t,r){"use strict";var a=e.extend("sap.ui.vbm.FeatureCollection",{metadata:{library:"sap.ui.vbm",properties:{},defaultAggregation:"items",aggregations:{items:{type:"sap.ui.vbm.Feature",multiple:true,singularName:"item"}},events:{click:{parameters:{featureId:{type:"string"}}},contextMenu:{parameters:{featureId:{type:"string"}}}}}});a.prototype.getDataObjects=function(){if(this.mbGeoJSONDirty){this._triggerFeatureCreation()}var e=[],r=[],a=[],i=[];jQuery.extend(e,this.mFeatureColl);var s={};if(e.length){var n=this.getItems();for(var o=0,u=n?n.length:0,p;o<u;++o){p=n[o];s[p.getFeatureId()]=p}}for(var g=0,m,l,h;g<e.length;++g){m=e[g];if(l=s[m.K]){var y={};jQuery.extend(y,m);m=e[g]=y;m.C=l.getColor();if(h=l.getTooltip()){m.TT=h}}switch(m.type){case"Polygon":case"MultiPolygon":r.push(m);break;case"LineString":case"MultiLineString":a.push(m);break;case"Point":case"MultiPoint":i.push(m);break;default:t.error("Unknown feature type",m.type,"sap.ui.vbm.FeatureCollection")}}return[{name:this.getId()+"_Polys",type:"N",E:r},{name:this.getId()+"_Lines",type:"N",E:a},{name:this.getId()+"_Points",type:"N",E:i}]};a.prototype.getDataRemoveObjects=function(){return[{name:this.getId()+"_Polys",type:"N"},{name:this.getId()+"_Lines",type:"N"},{name:this.getId()+"_Points",type:"N"}]};a.prototype.getFeaturesInfo=function(e){var t=[];for(var r=0,a=e.length,i;r<a;++r){i=e[r];t[i]={};t[i].BBox=this.mFeatureBBox[i];t[i].Midpoint=[(this.mFeatureBBox[i][0]+this.mFeatureBBox[i][1])/2,(this.mFeatureBBox[i][2]+this.mFeatureBBox[i][3])/2];t[i].Name=this.mNames[i];t[i].Properties=this.mFeatureProps[i]}return t};return a});
/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5) (c) Copyright 2009-2012 SAP AG. All rights reserved
 */
sap.ui.predefine("sap/ui/vbm/GeoCircle", ["./VoBase","./library"],function(t,e){"use strict";var i=t.extend("sap.ui.vbm.GeoCircle",{metadata:{library:"sap.ui.vbm",properties:{position:{type:"string",group:"Misc",defaultValue:"0;0;0"},colorBorder:{type:"string",group:"Misc",defaultValue:"RGB(0,0,0)"},radius:{type:"string",group:"Misc",defaultValue:"10000"},color:{type:"string",group:"Misc",defaultValue:"RGB(0,0,0)"},slices:{type:"string",group:"Misc",defaultValue:"20"}},events:{}}});i.prototype.openDetailWindow=function(t,e,i){this.oParent.openDetailWindow(this,{caption:t,offsetX:e,offsetY:i},true)};i.prototype.openContextMenu=function(t){this.oParent.openContextMenu("GeoCircle",this,t)};i.prototype.getDataElement=function(){var e=t.prototype.getDataElement.apply(this,arguments);var i=this.oParent.mBindInfo;if(i.P){e.P=this.getPosition()}if(i.R){e.R=this.getRadius()}if(i.C){e.C=this.getColor()}if(i.CB){e.CB=this.getColorBorder()}if(i.NS){e.NS=this.getSlices()}return e};i.prototype.handleChangedData=function(t){if(t.P){this.setPosition(t.P)}if(t.R){this.setRadius(t.R)}};return i});
/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5) (c) Copyright 2009-2012 SAP AG. All rights reserved
 */
sap.ui.predefine("sap/ui/vbm/GeoCircles", ["./VoAggregation","./library"],function(e,t){"use strict";var i=e.extend("sap.ui.vbm.GeoCircles",{metadata:{library:"sap.ui.vbm",properties:{posChangeable:{type:"boolean",group:"Misc",defaultValue:true},radiusChangeable:{type:"boolean",group:"Misc",defaultValue:true}},defaultAggregation:"items",aggregations:{items:{type:"sap.ui.vbm.GeoCircle",multiple:true,singularName:"item"}},events:{}}});i.prototype.getBindInfo=function(){var t=e.prototype.getBindInfo.apply(this,arguments);var i=this.getTemplateBindingInfo();t.C=i?i.hasOwnProperty("color"):true;t.CB=i?i.hasOwnProperty("colorBorder"):true;t.P=i?i.hasOwnProperty("position"):true;t.NS=i?i.hasOwnProperty("slices"):true;t.R=i?i.hasOwnProperty("radius"):true;return t};i.prototype.getTemplateObject=function(){var t=e.prototype.getTemplateObject.apply(this,arguments);var i=this.mBindInfo=this.getBindInfo();var r=i.hasTemplate?this.getBindingInfo("items").template:null;t["type"]="{00100000-2013-0004-B001-686F01B57873}";if(i.P){t["midpoint.bind"]=t.id+".P"}else{t.pos=r.getPosition()}if(i.NS){t["slices.bind"]=t.id+".NS"}else{t.slices=r.getSlices()}if(i.C){t["color.bind"]=t.id+".C"}else{t.color=r.getColor()}if(i.CB){t["colorBorder.bind"]=t.id+".CB"}else{t.colorBorder=r.getColorBorder()}if(i.R){t["radius.bind"]=t.id+".R"}else{t.radius=r.getRadius()}return t};i.prototype.getTypeObject=function(){var t=e.prototype.getTypeObject.apply(this,arguments);var i=this.mBindInfo;if(i.P){t.A.push({changeable:this.getPosChangeable().toString(),name:"P",alias:"P",type:"vector"})}if(i.R){t.A.push({changeable:this.getRadiusChangeable().toString(),name:"R",alias:"R",type:"double"})}if(i.C){t.A.push({name:"C",alias:"C",type:"color"})}if(i.CB){t.A.push({name:"CB",alias:"CB",type:"color"})}if(i.NS){t.A.push({name:"NS",alias:"NS",type:"long"})}return t};i.prototype.getActionArray=function(){var t=e.prototype.getActionArray.apply(this,arguments);var i=this.getId();if(this.mEventRegistry["click"]||this.isEventRegistered("click")){t.push({id:i+"1",name:"click",refScene:"MainScene",refVO:i,refEvent:"Click",AddActionProperty:[{name:"pos"}]})}if(this.mEventRegistry["contextMenu"]||this.isEventRegistered("contextMenu")){t.push({id:i+"2",name:"contextMenu",refScene:"MainScene",refVO:i,refEvent:"ContextMenu"})}if(this.mEventRegistry["drop"]||this.isEventRegistered("drop")){t.push({id:i+"3",name:"drop",refScene:"MainScene",refVO:i,refEvent:"Drop"})}return t};return i});
/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5) (c) Copyright 2009-2012 SAP AG. All rights reserved
 */
sap.ui.predefine("sap/ui/vbm/GeoJsonLayer", ["sap/ui/core/Element","sap/ui/core/theming/Parameters","sap/ui/unified/Menu","jquery.sap.global","sap/base/Log","./library"],function(e,t,r,jQuery,i,n){"use strict";var a="sap.ui.vbm.GeoJsonLayer";var o=e.extend("sap.ui.vbm.GeoJsonLayer",{metadata:{library:"sap.ui.vbm",properties:{srcURL:{type:"string",defaultValue:null},data:{type:"object",defaultValue:null},defaultLineWidth:{type:"int",group:"Appearance",defaultValue:5},defaultFillColor:{type:"sap.ui.core.CSSColor",group:"Appearance",defaultValue:"rgba(186, 193, 196, 0.5)"},defaultBorderColor:{type:"sap.ui.core.CSSColor",group:"Appearance",defaultValue:"rgba(255, 255, 255, 1.0)"}},defaultAggregation:"items",aggregations:{items:{type:"sap.ui.vbm.Feature",multiple:true,singularName:"item"}},events:{click:{parameters:{featureId:{type:"string"}}},contextMenu:{parameters:{featureId:{type:"string"}}}}}});o.prototype.init=function(){this.mbGeoJSONDirty=true;this.mbSrcLoadPending=false;this._aGeoJsonObjects=[]};o.prototype.setSrcURL=function(e){this.mbGeoJSONDirty=true;return this.setProperty("srcURL",e)};o.prototype.setData=function(e){this.mbGeoJSONDirty=true;this._aGeoJsonObjects=e;return this.setProperty("data",e)};o.prototype.addData=function(e){this.mbGeoJSONDirty=true;if(jQuery.type(e)==="array"){this._aGeoJsonObjects=this._aGeoJsonObjects.concat(e)}else{this._aGeoJsonObjects.push(e)}this.setProperty("data",this._aGeoJsonObjects);this.getParent().invalidate(this)};o.prototype._createFeatures=function(e){var t=this.getDefaultFillColor();var r=this.getDefaultBorderColor();var n=this._aGeoJsonObjects;if(e){n.push(e)}this.mFeatureColl=[];this.mFeatureBBox={};this.mNames={};this.mFeatureProps={};for(var o=0;o<n.length;++o){var s=n[o];switch(s.type){case"FeatureCollection":for(var u=0,p;u<s.features.length;++u){p=s.features[u];this._processType(p.id,p.geometry.type,p.geometry.coordinates,p.properties,t,r)}break;case"Feature":this._processType(s.id,s.geometry.type,s.geometry.coordinates,s.properties,t,r);break;case"GeometryCollection":for(var l=0,c;l<s.geometries.length;++l){c=s.geometries[l];this._processType(null,c.type,c.coordinates,null,t,r)}break;case"Polygon":case"MultiPolygon":case"LineString":case"MultiLineString":case"Point":case"MultiPoint":this._processType(null,s.type,s.coordinates,null,t,r);break;default:i.error("Unsupported GeoJSON object type",n[o].type,a);continue}}this.mbGeoJSONDirty=false};o.prototype._processType=function(e,t,r,n,o,s){var u,p,l=Number.MAX_VALUE,c=-Number.MAX_VALUE,h=Number.MAX_VALUE,d=-Number.MAX_VALUE;var f="",m;var y;var g;var v,b;var P=[];var C=[];var _=[];f=n&&n.name?n.name:"";this.mFeatureProps[e]=n;switch(t){case"Polygon":for(v=0;v<r.length;++v){g=r[v];y=[];for(b=0;b<g.length;++b){m=g[b];if(!v){if((u=m[0])<l){l=u}if(u>c){c=u}if((p=m[1])<h){h=p}if(p>d){d=p}}y.push(m[0],m[1],"0")}C.push(y)}P.push(C);_.push([l,c,h,d]);break;case"MultiPolygon":for(var S=0,B,M=r.length;S<M;++S){C=[];B=r[S].length;for(v=0;v<B;++v){g=r[S][v];y=[];for(b=0;b<g.length;++b){m=g[b];if(!v){if((u=m[0])<l){l=u}if(u>c){c=u}if((p=m[1])<h){h=p}if(p>d){d=p}}y.push(m[0],m[1],"0")}C.push(y)}P.push(C);_.push([l,c,h,d])}break;case"LineString":y=[];for(v=0;v<r.length;++v){m=r[v];if((u=m[0])<l){l=u}if(u>c){c=u}if((p=m[1])<h){h=p}if(p>d){d=p}y.push(m[0],m[1],0)}C.push(y);P.push(C);_.push([l,c,h,d]);break;case"Point":h=d=r[1];l=c=r[0];y=[r[0],r[1],0];C.push(y);P.push(C);_.push([l,c,h,d]);break;default:i.error("Unsupported geometry type",t,a);return}this.mFeatureColl.push(this._createDataElement(e,P,t,o,s,f,e));this.mFeatureBBox[e]=window.VBI.MathLib.GetSurroundingBox(_)};o.prototype._createDataElement=function(e,t,r,i,n,a,o){var s={K:e,P:[],TT:a,C:i,CB:n,type:r};s["VB:s"]=false;var u,p,l;var c,h,d,f,m;switch(r){case"Polygon":case"MultiPolygon":var y,g;m=t.length;for(l=0;l<m;++l){y=t[l];g=[];f=y.length;for(p=0;p<f;++p){c="";d=y[p].length;for(u=0;u<d;++u){if(u){c+=";"}c+=y[p][u]}g.push(c)}s.P.push(g)}break;case"LineString":c="";h=t[0][0];d=h.length;for(u=0;u<d;++u){if(u){c+=";"}c+=h[u]}s.P=c;break;case"Point":c="";h=t[0][0];d=h.length;for(u=0;u<d;++u){if(u){c+=";"}c+=h[u]}s.P=c;break}return s};o.prototype._triggerFeatureCreation=function(){var e=null;if(e=this.getSrcURL()){if(!this.mbSrcLoadPending){this.mbSrcLoadPending=true;jQuery.getJSON(e,function(e){this._createFeatures(e);this.mbSrcLoadPending=false;var t;if(t=this.getParent()){t.invalidate()}}.bind(this)).fail(function(){i.error("The path or the GeoJSON file is invalid",e,a)})}}else{this._createFeatures(null)}};o.prototype.getTemplateObjects=function(){var e,r=[];e={id:this.getId()+"_Polys",type:"{00100000-2012-0004-B001-F311DE491C77}",hotDeltaColor:"RHLSA(0;1;1;1.5)",altBorderDeltaColor:t?t.get("_sap_ui_vbm_shared_ChartDataPointBorderHoverSelectedColor"):"#666"};e.datasource=e.id;e["posarraymulti.bind"]=e.id+".P";e["color.bind"]=e.id+".C";e["colorBorder.bind"]=e.id+".CB";e["tooltip.bind"]=e.id+".TT";r.push(e);e={id:this.getId()+"_Lines",type:"{00100000-2012-0004-B001-C46BD7336A1A}",hotDeltaColor:"RHLSA(0;1;1;1.5)",altBorderDeltaColor:t?t.get("_sap_ui_vbm_shared_ChartDataPointBorderHoverSelectedColor"):"#666"};e.datasource=e.id;e["posarray.bind"]=e.id+".P";e["color.bind"]=e.id+".C";e["colorBorder.bind"]=e.id+".CB";e["tooltip.bind"]=e.id+".TT";r.push(e);e={id:this.getId()+"_Points",type:"{00100000-2012-0004-B001-64592B8DB964}",hotDeltaColor:"RHLSA(0;1;2;1)"};e.datasource=e.id;e["pos.bind"]=e.id+".P";e["tooltip.bind"]=e.id+".TT";r.push(e);return r};o.prototype.getTypeObjects=function(){var e={},t=[];var r={key:"K",minSel:"0",maxSel:"0",A:[{name:"K",alias:"K",type:"string"},{name:"C",alias:"C",type:"color"},{name:"CB",alias:"CB",type:"string"},{name:"TT",alias:"TT",type:"string"}]};jQuery.extend(true,e,r);e.name=this.getId()+"_Polys";e.A.push({name:"P",alias:"P",type:"vectorarraymulti"});t.push(e);e={};jQuery.extend(true,e,r);e.name=this.getId()+"_Lines";e.A.push({name:"P",alias:"P",type:"vectorarray"});t.push(e);e={};jQuery.extend(true,e,r);e.name=this.getId()+"_Points";e.A.push({name:"P",alias:"P",type:"vector"});t.push(e);return t};o.prototype.getDataObjects=function(){if(this.mbGeoJSONDirty){this._triggerFeatureCreation()}var e=[],t=[],r=[],n=[];jQuery.extend(true,e,this.mFeatureColl);var o={};if(e.length){var s=this.getItems();for(var u=0,p=s?s.length:0,l;u<p;++u){l=s[u];o[l.getFeatureId()]=l}}for(var c=0,h,d,f;c<e.length;++c){h=e[c];if(d=o[h.K]){h.C=d.getColor();if(f=d.getTooltip()){h.TT=f}}switch(h.type){case"Polygon":case"MultiPolygon":t.push(h);break;case"LineString":case"MultiLineString":r.push(h);break;case"Point":case"MultiPoint":n.push(h);break;default:i.error("Unknown object type",h.type,a)}}return[{name:this.getId()+"_Polys",type:"N",E:t},{name:this.getId()+"_Lines",type:"N",E:r},{name:this.getId()+"_Points",type:"N",E:n}]};o.prototype.getDataRemoveObjects=function(){return[{name:this.getId()+"_Polys",type:"N"},{name:this.getId()+"_Lines",type:"N"},{name:this.getId()+"_Points",type:"N"}]};o.prototype.getActionArray=function(){var e=[];var t=this.getId();if(this.mEventRegistry["click"]||this.isEventRegistered("click")){e.push({id:t+"Polys1",name:"click",refScene:"MainScene",refVO:t+"_Polys",refEvent:"Click",AddActionProperty:[{name:"pos"}]});e.push({id:t+"Lines1",name:"click",refScene:"MainScene",refVO:t+"_Lines",refEvent:"Click",AddActionProperty:[{name:"pos"}]});e.push({id:t+"Points1",name:"click",refScene:"MainScene",refVO:t+"_Points",refEvent:"Click",AddActionProperty:[{name:"pos"}]})}if(this.mEventRegistry["contextMenu"]||this.isEventRegistered("contextMenu")){e.push({id:t+"_Polys2",name:"contextMenu",refScene:"MainScene",refVO:t+"_Polys",refEvent:"ContextMenu"});e.push({id:t+"_Lines2",name:"contextMenu",refScene:"MainScene",refVO:t+"_Lines",refEvent:"ContextMenu"});e.push({id:t+"_Points2",name:"contextMenu",refScene:"MainScene",refVO:t+"_Points",refEvent:"ContextMenu"})}return e};o.prototype.getFeaturesInfo=function(e){var t=[];for(var r=0,i=e.length,n;r<i;++r){n=e[r];t[n]={};t[n].BBox=this.mFeatureBBox[n];t[n].Midpoint=[(this.mFeatureBBox[n][0]+this.mFeatureBBox[n][1])/2,(this.mFeatureBBox[n][2]+this.mFeatureBBox[n][3])/2];t[n].Name=this.mNames[n];t[n].Properties=this.mFeatureProps[n]}return t};o.prototype.handleEvent=function(e){var t=e.Action.name;var i="fire"+t[0].toUpperCase()+t.slice(1);var n,a=e.Action.instance;if(n=this.findInstance(a)){if(n.mEventRegistry[t]){if(t==="click"){n.mClickGeoPos=e.Action.AddActionProperties.AddActionProperty[0]["#"]}if(t==="contextMenu"){n.mClickPos=[e.Action.Params.Param[0]["#"],e.Action.Params.Param[1]["#"]];if(this.oParent.mVBIContext.m_Menus){this.oParent.mVBIContext.m_Menus.deleteMenu("DynContextMenu")}var o=new r;o.vbi_data={};o.vbi_data.menuRef="CTM";o.vbi_data.VBIName="DynContextMenu";n.fireContextMenu({menu:o})}else if(t==="handleMoved"){n[i]({data:e})}else{n[i]({})}}}if(this.mEventRegistry[t]){this[i]({featureId:a.split(".")[1]})}};o.prototype.openDetailWindow=function(e,t){var r=this.getParent();r.mDTWindowCxt.bUseClickPos=true;r.mDTWindowCxt.open=true;r.mDTWindowCxt.src=e;r.mDTWindowCxt.key=e.getFeatureId();r.mDTWindowCxt.params=t;r.m_bWindowsDirty=true;r.invalidate(this)};o.prototype.openContextMenu=function(e,t){this.oParent.openContextMenu("Area",e,t)};o.prototype.handleChangedData=function(e){if(e&&e.length){for(var t=0,r,i;t<e.length;++t){r=e[t];i=r.K?this.findInstance(r.K):null;if(i){i.handleChangedData(r)}}}};o.prototype.isEventRegistered=function(e){var t=this.getItems();if(!t){return false}for(var r=0,i=t.length;r<i;++r){if(t[r].mEventRegistry[e]){return true}}return false};o.prototype.findInstance=function(e){var t=this.getItems();if(!t){return null}switch(jQuery.type(e)){case"string":var r=e.indexOf(".")!==-1?e.split(".")[1]:e;for(var n=0,o=t.length;n<o;++n){if(t[n].getFeatureId()===r){return t[n]}}break;case"number":break;default:i.error("Unexpected instance name type",jQuery.type(e),a);break}return null};return o});
/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5) (c) Copyright 2009-2012 SAP AG. All rights reserved
 */
sap.ui.predefine("sap/ui/vbm/GeoMap", ["./VBI","jquery.sap.global","sap/base/Log","./library","./GeoMapRenderer"],function(e,jQuery,t,i,r){"use strict";var a="sap.ui.vbm.GeoMap";
/**
	 * Constructor for a new GeoMap.
	 *
	 * @param {string} [sId] id for the new control, generated automatically if no id is given
	 * @param {object} [mSettings] initial settings for the new control
	 * @class Map control with the option to position multiple visual objects on top of a map. The GeoMap control shows an image based map loaded from
	 *        one or more configurable external providers. Per default a map from <a href="http://www.mapquest.com">MapQuest</a> is used. Other map
	 *        providers can be configured via property <i>mapConfiguration</i>. Multiple maps can be mashed up into one map layer stack. If multiple
	 *        map layer stacks are provided via configuration it is possible to switch between them during runtime. The control supports the display
	 *        of copyright information for the visible maps.<br>
	 *        On top of the map the GeoMap control provides a navigation control, a scale, and a legend. Each of them can be switched off separately.<br>
	 *        It is possible to set the initial position and zoom for the map display. Further the control allows to restrict the potentially visible
	 *        map area and zoom range.<br>
	 *        Different visual objects can be placed on the map. Visual objects are grouped in VO aggregations and an arbitrary number of VO
	 *        aggregations can be assigned to the <i>vos</i> aggregation.<br>
	 *        The second aggregation <i>featureCollections</i> allows the use of GeoJSON as source for visual objects.
	 * @extends sap.ui.vbm.VBI
	 * @constructor
	 * @public
	 * @alias sap.ui.vbm.GeoMap
	 * @ui5-metamodel This control/element also will be described in the UI5 (legacy) designtime metamodel
	 */var o=e.extend("sap.ui.vbm.GeoMap",{metadata:{library:"sap.ui.vbm",properties:{mapConfiguration:{type:"object",group:"Misc",defaultValue:null},legendVisible:{type:"boolean",group:"Appearance",defaultValue:true},scaleVisible:{type:"boolean",group:"Appearance",defaultValue:true},navcontrolVisible:{type:"boolean",group:"Appearance",defaultValue:true},initialPosition:{type:"string",group:"Behavior",defaultValue:"0;0;0"},initialZoom:{type:"string",group:"Behavior",defaultValue:"2"},centerPosition:{type:"string",group:"Behavior",defaultValue:"0;0"},zoomlevel:{type:"int",group:"Behavior",defaultValue:2},refMapLayerStack:{type:"string",group:"Appearance",defaultValue:"Default"},visualFrame:{type:"object",group:"Behavior",defaultValue:null},clustering:{type:"object",group:"Behavior",defaultValue:null},disableZoom:{type:"boolean",group:"Behavior",defaultValue:false},disablePan:{type:"boolean",group:"Behavior",defaultValue:false},enableAnimation:{type:"boolean",group:"Behavior",defaultValue:false}},defaultAggregation:"vos",aggregations:{vos:{type:"sap.ui.vbm.VoAbstract",multiple:true,singularName:"vo"},geoJsonLayers:{type:"sap.ui.vbm.GeoJsonLayer",multiple:true,singularName:"geoJsonLayer"},featureCollections:{type:"sap.ui.vbm.FeatureCollection",multiple:true,singularName:"featureCollection"},resources:{type:"sap.ui.vbm.Resource",multiple:true,singularName:"resource"},legend:{type:"sap.ui.vbm.Legend",multiple:false},clusters:{type:"sap.ui.vbm.ClusterBase",multiple:true,singularName:"cluster"}},events:{click:{parameters:{pos:{type:"string"}}},contextMenu:{parameters:{clientX:{type:"int"},clientY:{type:"int"},pos:{type:"string"}}},drop:{parameters:{pos:{type:"string"}}},select:{},zoomChanged:{parameters:{centerPoint:{type:"string"},viewportBB:{type:"object"},zoomLevel:{type:"int"}}},centerChanged:{parameters:{centerPoint:{type:"string"},viewportBB:{type:"object"},zoomLevel:{type:"int"}}},keyDown:{parameters:{key:{type:"string"},code:{type:"int"},shift:{type:"boolean"},ctrl:{type:"boolean"},alt:{type:"boolean"},meta:{type:"boolean"}}},keyPress:{parameters:{key:{type:"string"},code:{type:"int"},shift:{type:"boolean"},ctrl:{type:"boolean"},alt:{type:"boolean"},meta:{type:"boolean"}}},keyUp:{parameters:{key:{type:"string"},code:{type:"int"},shift:{type:"boolean"},ctrl:{type:"boolean"},alt:{type:"boolean"},meta:{type:"boolean"}}}}},renderer:r});o.bEncodedSpotImagesAvailable=false;o.bEncodeSpotImageData=null;o.oBaseApp={SAPVB:{version:"2.0",MapProviders:{Set:{MapProvider:{name:"404",type:"",description:"",tileX:"256",tileY:"256",maxLOD:"19",copyright:"Map Provider is not configured, please read this {LINK|SCN Article} to configure your own Map Provider.",copyrightLink:"//scn.sap.com/docs/DOC-74221",copyrightImage:"",Source:[{id:"s1",url:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAIAAAGkFw+nAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA3ppVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMTMyIDc5LjE1OTI4NCwgMjAxNi8wNC8xOS0xMzoxMzo0MCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDoxMGJiNTIyYy1iMGY1LTRhOTgtOWEyZi1kYTY0MWU2ZTk0MGQiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6MURCMDcxRkE5NDBDMTFFNjlCODg5Njk4NURERjQ1RTUiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6MURCMDcxRjk5NDBDMTFFNjlCODg5Njk4NURERjQ1RTUiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTUuNSAoTWFjaW50b3NoKSI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOjExYzk5MTI5LWM0ZWYtNDZmYi05N2Q1LWUwNWExNGZmMDhlYSIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDoxMGJiNTIyYy1iMGY1LTRhOTgtOWEyZi1kYTY0MWU2ZTk0MGQiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz7y1q/+AAAmXElEQVR42uxWMRJFMBBNVFpHULsXF+AW9NRqo6RV6ikZlZJSGe9PZjKKb5IIXV6xs3aSfZvN2wzKGCNfwiEfwxJYAktgTjCOo2QFe4Su647jKMtSulKDIE1T2DAMtUoh0qTTNPHUIpLn+bZtOIEpwTAMwl/XFRZ5RUTxKFTruW7bFrau66IoFLeoEuz77nnehzL9mz3LsuvnPM9RFJnKtKoqYTniOH5BprhSyOYqJwwBIlwIqP1uo2qLcKuu68JJkgTpfs11HESCIIDv+/7zSW6ahheOYpdl0W0pkY6uIcjdfPV9z94Atf9FlsASkFMA9svYhmEQiKKehqEomYSOSZgDiRWQmIQ+edJJyEqwlZBLdy5O0Nz3x4f1n90DEzABE/iTQK2VughxvwAIuZqkRYR5iXgKAELIOPcFDjQB5IptzpJqCCVohgxV2QGndB+h1Ry8G1rmcOGtTQGxEmOcW77Q3OacdxzQheGZVCwvyJhK3967WjblcjnnQghf8NqHeCOL1ppOuoZnxhgsvPelFOr+z2g5GCmlh9JjucgETOA4ngKwa7UqFgJR+AUMZqNVH0SMZrMvIGafwOA7CDatBoOITeMmwWTQqkUR5O7HHpDLCnfdu/7c3Z0JwzAMer6Z8zPfOXO4Hfz6HWIAGAAGgAFgABiAPwagaRqwCyocep7308/djmkLVauqCv0wDGAD32XuJ3GCcRyTJFEUJU1TMEvMgLuZprle6ThOWZYYuK5LVaAd2tOs+3GCBSdwz8A/5Wp2PIF9VAh4QM8h9NtHW0uMBeixBqj2VaT9r9OWZfV9T4oEvRIE4bm67cVGvFcjPTQMI8/zA1Vo+zOGB4ky0q5708J4SRl1XQdXcRIAegiBf1O+kIReV3IxA/cKy4F5QPolRRQEwTzPF9gAopKu6+v5oigAQ5IkBK+2bTmOs20b89M0xXGsquoL2QBtPGWwaMvJaUZRtPFZyhleiAIWnAzG8DN1XdOAtiMMQ03TTruYfA2ASg4QFzqAXhRFhF7E0SzLZFnmef7i29yWY/J9/2X9LMsLMQAMAAPAAPxvAO8CsHP1KspDQbRZGwURSeOChaKihV1AEFGwsrDRSrAVfQF9APvvBeysLG2sRHwCBW1sLCwU/EUQURCx2IMDFzHZ3XwaY2BninBziTLnzsnMJJm5HAcYAANgAAyAATAABsAAGAADYAAMgAEwAOOFWkKflA/D1F0sFi6XC4NqtRqJRKxWqyRJD/eeGgpgNBptt1u/3w/VcXo4HFKpVL/fl2X5+T9/4WuVUqmUz+en0ynGwWAQR100vhfdvziIcvr5fK7aB6D8lP+MPHsT12q10+lUqVRET7PNZlutVhiA8fF4nCZBHuqRAekHg8GbLdDr9YrFouiHp76UHxabGv9hGfxKexPLCz8xEbmpska1KR6Ty+USFLLb7fv9Xs/iGl0soPrFF4uNBf53lR/2EtCl8/pWHnGjd8sJ9mcyGafTGQgExuMx2QRH4eMnkwkohEE4HIYPhVel9nazeCHVjS2KV4FZqOTsdaKzGy2Xy4JgGED7/91iw2g3KgSRFUcqdRJM83q92re+MEsg01fgssmq31nyDQBwz/wajEXlk/Ba3/UpGppOU5krbox6vY5gQrFZJHzEQyStNNNut3FBIpGg0/V6rR6yDCgzE8VmyiCAlRaxmUhCRzLRcDiczWbGeSEwlfhKe6dAKLQJKisDHxEDGGjHFYyPx2On03mbGxURQLnYYA4xm3RFKnV7XyqbSd8AQDXFwORtv+qtKVqt1vl8NkscuEsxkF80m02aDIVCWH6adzgchUKBxul02mKxmOuZGM8GpKvH49lsNnhsx9NjNBrd7XZ0gc/nM1cgQ85MlfYgNBWKCmY3Gg0DosqDAOA3SO/5VQTFu90u8k0jw6ImCoHN4EMsFoNXdrvdSIYlSYLexBAMRHqcTCYNfrn0oUX7bDaLAInVJX5DXVmWkeVTrejnVd72ekzL1gaiZcGE9Ze/u1GExsvlQuNcLme2d6NcL8QAGAADYAAMgAEwAAbAABjA3wXwJQB7VxMKXRiFLb4NCxZGfhoKi4lSKDsWfmdhZctaForVlI2wG1mxZENM7JSampHJAmHyEyUW/iXkr4Sm0Pc9fc/X2+36jDsM5s49z+LtneveKec57znve+6cc0x/HhANEggBQoBACBACBEKAECAQAoQAgRAgBAiEACFAIAQIAQIhQAgQCAFCgOBN/LLaP+zz+bKzs/mD7+vra5UcLAREE/v7+3l5eS0tLU6n0+/3V1RU7O3t5efnV1dX22y29fX1+vp6r9fLnPifhVl/FbG1tQVdZp4vBM2xra0NSo2/Qq+Zn52amprwNxXga0vVW2cFUNaYsIQAJI4r/f39LpcLao4rV1dX0PGEN5LiYxGxk3PBJEQmxTFllalxGG9ubrq7u9mAUuVY4p4wddv5VUx+DJO1KwW+/+k1tDgYDGJut9sh7sTERFgYFvbPzc19t+g8jT6bqbjd7tnZWYfDAXPk8Xjwze3t7RjhBqJZc8B0K4AptqOjo0oftVoJPTVe5QB3YkFgZGYsFwqLg3CJYA1F1I/2B/F9BFD07NaLicFKKkrKzG3EU7QqJA9rxcj3qOZJlibg3cxXdgSmZDFRek2Jay17eMLY6EOb9P4VjarijQBKFpKC7LSNpl53pWL1IlY2gPorR62sHP7EROaYdbym7LLR09NTVFR0eXlZUFCA3T22oThVBQIBbDrhqFtbW9n1zHQHmlgkIBQKdXZ23t3dYZuPjzjBjoyMnJ+fd3V16dohQfQnJydmlHusn4SxMU1OTu7r6zOdQM/OzhYXFyNo1vRb8CHQObH4DncQaksWke+xRDianUZvb29ZLdHlcvGikQfxFOcrKys47rHzF0Z4I1wpLy+HE4LKl5WVdXR0LC8vRxwFiTPFhPZh/8PThlYZVfHH8OcGRjug3bxfe05kSOO/j7+8vMzMzOCph4eHuN0F6QAtu7+/T09Pn5ubw8eGhga6YtWy06Aa+ny+yclJFk2E/nKuon7Ud20hy9PTU7BbWFhYXFwct06YdSMrKys9Hk9TU5Pdbu/t7XW73VjjGAcGBqCkTqfz4OAAW6MwjlpXbBj2ZHBwEM82NzcPDQ3hCrtdMmSUlZXFPpLKMMzPz19cXNTW1qakpFgiGvo6cKQ9ozEIYTCqynCT1hbRgOC89tpDQsrj4+PBYFAOYh8xRHCDUGEczYaHh7EaYDTYeBq2KCMjA/dom1AvLS0dHR3V1NTwRY28DzAaJoL6q3iOemfAEBujPbpqsjAsExMTCwsLEor4lHeFiGG1IfFAIJCTk5OUlLS6ukrHqLC2trazs1NVVUV9Nx2+9RygipYTY2NjcIxqDIVCuJiWloZxY2MD/nZqagqOMTMzEx9LSkoODw8dDodOY0pLSxsbG00q/W8yQWr7DI1mEVFWW1RxZl3Ic3NzE9uS4+NjK5yoo1nNm/F3jCxer96EqFdgurdUj4+P2Hf7/f7n52fLhjSiQAClrAqJcufHspwqsr+9vQ2l3t3dlSDS1zrhp6en6elpTOrq6j5fIdcKkHI1VtoFCYQAIUAgBAgBAiFACBAIAUKAQAgQAoQAgRAgBAiEACFA8CP4IwB75xZS1brF8VXWgxlFZXi8ZGSauTtdEMuKLMXUKBQE6UEJeumch8BAd0RP4WN0DJIgTj4FdheFTFpmmlQYpVnaRVRM8oaCBV1IjLL9Yw7Oxzwrc6u53XO5xniYzDXXXFMd//H9x39837ccuiCjI0ABUFMAFAA1BUABUFMAFAA1BUABUFMAFAA1BUABUFMAFAA1BUABUFMAFAA1BUABUFMAFAA1BUABUFMAFAA1BUABUFMAFAA1BUABUFMAFAA1BUABUFMAFAAvsdevX5eUlCgAf5vfT5486YSG8rMWANP8S3oSHD16tLCw0O12G78fO3bM39/foxeEAjBt1t/ff+/evYKCggsXLhD1XBkYGLD7fXh4uK2tzQl95+fOssAXhikqKtq5c+fChQvxdXl5+T8s+/z5s/H7unXrJtHu8a+0eV7qa2nAFhsbm5KS0tvbGxUV1dHRcfHixdzcXGBISEiAfNrb27kzKCjI3oDVcW3lvajXgWmk1NnZKc04pDGH6eYsjZ6lCbd0fNYuStOsYQh2uMVltRrMzMzkJDAw8OrVq7ANJLN///7KysqsrCzTedALzPlNxCTG7cFu4p0xYe9/Pn6veWf+gU5Jwo2NjegWaTFbVlYGj4tEqamp4RgZGQmtMwKkUSeWk5OD6xkHwcHBY44VnsbJPct4LAlDK+GxTbr7FhcXwy03btxAsEdHR+PcjIwMfJecnEy+bWpqGhwcrK+vN8KRm39Mp+Zd0m9FRQWghoWFdXd3kxIkISsAYxgufvnypZzjaGn9iNMJbVTN6dOnkY94lut2MfOjcQ+KCMwYFnv27GGshIaGVldX83wyB3rJmQDMkAyFBHAoR8QiwQvJLFiwQDoAczQVaUhICMcHDx5Igv3TQgnVHx4ezgOpucjDERER586dk4dgS5YsiYmJkZ8oqdt3k7Bp7cbx1q1b0tnanhgn1Yedm8nG0oVPtKnp7SnP8ejtqTLUJbEPpUj+JPw58ff3n1RZRLaAT0inJGS0ZmlpKS8fPny4d+9edCeJlxEwZnlsb+vsozlACF0oZf369dD6RIpScgMfIR/IS2hdWAu/19XVkRKam5s3bdokqn9M72PXrl3TOuD/6tiJMAx8ghCyN6QUYvndskmRlfTVdiwF+fH7zQzScXFx45S4VLCQCUc0KOrFz8/vxYsXyH9Sa0tLS2JiIretWLHi69evR44cGZ/r5s+ff/jwYXTn4sWL4Z/jx4+fPXs2NTVVZehPjdCGT9CgJ06coBSArFD9nz592rdvH9qfKDaqRqYwpV6zO10mJzgSTzASQoiP9/T0DAwMUFg4uduwI2ZDk5KSoHuRj7jMrj5Bwl7rMlZA68CBA5Jdnz9/3traGhAQAH4yAyq34X2cTqo/deqUw6eCnDIZRwE1EamO8Cfx5uXliaYCKgKfqIe+RFkNDQ2NX6/pCBjbxvc+ApSIZnAQ0ffv32dMSOqSkOcl3o+Pj3ey3PTKBRnoOygoiJBPT09ftmzZ27dvYao1a9a4rFbyxD7jJi0tDRhEnnqlOVCZ/ccy6T5vilupez0EpUc5rR21p8cIbci9sbGxu7u7q6uLjIo6cs1ScyIAZWVl+F2W1L3OoRI93g2AF5mINwoRRAHJiVT09OlTypdJyIHvPmnv3r37lY9LKsLpw8PDpCiZfJVcxZVJzcX6xNZEOM2UEbJUSQU3tXiXR1GCcE5mouom8Kk8eJmTk8NbXEEoe7cKmnYjNkVZTWpOELPvbSHq+/v7Oy3jxCw/NDQ0cOVflqHKvHVRfhpN9iIetUwqNcmKlBSQ9fLly7ko4+Bnc+ByUlBQsHTpUiMEZMk6IiKit7eXEzDgYkJCwurVq7n4X8skB1y6dMljtspXRgABSJgTiS8sg45NvHOREP5Z3cCdEu8UH6QH8wQzDuwVyY9Z5M2bN5BSS0vLFH5n1yygF0mGZuVAqEaWLeX6OLmUewCJE47yQQFSNh3JuXmIvQykOgGt2tra0dHRX/n9vXVvKPTy4cMHEX+8fPz4MRSRm5sLY0ALbrd7ImIc+k5PTw8LC4NDCGGyKNVfXFycLNhBVjwtNjbW7LPjyXV1dUNDQ1ANZcq0bO91eg6Q3c6yv0r8LqQsO7T6+vra29sJxqioKFkwWLRoUXNzc3x8/Pi1EvwOTfNZYKuurjYsX1lZybsAIGsPMtsKBUHr8MycOXMSExOzsrLw/myejJMo5mT79u1IurVr1xKk9fX1ZNfIyMiAgABJsyEhIaGhoR6Rbl8A8FiOlynVXbt2uawvEOBTud7U1MRPPHToEOdmzgN47t69y49mBPzTMh+aDeVvRllDI+gN8TKqIyMjo6OjA2fBOfYtcuNMBhQVFeFQXvIQwpZBAzwyknjIqlWr5Fsb5lGoo6qqKggnOTk5ODg4OzvbR+eCiD7xOF7AXzIR/adrBnYAMjMzUZMwzJkzZ2BtKFvC32VtxfCYuwbOnp6e1NTUv2U5wYkjAL8LLUzQ6TBSeXk5mQBiIZyJbryfn5/POeHMW48ePTp48KB9F0xbW9uTJ0+2bNkCp0F0Ohs6xYmw1tbWf1smdVBMTAzZgsDfuHHj+fPnCfkdO3YYvzOM7ty5s3Llyq1bt+qCzBQNSS7fFeAEGS6lln1TosdkwJcvX27evFlRUTEyMuLMv8gLAIBYKJHkixgodylQKZSkbuLIFY/ZTcqCy5cvDw4OOv+vcy4AlJ3EuAltMw0gJa7MENhLUzIBxdSrV6+8a0w7LglLiYt6kUljqTZlTo1jZ2enUY2Q+/v3769fvy5cv8oyXZKciugkYRLXsgFLxA9lEdFN0URRSukfHR1tcum3b98okT5+/JiWliZ7gbzaZnQqwsz0uv6389llbSakXLJvUZXii3KfIzI0KSkJAfPs2TNova+vz8/Pb/fu3Sj9WeD9mVNBsLbMDxsGJ3lK5rRTvMeuE+ojaL25uXkWLxb95SNA/m8GNI03ZVoRii8rKxsYGKDyZBDISp6MBuIdzuHdmpqa0dFRRH12dvaGDRtm8XLpdAJQUlJiFpvQJIWFhZzA15IwoXK5jUo1MDAwLy/P7XbD+DhdYr+0tBRsIBYSb3Jy8ty5vvGvdH6dW4xal1UnjqLczdoIL+Efs9xhjDQAw3R1dX33YftVGZqeni7fUCQrkjwJZ3yKnmlvbzebxeH6dZa5rO3mtbW1UVFRcXFxv1nm8m2bBhkK1eTn53NENRYXF6MOq6qquJ6bmytOHxkZuX379rx581JSUji61KZXBY35zVCK2Pr6+itXrqAgv6vN2Obcjo6OhoaGzZs3yxqh2kxQEBRfXV0dHh6+bds2dagPrQdoHaCmACgAagqAAqCmACgAagqAAqCmACgAagqAAqCmACgAagqAAqCmACgAagqAAqCmACgAagqAAqCmACgAagqAAqCmACgAagqAM+wPAdo7+5iqy/+NSwokFvgAJYkSiiVLSTLEShIzs+l001x/kMuyWXNuuUXMcmNKLSY53Wq1pq2t5sMfjsGmo4HmIDVR0RqiISoSZiCPipmET/1ev/Pe994ZoEPwgYfr+uPsPp/zeeKc63q/r/f9ue8bTdAQFIEEQQIQBAlAECQAQZAABEECEAQJQBAkAEGQAARBAhAECUAQJABBkAAEQQIQBAlAECQAQZAABEECEAQJQBAkAEGQAARBAhAECUAQJABBkAAEQQIQBAlAECQAQZAABEECEAQJQBAkAEGQAARBAhAECUAQJABBkAAEQQIQBAlAEDqOfvoKeg+OHTv25ZdfPvHEE5cuXaqsrFy1alVoaKgEIPQQnD9/Pi8vr7a2Nioq6sUXX2xN96amJnY7ceKE7b9ly5akpCRZIKF7IDk5edOmTS6Wnz59ev369e+9915mZiZbeE1LS5s5c+acOXMKCwvZ2dEd9hvdR40aReOxxx5DFTQiIiL0rSoDdBvMnj178+bNzz//fP/+/Qnt8fHxsL+qqorQHhAQEBwcfPHixYMHDxL7Y2Nj2dOOgu4PPfQQMoDugwYNQjP6Jr3h899//+lbuPf4999/eX3wwQftLeEcpvJ29+7dcHf58uW8TUlJecgD6PvGG2/A7NTU1KFDh8J7UsGePXu++OILDnFtzoMALl++jBieffZZfcntQV/ih76Fu0TxM2fOEHTdFsiNS4HN586da25u/v3339esWTNy5MhHHnmEiF5WVgZrw8PDf/31V/Qwbtw4aF1XV1dfX8+xFRUVxHUi/Y4dOzhk8uTJNTU1Dz/8MMdGR0eTHPp5wOGRkZGIR9+/aoD7DIJxeno6VHZbCOGBgYHW/vnnn7OysnhbWlrK26lTp8L7Q4cO0SbGm3GnwQ74dV5p43w4Ax7mqaeeIvCTB2joe5YF6kIgxpeUlISEhFCMwlHnWLx3MIdDFOetOfi5c+e++uqrtIuKiojxEydOdNZIkADuG44dO3azEIu9IUIbiZOTk3EdCxcuXLZsGU599OjRGzZsYPvKlSuN7u+//773eVCFdcuAZ555BjNzW4EcnWCr2lSIXc78D1fXL6gaoL3AqJhZh9lLly719fUNCwuDpj4+PvjsnJwczDq2BNNSUFCQkJCwb9++b775BuIaF/HlGBU/Pz/2eeWVVyhbcThBQUE4lsbGRrZjzd21OHz2/4Dpx8S3v4oAn3zySUNDA76fTyl8uaXi4mJey8vLX3vtNXwUV//444/1m6oGaC/Onz8Pm10XuwFaHz9+fN26dbQvX77cx9OhfvHiRVSRmZkJswm00I7tQ4YM4RWRzJo1C/Lh0YcNG8Yr+7B9wYIF1uhA/uHG4Lr1F1mX/9q1a2lTHKNYagxuyQoGUhAa4xBqCd7S0M+qDPD/EZRQff369RZBtAUoLgnbOz3AkEBl3hKYsfK5ublkg9DQUCIrMR6u19fXT5o0CbYRyK9du4bjJ9IvWrTIuuef9YCk0YG7tTzDtZAWRD916hS38e2335aVlY0aNWrjxo2UCm+++SYbsToXLlwg3l+9ehUZcGMkiqamphkzZrAnieUWWUXo4TUAjpw4bb3mZriJyklJSUTTtLQ02lCECIr59q5NHQV37drF4c61Q7W6urp58+bdKaOFSLjE/Pnzjx49Crm5DbajLquD7SanTZtm5QdbXBWB8GjYuAaiPke9/vrrtxa20BsFYIwhFhK8kUFAQAA8W7x4MTzGsdiTIxsk40TSwg7B0c53wliVjIGhGODtlClTyAxW/q5evRrimpmxoTgIj3tzXUP2YIt7todZvB0xYkTHfJTQG3uBXOejiYEtBE6oBufwx7R5bTMD3HEduv5N6+tEja5TyIJ9n//1+repxtvKe08//TT1hgh9u+iBY4EoBOEZYf5FD+zpEiG5kyMf4XFBQUFtbe2ECROIza7Pcdy4cWzExniTmEZeXt6BAwfi4uJsC5U0YsCs25NdkgCOv/N/LH8dyQ32kzSoQyyHCL26CKZC9S4EH/OgX7/bljoUz8jI8PPz43BcyrZt295++22qT3hvXZzW5/jOO++gB6J4fn7+9OnT3YWsM/TRRx/18fFJTExEJ2yMjo727hLtQNfQjh07jhw50rdvX/5AclpFRQWVMWmNcp970xAgZYCOV6jp6emBgYFE06KiIkphzHpYWBgbCd5sxKZTuRLFYeH27dsRgKUaK7s5A67du3iAiwiA8NwBb2Nj4ygYuDoNCt8lS5ZwA4hq4cKFth0Xh7q4VZIb18VKIchbPLwTeksG6BjwJI2NjdXV1R9++CHRmnAOvcaPHw/b9u/fP2/ePKI+URauW1+kpRoCP6TEzZNzWg9Bw5NERUVByr1799JAKjU1NSSBFmU3DKby5tPy8nIL4TY2jnzCLXH4559/HhISgirwVEgRn8P2kpISu9Xs7Gxi/1wP1AGqIrhTLt+NzMnMzMTZd75QtsQSHx8/ZswYMon3UGdXAZN2qAe8hwm53s/Bgwe7WzK1oAEr62X3JYCuKCFesSVG03fffbepqYm8wRYrea2HimzguoO8+2TXr19vT9zYk/yj3k8JoEsD63Lw4MHCwkLIOmvWLEyUdeHbZHM3T4Ww7aK4C+2lpaW5ubmchPAfGRkJ7+0Zhb5V1QBdl+7E8oyMDMoAKEvkJpxPmjRp/vz5ffv2/eyzzygScPAUDyiBHXDttDH3MTExfOTr6xvugfVQkQQwP/7+/pgcausZM2ZYN5GgXqCuCDMqixcvTkpKsmFqEJftZ86cgfRW/mLxCfyYmbq6Ot7SdhNw23QyWpGhK0CjQdsFo7sxG1v/0Ucf8Qq/g4ODc3JyiouLMTBWp8L1OzV2SDDgG4k4qgG6xC9BmA8ICFBtelfLKho2LY4vPC8vr7Ky0gazSABCj4ombu0WSiDS5qZNm4qKilasWAHjvUcrHjp0yEY03o3n3LJAvQhr1669j+sCnT59+j0PzM8Q2uE99wOzc3NzqawWLFiwZs2aQYMGlZaWBgYGul4BeE8GyM7OVgYQbgXIdOrUqeeee45oalGzxXyDe3MbFEUHDhwgitsgDjdMNTU1NS4uLisrKz4+3g1czczMLCgo+OCDD2yVUixQSkoKf8L48eNPnDjh3Cbbkc3dWMlUvUDd0iV7P3xwH0VFRcF16vI+nmVXiJr2JNvmG9jDY+95CJ25hx9++IFr2dsWY7lf9cBMDmHeuE4bMdTV1aGKPXv2lJWVrVy50h6V8OmqVau4vSlTplBiRUZG8if079/fW7HUA7C/uroahf/555+zZ88eMGCAMkBvKbvhDURZvnx5U1OT9cbiCtqc1mOUWr16NRy1Cc2dmW/A1bdv325D/ZxTt8Ed7oRciLtyOjzvgQ3TsJBvPPZeCS85OdnS1M2u29zc/Mcff5w8eZJLc2a0ER4e3oHxvMoA3YbltprQ1KlTvSO6m88Je6gOd+7cOWfOnD6tHj54n4pwO2LECOLr2LFj2znfoKqqCqpxTo7Ct+CaFi5caCsuuhEc7n7Ky8txU96HP+gBjmvw4MEobfjw4bYEr82Js47jPl6LQALvc9bW1hLUKyoqfHx8Hn/8ccL/kCFD/P39n/TgHnz5ygD3wcDANmg6ceJEe6RANKXN9s2bN3uHagvnBH78wIYNG+CTDR9yvbGdXEKL8//zzz80oKAjpRussXfvXu/t3h/ZBGWUkJCQQLzn3lqs/9UaV69eJaijkMbGRlvuDrr7+fnd919EQyE6BcLntWvXIOgtojsWHMZHRESw57JlywYOHBgTEwP1YTBRHycNMyZMmAAhjhw5gkJcZ190dPT06dNJDuwJ1X766Seivq2AYq+35QpsNPX+/fttMg1bSCmjR4/Geefm5gYFBdlMHUoLbhi+QmjK0+zs7GHDhkHZffv2YYeQ3Msvv2wDOnDhtsIXSvDuoGxoaCguLkY/R48excMgUfbkooR2eD9u3DhbX4MtXeEXVAa4DQKdPXsWOkJZCGEu1jpeCJMQ9+uvvz537hyxkNebrRVnGcCWEsLBm6vGzVPYwXLI0WKhB9u/A/He/lkGjsXm41sdTPBGeJyNJMOZuT1LKW7cHoSG6LS9V7OzVYbQXot7Q88Im6AO47Fq0BqR416618+qDNBepKWl3bhxg7hI8IOp3333na+vrwuff/31V35+vk2RgTo0rl+/3nqtOKIpeyIhgiLasG5K4rFF9NaZxC34nJGRgWzcfJcWc2sszxw+fJgzsA/tr776ilr5pZdegtO48zFjxnBXf//9NzuUlpaiVc5GnE5MTOQScJezXblyhfD/wgsvtFhZiDa0pkL45ZdfyFG21h1/0QMPPGDD/vg28OvBwcF3qU5VBugqpaqtzEOAJ7Nb8HZOnfD5448/IgbbgTywdOlSwu3WrVvZh+K1M33Y1uFj46VtFrzrFyIwE8jtZqwTHUZ6zzewjnZyFCf57bffyCSUH+QEm0jZ4kKIliyHaKlNkYr1nN7C4PUAqBeovbCFHlp0YoD58+dTShIg53nQooekY3PKKC127dplJ+ckGCT79xmuF9/1C3F+PsLq2OUQ3qVLl7hV/BIZiQOJzXZXT3ngXZUeP34c/0aDM+DTkCi+3MZs956fVRng9iIxQbTF46c7Aqsl3MJ1FtHZSDKxB0bV1dXw3romP/30UxMDodpNK7tZFYFtw3SdPHmSU3EU+YFL3KmnSBKA0N6uz8LCQlvtsI/n+T9mKT4+3rre3dxf6wN1HfDukRPHxsbGWveoJQfrRW3hYSwRISSuSCogqFNy4NT1E0gA9zNpeD+7xWxgqXHtbnAOgZzYDN29p1Bu2bLFem/aPCc/mT29IrRTj1pQ79iKvIIEcAeQnJxs/80uIiKCipOG+/8U3itN2AA1KteGhgYa9igXy/7WW2/dbDEfymjyAFaHRkhICFVpWFhYF+lBlwB6kYFxz25xHebXbYyNDWz0/k8wFvJh/PDhw7///nsjd3tm0pAHCOpnz57t16/fyJEjietBQUH6/iWA+8x+7Aosj4mJqa+vt64SLMrWrVvhqxWstpJPamoqsdzGjd16+lJzc3N5eTniYX+s/5NPPolUumMPugTQMw0Mode777L1s1tiOby31Xv6eMYOkATanLVUU1NDriB7+Pj4cHLObHOLBQngrgC7vHHjRkKyLcVjsRlqQsE+nlWjBw0a5J5nXfJgxYoVxcXFzsA4M4NBh+5xcXEJCQkIoKSkJCoqqnUno+HKlSs20osMgG+xkV6+vr6iV9dHj8q8tlInNp0qs49n+Io9OaIAxcBUVlZC38LCQmdR0ElZWZk94crJyUEAtG0Fc9qukLVl1q3NRwR16E7gCA8PxxQFBwf7+fk94YH4pAxwrwGJbUQxHIXuZkhgM8WosZwMYA/z2chrYmLiunXrzPO4B0mtT3v16lUb6XXhwgUb6UVQ73YjvYRukAGqqqqI2S2shZveOnPmzJSUlKFDh8bGxrK9zf9J4SZ6Y2mMzd6rhGPZDx8+TLSeO3euzVRqMZYBinMtUgGxgHoUp46KMDCjPBBFJIC7i23btsG/JUuW7Ny5083pdtNbm5qapk2blpWVZfTFqxCPbXAL8R49uGkllKe2gAwfLVq0yCnKGZjr16+bU6+rqxswYIAN30V7AwcOtP/uKDbIAt2fDEDBah3q1nYjAmx6KwYmPT0d3kNrK1gDAwPd/6Rok7h8ipaoiSlPw8LCcOrkEB8fH/3eQlesAdwoAJuK6tq7d+8OCAgYO3Ys++Tn5+NPMDbe6xrcuHHDhu/W1NSgE4hOluAQ/a5CdxKALbMxefLkW/x7H/y9jfRqbm4ODQ3FwFAMKKgLPa0XiPvByhPUsUP+/v420gv/o59K6MkCOHDgAHEdv67hu0KvzgCCcC+hcCtIAIIgAQiCBCAIEoAgSACCIAEIggQgCBKAIEgAgiABCIIEIAgSgCBIAIIgAQiCBCAIEoAgSACCIAEIggQgCBKAIEgAgiABCIIEIAgSgCBIAIIgAQiCBCAIEoAgSACCIAEIggQgCHcf/wdDxk1Jq1We/gAAAABJRU5ErkJggg=="}]}}},MapLayerStacks:{Set:{MapLayerStack:{name:"Default",MapLayer:{name:"layer1",refMapProvider:"404",opacity:"1.0",colBkgnd:"rgb(255,255,255)"}}}}}};o.prototype.exit=function(){e.prototype.exit.apply(this,arguments);this.detachSubmit(this.onGeoMapSubmit,this);this.detachContainerCreated(this.onGeoMapContainerCreated,this);this.detachContainerDestroyed(this.onGeoMapContainerDestroyed,this);this.detachCloseWindow(this.onGeoMapWindowClosed,this)};function n(){this.m_bActionsDirty=true;this.m_bSceneDirty=true;this.invalidate(this)}o.prototype.attachEvent=function(){e.prototype.attachEvent.apply(this,arguments);n.apply(this)};o.prototype.detachEvent=function(){e.prototype.detachEvent.apply(this,arguments);n.apply(this)};o.prototype.destroyResources=function(){this.m_bResourcesDirty=true;return this.destroyAggregation("resources")};o.prototype.addResource=function(e){this.m_bResourcesDirty=true;return this.addAggregation("resources",e)};o.prototype.insertResource=function(e,t){this.m_bResourcesDirty=true;return this.insertAggregation("resources",e,t)};o.prototype.removeResource=function(e){this.m_bResourcesDirty=true;return this.removeAggregation("resources",e)};o.prototype.removeAllResources=function(e){this.m_bResourcesDirty=true;return this.removeAllAggregation("resources")};o.prototype.destroyVos=function(){this.m_bVosDirty=true;return this.destroyAggregation("vos")};o.prototype.addVo=function(e){if(this.indexOfVo(e)<0){this.m_bVosDirty=true;this.addAggregation("vos",e);e.m_bAggRenew=true}return this};o.prototype.insertVo=function(e,t){this.m_bVosDirty=true;this.insertAggregation("vos",e,t);e.m_bAggRenew=true;return this};o.prototype.removeVo=function(e){this.m_bVosDirty=true;return this.removeAggregation("vos",e)};o.prototype.removeAllVos=function(e){this.m_bVosDirty=true;return this.removeAllAggregation("vos")};o.prototype.destroyGeoJsonLayers=function(){this.m_bGJLsDirty=true;return this.destroyAggregation("geoJsonLayers")};o.prototype.addGeoJsonLayer=function(e){this.m_bGJLsDirty=true;return this.addAggregation("geoJsonLayers",e)};o.prototype.insertGeoJsonLayer=function(e,t){this.m_bGJLsDirty=true;return this.insertAggregation("geoJsonLayers",e,t)};o.prototype.removeGeoJsonLayer=function(e){this.m_bGJLsDirty=true;return this.removeAggregation("geoJsonLayers",e)};o.prototype.removeAllGeoJsonLayers=function(e){this.m_bGJLsDirty=true;return this.removeAllAggregation("geoJsonLayers")};o.prototype.destroyFeatureCollections=function(){this.m_bFCsDirty=true;return this.destroyAggregation("featureCollections")};o.prototype.addFeatureCollection=function(e){this.m_bFCsDirty=true;return this.addAggregation("featureCollections",e)};o.prototype.insertFeatureCollection=function(e,t){this.m_bFCsDirty=true;return this.insertAggregation("featureCollections",e,t)};o.prototype.removeFeatureCollection=function(e){this.m_bFCsDirty=true;return this.removeAggregation("featureCollections",e)};o.prototype.removeAllFeatureCollections=function(e){this.m_bFCsDirty=true;return this.removeAllAggregation("featureCollections")};o.prototype.destroyClusters=function(){this.m_bClustersDirty=true;return this.destroyAggregation("clusters")};o.prototype.addCluster=function(e){this.m_bClustersDirty=true;return this.addAggregation("clusters",e)};o.prototype.insertCluster=function(e,t){this.m_bClustersDirty=true;return this.insertAggregation("clusters",e,t)};o.prototype.removeCluster=function(e){this.m_bClustersDirty=true;return this.removeAggregation("clusters",e)};o.prototype.removeAllClusters=function(e){this.m_bClustersDirty=true;return this.removeAllAggregation("clusters")};
/**
	 * Set Map configuration data. Map Configurations contain a set of Map Providers and Map Layer Stacks refering to those providers. The GeoMap
	 * property refMapLayerStack defines, which Map Layer Stack becomes visible.
	 *
	 * @param {object} oMapConfiguration Map Configuration object
	 * @param {array} oMapConfiguration.MapProvider Array of Map Provider definitions.
	 * @param {string} oMapConfiguration.MapProvider.name Name for the provider. Needed in Map Layer Stack as reference.
	 * @param {string} oMapConfiguration.MapProvider.tileX X-pixel dimension of map tile. Typical 256.
	 * @param {string} oMapConfiguration.MapProvider.tileY Y-pixel dimension of map tile. Typical 256.
	 * @param {string} oMapConfiguration.MapProvider.minLOD Minimal supported Level Of Detail.
	 * @param {string} oMapConfiguration.MapProvider.maxLOD Maximal supported Level Of Detail.
	 * @param {string} oMapConfiguration.MapProvider.copyright Copyright Information to be shown with the map.
	 * @param {array} oMapConfiguration.MapProvider.Header Array of HTTP headers definitions. Optional.
	 * @param {string} oMapConfiguration.MapProvider.Header.name Name of the header.
	 * @param {string} oMapConfiguration.MapProvider.Header.value Value of the header.
	 * @param {array} oMapConfiguration.MapProvider.Source Array of source definitions. At least on Source has to be given. Multiple sources can be used for load distribution.
	 * @param {string} oMapConfiguration.MapProvider.Source.id Source id.
	 * @param {string} oMapConfiguration.MapProvider.Source.url Source URL for map tile service. URL includes place holders for variable informations set at runtime, e.g. {LOD}.
	 * @param {array} oMapConfiguration.MapLayerStacks Array of Map Layer Stacks
	 * @param {string} oMapConfiguration.MapLayerStacks.name Name of Map Layer Stack. Use with the GeoMap refMapLayerStack property.
	 * @param {string} oMapConfiguration.MapLayerStacks.previewPosition.latitude Latitude position to use when creating image tile
	 * @param {string} oMapConfiguration.MapLayerStacks.previewPosition.longitude Longitude position to use when creating image tile
	 * @param {string} oMapConfiguration.MapLayerStacks.previewPosition.lod Lod position to use when creating image tile
	 * @param {array} oMapConfiguration.MapLayerStacks.MapLayer Array of Map Layers. Each Layer refers to a Map Proveride. Map Layers get overlayed in the given sequence.
	 * @param {string} oMapConfiguration.MapLayerStacks.MapLayer.name Name of Map Layer.
	 * @param {string} oMapConfiguration.MapLayerStacks.MapLayer.refMapProvider Name of referenced Map Provider.
	 * @param {string} oMapConfiguration.MapLayerStacks.MapLayer.opacity Opacity of Map Layer. Value range 0 to 1.
	 * @param {sap.ui.core.CSSColor} oMapConfiguration.MapLayerStacks.colBkgnd Background color for Map Layer. Only meaningful if opacity is below 1.
	 * @returns {sap.ui.vbm.GeoMap} This allows method chaining
	 * @public
	 * @ui5-metamodel This method also will be described in the UI5 (legacy) designtime metamodel
	 */o.prototype.setMapConfiguration=function(e){this.m_bMapConfigurationDirty=true;if(e.MapLayerStacks&&e.MapProvider){this.m_bMapLayerStacksDirty=true;this.m_bMapProvidersDirty=true;this.setProperty("mapConfiguration",e).invalidate()}return this};o.prototype.setClustering=function(e){this.m_bClusteringDirty=true;this.setProperty("clustering",e);return this};o.prototype.setRefMapLayerStack=function(e){if(e===this.getRefMapLayerStack()){return this}this.m_bRefMapLayerStackDirty=this.m_bSceneDirty=true;this.setProperty("refMapLayerStack",e).invalidate();return this};o.prototype.setVisualFrame=function(e){this.m_bVisualFrameDirty=true;this.setProperty("visualFrame",e);return this};o.prototype.setRectangularSelection=function(t){e.prototype.setRectangularSelection.apply(this,arguments);return this};o.prototype.setLassoSelection=function(t){e.prototype.setLassoSelection.apply(this,arguments);return this};o.prototype.setRectZoom=function(t){e.prototype.setRectZoom.apply(this,arguments);return this};o.prototype.getPositionInteractive=function(e,t){var i;if(!this.mIACreateCB&&t&&typeof t==="function"){this.mIACreateCB=t;var r=e?"POSARRAY":"POS";var a={SAPVB:{Automation:{Call:{handler:"OBJECTCREATIONHANDLER",name:"CreateObject",object:"MainScene",scene:"MainScene",instance:"",Param:{name:"data","#":"{"+r+"}"}}}}};this.load(a);i=true}else{i=false}return i};o.prototype.getCenterPosition=function(){var e=this.mVBIContext.GetMainScene(),t;if(e){var i=window.VBI.MathLib.RadToDeg(e.GetCenterPos());t=i[0]+";"+i[1]}else{t=this.getProperty("centerPosition")}return t};o.prototype.isNumeric=function(e){return!isNaN(parseFloat(e))&&isFinite(e)};o.prototype.setCenterPosition=function(e){var i=e?e.split(";"):undefined;if(!i||i.length<=1||!this.isNumeric(i[0])||!this.isNumeric(i[1])){t.error(sap.ui.vbm.getResourceBundle().getText("GEOMAP_INVALID_CENTER_POSITION")+":'"+e+"'","setCenterPosition",a)}else{var r=i[0]+";"+i[1]+";0";this.setProperty("centerPosition",r);if(this.isRendered()){i=r.split(";");this.zoomToGeoPosition(i[0],i[1],this.getZoomlevel())}}return this};o.prototype.setInitialPosition=function(e){this.setCenterPosition(e)};o.prototype.getZoomlevel=function(){var e=this.mVBIContext.GetMainScene();if(e){return parseInt(e.GetCurrentZoomlevel(),10)}return this.getProperty("zoomlevel")};o.prototype.setZoomlevel=function(e){if(!this.getDisableZoom()){if(e>=0){if(this.isRendered()){var i=this.getCenterPosition().split(";");if(this.getEnableAnimation()){var r=this.mVBIContext.GetMainScene();r.AnimateZoomToGeo(r.GetCenterPos(),e,5)}else{this.zoomToGeoPosition(i[0],i[1],e)}}this.setProperty("zoomlevel",e)}else{t.error(sap.ui.vbm.getResourceBundle().getText("GEOMAP_INVALID_ZOOM_LEVEL")+": "+e.toString(),"setZoomlevel",a)}}};o.prototype.setInitialZoom=function(e){this.setZoomlevel(parseInt(e,10))};o.prototype.openDetailWindow=function(e,t){this.mDTWindowCxt.key="";this.mDTWindowCxt.open=true;this.mDTWindowCxt.bUseClickPos=true;this.mDTWindowCxt.params=t?t:null;this.mDTWindowCxt.src={mClickGeoPos:e};this.invalidate(this);this.m_bWindowsDirty=true};o.prototype.goToStartPosition=function(){if(this.isRendered()){this.mVBIContext.GetMainScene().GoToInitialStart()}};o.prototype.closeAnyDetailWindow=function(){this.mDTWindowCxt.open=false;this.invalidate(this);this.m_bWindowsDirty=true};o.prototype.getVoByInternalId=function(e){var t=null;var i=e.split(/\./);var r=this.getAggregatorContainer(i[0]);if(r&&r.findInstance){t=r.findInstance(i[1])}return t};o.prototype.getClusteredSpots=function(e){var t=this.getInfoForCluster(e.getKey(),sap.ui.vbm.ClusterInfoType.ContainedVOs),i=t.map(function(e){return this.getVoByInternalId(e)}.bind(this));return i};o.prototype.setSelectionPropFireSelect=function(e){var t=e.N;for(var i=0;i<t.length;++i){var r=t[i];var a=r.E;var o;if((o=this.getAggregatorContainer(r.name))&&o.handleSelectEvent){o.handleSelectEvent(a)}}};o.prototype.onGeoMapSubmit=function(e){var t=JSON.parse(e.mParameters.data);if(t.Data&&t.Data.Merge){this.handleChangedData(t.Data.Merge.N)}var i;if(i=this.getAggregatorContainer(t.Action.object)){i.handleEvent(t);if(t.Action.name=="click"&&t.Data&&t.Data.Merge){this.setSelectionPropFireSelect(t.Data.Merge)}}else{switch(t.Action.name){case"click":this.fireClick({pos:t.Action.AddActionProperties.AddActionProperty[0]["#"],data:t});break;case"contextMenu":this.fireContextMenu({clientX:t.Action.Params.Param[0]["#"],clientY:t.Action.Params.Param[1]["#"],pos:t.Action.AddActionProperties.AddActionProperty[0]["#"],data:t});break;case"drop":this.fireDrop({pos:t.Action.AddActionProperties.AddActionProperty[0]["#"],data:t});break;case"zoomChanged":this.fireZoomChanged({zoomLevel:t.Action.AddActionProperties.AddActionProperty[0]["#"],centerPoint:t.Action.AddActionProperties.AddActionProperty[1]["#"],viewportBB:{upperLeft:t.Action.Params.Param[3]["#"],lowerRight:t.Action.Params.Param[4]["#"]},data:t});break;case"centerChanged":this.fireCenterChanged({zoomLevel:t.Action.AddActionProperties.AddActionProperty[0]["#"],centerPoint:t.Action.AddActionProperties.AddActionProperty[1]["#"],viewportBB:{upperLeft:t.Action.Params.Param[3]["#"],lowerRight:t.Action.Params.Param[4]["#"]},data:t});break;case"select":if(t.Data&&t.Data.Merge.N){var r=this.getSelectedItems(t.Data.Merge.N);this.fireSelect({selected:r,data:t});this.setSelectionPropFireSelect(t.Data.Merge)}break;case"GetPosComplete":if(this.mIACreateCB){try{this.mIACreateCB(t.Action.Params.Param[0]["#"]);this.mIACreateCB=null}catch(e){this.mIACreateCB=null;throw e}}else{t.Action.name="CreateComplete";this.fireEvent("createComplete",{data:t},true);e.preventDefault()}break;case"keydown":if(!this.fireEvent("keyDown",{key:t.Action.Params.Param[0]["#"],code:t.Action.Params.Param[1]["#"],shift:t.Action.Params.Param[2]["#"],ctrl:t.Action.Params.Param[3]["#"],alt:t.Action.Params.Param[4]["#"],meta:t.Action.Params.Param[5]["#"]},true)){e.preventDefault()}break;case"keypress":if(!this.fireEvent("keyPress",{key:t.Action.Params.Param[0]["#"],code:t.Action.Params.Param[1]["#"],shift:t.Action.Params.Param[2]["#"],ctrl:t.Action.Params.Param[3]["#"],alt:t.Action.Params.Param[4]["#"],meta:t.Action.Params.Param[5]["#"]},true)){e.preventDefault()}break;case"keyup":if(!this.fireEvent("keyUp",{key:t.Action.Params.Param[0]["#"],code:t.Action.Params.Param[1]["#"],shift:t.Action.Params.Param[2]["#"],ctrl:t.Action.Params.Param[3]["#"],alt:t.Action.Params.Param[4]["#"],meta:t.Action.Params.Param[5]["#"]},true)){e.preventDefault()}break;default:this.fireEvent(t.Action.name,t);break}}};o.prototype.onGeoMapContainerCreated=function(e){var t=e.getParameter("contentarea");if(t.m_ID){var i;if((i=this.getAggregatorContainer(t.m_ID))&&i.handleContainerCreated){i.handleContainerCreated(e)}}};o.prototype.onGeoMapContainerDestroyed=function(e){var t=e.getParameter("contentarea");if(t.m_ID){var i;if((i=this.getAggregatorContainer(t.m_ID))&&i.handleContainerDestroyed){i.handleContainerDestroyed(e)}}if(this.mDTWindowCxt.open&&e.getParameter("id")==="Detail"){this.mDTWindowCxt.open=false;this.mDTWindowCxt.src=null;this.m_bWindowsDirty=true}};o.prototype.onGeoMapWindowClosed=function(e){if(this.mDTWindowCxt.open&&e.getParameter("id")==="Detail"){this.mDTWindowCxt.open=false;this.mDTWindowCxt.src=null}};o.prototype.init=function(){this.attachSubmit(this.onGeoMapSubmit,this);this.attachContainerCreated(this.onGeoMapContainerCreated,this);this.attachContainerDestroyed(this.onGeoMapContainerDestroyed,this);this.attachCloseWindow(this.onGeoMapWindowClosed,this);this.m_bVosDirty=true;this.m_bFCsDirty=true;this.m_bGJLsDirty=true;this.m_bClustersDirty=true;this.m_bMapConfigurationDirty=true;this.m_bClusteringDirty=true;this.m_bVisualFrameDirty=true;this.m_bRefMapLayerStackDirty=true;this.m_bResourcesDirty=true;this.m_bMapProvidersDirty=true;this.m_bMapLayerStacksDirty=true;this.m_bWindowsDirty=true;this.m_bMapconfigDirty=true;this.m_bLegendDirty=true;this.m_bSceneDirty=true;this.m_bActionsDirty=true;this.mbForceDataUpdate=false;this.bDataDeltaUpdate=false;this.bHandleChangedDataActive=false;this.mDTWindowCxt={open:false,src:null,key:"",params:null};e.prototype.init.apply(this,arguments)};o.prototype.getSelectedItems=function(e){var t,i,r=[];if(!e){return null}if(jQuery.type(e)==="object"){t=this.getAggregatorContainer(e.name);i=t.findSelected(true,e.E);r=r.concat(i)}else if(jQuery.type(e)==="array"){for(var a=0;a<e.length;++a){t=this.getAggregatorContainer(e[a].name);i=t.findSelected(true,e[a].E);if(i&&i.length){r=r.concat(i)}}}return r};o.prototype.getWindowsObject=function(){var e={Set:[{name:"Main",Window:{id:"Main",caption:"MainWindow",type:"geo",refParent:"",refScene:"MainScene",modal:"true"}}],Remove:[]};var t=this.getLegend();if(t){var i;if(i=this.getDomRef(t.getId())){this.m_curLegendPos={right:parseInt(i.style.right,10),top:parseInt(i.style.top,10)}}var r=t.getTemplateObject();if(r.Set){e.Set=e.Set.concat(r.Set)}if(r.Remove){e.Remove=e.Remove.concat(r.Remove)}}if(this.mDTWindowCxt.src){var a,o;a=[{name:"Detail"}];if(this.mDTWindowCxt.key){var n=this.getChildByKey(this.mDTWindowCxt.src,this.mDTWindowCxt.key);if(!n){this.mDTWindowCxt.open=false;this.mDTWindowCxt.src=null;this.mDTWindowCxt.key="";this.mDTWindowCxt.params=null}else{this.mDTWindowCxt.src=n}}if(this.mDTWindowCxt.open){o={Set:[{name:"Detail",Window:{id:"Detail",type:"callout",refParent:"Main",refScene:"",modal:"true",caption:this.mDTWindowCxt.params.caption?this.mDTWindowCxt.params.caption:"",offsetX:this.mDTWindowCxt.params.offsetX?this.mDTWindowCxt.params.offsetX:"0",offsetY:this.mDTWindowCxt.params.offsetY?this.mDTWindowCxt.params.offsetY:"0"}}]};if(this.mDTWindowCxt.bUseClickPos==true&&this.mDTWindowCxt.src.mClickGeoPos){o.Set[0].Window.pos=this.mDTWindowCxt.src.mClickGeoPos}else{o.Set[0].Window["pos.bind"]=this.mDTWindowCxt.src.getParent().sId+"."+this.mDTWindowCxt.src.UniqueId+".P"}e.Set=e.Set.concat(o.Set)}e.Remove=e.Remove.concat(a)}return e};o.prototype.getActionArray=function(){var e=[];if(this.mEventRegistry["click"]){e.push({id:"GMap1",name:"click",refScene:"MainScene",refVO:"Map",refEvent:"Click",AddActionProperty:[{name:"pos"}]})}if(this.mEventRegistry["contextMenu"]){e.push({id:"GMap2",name:"contextMenu",refScene:"MainScene",refVO:"Map",refEvent:"ContextMenu",AddActionProperty:[{name:"pos"}]})}if(this.mEventRegistry["drop"]){e.push({id:"GMap3",name:"drop",refScene:"MainScene",refVO:"Map",refEvent:"Drop",AddActionProperty:[{name:"pos"}]})}if(this.mEventRegistry["zoomChanged"]){e.push({id:"GMap4",name:"zoomChanged",refScene:"MainScene",refVO:"Map",refEvent:"ZoomChanged",AddActionProperty:[{name:"zoom"},{name:"centerpoint"},{name:"pos"}]})}if(this.mEventRegistry["centerChanged"]){e.push({id:"GMap5",name:"centerChanged",refScene:"MainScene",refVO:"Map",refEvent:"CenterChanged",AddActionProperty:[{name:"zoom"},{name:"centerpoint"},{name:"pos"}]})}if(this.mEventRegistry["select"]){e.push({id:"GMap6",name:"select",refScene:"MainScene",refVO:"General",refEvent:"Select"})}e.push({id:"GMap7",name:"GetPosComplete",refScene:"MainScene",refVO:"General",refEvent:"CreateComplete"});if(this.mEventRegistry["keyDown"]){e.push({id:"GMap8",name:"keydown",refScene:"MainScene",refVO:"",refEvent:"KeyDown"})}if(this.mEventRegistry["keyPress"]){e.push({id:"GMap9",name:"keypress",refScene:"MainScene",refVO:"",refEvent:"KeyPress"})}if(this.mEventRegistry["keyUp"]){e.push({id:"GMap10",name:"keyup",refScene:"MainScene",refVO:"",refEvent:"KeyUp"})}return e};o.prototype.getSceneVOdelta=function(e,t){var i=[];var r=[];var a={};for(var o=0,n=e.length;o<n;++o){a[e[o].id]=e[o]}for(var s=0;s<t.length;++s){if(a[t[s].id]){if(JSON.stringify(t[s])!=JSON.stringify(a[t[s].id])){r.push({id:t[s].id,type:"VO"});i.push(t[s])}}else{i.push(t[s])}delete a[t[s].id]}for(var p in a){r.push({id:p,type:"VO"})}var c={Merge:{name:"MainScene",type:"SceneGeo",SceneGeo:{id:"MainScene",refMapLayerStack:this.getRefMapLayerStack()}}};if(r.length){c.Merge.SceneGeo.Remove=r}if(i.length){c.Merge.SceneGeo.VO=i}return c};o.prototype.minimizeApp=function(e){var t,i;i=null;if(!this.m_bWindowsDirty){(t=e)&&(t=t.SAPVB)&&(t=t.Windows)&&(i=JSON.stringify(t))&&i==this.m_curWindows&&delete e.SAPVB.Windows||(this.m_curWindows=i?i:this.m_curWindows)}else{this.m_bWindowsDirty=false}i=null;(t=e)&&(t=t.SAPVB)&&(t=t.Scenes)&&(i=JSON.stringify(t))&&i==this.m_curScenes&&delete e.SAPVB.Scenes||(this.m_curScenes=i?i:this.m_curScenes);i=null;(t=e)&&(t=t.SAPVB)&&(t=t.Actions)&&(i=JSON.stringify(t))&&i==this.m_curActions&&delete e.SAPVB.Actions||(this.m_curActions=i?i:this.m_curActions);i=null;(t=e)&&(t=t.SAPVB)&&(t=t.DataTypes)&&(i=JSON.stringify(t))&&i==this.m_curDataTypes&&delete e.SAPVB.DataTypes||(this.m_curDataTypes=i?i:this.m_curDataTypes);if(!this.mbForceDataUpdate){i=null;(t=e)&&(t=t.SAPVB)&&(t=t.Data)&&(i=JSON.stringify(t))&&i==this.m_curData&&delete e.SAPVB.Data||(this.m_curData=i?i:this.m_curData)}else{this.mbForceDataUpdate=false}return e};o.prototype.getAggregatorContainer=function(e){if(e!=="MainScene"){var t=this.getClusters();for(var i=0;i<t.length;++i){if(t[i].sId===e){return t[i]}}var r=this.getVos();for(var a=0,o=r.length;a<o;++a){if(r[a].sId===e){return r[a]}}var n=this.getGeoJsonLayers();for(var s=0;s<n.length;++s){if(e.indexOf(n[s].sId)===0){return n[s]}}var p=this.getFeatureCollections();for(var c=0;c<p.length;++c){if(e.indexOf(p[c].sId)===0){return p[c]}}var u=this.getLegend();if(u&&u.sId==e){return u}}return null};o.prototype.update=function(){var e=jQuery.extend(true,{},o.oBaseApp);if(this.m_bResourcesDirty){this.updateResourceData(e)}var t={};if(this.m_bClusteringDirty||this.m_bClustersDirty){this.updateClustering(e,t);this.mCurClusterRefVOs=jQuery.extend(true,{},t)}else{t=jQuery.extend(true,{},this.mCurClusterRefVOs)}if(this.m_bSceneDirty){this.updateScene(e,t)}if(this.m_bResourcesDirty){this.updateResourceData(e)}if(this.m_bMapConfigurationDirty){this.updateMapConfiguration(e)}this.updateMapProviders(e);this.updateMapLayerStacks(e);this.updateWindows(e);var i;if(i=this.getLegend()){if(e.SAPVB.Actions){Array.prototype.push.apply(e.SAPVB.Actions.Set.Action,i.getActionArray())}}if(this.m_bActionsDirty&&!e.SAPVB.Actions){this.m_bActionsDirty=false;((e.SAPVB.Actions={}).Set={}).Action=[]}if(e.SAPVB.Actions){this.m_bActionsDirty=false;Array.prototype.push.apply(e.SAPVB.Actions.Set.Action,this.getActionArray())}return this.minimizeApp(e)};o.prototype.updateMapProviders=function(e){if(!this.m_bMapProvidersDirty){delete e.SAPVB.MapProviders}this.m_bMapProvidersDirty=false};o.prototype.updateMapLayerStacks=function(e){if(!this.m_bMapLayerStacksDirty){delete e.SAPVB.MapLayerStacks}this.m_bMapLayerStacksDirty=false};o.prototype.updateWindows=function(e){e.SAPVB.Windows=this.getWindowsObject()};o.prototype.updateScene=function(e,t){var i=[];var r=t.Data?t.Data:[];var a=[];var o=[];var n=t.Actions?t.Actions:[];var s=!this.m_bFCsDirty&&!this.m_bGJLsDirty&&!this.m_bVosDirty;this.updateGJLData(i,r,a,o,n,s);this.updateFCData(i,r,a,o,n,s);this.updateVOData(i,r,a,o,n,s);if(t.VO){i=i.concat(t.VO)}if(this.m_bLegendDirty){var p=this.getLegend();if(p){a.push({name:p.sId,type:"N"});r.push(p.getDataObject());o.push(p.getTypeObject())}}var c=JSON.stringify(i);var u=true;if(!this.m_saVO){(((e.SAPVB.Scenes={}).Set={}).SceneGeo={id:"MainScene",refMapLayerStack:this.getRefMapLayerStack(),initialZoom:this.getProperty("zoomlevel"),initialStartPosition:this.getProperty("centerPosition"),scaleVisible:this.getScaleVisible().toString(),navControlVisible:this.getNavcontrolVisible().toString(),rectSelect:this.getRectangularSelection().toString(),lassoSelect:this.getLassoSelection().toString(),rectZoom:this.getRectZoom().toString(),VisualFrame:this.getVisualFrame(),NavigationDisablement:{zoom:this.getDisableZoom().toString(),move:this.getDisablePan().toString()},ariaLabel:this.getAriaLabel()}).VO=i}else if(this.m_bRefMapLayerStackDirty||!(this.m_saVO===c)){e.SAPVB.Scenes=this.getSceneVOdelta(JSON.parse(this.m_saVO),i)}else{u=false}this.m_saVO=c;if(!this.isRendered()&&e.SAPVB.Scenes&&e.SAPVB.Scenes.Merge){if(e.SAPVB.Scenes.Merge.SceneGeo.initialStartPosition!==this.getProperty("centerPosition")){e.SAPVB.Scenes.Merge.SceneGeo.initialStartPosition=this.getProperty("centerPosition")}if(e.SAPVB.Scenes.Merge.SceneGeo.initialZoom!==this.getProperty("zoomlevel")){e.SAPVB.Scenes.Merge.SceneGeo.initialZoom=this.getProperty("zoomlevel")}}var l;if(this.bDataDeltaUpdate){e.SAPVB.Data={};e.SAPVB.Data.Set=[];for(l=0;l<r.length;++l){e.SAPVB.Data.Set.push({name:r[l].name,type:"N",N:r[l]})}}else{e.SAPVB.Data={};if(a.length){e.SAPVB.Data.Remove=[];for(l=0;l<a.length;++l){e.SAPVB.Data.Remove.push(a[l])}}e.SAPVB.Data.Set=[];for(l=0;l<r.length;++l){e.SAPVB.Data.Set.push({name:r[l].name,type:"N",N:r[l]})}}if(u){((e.SAPVB.DataTypes={}).Set={}).N=o}((e.SAPVB.Actions={}).Set={}).Action=n;this.resetDirtyStates()};o.prototype.resetDirtyStates=function(){this.m_bRefMapLayerStackDirty=this.m_bSceneDirty=this.m_bFCsDirty=this.m_bGJLsDirty=this.m_bVosDirty=false};o.prototype.updateMapConfiguration=function(e){if(!this.m_bMapConfigurationDirty){return}this.m_bMapConfigurationDirty=false;var t=this.getMapConfiguration();if(t){e.SAPVB.MapProviders={Set:{MapProvider:t.MapProvider}};e.SAPVB.MapLayerStacks={Set:{MapLayerStack:t.MapLayerStacks}}}return};o.prototype.updateClustering=function(e,t){var i=this.getClusters();var r=null;if(i.length){r={Cluster:[]};t.VO=[];t.Actions=[];t.Data=[];for(var a=0,o;a<i.length;++a){o=i[a];t.VO.push(o.getTemplateObject());t.Actions=t.Actions.concat(o.getActionArray());r.Cluster.push(o.getClusterDefinition())}}else if(this.m_bClusteringDirty){r=this.getClustering()}if(r){e.SAPVB.Clustering={Set:r}}else if(this.mCurClusterRefVOs&&this.mCurClusterRefVOs.VO&&this.mCurClusterRefVOs.VO.length>0){e.SAPVB.Clustering={Set:[]}}this.m_bClusteringDirty=this.m_bClustersDirty=false};o.prototype.updateResourceData=function(e){if(!this.m_bResourcesDirty){return}this.m_bResourcesDirty=false;var t=this.getResources();((e.SAPVB.Resources={}).Set={}).Resource=[];function i(){var e=this.update();this.load(e)}var r=function(e){if(!e.m_Img){return}if(!e.m_Img.complete){return}var t=document.createElement("canvas");t.width=e.m_Img.width;t.height=e.m_Img.height;var r=t.getContext("2d");r.drawImage(e.m_Img,0,0);e.mProperties.value=t.toDataURL();delete e.m_Img;this.m_bResourcesDirty=true;window.setTimeout(i.bind(this),10)};for(var a=0,o=t.length;a<o;++a){var n=t[a];if(!n.mProperties.value&&n.mProperties.src){var s=document.createElement("img");s.crossOrigin="anonymous";n.m_Img=s;s.onload=r.bind(this,n);s.src=n.mProperties.src}else{e.SAPVB.Resources.Set.Resource.push({name:n.mProperties.name?n.mProperties.name:n.sId,value:n.mProperties.value})}}return};o.prototype.updateVOData=function(e,t,i,r,a,o){var n=this.getVos();for(var s=0,p=n.length;s<p;++s){var c=n[s];var u=c.aDiff;e.push(c.getTemplateObject());r.push(c.getTypeObject());Array.prototype.push.apply(a,c.getActionArray());if(u&&u.length&&c.m_bAggChange&&o){var l=c.getDataDeltaObject(u);if(l.oData&&l.oData.E&&l.oData.E.length){t.push(l.oData)}if(l.aRemoveData){for(var A=0;A<l.aRemoveData.length;++A){i.push(l.aRemoveData[A])}}}else if(!o||c.m_bAggRenew){i.push(c.getDataRemoveObject());if(c instanceof sap.ui.vbm.VoAggregation){c.resetIndices()}t.push(c.getDataObject())}if(c instanceof sap.ui.vbm.VoAggregation){c.aDiff=[];c.updateIdxArray();c.m_bAggRenew=c.m_bAggChange=false}}};o.prototype.updateGJLData=function(e,t,i,r,a,o){var n=this.getGeoJsonLayers();for(var s=0,p=n.length;s<p;++s){var c=n[s];Array.prototype.push.apply(e,c.getTemplateObjects());Array.prototype.push.apply(r,c.getTypeObjects());Array.prototype.push.apply(a,c.getActionArray());Array.prototype.push.apply(i,c.getDataRemoveObjects());Array.prototype.push.apply(t,c.getDataObjects())}};o.prototype.updateFCData=function(e,t,i,r,a,o){var n=this.getFeatureCollections();for(var s=0,p=n.length;s<p;++s){var c=n[s];Array.prototype.push.apply(e,c.getTemplateObjects());Array.prototype.push.apply(r,c.getTypeObjects());Array.prototype.push.apply(a,c.getActionArray());Array.prototype.push.apply(i,c.getDataRemoveObjects());Array.prototype.push.apply(t,c.getDataObjects())}};o.prototype.invalidate=function(e){this.m_bSceneDirty=true;if(e instanceof sap.ui.vbm.VoAggregation){this.m_bWindowsDirty=true;this.bDataDeltaUpdate=this.bHandleChangedDataActive}else if(e instanceof sap.ui.vbm.Legend){this.m_bLegendDirty=true}else if(e instanceof sap.ui.vbm.GeoJsonLayer){if(e instanceof sap.ui.vbm.FeatureCollection){this.m_bFCsDirty=true}else{this.m_bGJLsDirty=true}}else if(e instanceof sap.ui.vbm.ClusterBase){this.m_bClustersDirty=true}sap.ui.core.Control.prototype.invalidate.apply(this,arguments)};o.prototype.openContextMenu=function(e,t,i){if(i&&i.vbi_data&&i.vbi_data.VBIName=="DynContextMenu"){if(!this.mVBIContext.m_Menus){this.mVBIContext.m_Menus=new window.VBI.Menus}this.mVBIContext.m_Menus.m_menus.push(i);var r={SAPVB:{version:"2.0",Automation:{Call:{earliest:"0",handler:"CONTEXTMENUHANDLER",instance:t.sId,name:"SHOW",object:e,refID:"CTM",Param:[{name:"x","#":t.mClickPos[0]},{name:"y","#":t.mClickPos[1]},{name:"scene","#":"MainScene"}]}}}};this.loadHtml(r)}};o.prototype.addResourceIfNeeded=function(e){var t=this.getResources();for(var i=0,r=t.length;i<r;++i){if(t[i].getName()===e){return}}if(o.bEncodedSpotImagesAvailable==false){var a=sap.ui.resource("sap.ui.vbm","themes/base/img/Pin_images.json");var n=jQuery.sap.syncGetJSON(a);o.bEncodedSpotImageData=n.data;o.bEncodedSpotImagesAvailable=true}if(o.bEncodedSpotImageData){for(var s in o.bEncodedSpotImageData){if(e==s){this.addResource(new sap.ui.vbm.Resource({name:s,value:o.bEncodedSpotImageData[s]}))}}}else{this.addResource(new sap.ui.vbm.Resource({name:e,src:sap.ui.resource("sap.ui.vbm","themes/base/img/"+e)}))}this.m_bResourcesDirty=true};o.prototype.handleChangedData=function(e){try{this.bHandleChangedDataActive=true;if(e&&e.length){for(var t=0,i,r;t<e.length;++t){i=e[t];r=this.getAggregatorContainer(i.name);if(r){r.handleChangedData(i.E)}}}this.bHandleChangedDataActive=false}catch(e){this.bHandleChangedDataActive=false;throw e}};o.prototype.getChildByKey=function(e,t){var i,r=null;if(i=e.getParent()){if(i instanceof sap.ui.vbm.VoAggregation){if(this.getAggregatorContainer(i.getId())){r=i.findInstanceByKey(t)}}else{r=i.findInstance(t)}}return r};o.prototype.zoomToAreasById=function(e,t){if(t===undefined||t===null){t=.9999}e=[].concat(e);var i=this.getVos().filter(function(e){return e instanceof sap.ui.vbm.Areas});var r=i.reduce(function(e,t){return e.concat(t.getItems())},[]);var a=r.map(function(t){if(e.indexOf(t.getId())!==-1){return t.UniqueId}else{return null}});a=a.filter(function(e){return e?e:false});var o=this.mVBIContext.GetMainScene();o.ZoomTo(a,t);return this};return o},true);
/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5) (c) Copyright 2009-2012 SAP AG. All rights reserved
 */
sap.ui.predefine("sap/ui/vbm/GeoMapRenderer", ["./VBIRenderer"],function(e){"use strict";var r={apiVersion:2};r.render=function(r,a){a.addStyleClass("sapUiVbmGeoMap");e.render(r,a);var n;if(n=a.update()){a.load(n)}};return r},true);
/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5) (c) Copyright 2009-2012 SAP AG. All rights reserved
 */
sap.ui.predefine("sap/ui/vbm/HeatPoint", ["./VoBase","./library"],function(t,e){"use strict";var i=t.extend("sap.ui.vbm.HeatPoint",{metadata:{library:"sap.ui.vbm",properties:{position:{type:"string",group:"Misc",defaultValue:null},value:{type:"string",group:"Misc",defaultValue:null},radius:{type:"string",group:"Misc",defaultValue:"5"}},events:{}}});i.prototype.openDetailWindow=function(t,e,i){this.oParent.openDetailWindow(this,{caption:t,offsetX:e,offsetY:i},true)};i.prototype.getDataElement=function(){var e=t.prototype.getDataElement.apply(this,arguments);var i=this.oParent.mBindInfo;if(i.P){e.P=this.getPosition()}if(i.V){e.V=this.getValue()}if(i.R){e.R=this.getRadius()}return e};i.prototype.handleChangedData=function(t){if(t.P){this.setPosition(t.P)}if(t.V){this.setScale(t.V)}if(t.R){this.setRadius(t.R)}};i.prototype.getUniqueId=function(){return this.getId()};return i});
/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5) (c) Copyright 2009-2012 SAP AG. All rights reserved
 */
sap.ui.predefine("sap/ui/vbm/Heatmap", ["./VoAbstract","./library"],function(t,e){"use strict";var a=t.extend("sap.ui.vbm.Heatmap",{metadata:{library:"sap.ui.vbm",properties:{gradient:{type:"array",group:"Misc",defaultValue:null},opacity:{type:"string",group:"Misc",defaultValue:"0.5"},behavior:{type:"string",group:"Misc",defaultValue:"2"},valueScale:{type:"string",group:"Misc",defaultValue:"1.0"},radiusScale:{type:"string",group:"Misc",defaultValue:"1.0"},alphaExponent:{type:"string",group:"Misc",defaultValue:"1.0"},colorExponent:{type:"string",group:"Misc",defaultValue:"1.0"}},defaultAggregation:"items",aggregations:{items:{type:"sap.ui.vbm.HeatPoint",multiple:true,singularName:"item"}},events:{}}});a.prototype.getBindInfo=function(){var e=t.prototype.getBindInfo.apply(this,arguments);var a=this.getTemplateBindingInfo();e.P=a?a.hasOwnProperty("position"):true;e.V=a?a.hasOwnProperty("value"):true;e.R=a?a.hasOwnProperty("radius"):true;return e};a.prototype.getTemplateObject=function(){var e=t.prototype.getTemplateObject.apply(this,arguments);var a=this.mBindInfo=this.getBindInfo();var i=a.hasTemplate?this.getBindingInfo("items").template:null;e["type"]="{00100000-2012-0004-B001-E180770E8A12}";if(a.P){e["pos.bind"]=e.id+".P"}else{e.pos=i.getPosition()}if(a.R){e["radius.bind"]=e.id+".R"}else{e.radius=i.getRadius()}if(a.V){e["value.bind"]=e.id+".V"}else{e.value=i.getValue()}e.gradient=this.getGradient();e.opacity=this.getOpacity();e.behavior=this.getBehavior();e.radiusScale=this.getRadiusScale();e.valueScale=this.getValueScale();e.alphaExponent=this.getAlphaExponent();e.colorExponent=this.getColorExponent();return e};a.prototype.getTypeObject=function(){var e=t.prototype.getTypeObject.apply(this,arguments);var a=this.mBindInfo;if(a.P){e.A.push({name:"P",alias:"P",type:"vector"})}if(a.V){e.A.push({name:"V",alias:"V",type:"string"})}if(a.R){e.A.push({name:"R",alias:"R",type:"string"})}return e};a.prototype.handleEvent=function(t){};a.prototype.getActionArray=function(){var e=t.prototype.getActionArray.apply(this,arguments);return e};return a});
/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5) (c) Copyright 2009-2012 SAP AG. All rights reserved
 */
sap.ui.predefine("sap/ui/vbm/Legend", ["sap/ui/core/Element","./library"],function(e,t){"use strict";var a=e.extend("sap.ui.vbm.Legend",{metadata:{library:"sap.ui.vbm",properties:{caption:{type:"string",group:"Misc",defaultValue:sap.ui.getCore().getLibraryResourceBundle("sap.ui.vbm.i18n").getText("CAPTION_LEGEND")}},defaultAggregation:"items",aggregations:{items:{type:"sap.ui.vbm.LegendItem",multiple:true,singularName:"item"}},events:{click:{parameters:{data:{type:"object"},row:{type:"int"},ctrlKey:{type:"boolean"},shiftKey:{type:"boolean"},metaKey:{type:"boolean"},altKey:{type:"boolean"}}}}}});a.prototype.init=function(){};a.prototype.getTemplateObject=function(){var e=this.getId();var t={};if(this.getParent().getLegendVisible()){t={Set:[{name:e,Window:{id:e,type:"legend",caption:this.getCaption(),refParent:"Main",refScene:"",modal:"true",datasource:e,"colors.bind":e+".C","images.bind":e+".I","texts.bind":e+".T","tooltips.bind":e+".TT"}}]};if(this.getParent().m_curLegendPos){t.Set[0].Window.right=this.getParent().m_curLegendPos.right.toString();t.Set[0].Window.top=this.getParent().m_curLegendPos.top.toString()}}else{t={Remove:[{name:e}]}}return t};a.prototype.getTypeObject=function(){return{name:this.getId(),A:[{name:"C",alias:"C",type:"color"},{name:"I",alias:"I",type:"string"},{name:"T",alias:"T",type:"string"},{name:"TT",alias:"TT",type:"string"}]}};a.prototype.getDataObject=function(){var e={};e["name"]=this.getId();e.E=[];var t=this.getItems();for(var a=0,r=t.length;a<r;++a){e.E.push(t[a].getDataElement())}return e};a.prototype.handleEvent=function(e){var t=e.Action.name;var a="fire"+t[0].toUpperCase()+t.slice(1);var r={data:e,ctrlKey:e.Action.Params.Param[1]["#"],shiftKey:e.Action.Params.Param[2]["#"],metaKey:e.Action.Params.Param[3]["#"],altKey:e.Action.Params.Param[4]["#"]};var i;if(i=this.findInstance(e.Action.Params.Param[0]["#"])){if(i.mEventRegistry[t]){if(t=="click"){i[a](r)}}}r.row=parseInt(e.Action.Params.Param[0]["#"],10);this[a](r)};a.prototype.getActionArray=function(){var e=this.getId();var t=[];if(this.mEventRegistry["click"]||this.isEventRegistered("click")){t.push({id:e+"1",name:"click",refScene:"MainScene",refVO:e,refEvent:"Click"})}return t};a.prototype.isEventRegistered=function(e){var t=this.getItems();if(!t){return false}for(var a=0,r=t.length;a<r;++a){var i=t[a];if(i.mEventRegistry[e]){return true}}return false};a.prototype.findInstance=function(e){var t=this.getItems();t[0].sId.lastIndexOf("-");t=this.getItems();if(!t){return false}for(var a=0,r=t.length;a<r;++a){var i=t[a].sId;var n=i.lastIndexOf("-");var s=i.substring(n+1);if(s===e){return t[a]}}return null};return a});
/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5) (c) Copyright 2009-2012 SAP AG. All rights reserved
 */
sap.ui.predefine("sap/ui/vbm/LegendItem", ["sap/ui/core/Element","./library"],function(e,t){"use strict";var a=e.extend("sap.ui.vbm.LegendItem",{metadata:{library:"sap.ui.vbm",properties:{color:{type:"string",group:"Misc",defaultValue:""},image:{type:"string",group:"Misc",defaultValue:null},semanticSpotType:{type:"sap.ui.vbm.SemanticType",group:"Behavior",defaultValue:null},text:{type:"string",group:"Misc",defaultValue:null}},events:{click:{parameters:{data:{type:"object"},ctrlKey:{type:"boolean"},shiftKey:{type:"boolean"},metaKey:{type:"boolean"},altKey:{type:"boolean"}}}}}});a.prototype.getDataElement=function(){var e={};var t,a,i,n,p;if(t=this.getColor()){e.C=t}if(a=this.getImage()){e.I=a}if(i=this.getSemanticSpotType()){switch(i){case sap.ui.vbm.SemanticType.Hidden:e.I="Pin_Hidden.png";break;case sap.ui.vbm.SemanticType.Error:e.I="Pin_Red.png";break;case sap.ui.vbm.SemanticType.Warning:e.I="Pin_Orange.png";break;case sap.ui.vbm.SemanticType.Success:e.I="Pin_Green.png";break;case sap.ui.vbm.SemanticType.Inactive:e.I="Pin_Grey.png";break;case sap.ui.vbm.SemanticType.Default:e.I="Pin_Blue.png";break;default:break}if(e.I){this.getParent().getParent().addResourceIfNeeded(e.I)}}if(n=this.getText()){e.T=n}if(p=this.getTooltip()){e.TT=p}return e};return a});
/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5) (c) Copyright 2009-2012 SAP AG. All rights reserved
 */
sap.ui.predefine("sap/ui/vbm/Pie", ["./VoBase","./library"],function(t,e){"use strict";var i=t.extend("sap.ui.vbm.Pie",{metadata:{library:"sap.ui.vbm",properties:{position:{type:"string",group:"Misc",defaultValue:null},scale:{type:"string",group:"Misc",defaultValue:null}},defaultAggregation:"items",aggregations:{items:{type:"sap.ui.vbm.PieItem",multiple:true,singularName:"item"}},events:{}}});i.prototype.openContextMenu=function(t){this.oParent.openContextMenu("Pie",this,t)};i.prototype.getDataElement=function(){var e=[];var i=this.getItems();for(var a=0,n=i.length;a<n;++a){var r=i[a];e.push({T:r.getName(),V:r.getValue(),C:r.getColor()})}var s=t.prototype.getDataElement.apply(this,arguments);var o=this.oParent.mBindInfo;if(o.P){s.P=this.getPosition()}if(o.S){s.S=this.getScale()}s.N={name:"Series",E:e};return s};i.prototype.handleChangedData=function(t){if(t.P){this.setPosition(t.P)}if(t.S){this.setScale(t.S)}};return i});
/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5) (c) Copyright 2009-2012 SAP AG. All rights reserved
 */
sap.ui.predefine("sap/ui/vbm/PieItem", ["sap/ui/core/Element","./library"],function(e,t){"use strict";var u=e.extend("sap.ui.vbm.PieItem",{metadata:{library:"sap.ui.vbm",properties:{name:{type:"string",group:"Misc",defaultValue:""},value:{type:"string",group:"Misc",defaultValue:null},color:{type:"string",group:"Misc",defaultValue:null}},events:{click:{}}}});return u});
/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5) (c) Copyright 2009-2012 SAP AG. All rights reserved
 */
sap.ui.predefine("sap/ui/vbm/Pies", ["./VoAggregation","./library"],function(e,t){"use strict";var i=e.extend("sap.ui.vbm.Pies",{metadata:{library:"sap.ui.vbm",properties:{posChangeable:{type:"boolean",group:"Misc",defaultValue:true},scaleChangeable:{type:"boolean",group:"Misc",defaultValue:true}},defaultAggregation:"items",aggregations:{items:{type:"sap.ui.vbm.Pie",multiple:true,singularName:"item"}},events:{}}});i.prototype.getBindInfo=function(){var t=e.prototype.getBindInfo.apply(this,arguments);var i=this.getTemplateBindingInfo();t.P=i?i.hasOwnProperty("position"):true;t.S=i?i.hasOwnProperty("scale"):true;return t};i.prototype.getTemplateObject=function(){var t=e.prototype.getTemplateObject.apply(this,arguments);var i=this.mBindInfo=this.getBindInfo();var n=i.hasTemplate?this.getBindingInfo("items").template:null;t["type"]="{00100000-2012-0004-B001-383477EA1DEB}";if(i.P){t["pos.bind"]=t.id+".P"}else{t.pos=n.getPosition()}if(i.S){t["scale.bind"]=t.id+".S"}else{t.scale=n.getScale()}t["series.bind"]=t.id+".Series";t["text.bind"]=t.id+".Series.T";t["value.bind"]=t.id+".Series.V";t["slicecolor.bind"]=t.id+".Series.C";return t};i.prototype.getTypeObject=function(){var t=e.prototype.getTypeObject.apply(this,arguments);var i=this.mBindInfo;if(i.P){t.A.push({changeable:this.getPosChangeable().toString(),name:"P",alias:"P",type:"vector"})}if(i.S){t.A.push({changeable:this.getScaleChangeable().toString(),name:"S",alias:"S",type:"vector"})}t.N={name:"Series",A:[{name:"V",alias:"V",type:"float"},{name:"T",alias:"T",type:"string"},{name:"C",alias:"C",type:"string"}]};return t};i.prototype.getActionArray=function(){var t=e.prototype.getActionArray.apply(this,arguments);var i=this.getId();if(this.mEventRegistry["click"]||this.isEventRegistered("click")){t.push({id:i+"1",name:"click",refScene:"MainScene",refVO:i,refEvent:"Click",AddActionProperty:[{name:"pos"},{name:"pieitem"}]})}if(this.mEventRegistry["contextMenu"]||this.isEventRegistered("contextMenu")){t.push({id:i+"2",name:"contextMenu",refScene:"MainScene",refVO:i,refEvent:"ContextMenu",AddActionProperty:[{name:"pieitem"}]})}if(this.mEventRegistry["drop"]||this.isEventRegistered("drop")){t.push({id:i+"3",name:"drop",refScene:"MainScene",refVO:i,refEvent:"Drop"})}return t};return i});
/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5) (c) Copyright 2009-2012 SAP AG. All rights reserved
 */
sap.ui.predefine("sap/ui/vbm/Region", ["sap/ui/core/Element","./library"],function(e,t){"use strict";var a=e.extend("sap.ui.vbm.Region",{metadata:{library:"sap.ui.vbm",properties:{color:{type:"sap.ui.core.CSSColor",group:"Appearance",defaultValue:null},code:{type:"string",group:"Misc",defaultValue:null},select:{type:"boolean",group:"Misc",defaultValue:false},labelText:{type:"string",group:"Misc",defaultValue:null},labelType:{type:"sap.ui.vbm.SemanticType",group:"Behavior",defaultValue:sap.ui.vbm.SemanticType.None},labelBgColor:{type:"string",group:"Misc",defaultValue:"RGB(255;255;255)"},labelBorderColor:{type:"string",group:"Misc",defaultValue:null},labelArrow:{type:"boolean",group:"Misc",defaultValue:false}},events:{click:{parameters:{code:{type:"string"}}},contextMenu:{parameters:{code:{type:"string"}}}}}});a.prototype.getInfo=function(){return this.getParent().getRegionsInfo([this.getCode()])[0]};return a});
/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5) (c) Copyright 2009-2012 SAP AG. All rights reserved
 */
sap.ui.predefine("sap/ui/vbm/Resource", ["sap/ui/core/Element","./library"],function(e,u){"use strict";var r=e.extend("sap.ui.vbm.Resource",{metadata:{library:"sap.ui.vbm",properties:{value:{type:"string",group:"Misc",defaultValue:null},src:{type:"string",group:"Misc",defaultValue:""},name:{type:"string",group:"Misc",defaultValue:null}}}});return r});
/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5) (c) Copyright 2009-2012 SAP AG. All rights reserved
 */
sap.ui.predefine("sap/ui/vbm/Route", ["./VoBase","./library"],function(t,e){"use strict";var r=t.extend("sap.ui.vbm.Route",{metadata:{library:"sap.ui.vbm",properties:{position:{type:"string",group:"Misc",defaultValue:null},color:{type:"string",group:"Misc",defaultValue:"RGB(0;0;0)"},start:{type:"string",group:"Misc",defaultValue:"0"},end:{type:"string",group:"Misc",defaultValue:"0"},linewidth:{type:"string",group:"Misc",defaultValue:"3"},dotcolor:{type:"string",group:"Misc",defaultValue:"RGB(0;0;0)"},dotbordercolor:{type:"string",group:"Misc",defaultValue:"RGB(0;0;0)"},colorBorder:{type:"string",group:"Misc"},lineDash:{type:"string",group:"Misc"},dotwidth:{type:"string",group:"Misc",defaultValue:"0"},routetype:{type:"sap.ui.vbm.RouteType",group:"Misc",defaultValue:"Straight"},directionIndicator:{type:"boolean",group:"Misc",defaultValue:false}},aggregations:{dragSource:{type:"sap.ui.vbm.DragSource",multiple:true,singularName:"dragSource"},dropTarget:{type:"sap.ui.vbm.DropTarget",multiple:true,singularName:"dropTarget"}},events:{}}});r.prototype.openContextMenu=function(t){this.oParent.openContextMenu("Route",this,t)};r.prototype.getDataElement=function(){var e=t.prototype.getDataElement.apply(this,arguments);var r=this.oParent.mBindInfo;if(r.P){if(this.getRoutetype()=="Geodesic"){var i=this.getPosition().split(";");var a=i.length;var s=i.slice(0,3);var o=i.slice(a-3,a);var n=this.calcGeodesicRoute(s,o);e.P=s[0]+";"+s[1]+";0.0;"+n+o[0]+";"+o[1]+";0.0"}else{e.P=this.getPosition()}}if(r.C){e.C=this.getColor()}if(r.ST){e.ST=this.getStart()}if(r.ED){e.ED=this.getEnd()}if(r.LW){e.LW=this.getLinewidth()}if(r.DC){e.DC=this.getDotcolor()}if(r.DBC){e.DBC=this.getDotbordercolor()}if(r.CB){var u=this.getColorBorder();if(u!=undefined&&u!=""){e.CB=u}}if(r.LD){var h=this.getLineDash();if(h!=undefined&&h!=""){e.LD=h}}if(r.DW){e.DW=this.getDotwidth()}if(r.DS||r.DT){e.N=this.getDragDropDefs()}if(r.DI){e.DI=this.getDirectionIndicator()}return e};r.prototype.handleChangedData=function(t){if(t.P){this.setPosition(t.P)}};r.prototype.dot=function(t,e){var r=0;r=t[1]*e[1]+t[2]*e[2]+t[3]*e[3];return r};r.prototype.cross=function(t,e){var r=new Array(4);r[1]=t[2]*e[3]-t[3]*e[2];r[2]=t[3]*e[1]-t[1]*e[3];r[3]=t[1]*e[2]-t[2]*e[1];return r};r.prototype.radians=function(t){return t*Math.PI/180};r.prototype.degrees=function(t){return t*180/Math.PI};r.prototype.calcGeodesicRoute=function(t,e){var r=new Array(4);var i=new Array(4);var a=new Array(4);var s=new Array(4);var o=new Array(4);r[1]=Math.cos(this.radians(t[1]))*Math.cos(this.radians(t[0]));r[2]=Math.cos(this.radians(t[1]))*Math.sin(this.radians(t[0]));r[3]=Math.sin(this.radians(t[1]));i[1]=Math.cos(this.radians(e[1]))*Math.cos(this.radians(e[0]));i[2]=Math.cos(this.radians(e[1]))*Math.sin(this.radians(e[0]));i[3]=Math.sin(this.radians(e[1]));a=this.cross(r,i);var n=Math.sqrt(this.dot(a,a));s[1]=a[1]/n;s[2]=a[2]/n;s[3]=a[3]/n;o=this.cross(s,r);var u=new Array(101);var h=new Array(201);var p;for(p=0;p<=100;p++){u[p]=new Array(4);h[p]=new Array(4)}var d=Math.acos(this.dot(r,i));var c="";for(p=0;p<=100;p++){var g=p/100*d;u[p][0]=0;u[p][1]=Math.cos(g)*r[1]+Math.sin(g)*o[1];u[p][2]=Math.cos(g)*r[2]+Math.sin(g)*o[2];u[p][3]=Math.cos(g)*r[3]+Math.sin(g)*o[3];h[p][0]=0;h[p][1]=this.degrees(Math.atan2(u[p][2],u[p][1]));h[p][2]=this.degrees(Math.asin(u[p][3]));c+=h[p][1]+";"+h[p][2]+"; 0 "+";"}return c};return r});
/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5) (c) Copyright 2009-2012 SAP AG. All rights reserved
 */
sap.ui.predefine("sap/ui/vbm/Routes", ["./VoAggregation","./library"],function(e,t){"use strict";var r=e.extend("sap.ui.vbm.Routes",{metadata:{library:"sap.ui.vbm",properties:{posChangeable:{type:"boolean",group:"Misc",defaultValue:true}},defaultAggregation:"items",aggregations:{items:{type:"sap.ui.vbm.Route",multiple:true,singularName:"item"},dragSource:{type:"sap.ui.vbm.DragSource",multiple:true,singularName:"dragSource"},dropTarget:{type:"sap.ui.vbm.DropTarget",multiple:true,singularName:"dropTarget"}},events:{click:{},contextMenu:{},drop:{}}}});r.prototype.getBindInfo=function(){var t=e.prototype.getBindInfo.apply(this,arguments);var r=this.getTemplateBindingInfo();t.P=r?r.hasOwnProperty("position"):true;t.C=r?r.hasOwnProperty("color"):true;t.ST=r?r.hasOwnProperty("start"):true;t.ED=r?r.hasOwnProperty("end"):true;t.LW=r?r.hasOwnProperty("linewidth"):true;t.DC=r?r.hasOwnProperty("dotcolor"):true;t.DW=r?r.hasOwnProperty("dotwidth"):true;t.DBC=r?r.hasOwnProperty("dotbordercolor"):true;t.CB=r?r.hasOwnProperty("colorBorder"):true;t.LD=r?r.hasOwnProperty("lineDash"):true;t.DI=r?r.hasOwnProperty("directionIndicator"):true;return t};r.prototype.getTemplateObject=function(){var t=e.prototype.getTemplateObject.apply(this,arguments);var r=this.mBindInfo=this.getBindInfo();var i=r.hasTemplate?this.getBindingInfo("items").template:null;t["type"]="{00100000-2012-0004-B001-C46BD7336A1A}";if(r.P){t["posarray.bind"]=t.id+".P"}else{t.posarray=i.getPosition()}if(r.C){t["color.bind"]=t.id+".C"}else{t.color=i.getColor()}if(r.ST){t["start.bind"]=t.id+".ST"}else{t.start=i.getStart()}if(r.ED){t["end.bind"]=t.id+".ED"}else{t.end=i.getEnd()}if(r.LW){t["linewidth.bind"]=t.id+".LW"}else{t.linewidth=i.getLinewidth()}if(r.DC){t["dotcolor.bind"]=t.id+".DC"}else{t.dotcolor=i.getDotcolor()}if(r.DBC){t["dotbordercolor.bind"]=t.id+".DBC"}else{t.dotbordercolor=i.getDotbordercolor()}if(r.CB){t["colorBorder.bind"]=t.id+".CB"}else{t.colorBorder=i.getColorBorder()}if(r.LD){t["lineDash.bind"]=t.id+".LD"}else{t.lineDash=i.getLineDash()}if(r.DW){t["dotwidth.bind"]=t.id+".DW"}else{t.dotwidth=i.getDotwidth()}if(r.DI){t["directionIndicator.bind"]=t.id+".DI"}else{t.directionIndicator=i.getDirectionIndicator()}t["DragSource"]={DragItem:this.getDragItemTemplate(t.id)};t["DropTarget"]={DropItem:this.getDropItemTemplate(t.id)};return t};r.prototype.getTypeObject=function(){var t=e.prototype.getTypeObject.apply(this,arguments);var r=this.mBindInfo;if(r.P){t.A.push({changeable:this.getPosChangeable().toString(),name:"P",alias:"P",type:"vector"})}if(r.C){t.A.push({name:"C",alias:"C",type:"color"})}if(r.ST){t.A.push({name:"ST",alias:"ST",type:"long"})}if(r.ED){t.A.push({name:"ED",alias:"ED",type:"long"})}if(r.LW){t.A.push({name:"LW",alias:"LW",type:"float"})}if(r.DC){t.A.push({name:"DC",alias:"DC",type:"color"})}if(r.DBC){t.A.push({name:"DBC",alias:"DBC",type:"color"})}if(r.CB){t.A.push({name:"CB",alias:"CB",type:"color"})}if(r.LD){t.A.push({name:"LD",alias:"LD",type:"string"})}if(r.DW){t.A.push({name:"DW",alias:"DW",type:"float"})}if(r.DI){t.A.push({name:"DI",alias:"DI",type:"boolean"})}return t};r.prototype.getActionArray=function(){var t=e.prototype.getActionArray.apply(this,arguments);var r=this.getId();if(this.mEventRegistry["click"]||this.isEventRegistered("click")){t.push({id:r+"1",name:"click",refScene:"MainScene",refVO:r,refEvent:"Click",AddActionProperty:[{name:"pos"}]})}if(this.mEventRegistry["contextMenu"]||this.isEventRegistered("contextMenu")){t.push({id:r+"2",name:"contextMenu",refScene:"MainScene",refVO:r,refEvent:"ContextMenu"})}if(this.mEventRegistry["drop"]||this.isEventRegistered("drop")){t.push({id:r+"3",name:"drop",refScene:"MainScene",refVO:r,refEvent:"Drop"})}return t};return r});
/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5) (c) Copyright 2009-2012 SAP AG. All rights reserved
 */
sap.ui.predefine("sap/ui/vbm/Spot", ["./VoBase","sap/ui/core/theming/Parameters","./library"],function(e,t,i){"use strict";var n=e.extend("sap.ui.vbm.Spot",{metadata:{library:"sap.ui.vbm",properties:{position:{type:"string",group:"Misc",defaultValue:"0;0;0"},text:{type:"string",group:"Misc",defaultValue:null},image:{type:"string",group:"Misc",defaultValue:null},alignment:{type:"string",group:"Misc",defaultValue:"5"},scale:{type:"string",group:"Misc",defaultValue:"1;1;1"},imageSelected:{type:"string",group:"Misc",defaultValue:null},icon:{type:"string",group:"Misc",defaultValue:null},contentColor:{type:"string",group:"Misc",defaultValue:null},contentOffset:{type:"string",group:"Misc",defaultValue:"0;0"},contentFont:{type:"string",group:"Misc",defaultValue:"arial"},contentSize:{type:"string",group:"Misc",defaultValue:null},type:{type:"sap.ui.vbm.SemanticType",group:"Behavior",defaultValue:null}},aggregations:{dragSource:{type:"sap.ui.vbm.DragSource",multiple:true,singularName:"dragSource"},dropTarget:{type:"sap.ui.vbm.DropTarget",multiple:true,singularName:"dropTarget"}},events:{}}});n.prototype.init=function(){this.mProperties.contentColor="#000000";this.mProperties.contentSize=t?t.get("sapMFontMediumSize"):null};n.prototype.openContextMenu=function(e){this.getParent().openContextMenu("Spot",this,e)};n.prototype.getImageProps=function(e,t,i){var n={};if(e!==sap.ui.vbm.SemanticType.None){if(e===sap.ui.vbm.SemanticType.Hidden){n.I="Pin_Hidden.png"}else{if(e===sap.ui.vbm.SemanticType.Error){n.I="Pin_Red_"}if(e===sap.ui.vbm.SemanticType.Warning){n.I="Pin_Orange_"}if(e===sap.ui.vbm.SemanticType.Success){n.I="Pin_Green_"}if(e===sap.ui.vbm.SemanticType.Inactive){n.I="Pin_Grey_"}if(e===sap.ui.vbm.SemanticType.Default){n.I="Pin_Blue_"}if(t){if(t>3){n.I+="5-digit_space.png";n.CO="15;-3"}else if(t>1){n.I+="3-digit_space.png";n.CO="9;-3"}else{n.I+="1-digit.png";n.CO="0;-3"}}else if(n.I){n.I+=i?"1_Icon.png":"0_Icon.png";if(i){n.CO="0;-5"}}}if(n.I){this.getParent().getParent().addResourceIfNeeded(n.I)}}return n};n.prototype.getDataElement=function(){var t=e.prototype.getDataElement.apply(this,arguments);var i=this.oParent.mBindInfo;if(i.P){t.P=this.getPosition()}if(i.S){t.S=this.getScale()}if(i.T){t.T=this.getText()}if(i.I){t.I=this.getImage()}if(i.IS){t.IS=this.getImageSelected()}if(i.AL){t.AL=this.getAlignment()}if(i.IC){t.IC=this.getIcon()}if(i.CC){t.CC=this.getContentColor()}if(i.CO){t.CO=this.getContentOffset()}if(i.CF){t.CF=this.getContentFont()}if(i.CS){t.CS=this.getContentSize()}if(i.DS||i.DT){t.N=this.getDragDropDefs()}var n=this.getText();var a=n?n.length:0;var r=this.getIcon();var s=r.length>0?true:false;var p=this.getImageProps(this.getType(),a,s);if(p.I){t.I=p.I}if(p.CO){t.CO=p.CO}return t};n.prototype.handleChangedData=function(e){if(e.P){this.setPosition(e.P)}if(e.S){this.setScale(e.S)}};return n});
/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5) (c) Copyright 2009-2012 SAP AG. All rights reserved
 */
sap.ui.predefine("sap/ui/vbm/Spots", ["./VoAggregation","./library"],function(e,t){"use strict";var n=e.extend("sap.ui.vbm.Spots",{metadata:{library:"sap.ui.vbm",properties:{posChangeable:{type:"boolean",group:"Misc",defaultValue:true},scaleChangeable:{type:"boolean",group:"Misc",defaultValue:true}},defaultAggregation:"items",aggregations:{items:{type:"sap.ui.vbm.Spot",multiple:true,singularName:"item"},dragSource:{type:"sap.ui.vbm.DragSource",multiple:true,singularName:"dragSource"},dropTarget:{type:"sap.ui.vbm.DropTarget",multiple:true,singularName:"dropTarget"}},events:{}}});n.prototype.getBindInfo=function(){var t=e.prototype.getBindInfo.apply(this,arguments);var n=this.getTemplateBindingInfo();t.S=n?n.hasOwnProperty("scale"):true;t.I=n?n.hasOwnProperty("image"):true;t.IS=n?n.hasOwnProperty("imageSelected"):true;t.P=n?n.hasOwnProperty("position"):true;t.T=n?n.hasOwnProperty("text"):true;t.AL=n?n.hasOwnProperty("alignment"):true;t.IC=n?n.hasOwnProperty("icon"):true;t.CC=n?n.hasOwnProperty("contentColor"):true;t.CO=n?n.hasOwnProperty("contentOffset"):true;t.CF=n?n.hasOwnProperty("contentFont"):true;t.CS=n?n.hasOwnProperty("contentSize"):true;t.Type=n?n.hasOwnProperty("type"):true;return t};n.prototype.getTemplateObject=function(){var t=e.prototype.getTemplateObject.apply(this,arguments);var n=this.mBindInfo=this.getBindInfo();var i=n.hasTemplate?this.getBindingInfo("items").template:null;if(n.Type||i.mProperties["type"]!==sap.ui.vbm.SemanticType.None){n.T=n.I=n.CO=n.CC=true}t["type"]="{00100000-2012-0004-B001-64592B8DB964}";if(n.P){t["pos.bind"]=t.id+".P"}else{t.pos=i.getPosition()}if(n.IC){t["icon.bind"]=t.id+".IC"}else{t.icon=i.getIcon()}if(n.S){t["scale.bind"]=t.id+".S"}else{t.scale=i.getScale()}if(n.IS){t["imageSelected.bind"]=t.id+".IS"}else{t.imageSelected=i.getImageSelected()}if(n.AL){t["alignment.bind"]=t.id+".AL"}else{t.alignment=i.getAlignment()}if(n.CF){t["contentFont.bind"]=t.id+".CF"}else{t.contentFont=i.getContentFont()}if(n.CS){t["contentSize.bind"]=t.id+".CS"}else{t.contentSize=i.getContentSize()}if(n.T){t["text.bind"]=t.id+".T"}else{t.text=i.getText()}if(n.I){t["image.bind"]=t.id+".I"}else{t.image=i.getImage()}if(n.CO){t["contentOffset.bind"]=t.id+".CO"}else{t.contentOffset=i.getContentOffset()}if(n.CC){t["contentColor.bind"]=t.id+".CC"}else{t.contentColor=i.getContentColor()}t["DragSource"]={DragItem:this.getDragItemTemplate(t.id)};t["DropTarget"]={DropItem:this.getDropItemTemplate(t.id)};return t};n.prototype.getTypeObject=function(){var t=e.prototype.getTypeObject.apply(this,arguments);var n=this.mBindInfo;if(n.P){t.A.push({changeable:this.getPosChangeable().toString(),name:"P",alias:"P",type:"vector"})}if(n.S){t.A.push({changeable:this.getScaleChangeable().toString(),name:"S",alias:"S",type:"vector"})}if(n.T){t.A.push({name:"T",alias:"T",type:"string"})}if(n.I){t.A.push({name:"I",alias:"I",type:"string"})}if(n.IS){t.A.push({name:"IS",alias:"IS",type:"string"})}if(n.AL){t.A.push({name:"AL",alias:"AL",type:"string"})}if(n.IC){t.A.push({name:"IC",alias:"IC",type:"string"})}if(n.CC){t.A.push({name:"CC",alias:"CC",type:"string"})}if(n.CO){t.A.push({name:"CO",alias:"CO",type:"string"})}if(n.CF){t.A.push({name:"CF",alias:"CF",type:"string"})}if(n.CF){t.A.push({name:"CS",alias:"CS",type:"string"})}return t};n.prototype.getActionArray=function(t){var n=e.prototype.getActionArray.apply(this,arguments);var i=this.getId();if(t||this.mEventRegistry["click"]||this.isEventRegistered("click")){n.push({id:i+"1",name:"click",refScene:"MainScene",refVO:i,refEvent:"Click",AddActionProperty:[{name:"pos"}]})}if(t||this.mEventRegistry["contextMenu"]||this.isEventRegistered("contextMenu")){n.push({id:i+"2",name:"contextMenu",refScene:"MainScene",refVO:i,refEvent:"ContextMenu"})}if(t||this.mEventRegistry["drop"]||this.isEventRegistered("drop")){n.push({id:i+"3",name:"drop",refScene:"MainScene",refVO:i,refEvent:"Drop"})}return n};return n});
/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5) (c) Copyright 2009-2012 SAP AG. All rights reserved
 */
sap.ui.predefine("sap/ui/vbm/VBI", ["sap/ui/core/Control","sap/ui/core/RenderManager","jquery.sap.global","sap/base/Log","./library","./VBIRenderer","./lib/sapvbi","./lib/saputilities","./lib/sapvbicontext","./lib/sapdataprovider","./lib/sapresources","./lib/sapgeomath","./lib/sapmaplayer","./lib/sapmapprovider","./lib/sapmapmanager","./lib/sapvoutils","./lib/sapvobase","./lib/sapevents","./lib/saplabels","./lib/sappositioning","./lib/sapscene","./lib/sapwindow","./lib/sapactions","./lib/sapautomations","./lib/sapgeolocation","./lib/sapgeotool","./lib/sapscale","./lib/sapnavigation","./lib/sapvbmenu","./lib/sapprojection","./lib/sapvbcluster","./lib/sapparsing","./lib/sapconfig","./lib/saplassotrack","./lib/saprecttrack","./lib/sapheatmap"],function(e,t,jQuery,i,o,n){"use strict";var a="sap.ui.vbm.VBI";VBI.Utilities.GetTransparentImage();var r=e.extend("sap.ui.vbm.VBI",{metadata:{library:"sap.ui.vbm",properties:{width:{type:"sap.ui.core.CSSSize",group:"Misc",defaultValue:"800px"},height:{type:"sap.ui.core.CSSSize",group:"Misc",defaultValue:"600px"},config:{type:"object",group:"Misc",defaultValue:null},plugin:{type:"boolean",group:"Misc",defaultValue:false},rectangularSelection:{type:"boolean",group:"Misc",defaultValue:false},lassoSelection:{type:"boolean",group:"Misc",defaultValue:false},rectZoom:{type:"boolean",group:"Misc",defaultValue:false},allowKeyEventRepeat:{type:"boolean",group:"Behavior",defaultValue:true},keyEventDelay:{type:"int",group:"Behavior",defaultValue:250},enableOverlappingTest:{type:"boolean",group:"Behavior",defaultValue:true},ariaLabel:{type:"string",group:"Misc"}},associations:{ariaDescribedBy:{type:"sap.ui.core.Control",multiple:true,singularName:"ariaDescribedBy"},ariaLabelledBy:{type:"sap.ui.core.Control",multiple:true,singularName:"ariaLabelledBy"}},events:{submit:{parameters:{data:{type:"string"}}},thumbnailClick:{parameters:{pos:{type:"string"},zoomLevel:{type:"int"}}},render:{parameters:{canvas:{type:"object"}}},changeTrackingMode:{parameters:{mode:{type:"int"},bSet:{type:"boolean"}}},zoom:{parameters:{canvas:{type:"object"}}},move:{parameters:{canvas:{type:"object"}}},openWindow:{parameters:{contentarea:{type:"object"},id:{type:"string"}}},closeWindow:{parameters:{contentarea:{type:"object"},id:{type:"string"}}},containerCreated:{parameters:{contentarea:{type:"object"},id:{type:"string"}}},containerDestroyed:{parameters:{contentarea:{type:"object"},id:{type:"string"}}}}},renderer:n});r.RttMap={};r.prototype.exit=function(){if(this.getPlugin()){var e=this.getPlugInControl();if(e){e.OnSubmit=null}}else if(this.mVBIContext){this.mVBIContext.clear()}if(this.resizeID!=""){sap.ui.core.ResizeHandler.deregister(this.resizeID);this.resizeID=""}};r.prototype.resize=function(e){var t=this.oControl!=undefined?this.oControl:this;var i=t.mVBIContext;if(i){var o=i.GetMainScene();if(o){o.resizeCanvas(e)}if(i.m_Windows){i.m_Windows.NotifyResize()}}};r.prototype.init=function(){this.m_aLoadQueue=null;if(!this.getPlugin()){this.mVBIContext=new VBI.VBIContext(this)}this.resizeID="";this.m_renderList=[]};r.prototype.loadNative=function(e){var t=this.getId();var o=document.getElementById("VBI"+t);if(!o){return}var n=function(e){try{var t;if(t=JSON.parse(e)){var i=t.SAPVB;var o=JSON.stringify(i,null,"  ");this.fireSubmit({data:o})}}catch(e){if(VBI.m_bTrace){VBI.Trace("Error submitting plugin event")}}};if(jQuery.type(e)=="object"){var r=JSON.stringify(e,null,"  ");try{o.Load(r);o.OnSubmit=n.bind(this)}catch(e){i.error("Error loading vbiJSON from object","",a)}}else if(jQuery.type(e)=="string"){try{o.Load(e);o.OnSubmit=n.bind(this)}catch(e){i.error("Error loading vbiJSON from string","",a)}}};r.prototype.loadHtml=function(e){var t=this.getId();var i=null;if(typeof e==="string"){i=JSON.parse(e.indexOf("{")?e.substr(e.indexOf("{")):e)}else if(typeof e==="object"){i=e}if(!i){return}if(!i["SAPVB"]){var o;if(this.mVBIContext&&(o=new VBI.Adaptor(this.mVBIContext).CreateLoadData(i))){this.loadHtml(o);return}else{return}}var n=false;var a=false;var r=false;var s=false;var l=false;var m=false;if(jQuery.type(i)==="object"){if(i.SAPVB){if(i.SAPVB.Config){this.mVBIContext.GetConfig().load(i.SAPVB.Config,this.mVBIContext)}if(i.SAPVB.Resources){this.mVBIContext.GetResources().load(i.SAPVB.Resources,this.mVBIContext);s=true}if(i.SAPVB.DataTypes){if(!this.mVBIContext.m_DataTypeProvider){this.mVBIContext.m_DataTypeProvider=new VBI.DataTypeProvider}this.mVBIContext.m_DataTypeProvider.load(i.SAPVB.DataTypes,this.mVBIContext)}if(i.SAPVB.Data){if(!this.mVBIContext.m_DataProvider){this.mVBIContext.m_DataProvider=new VBI.DataProvider}this.mVBIContext.m_DataProvider.load(i.SAPVB.Data,this.mVBIContext);n=true}if(i.SAPVB.MapProviders){if(!this.mVBIContext.m_MapProviders){this.mVBIContext.m_MapProviders=new VBI.MapProviders}this.mVBIContext.m_MapProviders.load(i.SAPVB.MapProviders,this.mVBIContext);m=true}if(i.SAPVB.MapLayerStacks){if(!this.mVBIContext.m_MapLayerStackManager){this.mVBIContext.m_MapLayerStackManager=new VBI.MapLayerStackManager(this.mVBIContext)}this.mVBIContext.m_MapLayerStackManager.load(i.SAPVB.MapLayerStacks,this.mVBIContext);m=true}if(i.SAPVB.Windows){if(!this.mVBIContext.m_Windows){this.mVBIContext.m_Windows=new VBI.Windows}this.mVBIContext.m_Windows.load(i.SAPVB.Windows,this.mVBIContext);r=true}if(i.SAPVB.Actions){if(!this.mVBIContext.m_Actions){this.mVBIContext.m_Actions=new VBI.Actions}this.mVBIContext.m_Actions.load(i.SAPVB.Actions,this.mVBIContext)}if(i.SAPVB.Automation){if(!this.mVBIContext.m_Automations){this.mVBIContext.m_Automations=new VBI.Automations}this.mVBIContext.m_Automations.load(i.SAPVB.Automation,this.mVBIContext)}if(i.SAPVB.Menus){if(!this.mVBIContext.m_Menus){this.mVBIContext.m_Menus=new VBI.Menus}this.mVBIContext.m_Menus.load(i.SAPVB.Menus,this.mVBIContext)}if(i.SAPVB.Clustering){if(!this.mVBIContext.m_Clustering){this.mVBIContext.m_Clustering=new VBI.Clustering}this.mVBIContext.m_Clustering.load(i.SAPVB.Clustering,this.mVBIContext);l=true}if(i.SAPVB.Scenes){if(!this.mVBIContext.m_SceneManager){this.mVBIContext.m_SceneManager=new VBI.SceneManager}this.mVBIContext.m_SceneManager.load(i.SAPVB.Scenes,this.mVBIContext);a=true}else if(m){var p=this.mVBIContext.m_SceneManager.m_SceneArray;for(var u=0;u<p.length;++u){if(p[u].RefreshMapLayerStack){p[u].RefreshMapLayerStack()}}}}if(n){if(this.mVBIContext.m_Windows){this.mVBIContext.m_Windows.NotifyDataChange()}}if(a||r){if(this.mVBIContext.m_Windows){this.mVBIContext.m_Windows.Awake(t)}}if(a||n||l||s){if(this.mVBIContext.m_Windows){this.mVBIContext.m_Windows.RenderAsync()}}}};r.prototype.load=function(e){if(!e){return}if(!this.isRendered()){if(!this.m_aLoadQueue){this.m_aLoadQueue=[]}if(e.SAPVB&&e.SAPVB.Scenes&&e.SAPVB.Scenes.Merge&&e.SAPVB.Scenes.Merge.SceneGeo){var t=e.SAPVB.Scenes.Merge.SceneGeo.initialStartPosition;var i=e.SAPVB.Scenes.Merge.SceneGeo.initialZoom;if(t||i){var o=this.m_aLoadQueue;for(var n=0;n<o.length;++n){if(o[n].SAPVB&&o[n].SAPVB.Scenes&&o[n].SAPVB.Scenes.Set&&o[n].SAPVB.Scenes.Set.SceneGeo){var a=o[n].SAPVB.Scenes.Set.SceneGeo;a.initialStartPosition=t||a.initialStartPosition;a.initialZoom=i||a.initialZoom;break}}}}this.m_aLoadQueue.push(e);return}if(this.getPlugin()){this.loadNative(e)}else{this.loadHtml(e)}if(this.resizeID==""&&this.mVBIContext.GetMainScene()){this.resize();this.resizeID=sap.ui.core.ResizeHandler.register(this,this.resize)}};
/**
	 * Returns a Screenshot of the Overlay. Please note that the map cannot be included due to browser restrictions. Function returns the visible part
	 * of the Canvas excluding map, copyright info, navigation control, scaler, legend, detail windows, container elements. Analytic Maps are returned
	 * as they are not treated as "maps" internally. Modes 2 & 3 are experimental, trying to load the map (this may work on inhouse servers with
	 * adapted settings, standard configurations should fail)
	 *
	 * @param {int} [iMode] 0: Overlay only; 1 (default) and 3: include Labels; 2 and 3: try to include maps (will return "" if not possible)
	 * @returns {string} Base64 encoded picture (PNG format) on success, "" otherwise
	 * @public
	 * @ui5-metamodel This method also will be described in the UI5 (legacy) designtime metamodel
	 */r.prototype.getPicOfOverlay=function(e){var t=this.mVBIContext.GetMainScene();if(!(t&&t.GetOverlayPicture)){return""}return t.GetOverlayPicture(e)};r.prototype.minimize=function(e,t,i,o,n,a,r,s){var l=this.mVBIContext;if(!l.moThumbnail){l.moThumbnail={bThumbnailed:false}}var m=l.moThumbnail;m.nThumbWidth=e;m.nThumbHeight=t;m.strFont=n;m.strCol=a;m.nFontPos=r;m.strText=s;if(i){m.nFullWidth=i}if(o){m.nFullHeight=o}var p=l.GetMainScene();if(p){l.DoMinimize(p)}};r.prototype.maximize=function(e,t){var i=this.mVBIContext.GetMainScene();if(i&&this.mVBIContext.moThumbnail){var o,n;if(e){o=String(e)+"px"}else{o=this.mVBIContext.moThumbnail.strOrgWidth?this.mVBIContext.moThumbnail.strOrgWidth:this.getWidth()}if(t){n=String(t)+"px"}else{n=this.mVBIContext.moThumbnail.strOrgHeight?this.mVBIContext.moThumbnail.strOrgHeight:this.getHeight()}this.mVBIContext.m_bThumbnail=false;this.setWidth(o);this.setHeight(n);i.m_Ctx.moThumbnail=undefined;i.resizeCanvas(0)}};r.prototype.zoomToGeoPosition=function(e,t,i){var o=null;if(o=this.mVBIContext.GetMainScene()){if(jQuery.type(e)=="array"&&jQuery.type(t)=="array"){if(e.length>1&&t.length>1){o.ZoomToMultiplePositions(e,t)}else{o.ZoomToGeoPosition(VBI.MathLib.DegToRad([parseFloat(e[0]),parseFloat(t[0])]),parseFloat(i))}}else{o.ZoomToGeoPosition(VBI.MathLib.DegToRad([parseFloat(e),parseFloat(t)]),parseFloat(i))}}};r.prototype.zoomToAreas=function(e,t){var i=null;if(i=this.mVBIContext.GetMainScene()){i.ZoomToAreas(e,t)}};r.prototype.getInfoForCluster=function(e,t){var i=null;if(i=this.mVBIContext.GetMainScene()){return i.getInfoForCluster(e,t)}return null};r.prototype.setRectangularSelection=function(e){var t=this.mVBIContext.GetMainScene();if(t){if(!(e&&t.m_nInputMode==window.VBI.InputModeRectSelect)){t.endTrackingMode();if(e){this.setProperty("lassoSelection",false,true);this.setProperty("rectZoom",false,true);new t.RectSelection;t.m_Ctx.onChangeTrackingMode(VBI.InputModeRectSelect,true)}}}this.setProperty("rectangularSelection",e,true);return this};r.prototype.setLassoSelection=function(e){var t=this.mVBIContext.GetMainScene();if(t){if(!(e&&t.m_nInputMode==window.VBI.InputModeLassoSelect)){t.endTrackingMode();if(e){this.setProperty("rectangularSelection",false,true);this.setProperty("rectZoom",false,true);new t.LassoSelection;t.m_Ctx.onChangeTrackingMode(VBI.InputModeLassoSelect,true)}}}this.setProperty("lassoSelection",e,true);return this};r.prototype.setRectZoom=function(e){var t=this.mVBIContext.GetMainScene();if(t){if(!(e&&t.m_nInputMode==window.VBI.InputModeRectZoom)){t.endTrackingMode();if(e){this.setProperty("lassoSelection",false,true);this.setProperty("rectangularSelection",false,true);new t.RectangularZoom;t.m_Ctx.onChangeTrackingMode(VBI.InputModeRectZoom,true)}}}this.setProperty("rectZoom",e,true);return this};r.prototype.onAfterRendering=function(){if(this.$oldContent.length>0){this.$().append(this.$oldContent)}if(this.m_aLoadQueue){var e;for(e=0;e<this.m_aLoadQueue.length;++e){this.load(this.m_aLoadQueue[e])}this.m_aLoadQueue=null}if(this.resizeID==""&&this.mVBIContext.GetMainScene()){this.resize();this.resizeID=sap.ui.core.ResizeHandler.register(this,this.resize)}var t=this.getId();if(this.mVBIContext.m_Windows){this.mVBIContext.m_Windows.Awake(t)}var i=jQuery(this.getDomRef()).children(".vbi-hidden").children();for(var o=0,n;o<i.length;++o){n=i[o];var a=document.getElementById(n.attributes.getNamedItem("data").nodeValue);if(a){if(n.firstChild){a.appendChild(n.firstChild)}n.parentNode.removeChild(n)}}};r.prototype.onBeforeRendering=function(){var e=this.getDomRef();if(e&&!t.isPreservedContent(e)){t.preserveContent(e,true,false)}this.$oldContent=t.findPreservedContent(this.getId())};r.prototype.isRendered=function(){return this.getDomRef()?true:false};r.prototype.getPlugInControl=function(){var e=this.getId();var t=document.getElementById("VBI"+e);return t?t:null};r.prototype.setConfig=function(e){if(e){return this.load(e)}};r.prototype.setWidth=function(e){if(typeof e==="number"){this.setProperty("width",parseInt(e,10).toString()+"px")}else{this.setProperty("width",e)}};r.prototype.setHeight=function(e){if(typeof e==="number"){this.setProperty("height",parseInt(e,10).toString()+"px")}else{this.setProperty("height",e)}};r.prototype.addRenderItem=function(e,t){this.m_renderList.push({control:e,data:t});this.invalidate()};return r});
/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5) (c) Copyright 2009-2012 SAP AG. All rights reserved
 */
sap.ui.predefine("sap/ui/vbm/VBIRenderer", function(){"use strict";var e={apiVersion:2};e.render=function(e,t){var r=t.getAriaLabel();var i=t.getAriaLabelledBy();var a=t.getAriaDescribedBy();e.openStart("div",t);e.attr("role","Figure");if(r){e.attr("aria-label",r)}if(i&&i.length>0){e.attr("aria-labelledby",i.join(" "))}if(a&&a.length>0){e.attr("aria-describedby",a.join(" "))}e.attr("tabindex","0");e.class("vbi-main");e.style("width",t.getWidth());e.style("height",t.getHeight());e.openEnd();var n=t.getId();if(t.getPlugin()){if(t.$oldContent.length===0){if(navigator.appName=="Microsoft Internet Explorer"||/(trident)\/[\w.]+;.*rv:([\w.]+)/i.test(navigator.userAgent)){e.openStart("object","'VBI"+n+"'"+" data-sap-ui-preserve='"+n+"' CLASSID='CLSID:00100000-2011-0070-2000-FC7214A1CD7B'");e.attr("width",t.getWidth());e.attr("height",t.getHeight());e.openEnd();e.openStart("a");e.attr("href","https://help.sap.com/viewer/product/SAP_VISUAL_BUSINESS_2.1");e.openEnd();e.text("Get the Visual Business PlugIn.");e.close("a");e.close("object")}else{e.openStart("write","'VBI"+n+"'"+" data-sap-ui-preserve='"+n+"' type='application/x-visualbusiness'");e.attr("width",t.getWidth());e.attr("height",t.getHeight());e.openEnd()}}}e.openStart("div");e.class("vbi-hidden");e.attr("role",sap.ui.core.AccessibleRole.Presentation);e.openEnd();this.renderDependants(e,t.m_renderList);e.close("div");t.m_renderList=[];e.close("div")};e.renderDependants=function(e,t){for(var r=0,i;r<t.length;++r){i=t[r];if(!i.control.getDomRef()){e.openStart("div");e.attr("data",i.data);e.openEnd();e.renderControl(i.control);e.close("div")}}};return e},true);
/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5) (c) Copyright 2009-2012 SAP AG. All rights reserved
 */
sap.ui.predefine("sap/ui/vbm/Viewport", ["sap/ui/core/Control","sap/ui/core/ResizeHandler","./adapter3d/thirdparty/three","./adapter3d/thirdparty/OrbitControls","./adapter3d/Utilities","./ViewportRenderer","sap/base/Log","./library"],function(e,t,r,i,a,o,s,n){"use strict";var h="sap.ui.vbm.Viewport";var d=e.extend("sap.ui.vbm.Viewport",{metadata:{library:"sap.ui.vbm",properties:{width:{type:"sap.ui.core.CSSSize",defaultValue:"100%"},height:{type:"sap.ui.core.CSSSize",defaultValue:"100%"},cameraHistoryLength:{type:"int",defaultValue:0},cameraHistoryPos:{type:"int"}},events:{cameraChange:{parameters:{historyPos:{type:"int"},historyLength:{type:"int"}}}}},renderer:o});var l=1e-6;var c=.6;var p=5e4;var m=85;var _=d.getMetadata().getParent().getClass().prototype;d.prototype.init=function(){if(_.init){_.init.call(this)}this._resizeListenerId=null;this._renderLoopRequestId=0;this._renderLoopFunction=this._renderLoop.bind(this);this._renderer=new r.WebGLRenderer({antialias:true});this._renderer.setPixelRatio(window.devicePixelRatio);this._renderer.shadowMap.enabled=true;this._renderer.domElement.tabIndex=-1;this._renderer.domElement.setAttribute("role",sap.ui.core.AccessibleRole.Img);this._renderer.domElement.id=this.getId()+"-canvas";this._scene=new r.Scene;this._root=new r.Group;this._root.scale.set(-1,1,1);this._root.rotateX(r.Math.degToRad(90));this._root.matrixAutoUpdate=false;this._root.updateMatrix();this._scene.add(this._root);this._mapPlane=new r.Mesh(new r.PlaneGeometry(p,p,1,1),new r.MeshBasicMaterial({color:2128813,side:r.DoubleSide}));this._mapPlane.name="MapPlane";this._mapPlane.layers.set(2);this._mapPlane.visible=false;this._mapPlane.matrixAutoUpdate=false;this._mapPlane.updateMatrix();this._root.add(this._mapPlane);this._scene.background=new r.Color("white");this._scene.add(new r.AmbientLight(2105376,1));var e=new r.DirectionalLight(3355443,1);e.position.set(0,0,-1);e.matrixAutoUpdate=false;e.updateMatrix();this._scene.add(e);var t=new r.DirectionalLight(5329243,1);t.position.set(-2,-1.1,2.5);t.matrixAutoUpdate=false;t.updateMatrix();this._scene.add(t);var a=new r.DirectionalLight(5987163,2);a.position.set(2,1.5,.5);a.matrixAutoUpdate=false;a.updateMatrix();this._scene.add(a);this._light=new r.DirectionalLight(15658734,1);this._lightPos=new r.Vector3(0,0,0);this._scene.add(this._light);this._camera=new r.PerspectiveCamera(30,window.innerWidth/window.innerHeight,.1,2e3);this._camera.layers.enable(0);this._camera.layers.enable(1);this._scene.add(this._camera);this._camera.position.set(0,30,30);this._camera.lookAt(new r.Vector3(0,0,0));this._cameraHome=undefined;this._flyToRequestId=undefined;this._resetTimerId=undefined;this._cameraHistory=[];this._cameraChangeEvent={};this._bbox=new r.Box3;this._cameraController=new i(this._camera,this._renderer.domElement);this._cameraController.listenToKeyEvents(this._renderer.domElement);this._cameraController.addEventListener("end",this._cameraEnd.bind(this));this._cameraController.addEventListener("change",this._cameraUpdate.bind(this));this._cameraController.update()};d.prototype.getOrbitControl=function(){return this._cameraController};d.prototype.exit=function(){if(this._resizeListenerId){t.deregister(this._resizeListenerId);this._resizeListenerId=null}this._stopRenderLoop();this._cameraController.dispose();this._cameraController=null;this._renderer.dispose();this._renderer=null;this._scene=null;this._camera=null;if(_.exit){_.exit.call(this)}};d.prototype.getRoot=function(){return this._root};d.prototype.getScene=function(){return this._scene};d.prototype.getCamera=function(){return this._camera};d.prototype.getCameraHistoryLength=function(){return this._cameraHistory.length};d.prototype.setCameraHistoryLength=function(){s.error("cameraHistoryLength is read only property","",h);return this};d.prototype.setCameraHistoryPos=function(e){if(this._cameraHistory.length>0&&e>=0&&e<this._cameraHistory.length){if(e!==this.getCameraHistoryPos()){this.setProperty("cameraHistoryPos",e,true);delete this._cameraHistory[e].tag;this._fireCameraChange();this._flyTo(this._cameraController.saveState(),this._cameraHistory[e],c)}}return this};d.prototype.applyCameraHome=function(e){if(this._cameraHome){this._applyCamera(this._cameraHome,e)}};d.prototype.worldToScreen=function(e){var t=this.getDomRef();if(!t){return undefined}var i=t.getBoundingClientRect();var a=this.getCamera();var o=(new r.Matrix4).multiplyMatrices(a.projectionMatrix,(new r.Matrix4).getInverse(a.matrixWorld));var s=e.clone().applyMatrix4(o);var n=Math.floor((+s.x*.5+.5)*i.width+.5);var h=Math.floor((-s.y*.5+.5)*i.height+.5);return new r.Vector2(n,h)};d.prototype.onBeforeRendering=function(){if(this._resizeListenerId){t.deregister(this._resizeListenerId);this._resizeListenerId=null}this._stopRenderLoop()};d.prototype.onAfterRendering=function(){var e=this.getDomRef();e.appendChild(this._renderer.domElement);this._resizeListenerId=t.register(this,this._handleResize.bind(this));this._handleResize({size:{width:e.clientWidth,height:e.clientHeight}});this._startRenderLoop()};d.prototype._handleResize=function(e){if(!this._camera||!this._renderer){return false}var t=e.size.width;var r=e.size.height;if(this._camera){this._camera.aspect=t/r;this._camera.updateProjectionMatrix()}this._renderer.setSize(t,r,false)};d.prototype._startRenderLoop=function(){if(!this._renderLoopRequestId){this._renderLoopRequestId=window.requestAnimationFrame(this._renderLoopFunction)}return this};d.prototype._stopRenderLoop=function(){if(this._renderLoopRequestId){window.cancelAnimationFrame(this._renderLoopRequestId);this._renderLoopRequestId=0}return this};d.prototype._renderLoop=function(){this._cameraController.update();this._camera.getWorldDirection(this._lightPos);this._lightPos.negate();this._light.position.copy(this._lightPos);this._renderer.render(this._scene,this._camera);this._renderLoopRequestId=window.requestAnimationFrame(this._renderLoopFunction)};function u(e,t,r,i){return t+r*((e=e/i-1)*e*e+1)}function g(e){var t=Math.min((Date.now()-e.when)/1e3,e.length);var r=e.tempTarget;r.x=u(t,e.from.target.x,e.to.target.x-e.from.target.x,e.length);r.y=u(t,e.from.target.y,e.to.target.y-e.from.target.y,e.length);r.z=u(t,e.from.target.z,e.to.target.z-e.from.target.z,e.length);var i=u(t,e.distanceFrom,e.distanceTo-e.distanceFrom,e.length);var a=u(t,0,e.angle,e.length);var o=e.tempPos.copy(e.dir).applyAxisAngle(e.axis,a).multiplyScalar(i).add(r);this._cameraController.reset({position:o,target:r,zoom:1});if(t<e.length){this._flyToRequestId=window.requestAnimationFrame(g.bind(this,e))}else{this._flyToRequestId=undefined}}d.prototype._flyTo=function(e,t,i){var o=t.position.clone().sub(t.target);var s=e.position.clone().sub(e.target);var n=o.length();var h=s.length();var d=Math.acos(a.clamp(s.dot(o)/(n*h),-1,1));var l={to:t,from:e,when:Date.now(),length:i,angle:d,axis:s.clone().cross(o).normalize(),distanceTo:n,distanceFrom:h,dir:s.normalize(),tempPos:new r.Vector3,tempTarget:new r.Vector3};if(this._flyToRequestId){window.cancelAnimationFrame(this._flyToRequestId)}this._flyToRequestId=window.requestAnimationFrame(g.bind(this,l))};d.prototype._cameraEnd=function(e){var t=this._cameraController.saveState();var r=this.getCameraHistoryPos();var i=r>=0?this._cameraHistory[r]:undefined;if(i==undefined||t.target.distanceToSquared(i.target)>l||t.position.distanceToSquared(i.position)>l){this._pushCameraChange(t)}};function f(){if(this._cameraHistory.length>0){delete this._cameraHistory[this._cameraHistory.length-1].tag}this._resetTimerId=undefined}d.prototype._cameraUpdate=function(e){if(e.tag){if(this._resetTimerId){window.clearTimeout(this._resetTimerId)}this._resetTimerId=window.setTimeout(f.bind(this),500);var t=this._cameraController.saveState();var r=this.getCameraHistoryPos();t.tag=e.tag;var i=r>=0?this._cameraHistory[r]:{};if(t.tag&&t.tag===i.tag){this._cameraHistory[r]=t}else{this._pushCameraChange(t)}}this._updateCamera();this._updateController()};d.prototype._fireCameraChange=function(){this._cameraChangeEvent.historyPos=this.getCameraHistoryPos();this._cameraChangeEvent.historyLength=this._cameraHistory.length;this.fireCameraChange(this._cameraChangeEvent)};d.prototype._pushCameraChange=function(e){var t=this.getCameraHistoryPos();this._cameraHistory.splice(t>=0?t+1:0,this._cameraHistory.length);this._cameraHistory.push(e);this.setProperty("cameraHistoryPos",this._cameraHistory.length-1,true);this._fireCameraChange()};d.prototype._setCameraHome=function(e){this._cameraHome=e};d.prototype._applyCamera=function(e,t){var r=this._cameraController.saveState();if(e.target.distanceToSquared(r.target)>l||e.position.distanceToSquared(r.position)>l){this._pushCameraChange(e);if(t){this._flyTo(this._cameraController.saveState(),e,c)}else{this._cameraController.reset(e)}}};d.prototype._getCameraState=function(){return this._cameraController.saveState()};d.prototype._intersectMapPlane=function(e){e.layers.set(2);var t=e.intersectObjects([this._mapPlane],false);return t};var y=new r.Box3,v=new r.Matrix4;function C(e,t){var r,i=e.geometry;e.updateWorldMatrix(false,false);if(e.visible&&i){if(!i.boundingBox){i.computeBoundingBox()}if(e.isInstancedMesh){for(r=0;r<e.count;++r){e.getMatrixAt(r,v);y.copy(i.boundingBox);y.applyMatrix4(v);t.union(y)}}else{y.copy(i.boundingBox);y.applyMatrix4(e.matrixWorld);t.union(y)}}var a=e.children;for(r=0;r<a.length;++r){C(a[r],t)}}d.prototype._resetBBox=function(){this._bbox.makeEmpty()};d.prototype._getBBox=function(){if(this._bbox.isEmpty()){C(this.getScene(),this._bbox)}return this._bbox};d.prototype._updateCamera=function(){var e=this._getBBox();if(!e.isEmpty()){var t=new r.Sphere;e.getBoundingSphere(t);if(t.radius===0){t.radius=1}this._camera.updateMatrixWorld(false);t.center.applyMatrix4(this._camera.matrixWorldInverse);var i=a.clamp(-t.center.z-t.radius,t.radius*.001,-t.center.z-t.radius);var o=i+t.radius*2,s=false;if(Math.abs(this._camera.near-i)>=this._camera.near*.03){this._camera.near=i;s=true}if(Math.abs(this._camera.far-o)>=this._camera.far*.03){this._camera.far=o;s=true}if(s){this._camera.updateProjectionMatrix()}}};d.prototype._updateController=function(){var e=this._cameraController.target.clone().sub(this._camera.position).normalize();var t=new r.Vector3(0,this._camera.position.y>0?1:-1,0);var i=new r.Plane(t),a=new r.Vector3;var o=new r.Ray(this._camera.position,e);if(o.intersectPlane(i,a)){if(r.Math.radToDeg(this._camera.position.clone().sub(a).angleTo(t))<m){this._cameraController.target.copy(a)}}};return d});
/*!
* SAP UI development toolkit for HTML5 (SAPUI5) (c) Copyright 2009-2012 SAP AG. All rights reserved
*/
sap.ui.predefine("sap/ui/vbm/ViewportRenderer", function(){"use strict";var t={apiVersion:2};t.render=function(t,e){t.openStart("div",e);t.attr("tabindex",0);t.attr("role","figure");t.style("width",e.getWidth());t.style("height",e.getHeight());t.class("sapUiVbmViewport");t.openEnd();t.close("div")};return t},true);
/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5) (c) Copyright 2009-2012 SAP AG. All rights reserved
 */
sap.ui.predefine("sap/ui/vbm/VoAbstract", ["sap/ui/core/Element","./library"],function(t,e){"use strict";var n=t.extend("sap.ui.vbm.VoAbstract",{metadata:{library:"sap.ui.vbm",properties:{},events:{}}});n.prototype.isEventRegistered=function(t){var e=this.getItems();if(!e){return false}for(var n=0,r=e.length;n<r;++n){var a=e[n];if(a.mEventRegistry[t]){return true}}return false};n.prototype.findInstance=function(t){var e=this.getItems();if(!e){return false}var n=t.indexOf(".")!==-1?t.split(".")[1]:t;for(var r=0,a=e.length;r<a;++r){if(e[r].sId===n){return e[r]}}return null};n.prototype.findInstanceByKey=function(t){var e=this.getItems();if(!e){return false}var n=t.indexOf(".")!==-1?t.split(".")[1]:t;for(var r=0,a=e.length;r<a;++r){if(e[r].sId===n||e[r].getKey()===n){return e[r]}}return null};n.prototype.getActionArray=function(){var t=[];return t};n.prototype.getTemplateBindingInfo=function(){var t=this.getBindingInfo("items");if(t&&t.template){return t.template.mBindingInfos}};n.prototype.getBindInfo=function(){var t={};var e=this.getTemplateBindingInfo();t.hasTemplate=e?true:false;return t};n.prototype.getTemplateObject=function(){var t={};t["id"]=this.getId();t["datasource"]=t.id;return t};n.prototype.getTypeObject=function(){var t={};t["name"]=this.getId();t["key"]="K";t.A=[{name:"K",alias:"K",type:"string"},{name:"VB:s",alias:"VB:s",type:"boolean"}];return t};n.prototype.getDataDeltaObject=function(t){var e={};var n=[];var r=this.getItems();e["name"]=this.getId();e.E=[];for(var a=0;a<t.length;++a){if(t[a].type=="delete"){n.push(t[a].object)}else if(t[a].type=="insert"){var i=t[a].idx;e.E.push(r[i].getDataElement())}}return{oData:e,aRemoveData:n}};n.prototype.getDataRemoveObject=function(){var t={name:this.getId(),type:"N"};return t};n.prototype.getDataObject=function(){var t={};t["name"]=this.getId();t.E=[];var e=this.getItems();for(var n=0,r=e.length;n<r;++n){t.E.push(e[n].getDataElement())}return t};n.prototype.openContextMenu=function(t,e,n){this.oParent.openContextMenu(t,e,n)};return n});
/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5) (c) Copyright 2009-2012 SAP AG. All rights reserved
 */
sap.ui.predefine("sap/ui/vbm/VoAggregation", ["./VoAbstract","sap/ui/unified/Menu","jquery.sap.global","sap/base/Log","./library"],function(e,t,jQuery,i,r){"use strict";var n=e.extend("sap.ui.vbm.VoAggregation",{metadata:{library:"sap.ui.vbm",properties:{minSel:{type:"string",group:"Misc",defaultValue:"0"},maxSel:{type:"string",group:"Misc",defaultValue:"n"},customProperties:{type:"string[]",group:"Misc"}},events:{handleMoved:{parameters:{instance:{type:"sap.ui.vbm.VoBase"},handle:{type:"int"}}},handleContextMenu:{parameters:{instance:{type:"sap.ui.vbm.VoBase"},menu:{type:"sap.ui.unified.Menu"},handle:{type:"int"}}},handleClick:{parameters:{instance:{type:"sap.ui.vbm.VoBase"},handle:{type:"int"}}},select:{parameters:{selected:{type:"array"}}},deselect:{parameters:{deselected:{type:"array"}}},click:{parameters:{instance:{type:"sap.ui.vbm.VoBase"}}},contextMenu:{parameters:{instance:{type:"sap.ui.vbm.VoBase"},menu:{type:"sap.ui.unified.Menu"}}},drop:{parameters:{instance:{type:"sap.ui.vbm.Spot"},dragSource:{type:"sap.ui.vbm.VoBase"}}}}}});n.prototype.init=function(){this.aDiff=[];this.aUniqueIdx=[];this.currentIdx=1e3;this.setProperty("customProperties",[],true);this.bUseExtendedChangeDetection=true};n.prototype.handleSelectEvent=function(e){var t=[];var i=[];for(var r=0;r<e.length;++r){var n=e[r];var a=this.getItems();if(a){for(var s=0,o=a.length;s<o;++s){if(a[s].UniqueId==n.K){var l=n["VB:s"]=="true"?true:false;var p=a[s].getSelect();if(l!=p){if(l){a[s].setProperty("select",true,true);if(this.mEventRegistry["select"]){t.push(a[s])}}else{a[s].setProperty("select",false,true);if(this.mEventRegistry["deselect"]){i.push(a[s])}}}}}}}if(i.length){this.fireDeselect({deselected:i})}if(t.length){this.fireSelect({selected:t})}};n.prototype.isEventRegistered=function(e){var t=this.getItems();if(!t){return false}for(var i=0,r=t.length;i<r;++i){var n=t[i];if(n.mEventRegistry[e]){return true}}return false};n.prototype.findSelected=function(e,t){var i=this.getItems();if(!i){return null}var r=[];if(jQuery.type(t)=="object"){if(t["VB:s"]==(e?"true":"false")){for(var n=0;n<i.length;++n){if(i[n].UniqueId==t["K"]){r.push(i[n])}}}}else if(jQuery.type(t)=="array"){for(var a=0;a<t.length;++a){if(t[a]["VB:s"]==(e?"true":"false")){for(var s=0;s<i.length;++s){if(i[s].UniqueId==t[a]["K"]){r.push(i[s])}}}}}return r};n.prototype.findInstance=function(e){var t=this.getItems();if(!t){return false}var i=e.indexOf(".")!==-1?e.split(".")[1]:e;for(var r=0,n=this.aUniqueIdx.length;r<n;++r){if(this.aUniqueIdx[r]===i){return t[r]}}return null};n.prototype.findInstanceByKey=function(e){var t=this.getItems();if(!t){return false}var i=e.indexOf(".")!==-1?e.split(".")[1]:e;for(var r=0,n=t.length;r<n;++r){if(t[r].getKey()===i){return t[r]}}return null};n.prototype.getActionArray=function(){var e=this.getId();var t=[];if(this.mEventRegistry["handleMoved"]||this.isEventRegistered("handleMoved")){t.push({id:e+"4",name:"handleMoved",refScene:"MainScene",refVO:e,refEvent:"HandleMoved"})}if(this.mEventRegistry["handleContextMenu"]||this.isEventRegistered("handleContextMenu")){t.push({id:e+"5",name:"handleContextMenu",refScene:"MainScene",refVO:e,refEvent:"HandleContextMenu"})}if(this.mEventRegistry["handleClick"]||this.isEventRegistered("handleClick")){t.push({id:e+"6",name:"handleClick",refScene:"MainScene",refVO:e,refEvent:"HandleClick"})}var i;var r=(i=this.getTemplateBindingInfo())?i.hasOwnProperty("select"):false;if((this.mEventRegistry["select"]||this.mEventRegistry["deselect"]||r)&&!this.isEventRegistered("click")){t.push({id:e+"9",name:"click",refScene:"MainScene",refVO:e,refEvent:"Click"})}return t};n.prototype.getBindInfo=function(){var t=e.prototype.getBindInfo.apply(this,arguments);var i=this.getTemplateBindingInfo();t.HS=i?i.hasOwnProperty("hotScale"):true;t.HDC=i?i.hasOwnProperty("hotDeltaColor"):true;t.SC=i?i.hasOwnProperty("selectColor"):true;t.FS=i?i.hasOwnProperty("fxsize"):true;t.FD=i?i.hasOwnProperty("fxdir"):true;t.ET=i?i.hasOwnProperty("entity"):true;t.LT=i?i.hasOwnProperty("labelText"):true;t.LBC=i?i.hasOwnProperty("labelBgColor"):true;t.LBBC=i?i.hasOwnProperty("labelBorderColor"):true;t.AR=i?i.hasOwnProperty("labelArrow"):true;t.LP=i?i.hasOwnProperty("labelPos"):true;t.TT=i?i.hasOwnProperty("tooltip"):true;t.DD=i?i.hasOwnProperty("dragData"):true;t.M=i?i.hasOwnProperty("changeable"):true;t.DS=i?i.hasOwnProperty("dragSource"):true;t.DT=i?i.hasOwnProperty("dropTarget"):true;t.LabelType=i?i.hasOwnProperty("labelType"):true;return t};n.prototype.getTemplateObject=function(){var t=e.prototype.getTemplateObject.apply(this,arguments);var i=this.mBindInfo=this.getBindInfo();var r=i.hasTemplate?this.getBindingInfo("items").template:null;this.bHasType=i.LabelType||r.mProperties["labelType"]!==sap.ui.vbm.SemanticType.None;if(i.HS){t["hotScale.bind"]=t.id+".HS"}else{t.hotScale=r.getHotScale()}if(i.HDC){t["hotDeltaColor.bind"]=t.id+".HDC"}else{t.hotDeltaColor=r.getHotDeltaColor()}if(i.SC){t["selectColor.bind"]=t.id+".SC"}else{t.selectColor=r.getSelectColor()}if(i.FS){t["fxsize.bind"]=t.id+".FS"}else{t.fxsize=r.getFxsize()}if(i.FD){t["fxdir.bind"]=t.id+".FD"}else{t.fxdir=r.getFxdir()}if(i.ET){t["entity.bind"]=t.id+".ET"}else{t.entity=r.getEntity()}if(i.LT){t["labelText.bind"]=t.id+".LT"}else{t.labelText=r.getLabelText()}if(this.bHasType){t["labelIcon.bind"]=t.id+".LIC";t["labelIconBgrdCol.bind"]=t.id+".LICC";t["labelIconTextCol.bind"]=t.id+".LICTC";t["labelBgColor.bind"]=t.id+".LBC";t["labelBorderColor.bind"]=t.id+".LBBC"}else{if(i.LBC){t["labelBgColor.bind"]=t.id+".LBC"}else{t.labelBgColor=r.getLabelBgColor()}if(i.LBBC){t["labelBorderColor.bind"]=t.id+".LBBC"}else{t.labelBorderColor=r.getLabelBorderColor()}}if(i.AR){t["labelArrow.bind"]=t.id+".AR"}else{t.labelArrow=r.getLabelArrow()}if(i.LP){t["labelPos.bind"]=t.id+".LP"}else{t.labelPos=r.getLabelPos()}if(i.TT){t["tooltip.bind"]=t.id+".TT"}else{t.tooltip=r.getTooltip()}if(i.DD){t["dragdata.bind"]=t.id+".DD"}else{t.dragdata=r.getDragData()}if(!i.M){t["VB:c"]=r.getChangeable()}t.altBorderDeltaColor="#676767";return t};n.prototype.getTypeObject=function(){var t=e.prototype.getTypeObject.apply(this,arguments);var i=this.getMinSel();if(i!="0"&&i!="1"){i="0"}var r=this.getMaxSel();if(r!="0"&&r!="1"&&r!="n"||r=="n"){r="-1"}t["minSel"]=i;t["maxSel"]=r;var n=this.mBindInfo;if(n.HS){t.A.push({name:"HS",alias:"HS",type:"vector"})}if(n.HDC){t.A.push({name:"HDC",alias:"HDC",type:"string"})}if(n.SC){t.A.push({name:"SC",alias:"SC",type:"string"})}if(n.FS){t.A.push({name:"FS",alias:"FS",type:"boolean"})}if(n.ET){t.A.push({name:"ET",alias:"ET",type:"string"})}if(n.LT){t.A.push({name:"LT",alias:"LT",type:"string"})}if(this.bHasType){t.A.push({name:"LBC",alias:"LBC",type:"color"});t.A.push({name:"LBBC",alias:"LBBC",type:"color"});t.A.push({name:"LIC",alias:"LIC",type:"string"});t.A.push({name:"LICC",alias:"LICC",type:"color"});t.A.push({name:"LICTC",alias:"LICTC",type:"color"})}else{if(n.LBC){t.A.push({name:"LBC",alias:"LBC",type:"color"})}if(n.LBBC){t.A.push({name:"LBBC",alias:"LBBC",type:"color"})}}if(n.AR){t.A.push({name:"AR",alias:"AR",type:"boolean"})}if(n.LIC){t.A.push({name:"LIC",alias:"LIC",type:"string"})}if(n.LP){t.A.push({name:"LP",alias:"LP",type:"long"})}if(n.TT){t.A.push({name:"TT",alias:"TT",type:"string"})}if(n.DD){t.A.push({name:"DD",alias:"DD",type:"string"})}if(n.DS||n.DT){t.N=[];if(n.DS){t.N.push({name:"DS",A:{name:"DGT",alias:"A",type:"string"}})}if(n.DT){t.N.push({name:"DT",A:{name:"DPT",alias:"A",type:"string"}})}}var a=this.getCustomProperties();for(var s=0;s<a.length;++s){t.A.push({name:a[s],alias:a[s],type:"string"})}return t};n.prototype.getDragItemTemplate=function(e){var t=this.mBindInfo;var i=this.getDragSource();var r=[];for(var n=0,a=i.length;n<a;++n){r.push({type:i[n].getType()})}if(t.DS){r.push({datasource:e+".DS","type.bind":e+".DS.DGT"})}return r};n.prototype.getDropItemTemplate=function(e){var t=this.mBindInfo;var i=this.getDropTarget();var r=[];for(var n=0,a=i.length;n<a;++n){r.push({type:i[n].getType()})}if(t.DT){r.push({datasource:e+".DT","type.bind":e+".DT.DPT"})}return r};n.prototype.openDetailWindow=function(e,t,i){var r=this.getParent();r.mDTWindowCxt.bUseClickPos=i;r.mDTWindowCxt.open=true;r.mDTWindowCxt.src=e;r.mDTWindowCxt.key=e.getKey();r.mDTWindowCxt.params=t;r.m_bWindowsDirty=true;r.invalidate(this)};n.prototype.handleChangedData=function(e){if(e&&e.length){for(var t=0,i,r;t<e.length;++t){i=e[t];r=this.findInstance(i.K);if(r){r.handleChangedData(i)}}}};n.prototype.handleEvent=function(e){var r=e.Action.name;var n="fire"+r[0].toUpperCase()+r.slice(1);var a;if(a=this.findInstance(e.Action.instance)){var s={data:e};if(r.indexOf("handle")===0){s.handle=e.Action.Params.Param[2]["#"]}switch(r){case"click":if(e.Action.AddActionProperties&&e.Action.AddActionProperties.AddActionProperty.length&&e.Action.AddActionProperties.AddActionProperty[0].name=="pos"){a.mClickGeoPos=e.Action.AddActionProperties.AddActionProperty[0]["#"]}break;case"contextMenu":case"handleContextMenu":a.mClickPos=[e.Action.Params.Param[0]["#"],e.Action.Params.Param[1]["#"]];if(this.oParent.mVBIContext.m_Menus){this.oParent.mVBIContext.m_Menus.deleteMenu("DynContextMenu")}var o=new t;o.vbi_data={};o.vbi_data.menuRef="CTM";o.vbi_data.VBIName="DynContextMenu";s.menu=o;break;case"drop":var l=e.Action.Params.Param[0]["#"].split("|");var p=l[1];var f=l[2].split(".")[1];var u=this.getParent().getAggregatorContainer(p).findInstanceByKey(f);s.oDragSource=u;break;default:break}if(a.mEventRegistry[r]){if(n in a){a[n](s)}else{a.fireEvent(r,s)}}if(this.mEventRegistry[r]){s.instance=a;this[n](s)}}else{i.error("Instance for event not found","","sap.ui.vbm.VoAggregation")}};n.prototype.getChangeType=function(e){var t=0;var i=0;var r=0;var n=this.getItems().length;var a=[];var s,o;for(s=0;s<n;++s){a.push(2)}var l,p,f;for(o=0;o<e.length;++o){if(e[o].type=="delete"){f=false;p=0;l=0;while(!f){if(p==e[o].index&&a[l]!=0){a[l]=0;t++;break}else if(a[l]!=0){p++}l++}}else if(e[o].type=="insert"){if(e[o].index>=n){i++}else{f=false;p=0;l=0;while(!f){if(p==e[o].index&&a[l]==0){a[l]=2;r++;break}else if(a[l]!=0){p++}l++}}}}if(e.length&&r==t&&t==e.length/2){return 1}if(t==e.length){return 2}if(i==e.length){return 3}return 0};n.prototype.unbindAggregation=function(t){if(t==="items"){this.m_bAggRenew=true}e.prototype.unbindAggregation.apply(this,arguments)};n.prototype.updateAggregation=function(t){var i=this.mBindingInfos["items"],r=i&&i.binding||null;e.prototype.updateAggregation.apply(this,arguments);if(t==="items"&&r){var n=this.getItems();var a=this.sId;var s="0";var o=r.getCurrentContexts();if(o.diff&&!this.m_bAggChange&&!this.m_bAggRenew){var l=this.getChangeType(o.diff);if(l==2){for(var p=0;p<o.diff.length;++p){var f=o.diff[p].index;s=this.aUniqueIdx[f];var u={K:s};var h={name:a,E:u};var d={name:a,type:"E",N:h};this.aDiff.push({type:"delete",object:d});this.aUniqueIdx.splice(f,1);for(var g=0;g<n.length-1;++g){n[g].UniqueId=this.aUniqueIdx[g]}}this.m_bAggChange=true}else if(l==3||l==1){for(var y=0;y<o.diff.length;++y){if(o.diff[y].type=="insert"){this.aDiff.push({type:"insert",idx:o.diff[y].index})}}this.m_bAggChange=true}else{this.m_bAggRenew=true}}}};n.prototype.invalidate=function(e){var t;if(!this.m_bAggRenew){this.m_bAggRenew=true;if(e&&this.getParent()){t=this.aUniqueIdx.indexOf(e.UniqueId);if(t>-1){var i=false;for(var r=0;r<this.aDiff.length&&!i;++r){if(this.aDiff[r].type=="insert"&&this.aDiff[r].idx==t){i=true}}if(!i){this.aDiff.push({type:"insert",idx:t})}this.m_bAggChange=true;this.m_bAggRenew=false}}}sap.ui.core.Control.prototype.invalidate.apply(this,arguments)};n.prototype.resetIndices=function(){var e=this.getItems();for(var t=0;t<e.length;++t){e[t].UniqueId=undefined}};n.prototype.getUniqueIdx=function(){return this.currentIdx++};n.prototype.updateIdxArray=function(){this.aUniqueIdx=[];var e=this.getItems();for(var t=0;t<e.length;++t){this.aUniqueIdx.push(e[t].UniqueId)}};n.prototype.addUnique=function(e){this.aUniqueIdx.push(e)};n.prototype.setCustomProperties=function(e){this._oCPMap=null;return this.setProperty("customProperties",e)};n.prototype.getCustomPropertiesMap=function(){if(!this._oCPMap){this._oCPMap={};var e=this.getCustomProperties();for(var t=0;t<e.length;++t){this._oCPMap[e[t]]=true}}return this._oCPMap};n.prototype.isSelectable=function(){return this.getMaxSel()!=="0"};n.prototype.isSubscribed=function(e,t){if(this.hasListeners(e)){return true}if(t){var i=this.getItems()[t];return i&&i.hasListeners(e)}return false};return n});
/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5) (c) Copyright 2009-2012 SAP AG. All rights reserved
 */
sap.ui.predefine("sap/ui/vbm/VoBase", ["sap/ui/core/Element","sap/ui/core/theming/Parameters","sap/base/Log","./library"],function(e,t,a,i){"use strict";var r=e.extend("sap.ui.vbm.VoBase",{metadata:{library:"sap.ui.vbm",properties:{key:{type:"string",group:"Misc",defaultValue:null},hotScale:{type:"string",group:"Misc",defaultValue:"1.0;1.0;1.0"},hotDeltaColor:{type:"string",group:"Misc",defaultValue:"RHLSA(0;1.3;1.0;1.0)"},selectColor:{type:"string",group:"Misc",defaultValue:"RHLSA(0.0;1.0;1.0;1.0)"},fxsize:{type:"string",group:"Misc",defaultValue:"true"},fxdir:{type:"string",group:"Misc",defaultValue:"true"},entity:{type:"string",group:"Misc",defaultValue:null},labelText:{type:"string",group:"Misc",defaultValue:null},labelType:{type:"sap.ui.vbm.SemanticType",group:"Behavior",defaultValue:sap.ui.vbm.SemanticType.None},labelBgColor:{type:"string",group:"Misc",defaultValue:"RGB(255;255;255)"},labelBorderColor:{type:"string",group:"Misc",defaultValue:null},labelArrow:{type:"boolean",group:"Misc",defaultValue:false},labelPos:{type:"string",group:"Misc",defaultValue:null},changeable:{type:"boolean",group:"Misc",defaultValue:false},dragData:{type:"string",group:"Misc",defaultValue:null},select:{type:"boolean",group:"Misc",defaultValue:false}},events:{click:{},contextMenu:{parameters:{menu:{type:"sap.ui.unified.Menu"}}},handleMoved:{parameters:{handle:{type:"int"}}},handleContextMenu:{parameters:{handle:{type:"int"},menu:{type:"sap.ui.unified.Menu"}}},handleClick:{parameters:{handle:{type:"int"}}},drop:{parameters:{dragSource:{type:"sap.ui.vbm.VoBase"}}}}}});r.prototype.openDetailWindow=function(e,t,a){this.oParent.openDetailWindow(this,{caption:e,offsetX:t,offsetY:a},false)};r.prototype.openContextMenu=function(e){a.warning("Implementation missing","","sap.ui.vbm.VoBase")};r.prototype.DefaultColorBad=t?t.get("_sap_ui_vbm_shared_ChartBad"):"rgb(211, 32, 48)";r.prototype.DefaultColorCritical=t?t.get("_sap_ui_vbm_shared_ChartCritical"):"rgb(225, 123, 36)";r.prototype.DefaultColorGood=t?t.get("_sap_ui_vbm_shared_ChartGood"):"rgb(97, 166, 86)";r.prototype.DefaultColorNeutral=t?t.get("_sap_ui_vbm_shared_ChartNeutral"):"rgb(132, 143, 148)";r.prototype.getDataElement=function(){var e={};var t=this.getLabelType();var a=this.oParent.mBindInfo;e.K=this.getUniqueId();if(a.M){e["VB:c"]=this.getChangeable()}if(a.HS){e.HS=this.getHotScale()}if(a.HDC){e.HDC=this.getHotDeltaColor()}if(a.SC){e.SC=this.getSelectColor()}if(a.FS){e.FS=this.getFxsize()}if(a.FD){e.FD=this.getFxdir()}if(a.ET){e.ET=this.getEntity()}if(t!=sap.ui.vbm.SemanticType.Hidden){if(a.LT){e.LT=this.getLabelText()}if(a.LBC){e.LBC=this.getLabelBgColor()}if(a.LP){e.LP=this.getLabelPos()}if(a.LBBC){e.LBBC=this.getLabelBorderColor()}if(a.AR){e.AR=this.getLabelArrow()}}if(a.DD){e.DD=this.getDragData()}e["VB:s"]=this.getSelect();var i=this.getTooltip();if(i instanceof sap.ui.core.TooltipBase){e.TT="rtt#"+e.K;sap.ui.vbm.VBI.RttMap[e.K]=i}else{e.TT=i?i:""}var r=this.getLabelProps(t);if(r&&e.LT){if(r.LBC){e.LBC=r.LBC}if(r.LBBC){e.LBBC=r.LBBC}if(r.LIC){e.LIC=r.LIC}if(r.LICC){e.LICC=r.LICC}if(r.LICTC){e.LICTC=r.LICTC}}if(!e.LBC){e.LBC="rgba(255,255,255,1.0)"}if(e.LBBC==""){e.LBBC=e.LBC}var o;if(o=this.getCustomData()){var s,n=this.getParent();if(n.getCustomPropertiesMap&&(s=n.getCustomPropertiesMap())){for(var l=0;l<o.length;++l){var u=o[l].getKey();if(s[u]){e[u]=o[l].getValue()}}}}return e};r.prototype.handleChangedData=function(e){};r.prototype.getDragDropDefs=function(){var e=this.oParent.mBindInfo;var t=[];if(e.DS){var a=this.getDragSource(),i=[];for(var r=0,o=a.length;r<o;++r){i.push({"VB:ix":r,A:a[r].getType()})}if(i.length){t.push({name:"DS",E:i})}}if(e.DT){var s=this.getDropTarget(),n=[];for(var l=0,u=s.length;l<u;++l){n.push({"VB:ix":l,A:s[l].getType()})}if(n.length){t.push({name:"DT",E:n})}}return t};r.prototype.getLabelProps=function(e){var t={};if(e==sap.ui.vbm.SemanticType.None||e==sap.ui.vbm.SemanticType.Default||e==sap.ui.vbm.SemanticType.Hidden){return null}t.LBC=t.LICTC="rgba(255,255,255,1.0)";switch(e){case sap.ui.vbm.SemanticType.Warning:t.LBBC=t.LICC=this.DefaultColorCritical;t.LIC="message-warning";break;case sap.ui.vbm.SemanticType.Error:t.LBBC=t.LICC=this.DefaultColorBad;t.LIC="message-error";break;case sap.ui.vbm.SemanticType.Success:t.LBBC=t.LICC=this.DefaultColorGood;t.LIC="accept";break;case sap.ui.vbm.SemanticType.Inactive:t.LBBC=t.LICC=this.DefaultColorNeutral;t.LIC="hint";break;default:break}return t};r.prototype.getKey=function(){var e=this.getProperty("key");if(!e){e=this.getUniqueId()}return e};r.prototype.invalidate=function(){sap.ui.core.Control.prototype.invalidate.apply(this,arguments)};r.prototype.getUniqueId=function(){if(this.UniqueId==undefined||this.UniqueId==0){var e=this.getId();var t=e;var a=e.match(/\d+/g);if(a&&a.length){t=e.substring(0,e.lastIndexOf(a[a.length-1]))}this.UniqueId=t+this.getParent().getUniqueIdx()}return this.UniqueId};return r});
/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5) (c) Copyright 2009-2012 SAP AG. All rights reserved
 */
sap.ui.predefine("sap/ui/vbm/adapter3d/DragDropHandler", ["sap/ui/base/Object","./Utilities","./thirdparty/three","sap/base/Log"],function(t,e,i,s){"use strict";var a=i.Color;var n=i.Vector2;var o=i.Vector3;var r=i.Matrix4;var h=e.toColor;var p=e.toBoolean;var l=e.vbToThreeJs;var _=e.threeJsToVb;var c="sap.ui.vbm.DragDropHandler";var d=new a(1,0,0);var u=new a(0,1,0);var f=new a(0,0,1);var v=new a(0,0,0);var y=new a(0,1,1);var g=new o(1,0,0);var m=new o(0,1,0);var x=new o(0,0,1);var b="SNAP_X_COLOR";var P="SNAP_Y_COLOR";var w="SNAP_Z_COLOR";var D="SNAP_COLOR";var L="SNAP_HIGHLIGHT_COLOR";var B=1e4;var C=.01;var S=.04;var M=8;var A=new o;var j=new o;var H=new o;var z=new o;var O=new o;var T=new r;var E=new n;var R=new i.Box3;var I=new i.Ray;var G=new i.Line3;var V=new i.Raycaster;var k=new i.Quaternion;var K={PICK:0,DRAG:1};var U={onBeforeRendering:function(t){this._unsubscribe()},onAfterRendering:function(t){this._subscribe()}};var W=t.extend("sap.ui.vbm.adapter3d.DragDropHandler",{constructor:function(e){t.call(this);this._adapter=e;this._context=e._context;this._viewport=e._viewport;this._root=this._viewport._root;this._scene=this._viewport._scene;this._camera=this._viewport._camera;this._cameraControls=this._viewport._cameraController;this._state=K.PICK;this._snapping=false;this._snapAlways=false;this._lockToAxis=false;this._snapAxis=null;this._changeables=new Set;this._changeables3d=[];this._instances=[];this._origin=null;this._hovered=null;this._touch=null;this._offset=new o;this._plane=new i.Plane;this._inverseMatrix=new r;this._xAxisColor=d;this._yAxisColor=f;this._zAxisColor=u;this._lineMaterialSolid=new i.LineBasicMaterial({depthTest:false,depthWrite:false,color:0,linewidth:1,transparent:true,opacity:.99});this._lineMaterialDashed=new i.LineDashedMaterial({depthTest:false,depthWrite:false,color:0,linewidth:1,scale:1,dashSize:.1,gapSize:.06,transparent:true,opacity:.99});this._snapLine=new i.Line((new i.BufferGeometry).setFromPoints([new o,new o]),this._lineMaterialDashed);this._addToScene(this._snapLine,this._root,false,1,1e3);this._snapPointsData=[];for(var s=0;s<M;++s){this._snapPointsData.push({pos:new o,scale:new o})}this._snapPoints=new i.InstancedMesh(new i.SphereGeometry(1,16,16),new i.MeshBasicMaterial({depthTest:false,depthWrite:false,color:65535,transparent:true,opacity:.99}),M);this._addToScene(this._snapPoints,this._scene,false,1,1010);this._snapHighlightPoint=new i.Mesh(new i.SphereGeometry(1,16,16),new i.MeshBasicMaterial({depthTest:false,depthWrite:true,color:16711680,transparent:true,opacity:.99}));this._addToScene(this._snapHighlightPoint,this._scene,false,1,1020);this._snapBox=new i.BoxHelper(undefined,65535);this._addToScene(this._snapBox,this._scene,false,1);this._viewport.addEventDelegate(U,this)}});W.prototype.destroy=function(){this._unsubscribe();this._viewport.removeEventDelegate(U);this._snapBox.geometry.dispose();this._snapBox.material.dispose();this._snapPoints.geometry.dispose();this._snapPoints.material.dispose();this._snapHighlightPoint.geometry.dispose();this._snapHighlightPoint.material.dispose();this._snapLine.geometry.dispose();this._lineMaterialSolid.dispose();this._lineMaterialDashed.dispose();this._root.remove(this._snapLine);this._scene.remove(this._snapBox,this._snapPoints,this._snapHighlightPoint);this._adapter=null;this._context=null;this._viewport=null;this._root=null;this._scene=null;this._camera=null;this._cameraControls=null;this._lineMaterialSolid=null;this._lineMaterialDashed=null;this._snapBox=null;this._snapLine=null;this._snapPoints=null;this._snapHighlightPoint=null;t.prototype.destroy.call(this)};W.prototype.update=function(){this._cancel();var t=this._context.scene;var i=this._context.voQueues;(i.toAdd.get(t)||[]).forEach(function(t){if(t["VB:c"]&&(t.isBox||t.isCylinder)&&p(t["VB:c"])){this._changeables.add(t)}},this);(i.toRemove.get(t)||[]).forEach(function(t){this._changeables.delete(t)},this);(i.toUpdate.get(t)||[]).forEach(function(t){if(t["VB:c"]&&(t.isBox||t.isCylinder)&&e.propertyChanged(t,"VB:c")){if(p(t["VB:c"])){this._changeables.add(t)}else{this._changeables.delete(t)}e.updateProperty(t,"VB:c")}},this);this._changeables3d=Array.from(this._changeables,function(t){return t.object3D});var s=this._context.config;this._xAxisColor=s.has(b)?h(s.get(b)).rgb:d;this._yAxisColor=s.has(P)?h(s.get(P)).rgb:f;this._zAxisColor=s.has(w)?h(s.get(w)).rgb:u;var a=s.has(D)?h(s.get(D)).rgb:y;var n=s.has(L)?h(s.get(L)).rgb:d;this._snapBox.material.color.copy(a);this._snapBox.material.needsUpdate=true;this._snapPoints.material.color.copy(a);this._snapPoints.material.needsUpdate=true;this._snapHighlightPoint.material.color.copy(n);this._snapHighlightPoint.material.needsUpdate=true};W.prototype._onKeyUp=function(t){if(!t.repeat){this._handleKeyPress(t,false)}};W.prototype._onKeyDown=function(t){if(!t.repeat){this._handleKeyPress(t,true)}};W.prototype._onPointerDown=function(t){this._mouseDown=true;if(this._hovered){var e;if(this._snapHighlightPoint.visible){this._snapping=true;e=this._snapHighlightPoint.position}else{V.layers.set(0);V.setFromCamera(this._updatePointer(t,E),this._camera);var i=V.intersectObject(this._hovered,false);if(i.length>0){e=i[0].point}}if(e){this._dom.style.cursor="move";this._dragStart(e)}}};W.prototype._onPointerMove=function(t){if(this._mouseDown&&this._cameraControls.enabled){this._snapBox.visible=false;this._snapLine.visible=false;this._snapPoints.visible=false;this._snapHighlightPoint.visible=false;return}this._updatePointer(t,E);if(this._state===K.DRAG){V.layers.set(0);V.setFromCamera(E,this._camera);if(V.ray.intersectPlane(this._plane,A)){this._drag(A.sub(this._offset).applyMatrix4(this._inverseMatrix),E,t.ctrlKey,t.shiftKey)}}if(this._state===K.PICK||this._snapping){this._handleHover(E)}if(this._state===K.PICK&&this._snapPoints.visible){V.layers.set(1);var e=V.intersectObject(this._snapPoints,false);if(e.length>0){var i=e[0].instanceId;this._snapHighlightPoint.scale.copy(this._snapPointsData[i].scale);this._snapHighlightPoint.position.copy(this._snapPointsData[i].pos);this._snapHighlightPoint.updateMatrix();this._snapHighlightPoint.visible=true}else{this._snapHighlightPoint.visible=false}}};W.prototype._onPointerCancel=function(t){this._mouseDown=false;this._dom.style.cursor=this._hovered?"pointer":"auto";this._dragEnd()};W.prototype._handleHover=function(t){var e=[],i=false;V.layers.set(0);V.setFromCamera(t,this._camera);V.intersectObjects(this._changeables3d,false,e);if(this._hovered!==null){if(!this._hovered.geometry.boundingBox){this._hovered.geometry.computeBoundingBox()}R.copy(this._hovered.geometry.boundingBox);R.applyMatrix4(this._hovered.matrixWorld);if(V.ray.intersectBox(R,A)){i=true}}if(!i){if(e.length>0){var s=e[0].object;if(this._hovered!==s&&this._hovered!==null){this._hovered=null;this._dom.style.cursor="auto";this._hoverOff()}if(this._hovered!==s){this._hovered=s;this._dom.style.cursor="pointer";this._hoverOn(this._hovered)}}else if(this._hovered!==null){this._hovered=null;this._dom.style.cursor="auto";this._hoverOff()}}};W.prototype._handleKeyPress=function(t,e){if(t.keyCode===16){this._lockToAxis=e;this._updateSnapLine()}else if(t.keyCode===20){this._snapAlways=t.getModifierState("CapsLock");this._updateSnapLine()}else if(t.keyCode===27&&e){this._cancel()}};W.prototype._dragStart=function(t){this._plane.setFromNormalAndCoplanarPoint(this._camera.getWorldDirection(this._plane.normal),t);this._inverseMatrix.copy(this._hovered.parent.matrixWorld).invert();this._offset.copy(t).sub(A.setFromMatrixPosition(this._hovered.matrixWorld));this._touch=e.threeJsToVb(t);this._instances.length=0;var i=p(this._hovered._sapInstance["VB:s"]);this._changeables.forEach(function(t){if(t===this._hovered._sapInstance||i&&p(t["VB:s"])){this._instances.push(t);t._last.dragStart=t.object3D.position.clone();var e=this._adapter._sceneBuilder._instanceDecals.get(t);if(e){e.forEach(function(t){t._last.dragStart=t.object3D.position.clone()})}this._changeables3d.splice(this._changeables3d.indexOf(t.object3D),1)}},this);this._origin=this._hovered;this._hovered=null;this._state=K.DRAG;this._snapBox.visible=false;this._snapPoints.visible=false;this._snapHighlightPoint.visible=false;this._cameraControls.setEnabled(false)};W.prototype._drag=function(t,e,s,a){var n,o=true,h=false,p,c=Number.MAX_VALUE;var d=t.clone().sub(this._origin._sapInstance._last.dragStart);A.set(e.x,e.y,0);if(this._snapping&&this._snapPoints.visible){for(n=0;n<M;++n){j.copy(this._snapPointsData[n].pos);H.copy(j);j.project(this._camera);j.z=0;p=A.distanceTo(j);if(p<S&&p<c){h=true;c=p;_(H,H);_(this._offset,z);O.copy(H.sub(this._origin._sapInstance._last.dragStart));O.sub(z)}}}if(h){d.copy(O)}else{var u=[{dir:g,color:this._xAxisColor},{dir:m,color:this._yAxisColor},{dir:x,color:this._zAxisColor}];if(!this._lockToAxis){u.forEach(function(t){t.distance=this._getAxisSnapDistance(this._touch,d,t.dir)},this);u.sort(function(t,e){return t.distance<e.distance?-1:1});if(u[0].distance<S||this._snapAlways){this._snapAxis=u[0]}else{this._snapAxis=null}}this._updateSnapLine();if(this._snapAxis){this._getAxisSnapPosition(this._touch,d,this._snapAxis.dir,d)}}if(s){for(n=0;n<this._instances.length;++n){var f=this._instances[n];var v=f._last.dragStart.clone().add(d);var y=(new r).compose(v,f.object3D.quaternion,f.object3D.scale);y.multiplyMatrices(f.object3D.parent.matrixWorld,y);if(!f.object3D.geometry.boundingBox){f.object3D.geometry.computeBoundingBox()}var b=(new i.Box3).copy(f.object3D.geometry.boundingBox);b.applyMatrix4(y);if(this._isCollide(this._scene,b)){o=false;break}}}if(o){this._updateSnapLineGeometry(this._touch,d);for(n=0;n<this._instances.length;++n){this._instances[n].object3D.position.copy(this._instances[n]._last.dragStart).add(d);this._instances[n].object3D.updateMatrix();var P=this._adapter._sceneBuilder._instanceDecals.get(this._instances[n]);if(P){l(d,A);P.forEach(function(t){t.object3D.position.copy(t._last.dragStart).add(A);t.object3D.updateMatrix()})}}this._viewport._resetBBox();this._viewport._updateCamera()}this._snapLine.visible=true};W.prototype._dragEnd=function(){if(this._state!==K.DRAG){return}var t=new Map;var e={version:"2.0","xmlns:VB":"VB",Data:{Merge:{N:[]}}};this._instances.forEach(function(e){if(e.id){if(e.voGroup.isDataBound){var i=e.voGroup.datasource;var a=t.get(i);if(!a){a={name:i,E:[]};t.set(i,a)}var n=e.voGroup.template.pos;var o=n.path[n.path.length-1];var r=this._adapter._parser.getAttributeAlias(i,o);var h=this._adapter._parser.getAttributeAlias(i,e.voGroup.keyAttributeName);var p=e.object3D.position;var l=p.x.toFixed(5)+";"+p.y.toFixed(5)+";"+p.z.toFixed(5);e.dataInstance[o]=e._last.pos=e.pos=l;var _={};_[h]=e.id;_[r]=l;a.E.push(_)}else{s.error("Only data bound instance can be included in Data.Merge section",e.id,c)}}else{s.error("Cannot process instance without id",e,c)}},this);if(t.size>0){t.forEach(function(t){e.Data.Merge.N.push(t)});this._adapter.fireSubmit({data:JSON.stringify(e)})}this._state=K.PICK;this._hovered=null;this._origin=null;this._touch=null;this._snapping=false;this._snapLine.visible=false;this._instances.length=0;this._changeables3d=Array.from(this._changeables,function(t){return t.object3D});this._cameraControls.setEnabled(true)};W.prototype._hoverOn=function(t){var e=this;if(!t.geometry.boundingBox){t.geometry.computeBoundingBox()}R.copy(t.geometry.boundingBox);R.applyMatrix4(t.matrixWorld);function i(t,i,s,a){e._snapPointsData[t].pos.set(i,s,a)}i(0,R.min.x,R.min.y,R.min.z);i(1,R.min.x,R.min.y,R.max.z);i(2,R.min.x,R.max.y,R.min.z);i(3,R.min.x,R.max.y,R.max.z);i(4,R.max.x,R.min.y,R.min.z);i(5,R.max.x,R.min.y,R.max.z);i(6,R.max.x,R.max.y,R.min.z);i(7,R.max.x,R.max.y,R.max.z);this._snapPoints.visible=true;this._updateSnapPoints();this._snapBox.visible=true;this._snapBox.setFromObject(t)};W.prototype._hoverOff=function(){this._snapBox.visible=false;this._snapPoints.visible=false;this._snapHighlightPoint.visible=false};W.prototype._isCollide=function(t,i){var s;if(t.visible&&t.geometry&&e.layersEnabled(t.layers,0)&&this._instances.indexOf(t._sapInstance)<0){t.updateWorldMatrix(false,false);if(!t.geometry.boundingBox){t.geometry.computeBoundingBox()}if(t.isInstancedMesh){for(s=0;s<t.count;++s){t.getMatrixAt(s,T);R.copy(t.geometry.boundingBox);R.applyMatrix4(T);if(R.intersectsBox(i)){return true}}}else{R.copy(t.geometry.boundingBox);R.applyMatrix4(t.matrixWorld);if(R.intersectsBox(i)){return true}}}var a=t.children;for(s=0;s<a.length;++s){if(this._isCollide(a[s],i)){return true}}return false};W.prototype._updateSnapLineGeometry=function(t,e){var i=this._snapLine.geometry.attributes.position;i.needsUpdate=true;i.array[0]=t.x;i.array[1]=t.y;i.array[2]=t.z;i.array[3]=t.x+e.x;i.array[4]=t.y+e.y;i.array[5]=t.z+e.z;this._snapLine.geometry.computeBoundingBox();this._snapLine.geometry.computeBoundingSphere();if(this._snapLine.material===this._lineMaterialDashed){this._snapLine.computeLineDistances()}};W.prototype._updateSnapLine=function(){this._updateSnapLineColor(this._snapAxis?this._snapAxis.color:v);this._updateSnapLineType(this._snapAxis&&this._lockToAxis||this._snapAlways)};W.prototype._updateSnapLineColor=function(t){if(!this._snapLine.material.color.equals(t)){this._snapLine.material.color.copy(t);this._snapLine.material.needsUpdate=true}};W.prototype._updateSnapLineType=function(t){var e=this._snapLine.material;this._snapLine.material=t?this._lineMaterialSolid:this._lineMaterialDashed;if(e!==this._snapLine.material){this._snapLine.material.color.copy(e.color);this._snapLine.material.needsUpdate=true;if(this._snapLine.material===this._lineMaterialDashed){this._snapLine.computeLineDistances()}}};W.prototype._getAxisSnapDistance=function(t,e,i){l(t,A);l(j.copy(t).add(e),j);H.copy(A).add(i);var s=this._viewport._camera;A.project(s);j.project(s);H.project(s);A.z=j.z=H.z=0;G.start.copy(A);G.end.copy(H);G.closestPointToPoint(j,false,A);return j.distanceTo(A)};W.prototype._getAxisSnapPosition=function(t,e,i,a){l(t,A);l(j.copy(t).add(e),j);H.copy(i).multiplyScalar(B);z.copy(A).sub(H);O.copy(A).add(H);var n=this._viewport._camera;j.project(n);A.copy(z).project(n);H.copy(O).project(n);A.z=j.z=H.z=0;G.start.copy(A);G.end.copy(H);G.closestPointToPoint(j,false,A);I.origin.setFromMatrixPosition(n.matrixWorld);I.direction.set(A.x,A.y,.5).unproject(n).sub(I.origin).normalize();if(I.distanceSqToSegment(z,O,A,j)<C){_(j,j);a.copy(j.sub(t))}else{s.error("failed to calculate snapping point","",c)}};W.prototype._cancel=function(){if(this._touch){for(var t=0;t<this._instances.length;++t){this._instances[t].object3D.position.copy(this._instances[t]._last.dragStart);this._instances[t].object3D.updateMatrix();var e=this._adapter._sceneBuilder._instanceDecals.get(this._instances[t]);if(e){e.forEach(function(t){t.object3D.position.copy(t._last.dragStart);t.object3D.updateMatrix()})}}this._touch=null;this._hovered=null;this._snapLine.visible=false;this._instances.length=0;this._cameraControls.setEnabled(true);this._dom.style.cursor="auto";this._viewport._resetBBox();this._viewport._updateCamera()}};W.prototype._addToScene=function(t,e,i,s,a){if(i!==undefined){t.visible=i}if(s!==undefined){t.layers.set(s)}if(a!==undefined){t.renderOrder=a}e.add(t);t.matrixAutoUpdate=false};W.prototype._addListener=function(t,e,i){var s=i.bind(this);this[e+"Proxy"]=s;t.addEventListener(e,s)};W.prototype._removeListener=function(t,e){t.removeEventListener(e,this[e+"Proxy"]);delete this[e+"Proxy"]};W.prototype._subscribe=function(){var t=this._viewport.getDomRef();if(t){this._dom=t;this._addListener(t,"keyup",this._onKeyUp);this._addListener(t,"keydown",this._onKeyDown);this._addListener(t,"wheel",this._onPointerMove);this._addListener(t,"pointerup",this._onPointerCancel);this._addListener(t,"pointerdown",this._onPointerDown);this._addListener(t,"pointermove",this._onPointerMove);this._addListener(t,"pointerleave",this._onPointerCancel)}this._addListener(this._cameraControls,"change",this._onCameraChange)};W.prototype._unsubscribe=function(){var t=this._viewport.getDomRef();if(t){this._dom=null;this._removeListener(t,"wheel");this._removeListener(t,"keyup");this._removeListener(t,"keydown");this._removeListener(t,"pointerup");this._removeListener(t,"pointerdown");this._removeListener(t,"pointermove");this._removeListener(t,"pointerleave")}this._removeListener(this._cameraControls,"change")};W.prototype._updatePointer=function(t,e){var i=this._viewport.getDomRef().getBoundingClientRect();e.x=(t.cursor?t.cursor.x:t.pageX-window.pageXOffset-i.left)/i.width*2-1;e.y=-(t.cursor?t.cursor.y:t.pageY-window.pageYOffset-i.top)/i.height*2+1;return e};W.prototype._updateSnapPoints=function(){A.copy(this._snapPointsData[0].pos).add(this._snapPointsData[M-1].pos).multiplyScalar(.5);var t=A.distanceTo(this._camera.position)*Math.min(1.9*Math.tan(Math.PI*this._camera.fov/360)/this._camera.zoom,10);for(var e=0;e<M;++e){this._snapPointsData[e].scale.set(1,1,1).multiplyScalar(t/170);T.compose(this._snapPointsData[e].pos,k,this._snapPointsData[e].scale);this._snapPoints.setMatrixAt(e,T)}this._snapPoints.instanceMatrix.needsUpdate=true;this._snapHighlightPoint.scale.copy(this._snapPointsData[0].scale);this._snapHighlightPoint.updateMatrix()};W.prototype._onCameraChange=function(t){if(this._snapPoints.visible){this._updateSnapPoints()}};return W});
/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5) (c) Copyright 2009-2012 SAP AG. All rights reserved
 */
sap.ui.predefine("sap/ui/vbm/adapter3d/ModelHandler", ["sap/ui/base/Object","./Utilities","./thirdparty/three","./thirdparty/ColladaLoader","sap/base/Log"],function(e,t,o,s,r){"use strict";var n="sap.ui.vbm.ModelHandler";var i=o.Box3;var a=o.Matrix4;var l=t.propertyAdded;var d=t.propertyChanged;var c=t.updateProperty;var h=t.addRef;var u=t.subRef;var f=e.extend("sap.ui.vbm.adapter3d.ModelHandler",{constructor:function(t,o,s,r){e.call(this);this._resources=t;this._textures=o;this._scene=s;this._root=r;this._root.updateWorldMatrix(false,false);this._hotInstance=null;this._instances=new Map;this._models=new Map;this._meshes=new Map;this._colladaLoader=null;this._glTFLoader=null}});var m=4e3;f.prototype.destroy=function(){this._resources=null;this._textures=null;this._scene=null;this._root=null;this._hotInstance=null;this._meshes.forEach(function(e){e.forEach(function(e){e.objects3D.forEach(function(e){this._deleteObject3D(e)},this)},this)},this);this._instances.forEach(function(e){if(e.texture){u(e.texture)}});this._models.forEach(function(e,t){this._deleteModel(e)},this);this._meshes.clear();this._meshes=null;this._instances.clear();this._instances=null;this._models.clear();this._models=null;this._glTFLoader=null;this._colladaLoader=null;e.prototype.destroy.call(this)};f.prototype.addInstance=function(e){this._instances.set(e,{instance:e,world:new a,matrices:[],model:null,texture:null,key:null,mesh:null});this.updateInstance(e)};f.prototype.updateInstance=function(e){var o=this._instances.get(e),s=false,i=this._hotInstance&&this._hotInstance===e;if(o){var f=t.toBoolean(e.normalize);if(d(e,"model")){if(!l(e,"model")){this._removeInstanceFromMesh(o);u(o.model)}o.model=this._models.get(e.model);if(!o.model){r.error("Removing broken instance with unknown model",e.model,n);this.removeInstance(e);return}h(o.model);o.matrices.length=0;s=true}if(d(e,"texture")){if(!l(e,"texture")){if(o.texture){u(o.texture);o.texture=null}}if(e.texture){o.texture=this._textures.get(e.texture)||null;if(o.texture){h(o.texture)}else{r.error("Failed to apply texture on model, texture not found",e.texture,n)}}s=true}if(d(e,["normalize","model"])){this._updateModel(o.model,f);o.matrices.length=0;s=true}if(d(e,["pos","rot","scale"])){t.getInstanceMatrix(e,o.world,f?o.model.normalized.bbox:o.model.bbox);o.matrices.length=0;s=true}var m=this._getInstanceKey(e,i);if(!o.key||m!==o.key){this._removeInstanceFromMesh(o);o.key=m;s=true}c(e,["model","normalize","pos","rot","scale","texture","color","selectColor","hotDeltaColor","VB:s"]);if(o.matrices.length===0){var p=this._root.matrixWorld.clone();p.multiply(o.world);if(f){p.multiply(o.model.normalized.world)}o.model.root.children.forEach(function(e){o.matrices.push((new a).multiplyMatrices(p,e.matrixWorld))})}if(s){this._requestUpdate(o)}}else{r.error("Unable to find model instance data","",n)}};f.prototype.removeInstance=function(e){var t=this._instances.get(e);if(t){if(this._hotInstance===e){this._hotInstance=null}this._instances.delete(e);this._removeInstanceFromMesh(t);e._last={};if(t.model){u(t.model)}if(t.texture){u(t.texture)}}else{r.error("Unable to find model instance data","",n)}};f.prototype.update=function(){var e=[];this._meshes.forEach(function(s,r){for(var n=0;n<s.length;){if(s[n].dirty){var i,a,l=0,d=s[n];d.objects3D.forEach(function(e){this._deleteObject3D(e)},this);d.objects3D.length=d.hitInfo.length=0;if(d.instances.size){d.model.root.children.forEach(function(e){var s=new o.InstancedMesh(e.geometry,t.cloneMaterials(e.material),d.instances.size);s.matrixAutoUpdate=false;s.layers.set(0);s._instanceHitTest=this._instanceHitTest.bind(d);this._scene.add(s);d.objects3D.push(s)},this);d.instances.forEach(function(e){a=e;d.hitInfo.push(a);for(i=0;i<d.objects3D.length;++i){d.objects3D[i].setMatrixAt(l,a.matrices[i])}l++});t.applyColor(a.instance,a.instance.color,d.objects3D,this._hotInstance===a.instance,a.texture)}d.dirty=false}if(s[n].objects3D.length!==0){n++}else{s.splice(n,1)}}if(!s.length){e.push(r)}},this);e.forEach(function(e){this._meshes.delete(e)},this);this._models.forEach(function(e,o){if(t.refCountableDispose(e)){this._deleteModel(e);this._models.delete(o)}},this)};f.prototype.updateHotInstance=function(e){var t;if(this._hotInstance){t=this._instances.get(this._hotInstance);t.key=this._getInstanceKey(this._hotInstance,false);this._removeInstanceFromMesh(t);this._requestUpdate(t)}if(e&&e.isModel){t=this._instances.get(e);t.key=this._getInstanceKey(e,true);this._removeInstanceFromMesh(t);this._requestUpdate(t)}this._hotInstance=e&&e.isModel?e:null};f.prototype.addModel=function(e){if(e.isModel&&e.model&&!this._models.has(e.model)){this._models.set(e.model,{root:null,bbox:null,normalized:null})}};f.prototype.loadModels=function(){var e=[];this._models.forEach(function(t,o){if(!t.root){e.push(this._loadModel(o,t))}},this);return Promise.all(e)};f.prototype._loadModel=function(e,o){var s=this;var i=this._resources.get(e);if(!i){r.error("Failed to get model from context",e,n);this._models.delete(e);return Promise.resolve()}return new Promise(function(a,l){if(atob(i.slice(0,6)).startsWith("glTF")){try{s._getGlTFLoader().parse(t.base64ToArrayBuffer(i),"",function(e){s._postprocess(e,o);a()})}catch(t){s._models.delete(e);r.error("Failed to load glb model",e,n);a()}}else{try{s._postprocess(s._getColladaLoader().parse(atob(i)),o);a()}catch(t){try{s._getGlTFLoader().parse(atob(i),"",function(e){s._postprocess(e,o);a()})}catch(t){s._models.delete(e);r.error("Failed to load collada/gltf model",e,n);a()}}}})};f.prototype._postprocess=function(e,s){e.scene.scale.set(1,1,-1);var r=[],n=new Set,i="_sapUsed";e.scene.traverse(function(e){e.updateWorldMatrix(false,false);var o=e.isMesh&&e.visible;if(o){r.push(e)}else if(e.geometry){e.geometry.dispose()}t.toArray(e.material).forEach(function(e){if(o||!e[i]){e[i]=o}n.add(e)})});n.forEach(function(e){if(!e[i]){for(var t in e){if(t instanceof o.Texture){t.dispose()}}e.dispose()}});s.root=new o.Group;r.forEach(function(e){e.remove(e.children);s.root.add(e);e.matrixWorld.decompose(e.position,e.quaternion,e.scale)})};f.prototype._requestUpdate=function(e){if(e.mesh){e.mesh.dirty=true}else{var t=this._meshes.get(e.key);if(!t){t=[];this._meshes.set(e.key,t)}for(var o=0;o<t.length;++o){if(t[o].instances.size<m){e.mesh=t[o];break}}if(!e.mesh){e.mesh={dirty:true,model:e.model,hitInfo:[],objects3D:[],instances:new Set};t.push(e.mesh)}e.mesh.instances.add(e);e.mesh.dirty=true}};f.prototype._updateModel=function(e,o){if(o){if(!e.normalized){e.normalized={bbox:new i,world:new a};t.normalizeObject3D(e.root,e.normalized.world,e.normalized.bbox)}}else if(!e.bbox){e.bbox=(new i).setFromObject(e.root)}};f.prototype._deleteModel=function(e){e.root.children.forEach(function(e){e.geometry.dispose();t.toArray(e.material).forEach(function(e){for(var t in e){if(t instanceof o.Texture){t.dispose()}}e.dispose()})},this)};f.prototype._removeInstanceFromMesh=function(e){if(e.mesh){if(e.mesh.instances.delete(e)){e.mesh.dirty=true;e.mesh=null}else{r.error("Unable to find instance data in polygon mesh data","",n)}}};f.prototype._deleteObject3D=function(e){if(e){if(e.parent){e.parent.remove(e)}t.toArray(e.material).forEach(function(e){e.dispose()})}};f.prototype._getInstanceKey=function(e,o){var s=t.toBoolean(e["VB:s"]);var r=e.texture?"_texture_"+e.texture:"";var n="_color_"+e.color.toLowerCase();var i=s?"_selected_"+e.selectColor.toLowerCase():"";var a=o?"_hot_"+e.hotDeltaColor.toLowerCase():"";return e.model+r+n+i+a};f.prototype.getTarget=function(e){var t=this._instances.get(e);if(t){var s=new o.Mesh(t.model.root.children[0].geometry.clone());var r=t.world.clone();if(t.model.normalized){r.multiply(t.model.normalized.world)}r.multiply(t.model.root.children[0].matrixWorld);r.decompose(s.position,s.quaternion,s.scale);s.updateMatrix();this._root.add(s);return s}return null};f.prototype._instanceHitTest=function(e){if(e.instanceId>=0){var t=this.hitInfo[e.instanceId];e.world=t.matrices[e.instanceId];return t.instance}return null};f.prototype._getColladaLoader=function(){return this._colladaLoader||(this._colladaLoader=new o.ColladaLoader)};f.prototype._getGlTFLoader=function(){return this._glTFLoader||(this._glTFLoader=new o.GLTFLoader)};return f});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5) (c) Copyright 2009-2012 SAP AG. All rights reserved
 */
sap.ui.predefine("sap/ui/vbm/adapter3d/ObjectFactory", ["sap/ui/base/Object"],function(e){"use strict";var t={id:undefined,type:"default",caption:undefined,refScene:undefined,refParent:undefined,width:"0",height:"0",modal:"true",pos:"0;0;0"};var r={id:undefined,type:"default",voGroups:undefined,getVisualObjectGroupById:function(e){for(var t=0,r=this.voGroups.length;t<r;++t){var n=this.voGroups[t];if(n.id===e){return n}}return undefined}};var n={id:undefined,type:undefined,datasource:undefined,scene:undefined,vos:undefined,maxSel:"-1",minSel:"0",keyAttributeName:undefined,template:undefined,isDataBound:false,isDirty:true};var a=Object.create(Object.prototype);a["VB:c"]="false";a["VB:s"]="false";a.color="RGB(128,128,128)";a.fxdir="false";a.fxsize="false";a.hotDeltaColor="RHLSA(0;1.1;1;1)";a.opacity="1";a.pos="0;0;0";a.rot="0;0;0";a.scale="1;1;1";a.selectColor="RGBA(178;127;0;255)";a.zsort="false";a.dragSource=undefined;a.dropTarget=undefined;var i=Object.create(a);i.isBox=true;i.object3D=undefined;i.type="{00100000-2012-0004-B001-BFED458C3076}";i.colorBorder=undefined;i.texture=undefined;i.texture6="false";i.normalize="false";i.tooltip=undefined;var u=Object.create(a);u.object3D=undefined;u.isCylinder=true;u.type="{00100000-2012-0004-AFC0-5FDB345FC47E}";u.colorBorder=undefined;u.texture=undefined;u.textureCap=undefined;u.isOpen=false;u.normalize="false";u.tooltip=undefined;var d=Object.create(a);d.isPolygon=true;d.type="{00100000-2014-0004-BDA8-87B904609063}";d.OuterNormal="0;0;1";d.colorBorder=undefined;d.tooltip=undefined;var o=Object.create(a);o.isModel=true;o.type="{00100000-2012-0070-1000-35762CF28B6B}";o.model=undefined;o.text=undefined;o.texture=undefined;o.normalize="false";o.tooltip=undefined;var f={object3D:undefined,isDecal:true,type:"{388951f5-a66b-4423-a5ad-e0ee13c2246f}",position:"0;0;0",direction:"0;0;0",size:"0;0;0",rotation:"0",texture:undefined,text:undefined,target:undefined,planeOrigin:undefined,planeNormal:undefined};var s=Object.create(Object.prototype);s.left="0";s.top="0";s.right="0";s.bottom="0";s.align="0";s.tooltip=undefined;var c=Object.create(s);c.isCaption=true;c.type="{00100000-2013-1000-1100-50059A6A47FA}";c.level="0";c.text=undefined;var p=Object.create(s);p.isLabel=true;p.type="{00100000-2013-1000-3700-AD84DDBBB31B}";p.text=undefined;var l=Object.create(s);l.isImage=true;l.type="{00100000-2013-1000-2200-6B060A330B2C}";l.image=undefined;var y=Object.create(s);y.isButton=true;y.type="{00100000-2013-1000-1200-855B919BB0E9}";y.text=undefined;var b=Object.create(s);b.isLink=true;b.type="{00100000-2013-1000-2400-D305F7942B98}";b.href=undefined;b.text=undefined;var v=new Map;v.set(i.type,i);v.set(u.type,u);v.set(o.type,o);v.set(d.type,d);v.set(f.type,f);v.set(c.type,c);v.set(p.type,p);v.set(l.type,l);v.set(y.type,y);v.set(b.type,b);var B={name:undefined,key:undefined,minSel:"-1",maxSel:"0",attributes:undefined,dataTypes:undefined,getKeyAttribute:function(){return this.key?this.getAttributeByName(this.key):undefined},getAttributeByAlias:function(e){for(var t=0,r=this.attributes.length;t<r;++t){var n=this.attributes[t];if(n.alias===e){return n}}return undefined},getAttributeByName:function(e){for(var t=0,r=this.attributes.length;t<r;++t){var n=this.attributes[t];if(n.name===e){return n}}return undefined},getDataTypeByName:function(e){for(var t=0,r=this.dataTypes.length;t<r;++t){var n=this.dataTypes[t];if(n.name===e){return n}}return undefined}};var j={name:undefined,alias:undefined,type:"string"};var O=e.extend("sap.ui.vbm.adapter3d.ObjectFactory",{});O.prototype.createVisualObject=function(e){var t=v.get(e.type);var r=t&&Object.create(t,{voGroup:{writable:true},dataInstance:{writable:true}});if(r){r._last={};r.voGroup=e;e.vos.push(r)}return r};O.prototype.createVisualObjectGroup=function(e){var t=Object.create(n);t.scene=e;e.voGroups.push(t);t.template={};t.vos=[];t.selected=[];return t};O.prototype.createScene=function(e){var t=Object.create(r);t.voGroups=[];t.sceneGeo=e;return t};O.prototype.createWindow=function(){return Object.create(t)};O.prototype.createDataType=function(){var e=Object.create(B);e.attributes=[];e.dataTypes=[];return e};O.prototype.createDataTypeAttribute=function(){return Object.create(j)};O.prototype.createDataNode=function(){return[]};O.prototype.createDataInstance=function(){return Object.create(Object.prototype,{isDirty:{writable:true},visualObject:{writable:true}})};return O});
/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5) (c) Copyright 2009-2012 SAP AG. All rights reserved
 */
sap.ui.predefine("sap/ui/vbm/adapter3d/PolygonHandler", ["sap/ui/base/Object","./Utilities","./thirdparty/three","sap/base/Log"],function(e,t,r,o){"use strict";var n="sap.ui.vbm.PolygonHandler";var s=r.Vector3;var i=r.Matrix4;var a=t.propertyAdded;var l=t.propertyRemoved;var c=t.propertyChanged;var h=t.updateProperty;var d=t.getColor;var u=t.rgbaToString;var p=t.equalsRGBA;var f=t.createMaterial;var m=t.createLineMaterial;var g=e.extend("sap.ui.vbm.adapter3d.PolygonHandler",{constructor:function(t){e.call(this);this._root=t;this._hotInstance=null;this._instances=new Map;this._meshes=new Map;this._borders=new Map}});var y=2e3;var b=2e3;g.prototype.destroy=function(){this._root=null;this._hotInstance=null;this._meshes.forEach(function(e,t){t.forEach(function(e){this._deleteObject3D(e.object3D)},this)},this);this._borders.forEach(function(e,t){t.forEach(function(e){this._deleteObject3D(e.object3D)},this)},this);this._instances.clear();this._instances=null;this._meshes.clear();this._meshes=null;this._borders.clear();this._borders=null;e.prototype.destroy.call(this)};g.prototype.update=function(){var e=this._updateMeshes()||false;e=this._updateBorders()||e;if(this._hotInstance&&e){this._updateHot(this._hotInstance,true)}};g.prototype.addInstance=function(e){this._instances.set(e,{instance:e,indices:[],vertices:[],normal:null,lines:null,matrix:new i,color:null,colorHot:null,colorBorder:null,colorBorderHot:null,mesh:null,border:null});this.updateInstance(e)};g.prototype.updateInstance=function(e){var r=this._instances.get(e),s=false,i=false;if(r){if(c(e,["pos","rot","scale"])){t.getInstanceMatrix(e,r.matrix);s=i=true}if(c(e,"OuterNormal")){r.normal=t.toVector3(e.OuterNormal||"0;0;1").normalize();s=true}if(c(e,"posarray")){this._getGeometry(e,r.indices,r.vertices);s=i=true}if(c(e,["color","selectColor","VB:s"])){var u=d(e,e.color,false);if(!r.color||!p(u,r.color)){this._removeInstanceFromMesh(r);r.color=u;r.colorHot=d(e,e.color,true);s=true}}if(l(e,"colorBorder")){this._removeInstanceFromBorder(r);r.lines=r.colorBorder=r.colorBorderHot=null}else if(e.colorBorder){if(a(e,"colorBorder")||c(e,"posarray")){r.lines=this._getBorderGeometry(r.indices,r.vertices);i=true}if(c(e,["colorBorder","selectColor,","VB:s"])){var f=d(e,e.colorBorder,false);if(!r.colorBorder||!p(f,r.colorBorder)){this._removeInstanceFromBorder(r);r.colorBorder=f;r.colorBorderHot=d(e,e.colorBorder,true);i=true}}}if(c(e,"hotDeltaColor")){r.colorHot=d(e,e.color,true);if(r.colorBorder){r.colorBorderHot=d(e,e.colorBorder,true)}}h(e,["pos","rot","scale","OuterNormal","posarray","color","colorBorder","selectColor","hotDeltaColor","VB:s"]);if(s){this._requestMeshUpdate(r)}if(e.colorBorder){if(i){this._requestBorderUpdate(r)}}}else{o.error("Unable to find polygon instance data","",n)}};g.prototype.removeInstance=function(e){var t=this._instances.get(e);if(t){if(this._hotInstance===e){this._hotInstance=null}this._instances.delete(e);this._removeInstanceFromMesh(t);this._removeInstanceFromBorder(t);e._last={}}else{o.error("Unable to find polygon instance data","",n)}};g.prototype.updateHotInstance=function(e){if(this._hotInstance){this._updateHot(this._hotInstance,false)}if(e&&e.isPolygon){this._updateHot(e,true)}this._hotInstance=e&&e.isPolygon?e:null};g.prototype._updateHot=function(e,t){var r=this._instances.get(e),s,i,a,l;if(r){if(r.mesh){s=r.mesh.material;i=r.mesh.object3D;a=i.geometry;if(a.groups.length){a.groups=[];i.material=i.material[0]}if(t){l=r.mesh.instances.get(r);s.color.copy(r.colorHot.rgb);s.opacity=r.colorHot.opacity;s.transparent=s.opacity<1;s.needsUpdate=true;i.material=[i.material,s];a.addGroup(l.start,r.indices.length,1);if(l.start!==0){a.addGroup(0,l.start,0)}if(l.start+r.indices.length<a.index.count){a.addGroup(l.start+r.indices.length,a.index.count-l.start-r.indices.length,0)}}}if(r.border){s=r.border.material;i=r.border.object3D;a=i.geometry;var c=a.getAttribute("position");if(a.groups.length){a.groups=[];i.material=i.material[0]}if(t){l=r.border.instances.get(r);s.color.copy(r.colorBorderHot.rgb);s.opacity=r.colorBorderHot.opacity;s.transparent=s.opacity<1;s.needsUpdate=true;i.material=[i.material,s];var h=r.lines.length/3;a.addGroup(l.start,h,1);if(l.start!==0){a.addGroup(0,l.start,0)}if(l.start+h<c.count){a.addGroup(l.start+h,c.count-l.start-h,0)}}}}else{o.error("Unable to find polygon instance data","",n)}};g.prototype._getGeometry=function(e,t,o){var n,s=[],i=e.posarray.split(";");o.length=t.length=0;for(n=0;n<i.length/3;++n){var a=parseFloat(i[n*3+0]);var l=parseFloat(i[n*3+1]);var c=parseFloat(i[n*3+2]);s.push(new r.Vector2(a,l));o.push(a,l,c)}var h=r.ShapeUtils.triangulateShape(s,[]);for(n=0;n<h.length;++n){t.push(h[n][0],h[n][1],h[n][2])}};g.prototype._getBorderGeometry=function(e,t){var o=new r.BufferGeometry;o.setIndex(e);o.setAttribute("position",new r.Float32BufferAttribute(t,3));var n=new r.EdgesGeometry(o);var s=n.getAttribute("position").array;n.dispose();o.dispose();return s};g.prototype._updateMeshes=function(){var e=[],t=false,o=this._hotInstance?this._instances.get(this._hotInstance):null;this._meshes.forEach(function(n,i){for(var a=0;a<n.length;){if(n[a].dirty){var l,c,h,d=[],u=[],p=[],m=n[a];this._deleteObject3D(m.object3D);m.object3D=null;m.hitInfo.length=0;m.instances.forEach(function(e,t){c=t;e.start=d.length;for(l=0,h=u.length/3;l<c.indices.length;++l){d.push(h+c.indices[l])}var r=c.indices.length/3;m.hitInfo.length+=r;m.hitInfo.fill(c.instance,m.hitInfo.length-r,m.hitInfo.length);if(c.matrix._identity){for(l=0;l<c.vertices.length/3;++l){u.push(c.vertices[l*3],c.vertices[l*3+1],c.vertices[l*3+2]);p.push(c.normal.x,c.normal.y,c.normal.z)}}else{var o=new s;for(l=0;l<c.vertices.length/3;++l){o.set(c.vertices[l*3],c.vertices[l*3+1],c.vertices[l*3+2]);o.applyMatrix4(c.matrix);u.push(o.x,o.y,o.z);p.push(c.normal.x,c.normal.y,c.normal.z)}}});if(d.length){var g=new r.BufferGeometry;g.setIndex(d);g.setAttribute("position",new r.Float32BufferAttribute(u,3));g.setAttribute("normal",new r.Float32BufferAttribute(p,3));g.computeBoundingBox();g.computeBoundingSphere();var y=f(true);y.color.copy(c.color.rgb);y.opacity=c.color.opacity;y.transparent=y.opacity<1;y.needsUpdate=true;m.object3D=new r.Mesh(g,y);m.object3D.matrixAutoUpdate=false;m.object3D.layers.set(0);this._root.add(m.object3D);m.object3D._instanceHitTest=this._instanceHitTest.bind(m);m.triangleCount=d.length/3}if(o&&m.instances.has(o)){t=true}m.dirty=false}if(n[a].object3D){a++}else{n.splice(a,1)}}if(!n.length){e.push(i)}},this);e.forEach(function(e){this._meshes.delete(e)},this);return t};g.prototype._updateBorders=function(){var e=[],t=false,o=this._hotInstance?this._instances.get(this._hotInstance):null;this._borders.forEach(function(n,i){for(var a=0;a<n.length;){if(n[a].dirty){var l,c,h=[],d=n[a];this._deleteObject3D(d.object3D);d.object3D=null;d.instances.forEach(function(e,t){c=t;e.start=h.length/3;if(c.matrix._identity){for(l=0;l<c.lines.length;++l){h.push(c.lines[l])}}else{var r=new s;for(l=0;l<c.lines.length/3;++l){r.set(c.lines[l*3],c.lines[l*3+1],c.lines[l*3+2]);r.applyMatrix4(c.matrix);h.push(r.x,r.y,r.z)}}});if(h.length){var u=new r.BufferGeometry;u.setAttribute("position",new r.Float32BufferAttribute(h,3));u.computeBoundingBox();var p=m();p.color.copy(c.colorBorder.rgb);p.opacity=c.colorBorder.opacity;p.transparent=p.opacity<1;p.needsUpdate=true;d.object3D=new r.LineSegments(u,p);d.object3D.matrixAutoUpdate=false;d.object3D.layers.set(1);this._root.add(d.object3D);d.lineCount=h.length/6}if(o&&d.instances.has(o)){t=true}d.dirty=false}if(n[a].object3D){a++}else{n.splice(a,1)}}if(!n.length){e.push(i)}},this);e.forEach(function(e){this._borders.delete(e)},this);return t};g.prototype._requestMeshUpdate=function(e){if(e.mesh){e.mesh.dirty=true}else{var t=u(e.color);var r=this._meshes.get(t);if(!r){r=[];this._meshes.set(t,r)}for(var o=0;o<r.length;++o){if(r[o].triangleCount+e.indices.length/3<=y){e.mesh=r[o];break}}if(!e.mesh){e.mesh={dirty:true,object3D:null,material:f(true),triangleCount:0,hitInfo:[],instances:new Map};r.push(e.mesh)}e.mesh.instances.set(e,{start:0});e.mesh.dirty=true;e.mesh.triangleCount+=e.indices.length/3}};g.prototype._requestBorderUpdate=function(e){if(e.border){e.border.dirty=true}else{var t=u(e.colorBorder);var r=this._borders.get(t);if(!r){r=[];this._borders.set(t,r)}for(var o=0;o<r.length;++o){if(r[o].lineCount+e.lines.length/6<=b){e.border=r[o];break}}if(!e.border){e.border={dirty:true,object3D:null,material:m(),lineCount:0,instances:new Map};r.push(e.border)}e.border.instances.set(e,{start:0});e.border.dirty=true;e.border.lineCount+=e.lines.length/6}};g.prototype._removeInstanceFromMesh=function(e){if(e.mesh){if(e.mesh.instances.delete(e)){e.mesh.triangleCount-=e.indices.length/3;e.mesh.dirty=true;e.mesh=null}else{o.error("Unable to find instance data in polygon mesh data","",n)}}};g.prototype._removeInstanceFromBorder=function(e){if(e.border){if(e.border.instances.delete(e)){e.border.lineCount-=e.lines.length/6;e.border.dirty=true;e.border=null}else{o.error("Unable to find instance data in polygon border data","",n)}}};g.prototype._deleteObject3D=function(e){if(e){if(e.parent){e.parent.remove(e)}if(e.geometry){e.geometry.dispose()}t.toArray(e.material).forEach(function(e){e.dispose()})}};g.prototype._instanceHitTest=function(e){return e.faceIndex>=0?this.hitInfo[e.faceIndex]:null};return g});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5) (c) Copyright 2009-2012 SAP AG. All rights reserved
 */
sap.ui.predefine("sap/ui/vbm/adapter3d/SceneBuilder", ["sap/ui/base/Object","./Utilities","./PolygonHandler","./ModelHandler","./thirdparty/three","./thirdparty/DecalGeometry","./thirdparty/html2canvas","sap/base/Log"],function(e,t,r,i,a,s,n,o){"use strict";var l="sap.ui.vbm.adapter3d.SceneBuilder";var c=a.Matrix4;var d=a.Vector3;var u=a.Math.degToRad;var p=t.toArray;var h=t.toBoolean;var f=t.toVector3;var _=t.createMaterial;var y=t.propertyChanged;var m=t.propertyRemoved;var g=t.propertyAdded;var x=t.updateProperty;var v=t.refCountableDispose;var b;var w;var D=e.extend("sap.ui.vbm.adapter3d.SceneBuilder",{constructor:function(t,a){e.call(this);this._context=t;this._viewport=a;this._root=a.getRoot();this._scene=a.getScene();this._hotInstance=null;this._decalHelper=null;this._targets=new Map;this._instanceDecals=new Map;this._textures=new Map;this._box4=null;this._box6=null;this._cylinder=null;this._cylinderCaps=null;this._polygonHandler=new r(this._root);this._modelHandler=new i(this._context.resources,this._textures,this._scene,this._root);this._textureLoader=null}});D.prototype.destroy=function(){this._root=null;this._scene=null;this._viewport=null;this._context=null;this._hotInstance=null;if(this._box4){this._box4.dispose()}if(this._box6){this._box6.dispose()}if(this._cylinder){this._cylinder.dispose()}if(this._cylinderCaps){this._cylinderCaps.dispose()}if(this._decalHelper){this._decalHelper.material.dispose();this._decalHelper.geometry.dispose();this._scene.remove(this._decalHelper);this._decalHelper=null}this._polygonHandler.destroy();this._polygonHandler=null;this._modelHandler.destroy();this._modelHandler=null;this._textures.forEach(function(e){e.dispose()});this._targets.clear();this._targets=null;this._instanceDecals.clear();this._instanceDecals=null;e.prototype.destroy.call(this)};D.prototype.synchronize=function(){var e=this;function t(t){var r=e._textures.get(t);if(!r){e._textures.set(t,null)}}return new Promise(function(r,i){var a=sap.ui.vbm.findInArray(e._context.windows,function(e){return e.type==="default"});var s=a&&sap.ui.vbm.findInArray(e._context.scenes,function(e){return e.id===a.refScene});if(!s){r();return}e._context.scene=s;if(e._context.setupView){var n=e._context.setupView;e._setupView(n.position,n.zoom,n.pitch,n.yaw,n.home,n.flyTo);e._context.setupView=undefined}var o=[];var l=[],c=[];var d=e._context.voQueues.toAdd.get(s)||[];var u=e._context.voQueues.toUpdate.get(s)||[];var p=e._context.voQueues.toRemove.get(s)||[];[].concat(d,u).forEach(function(r){if(r.isModel){e._modelHandler.addModel(r)}if(r.texture&&y(r,"texture")){t(r.texture)}if(r.textureCap&&y(r,"textureCap")){t(r.textureCap)}if(r.isDecal&&r.text&&y(r,["text","size"])){o.push(r)}});e._loadTextures().then(function(){return e._modelHandler.loadModels()}).then(function(){return e._renderTexts(o)}).then(function(){p.forEach(e._removeInstance.bind(e));u.forEach(e._updateInstance.bind(e,c));d.forEach(e._addInstance.bind(e,l));e._polygonHandler.update();e._modelHandler.update();e._scene.updateMatrixWorld(true);c.forEach(e._updateInstance.bind(e,null));l.forEach(e._addInstance.bind(e,null));e._cleanupCache();r()}).catch(function(e){i(e)})})};D.prototype._findMesh=function(e){var t=null;e.traverse(function(e){if(!t&&e.isMesh){t=e}});return t};D.prototype._getGeometrySize=function(){return 2};D.prototype._getZoomFactor=function(e,t){var r=new d;r.subVectors(t,e);return this._getGeometrySize()*2/r.length()};D.prototype._setupView=function(e,t,r,i,a,s){e=f(e||"0;0;0");t=parseFloat(t||"1");if(t===0){t=1}else if(t<0){t=.1}var n=this._getGeometrySize()*2/t;r=parseFloat(r||"0");i=parseFloat(i||"0");r=r%180===0?r+1:r;var o=new c;o.makeRotationX(u(r+180));var l=new c;l.makeRotationZ(u(-(i+180)));var p=new c;p.multiplyMatrices(l,o);var h=new d(0,0,-5);var _=new d(0,0,0);var y=new d;y.subVectors(_,h).normalize();y.multiplyScalar(n);y.applyMatrix4(p);y.add(e);_.add(e);var m={zoom:1,target:new d(-_.x,-_.z,_.y),position:new d(-y.x,-y.z,y.y)};if(a){this._viewport._setCameraHome(m);this._viewport._applyCamera(m,s)}else{this._viewport._applyCamera(m,s)}};D.prototype._getDecalTextKey=function(e){return e.size+";"+e.text};D.prototype._renderTexts=function(e){var t=[];e.forEach(function(e){if(!this._textures.has(this._getDecalTextKey(e))){t.push(this._renderText(e))}},this);return Promise.all(t)};D.prototype._renderText=function(e){var r=this;return new Promise(function(i,s){var c=f(e.size);if(c.length()<1e-6){o.error("Unable render text to html: decal size is invalid","",l);i()}else{var d=512;var u=c.x/c.y;var p=Math.ceil(u>=1?d:d*u);var h=Math.ceil(u<=1?d:d/u);var _=document.createElement("iframe");_.style.visibility="hidden";_.sandbox="allow-same-origin";_.width=p;_.height=h;document.body.appendChild(_);var y=_.contentDocument||_.contentWindow.document;y.open();y.close();y.body.innerHTML=e.text;var m=document.createElement("canvas");m.width=_.width*window.devicePixelRatio;m.height=_.height*window.devicePixelRatio;m.style.width=_.width+"px";m.style.height=_.height+"px";var g=m.getContext("2d");g.scale(window.devicePixelRatio,window.devicePixelRatio);n(y.body,{canvas:m,width:p,height:h,backgroundColor:null,logging:false}).then(function(s){if(s.width>0&&s.height>0){var n=new a.Texture(s);n.needsUpdate=true;t.addRef(n);r._textures.set(r._getDecalTextKey(e),n)}else{o.error("Failed render text to html","",l)}document.body.removeChild(_);i()})}})};D.prototype._loadTextures=function(){var e=[];this._textures.forEach(function(t,r){if(!t){e.push(this._loadTexture(r))}},this);return Promise.all(e)};D.prototype._loadTexture=function(e){var r=this;var i=this._context.resources.get(e);if(!i){this._textures.delete(e);o.error("Failed to get texture from context",e,l);return Promise.resolve()}return new Promise(function(a,s){r._getTextureLoader().load(t.makeDataUri(i),function(t){t.flipY=false;r._textures.set(e,t);a()},null,function(t){r._textures.delete(e);o.error("Failed to load texture from Data URI: "+e,"status: "+t.status+", status text: "+t.statusText,l);a()})})};D.prototype._cleanupCache=function(){this._textures.forEach(function(e){if(v(e)){e.dispose();this._textures.delete(e)}},this);if(this._box4&&v(this._box4)){this._box4.dispose();this._box4=null}if(this._box6&&v(this._box6)){this._box6.dispose();this._box6=null}if(this._cylinder&&v(this._cylinder)){this._cylinder.dispose();this._cylinder=null}if(this._cylinderCaps&&v(this._cylinderCaps)){this._cylinderCaps.dispose();this._cylinderCaps=null}};D.prototype._addInstance=function(e,t){if(!t.isDecal){this._updateInstanceKeys(t)}if(t.isPolygon){this._polygonHandler.addInstance(t)}else if(t.isModel){this._modelHandler.addInstance(t)}else if(t.isBox){this._assignBoxProperties(t)}else if(t.isCylinder){this._assignCylinderProperties(t)}else if(t.isDecal){if(e){e.push(t)}else{this._assignDecalProperties(t)}}else{o.error("Unable to add instance: instance type is unknown","",l)}};D.prototype._updateInstance=function(e,t){if(!t.isDecal){this._updateInstanceKeys(t)}if(t.isPolygon){this._polygonHandler.updateInstance(t)}else if(t.isModel){this._modelHandler.updateInstance(t)}else if(t.isBox){this._assignBoxProperties(t,t===this._hotInstance)}else if(t.isCylinder){this._assignCylinderProperties(t,t===this._hotInstance)}else if(t.isDecal){if(e){e.push(t)}else{this._assignDecalProperties(t)}}else{o.error("Unable to update instance: instance type is unknown","",l)}};D.prototype._removeInstance=function(e){if(!e.isDecal){this._removeInstanceKeys(e)}if(e.isPolygon){this._polygonHandler.removeInstance(e)}else if(e.isModel){this._modelHandler.removeInstance(e)}else if(e.isBox||e.isCylinder||e.isDecal){if(e.object3D){this._deleteObject3D(e.object3D);e.object3D=null;e._last={};if(e.isDecal&&e.target){var t=this._targets.get(e.target);if(t){this._instanceDecals.get(t).delete(e)}else{o.error("Unable to remove decal from (instance <-> decals) map","",l)}}}else{o.error("Unable to remove instance: object3D is missing","",l)}}else{o.error("Unable to remove instance: instance type is unknown","",l)}if(this._hotInstance===e){this._hotInstance=null}};D.prototype.updateSelection=function(e,t){e.concat(t).forEach(function(e){if(e.isPolygon){this._polygonHandler.updateInstance(e)}else if(e.isModel){this._modelHandler.updateInstance(e)}else if(e.isBox){this._assignBoxProperties(e,e===this._hotInstance)}else if(e.isCylinder){this._assignCylinderProperties(e,e===this._hotInstance)}},this);this._polygonHandler.update();this._modelHandler.update()};D.prototype._updateHotStatus=function(e,t){if(e.isBox){this._assignBoxProperties(e,t)}else if(e.isCylinder){this._assignCylinderProperties(e,t)}};D.prototype.updateHotInstance=function(e){this._polygonHandler.updateHotInstance(e);this._modelHandler.updateHotInstance(e);this._polygonHandler.update();this._modelHandler.update();if(this._hotInstance){this._updateHotStatus(this._hotInstance,false)}if(e){this._updateHotStatus(e,true)}this._hotInstance=e};D.prototype._assignBoxProperties=function(e,r){var i=e.object3D||null;if(!i||y(e,"texture6")){var s=this._getBoxGeometry(h(e.texture6));t.addRef(s);if(i){t.subRef(i.geometry);i.geometry=s}else{i=new a.Mesh(s,_(false));i.matrixAutoUpdate=false;i.layers.set(0);i._sapInstance=e;this._root.add(i);e.object3D=i}}x(e,"texture6");this._assignProperties(e,r)};D.prototype._assignCylinderProperties=function(e,r){var i,s=false,n=h(e.isOpen),c=e.object3D||null;if(!c||y(e,"isOpen")){var d=this._getCylinderGeometry(n);t.addRef(d);if(c){t.subRef(c.geometry);c.geometry=d;if(n){i=c.material[1];if(i.map){t.subRef(i.map);i.dispose()}c.material=c.material[0];c.material.side=a.DoubleSide;c.material.needsUpdate=true}else{i=c.material.clone();i.map=null;c.material=[c.material,i,i];c.material.forEach(function(e){e.needsUpdate=true;e.side=a.FrontSide});s=true}}else{if(n){c=new a.Mesh(d,_(true))}else{i=_(false);c=new a.Mesh(d,[_(false),i,i])}c.matrixAutoUpdate=false;c.layers.set(0);c._sapInstance=e;this._root.add(c);e.object3D=c}}if(y(e,"textureCap")||s){i=Array.isArray(c.material)?c.material[1]:null;if(i){if(i.map){t.subRef(i.map);i.map=null;i.needsUpdate=true}if(e.textureCap){i.map=this._textures.get(e.textureCap);if(i.map){i.needsUpdate=true;t.addRef(i.map)}else{o.error("Unable to apply cap texture on cylinder, texture not found",e.textureCap,l)}}}}x(e,["isOpen","textureCap"]);this._assignProperties(e,r)};D.prototype._assignProperties=function(e,r){var i,s,n=e.object3D;if(y(e,"texture")){s=Array.isArray(n.material)?n.material[0]:n.material;if(s.map){t.subRef(s.map);s.map=null;s.needsUpdate=true}if(e.texture){s.map=this._textures.get(e.texture);if(s.map){s.needsUpdate=true;t.addRef(s.map)}else{o.error("Unable to apply texture, texture not found",e.texture,l)}}}if(y(e,["color","selectColor","VB:s"])||r!==undefined){i=t.getColor(e,e.color,r);t.toArray(n.material).forEach(function(e){e.color.copy(i.rgb);e.opacity=i.opacity;e.transparent=e.opacity<1;e.needsUpdate=true})}var d=n.children.length===0?null:n.children[0];if(m(e,"colorBorder")){d.material.dispose();d.geometry.dispose();n.remove(d)}else if(e.colorBorder){if(g(e,"colorBorder")){var u=e.isBox?new a.EdgesGeometry(n.geometry):new a.EdgesGeometry(n.geometry,60);d=new a.LineSegments(u,t.createLineMaterial());d.matrixAutoUpdate=false;d.layers.set(1);n.add(d)}if(y(e,["colorBorder","selectColor,","VB:s"])||r!==undefined){s=d.material;i=t.getColor(e,e.colorBorder,r);s.color.copy(i.rgb);s.opacity=i.opacity;s.transparent=s.opacity<1;s.needsUpdate=true}}if(y(e,["pos","rot","scale","normalize"])){var p=new c,f=new c;if(h(e.normalize)){n.position.set(0,0,0);n.rotation.set(0,0,0);n.scale.set(1,1,1);n.updateMatrix();t.normalizeObject3D(n,p)}t.getInstanceMatrix(e,f);f.multiply(p);f.decompose(n.position,n.quaternion,n.scale);n.updateMatrix()}x(e,["texture","color","selectColor","VB:s","colorBorder","normalize","pos","rot","scale"])};D.prototype._assignDecalProperties=function(e){var r=false,i;if(y(e,["position","direction","size","rotation","target"])){r=true}if(!e.target&&y(e,["planeOrigin","planeNormal"])){r=true}if(r){if(e.object3D){i=e.object3D.material.clone();this._deleteObject3D(e.object3D);e.object3D=null}var a=this._getDecalTarget(e);if(!a){o.error("Unable to create decal","target is missing",l);return}var s=this._createDecal(e,a,i);this._disposeDecalTarget(e,a);if(!s){return}}if(y(e,["texture","text"])){i=e.object3D.material;if(i.map){t.subRef(i.map);i.map=null}i.map=this._textures.get(e.text?this._getDecalTextKey(e):e.texture);if(i.map){i.map.flipY=true;i.needsUpdate=true;t.addRef(i.map)}else{o.error("Unable to apply texture, texture not found",e.texture,l)}}if(y(e,"target")){var n=this._targets.get(e._last.target);if(n){this._instanceDecals.get(n).delete(e)}n=this._targets.get(e.target);if(n){if(!this._instanceDecals.has(n)){this._instanceDecals.set(n,new Set)}this._instanceDecals.get(n).add(e)}}x(e,["position","direction","size","rotation","target","texture","text","planeOrigin","planeNormal"])};D.prototype._createDecal=function(e,r,i){this._root.updateMatrixWorld(true);var s=f(e.position);var n=f(e.direction).normalize();if(n.length()<1e-6){o.error("Unable create decal: direction is invalid","",l);return false}var c=u(t.toFloat(e.rotation));var d=f(e.size);if(d.length()<1e-6){o.error("Unable create decal: size is invalid","",l);return false}s.applyMatrix4(r.matrixWorld);n.transformDirection(r.matrixWorld);var p=new a.Raycaster(s,n);var h=p.intersectObject(r);if(!h.length){o.error("Unable create decal: cannot project decal to plane","",l);return false}if(!this._decalHelper){this._decalHelper=new a.Mesh(new a.BoxBufferGeometry(1,1,5));this._decalHelper.visible=false;this._decalHelper.layers.set(1);this._decalHelper.up.set(0,1,0);this._scene.add(this._decalHelper)}var _=h[0];var y=_.point;var m=n.clone().negate();var g=(new a.Box3).setFromObject(r);var x=g.max.clone().sub(g.min).length();m.multiplyScalar(x);m.add(y);this._decalHelper.position.copy(y);this._decalHelper.lookAt(m);this._decalHelper.rotation.z+=c;i=i||new a.MeshPhongMaterial({specular:4473924,shininess:0,opacity:.99,transparent:true,depthTest:true,depthWrite:false,polygonOffset:true,polygonOffsetUnits:.1,polygonOffsetFactor:-1});var v=new a.DecalGeometry(r,y,this._decalHelper.rotation,d);e.object3D=new a.Mesh(v,i);e.object3D.renderOrder=100;e.object3D.matrixAutoUpdate=false;e.object3D.layers.set(1);this._scene.add(e.object3D);return true};D.prototype._createPlane=function(e,t){var r=f(e.planeOrigin);var i=f(e.planeNormal).normalize();if(i.length()<1e-6){o.error("Unable to create plane for decal: normal is invalid","",l);return null}var s=new d(i.x===0?10:-i.x,i.y===0?-10:i.y,i.z===0?10:-i.z);var n=r.clone(r).add(s);n.sub(i.clone().multiplyScalar(i.dot(n.clone().sub(r))));var c=1e4;s=n.clone().sub(r).normalize();var u=i.clone().cross(s).normalize();s.multiplyScalar(c);u.multiplyScalar(c);var p=r.clone().add(s);var h=r.clone().sub(s);var _=r.clone().add(u);var y=r.clone().sub(u);var m=new a.BufferGeometry;m.setAttribute("position",new a.Float32BufferAttribute([p.x,p.y,p.z,_.x,_.y,_.z,h.x,h.y,h.z,h.x,h.y,h.z,y.x,y.y,y.z,p.x,p.y,p.z],3));m.setAttribute("normal",new a.Float32BufferAttribute([i.x,i.y,i.z,i.x,i.y,i.z,i.x,i.y,i.z,i.x,i.y,i.z,i.x,i.y,i.z,i.x,i.y,i.z],3));var g=new a.Mesh(m);t.add(g);return g};D.prototype._getDecalTarget=function(e){if(e.target){var t=this._targets.get(e.target);if(t){if(t.isBox||t.isCylinder){return t.object3D}else if(t.isPolygon){return this._polygonHandler.getTarget(t)}else if(t.isModel){return this._modelHandler.getTarget(t)}else{o.error("Unable to get decal's target","target instance type is unknown",l);return null}}}else if(e.planeOrigin&&e.planeNormal){return this._createPlane(e,this._root)}else{o.error("Unable to get/create decal's target","missing parameters",l);return null}};D.prototype._disposeDecalTarget=function(e,t){if(e.target){var r=this._targets.get(e.target);if(r){if(r.isPolygon||r.isModel){this._deleteObject3D(t)}}else{o.error("Unable to dispose decal's target","target not found",l)}}else{this._deleteObject3D(t)}};D.prototype._updateInstanceKeys=function(e){var t=this._getInstanceKeys(e);if(t){if(t.key!==e._last.key){this._targets.delete(e._last.key);this._targets.delete(e._last.group);this._targets.set(t.key,e);this._targets.set(t.group,e);e._last.key=t.key;e._last.group=t.group}}};D.prototype._removeInstanceKeys=function(e){var t=this._getInstanceKeys(e);if(t){this._targets.delete(t.key);this._targets.delete(t.group)}};D.prototype._getInstanceKeys=function(e){if(e.dataInstance){var t=e.voGroup.keyAttributeName;if(t){var r=e.dataInstance[t];if(r){return{key:r,group:e.voGroup.id+"."+r}}}}return null};D.prototype._deleteObject3D=function(e){e.traverse(function(e){if(e.geometry){if(t.refCountable(e.geometry)){t.subRef(e.geometry)}else{e.geometry.dispose()}}p(e.material).forEach(function(e){if(e.map){t.subRef(e.map)}e.dispose()})});e.parent.remove(e)};D.prototype._getBoxGeometry=function(e){if(e){return this._box6||(this._box6=b(e))}else{return this._box4||(this._box4=b(e))}};D.prototype._getCylinderGeometry=function(e){if(e){return this._cylinder||(this._cylinder=w(e))}else{return this._cylinderCaps||(this._cylinderCaps=w(e))}};D.prototype._getTextureLoader=function(){return this._textureLoader||(this._textureLoader=new a.TextureLoader)};b=function(e){var t=new a.BufferGeometry;t.setAttribute("position",new a.Float32BufferAttribute([.1,.1,-.1,-.1,-.1,-.1,-.1,.1,-.1,.1,.1,-.1,.1,-.1,-.1,-.1,-.1,-.1,.1,.1,.1,-.1,.1,.1,-.1,-.1,.1,.1,.1,.1,-.1,-.1,.1,.1,-.1,.1,.1,.1,-.1,.1,-.1,.1,.1,-.1,-.1,.1,.1,-.1,.1,.1,.1,.1,-.1,.1,.1,-.1,-.1,-.1,-.1,.1,-.1,-.1,-.1,.1,-.1,-.1,.1,-.1,.1,-.1,-.1,.1,-.1,-.1,-.1,-.1,.1,.1,-.1,.1,-.1,-.1,-.1,-.1,-.1,-.1,.1,-.1,.1,.1,.1,.1,.1,-.1,.1,-.1,-.1,.1,.1,.1,.1,.1,.1,.1,-.1,-.1,.1,-.1],3));t.setAttribute("normal",new a.Float32BufferAttribute([0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0],3));t.setAttribute("color",new a.Float32BufferAttribute([.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5],3));if(e){t.setAttribute("uv",new a.Float32BufferAttribute([2/3,.5,1,1,2/3,1,2/3,.5,1,.5,1,1,2/3,0,1,0,1,.5,2/3,0,1,.5,2/3,.5,2/3,.5,1/3,1,1/3,.5,2/3,.5,2/3,1,1/3,1,2/3,0,1/3,.5,1/3,0,2/3,0,2/3,.5,1/3,.5,1/3,.5,0,1,0,.5,1/3,.5,1/3,1,0,1,0,.5,1/3,0,1/3,.5,0,.5,0,0,1/3,0],2))}else{t.setAttribute("uv",new a.Float32BufferAttribute([.5,.5,1,1,.5,1,.5,.5,1,.5,1,1,1,.5,1,1,.5,1,1,.5,.5,1,.5,.5,.5,.5,0,1,0,.5,.5,.5,.5,1,0,1,.5,.5,1,0,1,.5,.5,.5,.5,0,1,0,.5,.5,0,1,0,.5,.5,.5,.5,1,0,1,0,.5,.5,0,.5,.5,0,.5,0,0,.5,0],2))}return t};w=function(e){var t=.1;return new a.CylinderGeometry(t,t,2*t,24,1,e)};return D});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5) (c) Copyright 2009-2012 SAP AG. All rights reserved
 */
sap.ui.predefine("sap/ui/vbm/adapter3d/Utilities", ["sap/ui/base/Object","./thirdparty/three","sap/base/Log"],function(e,t,r){"use strict";var a="sap.ui.vbm.adapter3d.Utilities";var o=t.Color;var n=t.Vector3;var i=t.Matrix4;var l=t.Math.degToRad;var s=e.extend("sap.ui.vbm.adapter3d.Utilities",{});s.refCountPropertyName="_sapRefCount";s.refCountable=function(e){return e.hasOwnProperty(s.refCountPropertyName)};s.refCountableDispose=function(e){return e.hasOwnProperty(s.refCountPropertyName)&&e[s.refCountPropertyName]===0};s.addRef=function(e){if(!e.hasOwnProperty(s.refCountPropertyName)){e[s.refCountPropertyName]=0}e[s.refCountPropertyName]+=1};s.subRef=function(e){if(e.hasOwnProperty(s.refCountPropertyName)){e[s.refCountPropertyName]-=1;return e[s.refCountPropertyName]===0}return false};s.toArray=function(e){return e===undefined?[]:[].concat(e)};s.toBoolean=function(e){var t=e.charAt(0);return t==="t"||t!==""&&t!=="f"&&t!==" "&&t!=="0"};s.toFloat=function(e){return parseFloat(e)};s.toVector3=function(e,t){var r=e.split(";");if(r.length!==3){return t?t.set(0,0,0):new n(0,0,0)}var a=parseFloat(r[0]),o=parseFloat(r[1]),i=parseFloat(r[2]);return t?t.set(a,o,i):new n(a,o,i)};s.threeJsToVb=function(e,t){return t?t.set(-e.x,e.z,-e.y):new n(-e.x,e.z,-e.y)};s.vbToThreeJs=function(e,t){return t?t.set(-e.x,-e.z,e.y):new n(-e.x,-e.z,e.y)};s.toColor=function(){var e="\\s*(\\d+)\\s*";var t="\\s*(?:0[xX])([\\da-fA-F]+)\\s*";var n=e+"(,|;)"+e+"\\2"+e;var i=e+"(,|;)"+e+"\\2"+e+"\\2"+e;var l=t+"(,|;)"+t+"\\2"+t;var s=t+"(,|;)"+t+"\\2"+t+"\\2"+t;var c=new RegExp("^\\s*RGB\\("+n+"\\)\\s*$");var f=new RegExp("^\\s*RGB\\("+l+"\\)\\s*$");var p=new RegExp("^\\s*RGBA\\("+i+"\\)\\s*$");var u=new RegExp("^\\s*RGBA\\("+s+"\\)\\s*$");var y=new RegExp("^\\s*ARGB\\("+i+"\\)\\s*$");var v=new RegExp("^\\s*ARGB\\("+s+"\\)\\s*$");var m=new RegExp("^\\s*HLS\\("+n+"\\)\\s*$");var h=new RegExp("^\\s*HLS\\("+l+"\\)\\s*$");var d=new RegExp("^\\s*HLSA\\("+i+"\\)\\s*$");var C=new RegExp("^\\s*HLSA\\("+s+"\\)\\s*$");var g=new RegExp("^"+e+"$");var w=new RegExp("^"+t+"$");return function(e){var t;var n;var i=1;if(t=e.match(c)){n=new o(parseInt(t[1],10)/255,parseInt(t[3],10)/255,parseInt(t[4],10)/255)}else if(t=e.match(f)){n=new o(parseInt(t[1],16)/255,parseInt(t[3],16)/255,parseInt(t[4],16)/255)}else if(t=e.match(p)){n=new o(parseInt(t[1],10)/255,parseInt(t[3],10)/255,parseInt(t[4],10)/255);i=t[5]/255}else if(t=e.match(u)){n=new o(parseInt(t[1],16)/255,parseInt(t[3],16)/255,parseInt(t[4],16)/255);i=t[5]/255}else if(t=e.match(y)){n=new o(parseInt(t[3],10)/255,parseInt(t[4],10)/255,parseInt(t[5],10)/255);i=t[1]/255}else if(t=e.match(v)){n=new o(parseInt(t[3],16)/255,parseInt(t[4],16)/255,parseInt(t[5],16)/255);i=t[1]/255}else{r.warning("Cannot convert color, use default",e,a);n=new o(.5,.5,.5)}return{rgb:n,opacity:i}}}();s.toColorDelta=function(){var e="\\s*([-+]?\\d*\\.?\\d+(?:[eE][-+]?\\d+)?)\\s*";var t=new RegExp("^\\s*RHLS\\("+e+";"+e+";"+e+"\\)\\s*$");var o=new RegExp("^\\s*RHLSA\\("+e+";"+e+";"+e+";"+e+"\\)\\s*$");return function(e){var i;var l;var s=1;if(i=e.match(t)){l=new n(parseFloat(i[1]),parseFloat(i[2]),parseFloat(i[3]))}else if(i=e.match(o)){l=new n(parseFloat(i[1]),parseFloat(i[2]),parseFloat(i[3]));s=parseFloat(i[4])}else{r.warning("Cannot convert color delta, use default",e,a);l=new n(1,1,1)}return{hls:l,opacity:s}}}();s.multiplyColors=function(e,t,r){r.r=s.clamp(e.r*t.r,0,1);r.g=s.clamp(e.g*t.g,0,1);r.b=s.clamp(e.b*t.b,0,1)};s.isColorDelta=function(e){return e.startsWith("RHLS")};s.applyDeltaHLS=function(e,t){var r=e.getHSL({});r.h=r.h+t.x;r.s=s.clamp(r.s*t.z,0,1);r.l=s.clamp(r.l*t.y,0,1);e.setHSL(r.h,r.s,r.l)};s.rgbaToString=function(e){return e.rgb.getHexString()+Math.round(e.opacity*255).toString(16)};s.equalsRGBA=function(e,t){return e.rgb.equals(t.rgb)&&e.opacity===t.opacity};s.getColor=function(e,t,r){var a=s.toColor(t);var o=s.toBoolean(e["VB:s"]);if(o){var n=s.isColorDelta(e.selectColor);var i=n?s.toColorDelta(e.selectColor):s.toColor(e.selectColor);if(n){s.applyDeltaHLS(a.rgb,i.hls);a.opacity=s.clamp(a.opacity*i.opacity,0,1)}else{a.rgb.copy(i.rgb);a.opacity=i.opacity}}if(r){var l=s.isColorDelta(e.hotDeltaColor);var c=l?s.toColorDelta(e.hotDeltaColor):s.toColor(e.hotDeltaColor);if(l){s.applyDeltaHLS(a.rgb,c.hls);a.opacity=s.clamp(a.opacity*c.opacity,0,1)}else{a.rgb.copy(c.rgb);a.opacity=c.opacity}}return a};s.applyColor=function(e,t,r,a,o){var n=s.toColor(t);var i=s.toBoolean(e["VB:s"]);var l,c,f,p;if(i){l=s.isColorDelta(e.selectColor);c=l?s.toColorDelta(e.selectColor):s.toColor(e.selectColor)}if(a){f=s.isColorDelta(e.hotDeltaColor);p=f?s.toColorDelta(e.hotDeltaColor):s.toColor(e.hotDeltaColor)}var u="_sapReference";s.toArray(r).forEach(function(e){e.traverse(function(e){s.toArray(e.material).forEach(function(e){if(o!==undefined){e.map=o}var t=e[u]||(e[u]={rgb:e.color.clone(),opacity:e.opacity});s.multiplyColors(t.rgb,n.rgb,e.color);e.opacity=s.clamp(t.opacity*n.opacity,0,1);if(i){if(l){s.applyDeltaHLS(e.color,c.hls);e.opacity=s.clamp(e.opacity*c.opacity,0,1)}else{e.color.copy(c.rgb);e.opacity=c.opacity}}if(a){if(f){s.applyDeltaHLS(e.color,p.hls);e.opacity=s.clamp(e.opacity*p.opacity,0,1)}else{e.color.copy(p.rgb);e.opacity=p.opacity}}e.transparent=e.opacity<1})})})};s.clamp=function(e,t,r){if(e<t){return t}if(e>r){return r}return e};s.swap=function(e,t,r){var a=e[t];e[t]=e[r];e[r]=a};s.makeDataUri=function(e){return e&&"data:text/plain;base64,"+e};s.base64ToArrayBuffer=function(e){var t=atob(e);var r=new Uint8Array(t.length);for(var a=0;a<t.length;++a){r[a]=t.charCodeAt(a)}return r.buffer};s.getInstanceTransform=function(e,t,o,c,f){s.toVector3(e.pos,t);s.toVector3(e.scale,c);var p=s.toVector3(e.rot);o.set(l(p.x),l(p.y),l(p.z),"YXZ");var u;if(e.isPolygon){u=new n(0,0,0)}else if(e.isBox||e.isCylinder){u=new n(0,0,-1)}else if(e.isModel){u=new n(0,0,-1*(f.min.z>0?f.min.z:f.max.z))}else{r.error("Unsupported instance type","",a)}if(o.x!==0||o.y!==0||o.z!==0||c.x!==1||c.y!==1||c.z!==1){var y=new i;y.makeRotationFromEuler(o);var v=new i;v.makeScale(c.x,c.y,c.z);v.multiply(y);u.applyMatrix4(v)}u.z=-u.z;t.sub(u)};s.getInstanceMatrix=function(e,r,a){var o=new n,i=new t.Euler,l=new n;s.getInstanceTransform(e,o,i,l,a);if(o.x!==0||o.y!==0||o.z!==0||i.x!==0||i.y!==0||i.z!==0||l.x!==1||l.y!==1||l.z!==1){var c=new t.Quaternion;c.setFromEuler(i,false);r.compose(o,c,l);r._identity=false}else{r.identity();r._identity=true}};s.createMaterial=function(e){return new t.MeshPhongMaterial({color:16777215,opacity:1,shininess:1,specular:1052681,side:e?t.DoubleSide:t.FrontSide})};s.createLineMaterial=function(){return new t.LineBasicMaterial({color:16777215,opacity:1,linewidth:1})};s.propertyAdded=function(e,t){return e[t]&&!e._last[t]};s.propertyRemoved=function(e,t){return!e[t]&&e._last[t]};s.propertyChanged=function(e,t){if(Array.isArray(t)){for(var r=0;r<t.length;++r){if(e[t[r]]!==e._last[t[r]]){return true}}return false}else{return e[t]!==e._last[t]}};s.updateProperty=function(e,t){if(Array.isArray(t)){t.forEach(function(t){e._last[t]=e[t]})}else{e._last[t]=e[t]}};s.normalizeObject3D=function(e,r,a){var o=(new t.Box3).setFromObject(e);var l=o.getCenter(new n);o.min.sub(new n(l.x,l.y,-l.z));o.max.sub(new n(l.x,l.y,-l.z));var c=Math.max(Math.abs(o.min.x),Math.abs(o.min.y),Math.abs(o.min.z),Math.abs(o.max.x),Math.abs(o.max.y),Math.abs(o.max.z));if(c){c=1/c}o.min.set(o.min.x*c,o.min.y*c,-o.min.z*c);o.max.set(o.max.x*c,o.max.y*c,-o.max.z*c);s.swap(o,"min","max");if(a){a.copy(o)}var f=(new i).makeScale(c,c,c);var p=(new i).makeTranslation(-l.x,-l.y,-l.z);e.updateMatrix();f.multiply(p);f.multiply(e.matrix);if(r){r.copy(f)}else{f.decompose(e.position,e.quaternion,e.scale)}};s.cloneMaterials=function(e){if(e){if(Array.isArray(e)){return e.map(function(e){return e.clone()})}return e.clone()}return e};s.getAttributeAlias=function(e,t,r){for(var a=0;a<e.dataTypes.length;++a){var o=e.dataTypes[a];if(o.name===t){for(var n=0;n<o.attributes.length;++n){var i=o.attributes[n];if(i.name===r){return i.alias}}}}return undefined};s.layersEnabled=function(e,t){return(e.mask&(1<<t|0))!==0};s.parseKeyboardShortcut=function(e){var t=[];var r={},a=false,o;r.ctrlKey=false;r.altKey=false;r.shiftKey=false;if(typeof e==="string"){o=e.split(",")}else{o=e;r.keyCode=o;t.push(r);return t}o.forEach(n);function n(e){if(e.includes("CTRL")){r.ctrlKey=true;a=true}if(e.includes("ALT")){r.altKey=true;a=true}if(e.includes("SHIFT")){r.shiftKey=true;a=true}if(a){var o=e.split("+");r.keyCode=o[o.length-1]}else{r.keyCode=e}t.push({shiftKey:r.shiftKey,ctrlKey:r.ctrlKey,altKey:r.altKey,keyCode:r.keyCode});r.ctrlKey=false;r.altKey=false;r.shiftKey=false;r.keyCode=""}return t};s.matchKeyboardShortcut=function(e,t){var r=false,a=0,o=false,n=0;if(e.altKey){a++;o=true}if(e.shiftKey){a++;o=true}if(e.ctrlKey){a++;o=true}for(var i=0;i<t.length;i++){var l=false,s=0,c=0,f=false;if(t[i].altKey||t[i].shiftKey||t[i].ctrlKey){f=true;if(t[i].altKey){n++}if(t[i].ctrlKey){n++}if(t[i].shiftKey){n++}}if(e.keyCode==t[i].keyCode){s++;l=true}else{l=false;r=false;continue}if(e.altKey||t[i].altKey){if(e.altKey==t[i].altKey){s++;c++}}if(e.shiftKey||t[i].shiftKey){if(e.shiftKey==t[i].shiftKey){s++;c++}}if(e.ctrlKey||t[i].ctrlKey){if(e.ctrlKey==t[i].ctrlKey){s++;c++}}if(s>1&&l==true&&c==a&&a==n||(s=1&&l==true&&f==false&&o==false)){r=true;break}}return r};return s});
/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5) (c) Copyright 2009-2012 SAP AG. All rights reserved
 */
sap.ui.predefine("sap/ui/vbm/adapter3d/VBIJSONParser", ["sap/ui/base/Object","./Utilities","./ObjectFactory","sap/base/Log","./../library"],function(e,t,n,i,r){"use strict";var a="sap.ui.vbm.VBIJSONParser";var s=t.toArray;var o=e.extend("sap.ui.vbm.adapter3d.VBIJSONParser",{constructor:function(t){e.call(this);this._context=t;this._factory=new n}});o.prototype.loadVBIJSON=function(e){if(e&&e.SAPVB){if(e.SAPVB.Resources){this._processResources(e.SAPVB.Resources)}if(e.SAPVB.Config){this._processConfig(e.SAPVB.Config)}if(e.SAPVB.DataTypes){this._processDataTypes(e.SAPVB.DataTypes)}if(e.SAPVB.Data){this._processData(e.SAPVB.Data)}if(e.SAPVB.Scenes){this._processScenes(e.SAPVB.Scenes)}if(e.SAPVB.Windows){this._processWindows(e.SAPVB.Windows)}if(e.SAPVB.Actions){this._processActions(e.SAPVB.Actions)}if(e.SAPVB.Automation){this._processAutomation(e.SAPVB.Automation)}if(e.SAPVB.Data||e.SAPVB.Scenes){this._refreshVisualObjects()}}return this};var u=function(e,t,n,i){i=s(i);for(var r=0,a=n.length;r<a;++r){var o=n[r];var u=i.length>r?i[r]:o;if(t.hasOwnProperty(o)){e[u]=t[o]}}return e};o.prototype._processResources=function(e){s(e.Set.Resource).forEach(function(e){this._context.resources.set(e.name,e.value)},this);return this};o.prototype._processConfig=function(e){s(e.Set.P).forEach(function(e){this._context.config.set(e.name,e.value)},this);return this};o.prototype._processDataTypes=function(e){if(e&&e.Set&&!Array.isArray(e.Set)&&!e.Set.name){this._context.dataTypes.splice(0);var t=function(e){var n=u(this._factory.createDataType(),e,["name","key","minSel","maxSel"]);s(e.A).forEach(function(e){n.attributes.push(u(this._factory.createDataTypeAttribute(),e,["name","alias","type"]))},this);s(e.N).forEach(function(e){n.dataTypes.push(t(e))});return n}.bind(this);s(e.Set.N).forEach(function(e){this._context.dataTypes.push(t(e))},this)}else{i.error("DataTypes: only the Set verb with no type attribute is supported.","",a)}return this};o.prototype._findDataTypeByPath=function(e){var t=function(n,i){if(i>e.length){return undefined}var r=e[i-1];for(var a=0,s=n.length;a<s;++a){var o=n[a];if(o.name===r){if(i===e.length){return o}else{return t(o.dataTypes,i+1)}}}return undefined};return t(this._context.dataTypes,1)};o.prototype._findDataTypeByDataNodePath=function(e){var t=[];for(var n=0,i=(e.length+1)/2;n<i;++n){t.push(e[n*2])}return this._findDataTypeByPath(t)};o.prototype._processData=function(e){s(e.Remove).forEach(function(e){if(e.type!=="E"){i.error("Data: the Remove verb is supported for the 'E' type only.",e.type,a);return}if(!e.name){i.error("Data: the Remove verb must have the non-empty name attribute.","",a);return}var t=this._findDataTypeByPath(e.name.split("."));if(!t){i.error("Data: the Remove verb is supported for data nodes with data types only.",e.name,a);return}var n=t.getKeyAttribute();if(!n){i.error("Data: the Remove verb is supported for data types with keys only.",e.name,a);return}var r=s(e.N.E).map(function(e){return e[n.alias]});var o=this._findDataNodeByPath(e.name.split("."));if(!o){if(r.length>0){i.warning("Data: unknown data node.",e.name,a)}return}this._removeDataInstancesByKey(o,n.name,r)},this);var t=function(e,n,r){var o=this._findDataTypeByPath(r);var u=o&&o.getKeyAttribute();s(n.E).forEach(function(n,s){var c=u?sap.ui.vbm.findInArray(e,function(e){return e[u.name]===n[u.alias]}):e[s];if(!c){c=this._factory.createDataInstance();if(u){e.push(c)}else{e[s]=c}}c.isDirty=true;for(var h in n){if(h==="N"){if(n.N.name){t(c[n.N.name]||(c[n.N.name]=this._factory.createDataNode()),n.N,r.concat(n.N.name))}else{i.error("Data: child data nodes must have names.","",a)}}else{var f=o.getAttributeByAlias(h);if(f){c[f.name]=n[h]}else{c[h]=n[h]}}}},this)}.bind(this);var n=s(e.Set);if(n.length===1&&!n[0].name){this._removeAllDataNodes();s(n.N).forEach(function(e){t(this._context.data[e.name]=this._factory.createDataInstance(),e,[e.name])},this)}else if(n.length>0){if(n.some(function(e){return!e.name})){i.error("Data: if there are multiple Set verbs then all Set verbs must have the non-empty name attribute.","",a);return this}if(n.some(function(e){return!e.N||s(e.N).length>1})){i.error("Data: all Set verbs with the name attribute must have the single N element.","",a);return this}n.forEach(function(e){var n=e.name.split(".");if(n.length!==1){i.error("Compound data node paths are not supported yet.","",a)}t(this._findDataNodeByPath(n)||(this._context.data[e.name]=this._factory.createDataNode()),e.N,[n[0]])},this)}return this};o.prototype._findDataNodeByPath=function(e){if(e.length>1){i.error("Compound paths for data nodes are not supported yet.",e,a);return undefined}return this._context.data[e[0]]};o.prototype._getDataValueByPath=function(e){if(e.length%2!==1){i.error("The absolute path to data value must contain an odd number of elements.",e.join("."),a);return undefined}var t;var n;for(var r=0,s=e.length;r<s;++r){var o=e[r];if(r%2===0){if(r===s-1){return n&&n[o]}else{t=(r==0?this._context.data:n)[o];if(t===undefined){return undefined}}}else{n=t[o];if(n===undefined){return undefined}}}return undefined};o.prototype._removeAllDataNodes=function(){for(var e in this._context.data){this._clearDataNode(this._context.data[e]);delete this._context.data[e]}return this};o.prototype._clearDataNode=function(e){e.splice(0).forEach(this._clearDataInstance,this);return this};o.prototype._clearDataInstance=function(e){if(e.visualObject){this._removeVisualObject(e.visualObject)}for(var t in e){if(Array.isArray(e[t])){this._clearDataNode(e[t]);delete e[t]}}return this};o.prototype._removeDataInstancesByKey=function(e,t,n){for(var i=e.length-1;i>=0&&n.length>0;--i){var r=e[i];var a=r[t];for(var s=n.length-1;s>=0;--s){if(a===n[s]){this._clearDataInstance(r);e.splice(i,1);n.splice(s,1);break}}}return this};o.prototype._processScenes=function(e){var t=function(e,t){u(e,t,["id","type","initialStartPosition","initialPitch","initialYaw","initialZoom"],["id","type","position","pitch","yaw","zoom"]);if(e.position||e.zoom||e.pitch||e.yaw){this._context.setupView={position:e.position,zoom:e.zoom,pitch:e.pitch,yaw:e.yaw,home:true,flyTo:false}}s(t.VO).forEach(function(t){var n=e.getVisualObjectGroupById(t.id);if(!n){n=this._factory.createVisualObjectGroup(e);for(var r in t){switch(r){case"id":case"datasource":case"type":n[r]=t[r];break;case"DragSource":case"DropTarget":break;default:if(r.endsWith(".bind")){n.isDataBound=true;var s=r.split(".")[0];var o=t[r].split(".");if(t["datasource"]){o.shift()}n.template[s]={path:o}}else{n.template[r]={value:t[r]}}break}}}else{i.warning("Scenes: cannot modify existing VO group.",t.id,a)}},this);return e}.bind(this);if(e.Remove){this._removeScenes(s(e.Remove).map(function(e){return e.name}))}if(e.Set){var n=s(e.Set);if(n.length===1&&!n[0].name){this._removeScenes(this._context.scenes.map(function(e){return e.id}))}else if(n.length>0){if(n.some(function(e){return!e.name})){i.error("Scenes: if there are multiple Set verbs then all Set verbs must have the non-empty name attribute.","",a);return this}if(n.some(function(e){return!e.Scene||s(e.Scene).length>1})){i.error("Scene: all Set verbs with the name attribute must have the single Scene element.","",a);return this}if(n.some(function(e){return e.name!==e.Scene.id})){i.error("Scene: the Set's attribute 'name' must equal the Set.Scene's attribute 'id'.","",a);return this}this._removeScenes(n.map(function(e){return e.name}))}n.forEach(function(e){s(e.Scene||e.SceneGeo).forEach(function(n){var i=this._factory.createScene(!!e.SceneGeo);t(i,n);this._context.scenes.push(i);this._context.sceneQueues.toAdd.push(i)},this)},this)}if(e.Merge){var r=s(e.Merge);if(r.length>0){if(r.some(function(e){return!e.name})){i.error("Scenes: all Merge elements must have the name attribute.","",a);return this}if(r.some(function(e){return!e.Scene||s(e.Scene).length>1})){i.error("Scenes: all Merge verbs must have the single Scene element.","",a);return this}if(r.some(function(e){return e.name!==e.Scene.id})){i.error("Scenes: the Merge's attribute 'name' must equal the Merge.Scene's attribute 'id'.","",a);return this}r.forEach(function(e){s(e.Scene||e.SceneGeo).forEach(function(n){var i=this._findSceneById(e.name);if(i){t(i,n);this._context.sceneQueues.toUpdate.push(i)}},this)},this)}}return this};o.prototype._findSceneById=function(e){for(var t=0,n=this._context.scenes.length;t<n;++t){var i=this._context.scenes[t];if(i.id===e){return i}}return undefined};o.prototype._removeScenes=function(e){for(var t=this._context.scenes.length-1;t>=0&&e.length>0;--t){var n=this._context.scenes[t];var i=n.id;for(var r=e.length-1;r>=0;--r){if(e[r]===i){this._context.sceneQueues.toRemove.push(n);this._context.scenes.splice(t,1);e.splice(r,1);n.voGroups.forEach(function(e){for(var t=e.vos.length-1;t>=0;--t){this._removeVisualObject(e.vos[t])}},this);break}}}return this};o.prototype._processVisualObjectGroup=function(e){if(e.isDataBound&&e.datasource){var t=e.datasource.split(".");var n=this._findDataNodeByPath(t);if(n){var i=this._findDataTypeByDataNodePath(t);if(i){e.maxSel=i.maxSel;e.minSel=i.minSel;var r=i.getKeyAttribute();if(r){e.keyAttributeName=r.name}}n.forEach(function(t){if(t.visualObject){if(t.isDirty||e.isDirty){this._queueVisualObjectToUpdate(e.scene,this._populateVisualObject(t.visualObject,t))}}else{this._queueVisualObjectToAdd(e.scene,this._populateVisualObject(this._factory.createVisualObject(e),t))}},this)}}else if(e.vos.length===0){this._queueVisualObjectToAdd(e.scene,this._populateVisualObject(this._factory.createVisualObject(e)))}else if(e.vos.length===1){this._queueVisualObjectToUpdate(e.scene,this._populateVisualObject(e.vos[0]))}return this};o.prototype._removeVisualObject=function(e){var t=e.voGroup.vos;var n=t.indexOf(e);if(n>=0){t.splice(n,1)}var i=e.voGroup.selected;var r=i.indexOf(e);if(r>=0){i.splice(r,1)}var a=e.voGroup.scene;e.voGroup=null;if(e.dataInstance){e.dataInstance.visualObject=null;e.dataInstance=null}this._queueVisualObjectToRemove(a,e);return this};o.prototype._populateVisualObject=function(e,t){var n=e.voGroup;var i=n.template;for(var r in i){var a=i[r],s;if("path"in a){if(t){s=t[a.path[0]];if(s!==undefined){e[r]=s}}else{s=this._getDataValueByPath(a.path);if(s!=undefined){e[r]=s}}}else{e[r]=a.value}}if(t){if(n.keyAttributeName){e.id=t[n.keyAttributeName]}t.visualObject=e;e.dataInstance=t;e["VB:c"]=t["VB:c"];var o=e["VB:s"]&&e["VB:s"]!=="false"?true:false;var u=t["VB:s"]&&t["VB:s"]!=="false"?true:false;if(o!==u){if(o){if(n.minSel==="0"||n.selected.length>1){n.selected.splice(n.selected.indexOf(e),1);e["VB:s"]="false"}}else if(n.maxSel!=="0"){if(n.maxSel==="1"){n.selected.splice(0).forEach(function(e){e["VB:s"]="false";this._queueVisualObjectToUpdate(n.scene,e)},this)}n.selected.push(e);e["VB:s"]="true"}}}return e};var c=function(e,t,n){if(e.has(t)){e.get(t).push(n)}else{e.set(t,[n])}return n};o.prototype._queueVisualObjectToAdd=function(e,t){c(this._context.voQueues.toAdd,e,t);return this};o.prototype._queueVisualObjectToUpdate=function(e,t){c(this._context.voQueues.toUpdate,e,t);return this};o.prototype._queueVisualObjectToRemove=function(e,t){c(this._context.voQueues.toRemove,e,t);return this};o.prototype._refreshVisualObjects=function(){this._context.scenes.forEach(function(e){e.voGroups.forEach(this._processVisualObjectGroup,this)},this);this._resetDirtyFlag();return this};o.prototype._processWindows=function(e){var t=function(e){for(var t=0,n=this._context.windows.length;t<n;++t){var i=this._context.windows[t];if(i.id===e){return{window:i,index:t}}}return{}}.bind(this);if(e.Remove){s(e.Remove).forEach(function(e){var n=t(e.name);if(n.window){this._context.windows.splice(n.index,1);this._context.windowQueues.toRemove.push(n.window)}},this)}if(e.Set){var n=s(e.Set);if(n.length===1&&!n[0].name){this._context.windows.splice(0).forEach(function(e){this._context.windowQueues.toRemove.push(e)},this)}else if(n.length>0){if(n.some(function(e){return!e.name})){i.error("Windows: if there are multiple Set verbs then all Set verbs must have the non-empty name attribute.","",a);return this}if(n.some(function(e){return!e.Window||s(e.Window).length>1})){i.error("Window: all Set verbs with the name attribute must have the single Window element.","",a);return this}if(n.some(function(e){return e.name!==e.Window.id})){i.error("Window: the Set's attribute 'name' must equal the Set.Window's attribute 'id'.","",a);return this}}n.forEach(function(e){s(e.Window).forEach(function(e){var n=t(e.id).window;if(n){this._context.windowQueues.toUpdate.push(n)}else{n=this._factory.createWindow();this._context.windows.push(n);this._context.windowQueues.toAdd.push(n)}u(n,e,["id","type","caption","refScene","refParent","width","height","modal"]);if("pos.bind"in e){n.pos=this._getDataValueByPath(e["pos.bind"])}else if("pos"in e){n.pos=e.pos}},this)},this)}return this};o.prototype._processActions=function(e){if(e&&e.Set&&e.Set.Action){Array.prototype.push.apply(this._context.actions,s(e.Set.Action))}return this};o.prototype._processAutomation=function(e){if(e&&e.Call){s(e.Call).forEach(function(e){switch(e.handler){case"FLYTOHANDLER":var t=s(e.Param);var n=sap.ui.vbm.findInArray(this._context.scenes,function(e){return e.id===(sap.ui.vbm.findInArray(t,function(e){return e.name==="scene"})||{})["#"]||""});if(n){var i=(sap.ui.vbm.findInArray(t,function(e){return e.name==="x"})||{})["#"]||"0";var r=(sap.ui.vbm.findInArray(t,function(e){return e.name==="y"})||{})["#"]||"0";var a=(sap.ui.vbm.findInArray(t,function(e){return e.name==="z"})||{})["#"]||"0";n.position=i+";"+r+";"+a;n.zoom=(sap.ui.vbm.findInArray(t,function(e){return e.name==="lod"})||{})["#"]||"0";n.pitch=(sap.ui.vbm.findInArray(t,function(e){return e.name==="pitch"})||{})["#"]||"0";n.yaw=(sap.ui.vbm.findInArray(t,function(e){return e.name==="yaw"})||{})["#"]||"0";this._context.setupView={position:n.position,zoom:n.zoom,pitch:n.pitch,yaw:n.yaw,flyTo:true}}break;default:break}},this)}return this};o.prototype._resetDirtyFlag=function(){for(var e in this._context.data){(function e(t){t.forEach(function(t){t.isDirty=false;for(var n in t){if(Array.isArray(t[n])){e(t[n])}}})})(this._context.data[e])}this._context.scenes.forEach(function(e){e.voGroups.forEach(function(e){e.isDirty=false})});return this};o.prototype.getAttributeAlias=function(e,t){for(var n=0;n<this._context.dataTypes.length;++n){var i=this._context.dataTypes[n];if(i.name===e){for(var r=0;r<i.attributes.length;++r){var a=i.attributes[r];if(a.name===t){return a.alias}}}}return undefined};return o});
/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5) (c) Copyright 2009-2012 SAP AG. All rights reserved
 */
sap.ui.predefine("sap/ui/vbm/lib/sapactions", ["./sapvbi"],function(){"use strict";VBI.Actions=function(){var e={};e.m_actions=[];e.clear=function(){for(var t=0;t<e.m_actions.length;++t){e.m_actions[t].clear()}e.m_actions=[]};e.Set=function(t,n,r){if(n){var i;if(i=e.findById(n)){i.load(t,r)}else{i=new VBI.Actions.Action;i.load(t,r);e.m_actions.push(i)}return}};e.Remove=function(t,n,r){if(n){var i;if(i=e.findById(n)){e.m_actions.splice(i.m_nArrayIndex,1)}return}};e.load=function(t,n){var r;if(t.Remove){if(jQuery.type(t.Remove)=="array"){for(r=0;r<t.Remove.length;++r){e.Remove(t.Remove[r],t.Remove[r].id,n)}}}if(t.Set){if(jQuery.type(t.Set)=="array"){for(r=0;r<t.Set.length;++r){e.Set(t.Set[r].Action,t.Set[r].id,n)}return}if(!t.Set.id){e.clear()}if(jQuery.type(t.Set.Action)=="object"){e.Set(t.Set.Action,t.Set.Action.id,n)}else if(jQuery.type(t.Set.Action)=="array"){for(r=0;r<t.Set.Action.length;++r){e.Set(t.Set.Action[r],t.Set.Action[r].id,n)}}}};e.findById=function(t){var n=e.m_actions,r=n.length;for(var i=0;i<r;++i){var o=n[i];if(o&&o.m_id==t){o.m_nArrayIndex=i;return o}}};e.findAction=function(t,n,r,i){var o=null;if(jQuery.type(r)=="object"){o=r.m_ID}else if(jQuery.type(r)=="string"){o=r}var a,c=e.m_actions.length;for(var f=0;f<c;++f){a=e.m_actions[f];if((t?a.m_refEvent==t:true)&&(n?a.m_refScene==n.m_ID:true)&&(r?a.m_refVO==o:true)&&(i?a.m_id==i:true)){return a}}return null};VBI.Actions.Action=function(){var e={};e.m_id=0;e.m_name=null;e.m_refScene=null;e.m_refVO=null;e.m_refEvent=null;e.m_additionalProperties=[];e.clear=function(){e.m_addProperties=null};e.load=function(t,n){e.m_id=t.id;e.m_name=t.name;e.m_refScene=t.refScene;e.m_refVO=t.refVO;e.m_refEvent=t.refEvent;e.m_additionalProperties=[];if(t.AddActionProperty){if(jQuery.type(t.AddActionProperty)=="object"){e.m_additionalProperties.push(t.AddActionProperty.name)}else if(jQuery.type(t.AddActionProperty)=="array"){for(var r=0;r<t.AddActionProperty.length;++r){e.m_additionalProperties.push(t.AddActionProperty[r].name)}}}};return e};return e}});
/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5) (c) Copyright 2009-2012 SAP AG. All rights reserved
 */
sap.ui.predefine("sap/ui/vbm/lib/sapautomations", ["./sapvbi"],function(){"use strict";VBI.Automations=function(){var e={};e.m_automations=[];e.clear=function(){for(var n=0;n<e.m_automations.length;++n){e.m_automations[n].clear()}e.m_automations=[]};e.load=function(n,t){if(n.Call){var a={};if(jQuery.type(n.Call)=="object"){a=new VBI.Automations.Automation;a.load(n.Call,t);e.m_automations.push(a)}else if(jQuery.type(n.Call)=="array"){for(var r=0;r<n.Call.length;++r){a=new VBI.Automations.Automation;a.load(n.Call[r],t);e.m_automations.push(a)}}}};VBI.Automations.Automation=function(){var e={};e.m_additionalProperties=[];e.clear=function(){e.m_addProperties=null};e.createHandler=function(e,n){switch(n){case"CONTEXTMENUHANDLER":return new VBI.ContextMenuHandler(e);case"FLYTOHANDLER":return new VBI.FlyToHandler(e);case"OBJECTCREATIONHANDLER":return new VBI.ObjectCreationHandler(e);case"LOOPBACKHANDLER":return new VBI.LoopBackHandler(e);default:return undefined}};e.getMainScene=function(e){if(e.m_SceneManager.m_SceneArray.length==1){return e.m_SceneManager.m_SceneArray[0].m_ID}return undefined};e.load=function(n,t){e.m_handlerName=n.handler;e.m_handler=e.createHandler(n.Param,n.handler);if(!e.m_handler){return}e.m_handler.m_Ctx=t;e.m_name=n.name;if(e.m_handler.m_scene==undefined){e.m_handler.m_scene=n.scene==undefined?e.getMainScene(t):n.scene}e.m_delay=n.delay==undefined?1:n.delay;e.m_earliest=n.earliest==undefined?1:n.earliest;e.m_retryAfterMS=n.retryAfterMS==undefined?0:n.retryAfterMS;e.m_reattempts=n.reattempts==undefined?-1:n.reattempts;e.m_handler.m_refID=n.refID==undefined?"":n.refID;e.m_handler.m_refObj=n.object==undefined?"":n.object;e.m_handler.m_refInstance=n.object==undefined?"":n.instance;e.m_handler.m_Name=n.name;e.m_nAttempts=0;var a=new Date;var r=a.getTime()-t.m_StartupTime;var m=e.m_delay;if(r<e.m_earliest){m=Math.max(m,e.m_earliest-r)}e.m_AnimZoomTimer=window.setInterval(e.startAutomation,m)};e.startAutomation=function(){window.clearInterval(e.m_AnimZoomTimer);if(!e.m_handler.start()&&e.m_retryAfterMS){e.m_nAttempts++;if(e.m_reattempts==-1||e.m_nAttempts<e.m_reattempts){e.m_AnimZoomTimer=window.setInterval(e.startAutomation,e.m_retryAfterMS)}}};return e};return e};VBI.FlyToHandler=function(e){var n={};n.cnt=0;for(var t=0;t<e.length;++t){if(e[t].name==="x"){n.m_x=e[t]["#"]}if(e[t].name==="y"){n.m_y=e[t]["#"]}if(e[t].name==="lod"){n.m_lod=e[t]["#"]}if(e[t].name==="mode"){n.m_mode=e[t]["#"]}if(e[t].name==="velocity"){n.m_velocity=e[t]["#"]}if(e[t].name==="basetime"){n.m_basetime=e[t]["#"]}if(e[t].name==="scene"){n.m_scene=e[t]["#"]}if(e[t].name==="zoomToAll"){n.m_zoomToAll=e[t]["#"]}}n.start=function(){if(VBI.m_bTrace){VBI.m_bTrace&&VBI.Trace("FlyTo triggered to "+n.m_x+","+n.m_y+","+n.m_lod+" on scene "+n.m_scene)}if(n.m_scene==undefined||n.m_x==undefined||n.m_y==undefined||n.m_lod==undefined){return true}var e=n.m_Ctx.m_SceneManager.GetSceneByName(n.m_scene);if(e){if(n.m_zoomToAll){e.ZoomToAll()}else{var t=n.m_lod;var a=VBI.MathLib.DegToRad([parseFloat(n.m_x),parseFloat(n.m_y)]);e.ZoomToGeoPosition(a,t)}}return true};return n};VBI.ContextMenuHandler=function(e){var n={};n.cnt=0;for(var t=0;t<e.length;++t){if(e[t].name==="x"){n.m_x=parseInt(e[t]["#"],10)}if(e[t].name==="y"){n.m_y=parseInt(e[t]["#"],10)}if(e[t].name==="scene"){n.m_scene=e[t]["#"]}}n.start=function(){var e=n.m_Ctx.m_SceneManager.GetSceneByName(n.m_scene);var t=n.m_Ctx;var a=t.m_Menus.findMenuByID(n.m_refID);if(!e){return true}a.vbi_data.scene=n.m_scene;a.vbi_data.object=n.m_refObj;a.vbi_data.instance=n.m_refInstance;if(t.m_strOpenMenu){t.m_Menus.findMenuByID(t.m_strOpenMenu).close()}if(t.m_HitMenu){t.m_HitMenu.close();t.m_HitMenu.destroy()}t.m_strOpenMenu=n.m_refID;a.open(true,0,"begin top","begin top",e.m_Div,""+n.m_x+" "+n.m_y+"","fit")};return n};VBI.ObjectCreationHandler=function(e){var n={};n.cnt=0;n.m_Ctx=null;n.m_Name=null;if(jQuery.type(e)=="object"){if(e.name==="data"){n.m_data=e["#"]}}else if(jQuery.type(e)=="array"){for(var t=0,a=e.length;t<a;++t){if(e[t].name==="data"){n.m_data=e[t]["#"]}}}n.start=function(){var e=null;if(e=n.m_Ctx.m_SceneManager.GetSceneByName(n.m_scene)){if(n.m_Name=="CreateObject"){var t=null,a=e.m_Ctx.m_Actions;if(a){t=e.m_Ctx.m_Actions.findAction("CreateComplete",e,"General")}var r=null;if(t){r=function(n){var a={data:n};e.m_Ctx.FireAction(t,e,"General",null,a)}}else{r=e.m_Ctx.m_Control.load.bind(e.m_Ctx.m_Control)}e.DesignCreateObject(n.m_data,null,r)}}};return n};VBI.LoopBackHandler=function(e){var n={};n.cnt=0;n.m_Ctx=null;n.m_Name=null;if(jQuery.type(e)=="object"){if(e.name==="ActionID"){n.m_ActionID=e["#"]}}else if(jQuery.type(e)=="array"){for(var t=0,a=e.length;t<a;++t){if(e[t].name==="ActionID"){n.m_ActionID=e[t]["#"]}}}n.start=function(){if(n.m_Name=="TriggerAction"){var e;if(e=n.m_Ctx.m_Actions){var t;if(t=e.findAction(null,null,null,n.m_ActionID)){var a;if(a=n.m_Ctx.m_SceneManager.GetSceneByName(t.m_refScene)){var r=a.BaseGetVO(t.m_refVO);n.m_Ctx.FireAction(t,a,r?r:t.m_refVO,null,null)}}}}};return n}});
/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5) (c) Copyright 2009-2012 SAP AG. All rights reserved
 */
sap.ui.predefine("sap/ui/vbm/lib/sapconfig", ["./sapvbi"],function(){"use strict";VBI.Configurations=function(){var a={};a.m_configdata=[];a.clear=function(){a.m_configdata=[]};a.load=function(n,t){if(n.Set){a.clear();var e=n.Set.P;if(jQuery.type(e)=="object"){a.m_configdata[e.name]=e.value}else if(jQuery.type(e)=="array"){for(var i=0,f=e.length;i<f;++i){a.m_configdata[e[i].name]=e[i].value}}}};a.GetData=function(n){return a.m_configdata[n]};return a}});
/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5) (c) Copyright 2009-2012 SAP AG. All rights reserved
 */
sap.ui.predefine("sap/ui/vbm/lib/sapdataprovider", ["./sapvbi"],function(){"use strict";VBI.isInt=function(e){return e-0==e&&e%1==0};VBI.IndexOf=function(e,t){var a=e.length;for(var r=0;r<a;++r){if(t==e[r]){return r}}return-1};VBI.Types={st_unknown:0,st_vector:1,st_string:2,st_vectorarray:3,st_float:4,st_color:5,st_long:6,st_bool:7,st_vectorarraymulti:8,string2bool:function(e){if(typeof e=="boolean"){return e}if(typeof e=="number"){return e?true:false}var t=e.slice(0,1);return t=="t"||t=="1"||t=="X"?true:false},string2vector:function(e){var t=false;var a=e.split(";");for(var r=0,n=a.length;r<n;++r){a[r]=parseFloat(a[r]);if(!t&&(isNaN(a[r])||!isFinite(a[r]))){t=true;jQuery.sap.log.error("The string contains invalid numbers")}}return a},stringarray2vectorarray:function(e){var t=[];for(var a=0,r=e.length;a<r;++a){var n=[];for(var i=0,s=e[a].length;i<s;++i){n.push(this.string2vector(e[a][i]))}t.push(n)}return t},string2rgba:function(e){var t,a;if(t=/^rgba\(([\d]+)[,;]\s*([\d]+)[,;]\s*([\d]+)[,;]\s*([\d]+|[\d]*.[\d]+)\)/.exec(e)){return[+t[1],+t[2],+t[3],+t[4],1]}else if(t=/^rgba\(([\d]+)\%[,;]\s*([\d]+)\%[,;]\s*([\d]+)\%[,;]\s*([\d]+|[\d]*.[\d]+)\)/.exec(e)){return[+Math.round(t[1]*2.55),+Math.round(t[2]*2.55),+Math.round(t[3]*2.55),+t[4],1]}else if(t=/^rgb\(([\d]+)[,;]\s*([\d]+)[,;]\s*([\d]+)\)/.exec(e)){return[+t[1],+t[2],+t[3],1,0]}else if(t=/^rgb\(([\d]+)\%[,;]\s*([\d]+)\%[,;]\s*([\d]+)\%\)/.exec(e)){return[+Math.round(t[1]*2.55),+Math.round(t[2]*2.55),+Math.round(t[3]*2.55),1,0]}else if(e.charAt(0)==="#"){var r;if(e.length<7){r=e.substring(0,2)+e.substring(1,2)+e.substring(2,3)+e.substring(2,3)+e.substring(3,4)+e.substring(3,4)}else{r=e}return[parseInt(r.substring(1,3),16),parseInt(r.substring(3,5),16),parseInt(r.substring(5,7),16),1,1]}else if(t=/^hsla\(([\d]+)[,]\s*([\d]+)\%[,]\s*([\d]+)\%[,]\s*([\d]+|[\d]*.[\d]+)\)/.exec(e)){t=[+t[1],+t[2],+t[3],+t[4]];a=VBI.Utilities.HLS2RGB(t[0]/360,t[2]/100,t[1]/100);return[a[0],a[1],a[2],t[3],1]}else if(t=/^hsl\(([\d]+)[,]\s*([\d]+)\%[,]\s*([\d]+)\%\)/.exec(e)){t=[+t[1],+t[2],+t[3]];a=VBI.Utilities.HLS2RGB(t[0]/360,t[2]/100,t[1]/100);return[a[0],a[1],a[2],1,0]}else if(t=/^RGBA\(([\d]+)[,;]([\d]+)[,;]([\d]+)[,;]([\d]+|[\d]*.[\d]+)\)/.exec(e)){return[+t[1],+t[2],+t[3],parseFloat(+t[4])/255,1]}else if(t=/^RGB\(([\d]+)[,;]([\d]+)[,;]([\d]+)\)/.exec(e)){return[+t[1],+t[2],+t[3],1,0]}else if(t=/^ARGB\((0[xX][0-9A-Fa-f]+)[,;](0[xX][0-9A-Fa-f]+)[,;](0[xX][0-9A-Fa-f]+)[,;](0[xX][0-9A-Fa-f]+)\)/.exec(e)){return[parseInt(t[2],16),parseInt(t[3],16),parseInt(t[4],16),parseFloat(+t[1])/255,1]}else if(t=/^ARGB\(([\d]+)[,;]([\d]+)[,;]([\d]+)[,;]([\d]+)\)/.exec(e)){return[+t[2],+t[3],+t[4],parseFloat(+t[1])/255,1]}else if(t=/^HLSA\(([\d]+)[,;]([\d]+)[,;]([\d]+)[,;]([\d]+)\)/.exec(e)){t=[+t[1],+t[2],+t[3],+t[4]];a=VBI.Utilities.HLS2RGB(t[0]/600,t[1]/600,t[2]/600);return[a[0],a[1],a[2],t[3]/255,1]}else if(t=/^HLS\(([\d]+)[,;]([\d]+)[,;]([\d]+)\)/.exec(e)){t=[+t[1],+t[2],+t[3]];a=VBI.Utilities.HLS2RGB(t[0]/600,t[1]/600,t[2]/600);return[a[0],a[1],a[2],1,0]}return[255,0,0,1,0]},string2color:function(e){var t=this.string2rgba(e);return"rgba("+t[0]+","+t[1]+","+t[2]+","+t[3]+")"},string2rhls:function(e){var t;if(t=/^RHLS\(([\d]+|[\d]*.[\d]+)[,;]([\d]+|[\d]*.[\d]+)[,;]([\d]+|[\d]*.[\d]+)\)/.exec(e)){return[parseFloat(+t[1])/360,parseFloat(+t[2]),parseFloat(+t[3]),1]}else if(t=/^RHLSA\(([\d]+|[\d]*.[\d]+)[,;]([\d]+|[\d]*.[\d]+)[,;]([\d]+|[\d]*.[\d]+)[,;]([\d]+|[\d]*.[\d]+)\)/.exec(e)){return[parseFloat(+t[1])/360,parseFloat(+t[2]),parseFloat(+t[3]),parseFloat(+t[4])]}return null},color2array:function(e){var t;if(t=/^rgba\(([\d]+)[,]([\d]+)[,]([\d]+)[,]([\d]+|[\d]*.[\d]+)\)/.exec(e)){t=[parseInt(+t[1],10),parseInt(+t[2],10),parseInt(+t[3],10),parseFloat(+t[4])];return t}return null},string2long:function(e){if(typeof e=="boolean"){return e?1:0}return parseInt(e,10)},string2float:function(e){if(typeof e=="boolean"){return e?1:0}return parseFloat(e)},float2string:function(e){return e.toString()},vector2string:function(e){var t="";for(var a=0;a<e.length;++a){t+=e[a];if(a+1<e.length){t+=";"}}return t},color2string:function(e){var t;if(t=/^rgba\(([\d]+),([\d]+),([\d]+),([\d]+|[\d]*.[\d]+)\)/.exec(e)){t=[+t[1],+t[2],+t[3],parseInt(parseFloat(+t[4])*255,10)];return"RGBA("+t[0]+","+t[1]+","+t[2]+","+t[3]+")"}return null},long2float:function(e){return parseFloat(e,10)},float2long:function(e){return parseInt(e,10)}};VBI.DataTypeProvider=function(){var e={};e.m_datatypenodes=[];e.vbiclass="DataTypeProvider";e.isParentOf=function(e,t){if(!t){return false}var a=t;while(a=a.m_Parent){if(a==e){return true}}return false};e.clear=function(){var e,t=this.m_datatypenodes.length;for(var a=0;a<t;++a){if(e=this.m_datatypenodes[a]){e.clear()}}this.m_datatypenodes=[]};e.set=function(t,a){if(t.type&&t.name){if(t.type=="N"){if(jQuery.type(t.N)=="object"){var r;if(r=e.GetTypeNode(t.name,true)){r.load(t.N);return}}}}else{this.clear()}var n;if(jQuery.type(t.N)=="object"){this.m_datatypenodes.push(n=new VBI.DataTypeProvider.DataTypeNode(this,this.m_datatypenodes.length));if(t.name){n.m_Name=t.name}if(t.N.key){n.m_Key=t.N.key}n.load(t.N)}else if(jQuery.type(t.N)=="array"){for(var i=0,s=t.N.length;i<s;++i){this.m_datatypenodes.push(n=new VBI.DataTypeProvider.DataTypeNode(this,this.m_datatypenodes.length));if(t.N[i].name){n.m_Name=t.N[i].name}if(t.N[i].key){n.m_Key=t.N[i].key}n.load(t.N[i])}}};e.load=function(t,a){if(t.Set){if(jQuery.type(t.Set)=="object"){e.set(t.Set,a)}else if(jQuery.type(t.Set)=="array"){for(var r=0,n=t.Set.length;r<n;++r){e.set(t.Set[r],a)}}}};e.GetTypeNode=function(e,t){for(var a=0;a<this.m_datatypenodes.length;++a){if(this.m_datatypenodes[a].m_Name==e){return this.m_datatypenodes[a]}}if(!t){return null}var r;this.m_datatypenodes.push(r=new VBI.DataTypeProvider.DataTypeNode(null,this.m_datatypenodes.length));r.m_Name=e;return r};e.FindTypeRefs=function(){var e=[];for(var t=0,a=this.m_datatypenodes.length;t<a;++t){var r=this.m_datatypenodes[t].m_Ref;if(r){e.push({m_Ref:r,m_DTN:this.m_datatypenodes[t]})}}return e};e.FindTypeNodeFromPath=function(e){var t,a=this.GetTypeNode(e[0],false);if(a==null){a=this.GetTypeNode(e[0],true)}for(var r=1;r<e.length;++r){if(!(t=a.GetTypeNode(e[r],false))){continue}a=t}return a};e.FindTypeAttributeFromPath=function(e){var t=[];for(var a=0;a<e.length-1;++a){t.push(e[a])}var r=this.FindTypeNodeFromPath(t);return r?r.GetTypeAttribute(e[e.length-1]):null};VBI.DataTypeProvider.DataTypeNode=function(e,t){var a={};a.m_datatypenodes=[];a.m_datatypeattributes=[];a.m_nArrayIndex=t;a.m_Name="";a.m_Key=null;a.m_Ref=null;a.m_Parent=e;a.m_MinSelect=1;a.m_MaxSelect=1;a.clear=function(){var e,t,r;a.m_Parent=null;r=a.m_datatypenodes.length;for(t=0;t<r;++t){if(e=a.m_datatypenodes[t]){e.clear()}}a.m_datatypenodes=[];r=a.m_datatypeattributes.length;for(t=0;t<r;++t){if(e=a.m_datatypeattributes[t]){e.clear()}}a.m_datatypeattributes=[]};a.load=function(e){if(e.name){a.m_Name=e.name}if(e.key){a.m_Key=e.key}if(e.ref){a.m_Ref=e.ref}if(e.minSel){a.m_MinSelect=parseInt(e.minSel,10)}if(e.maxSel){a.m_MaxSelect=parseInt(e.maxSel,10)}var t;if(e.A){var r;if(jQuery.type(e.A)=="array"){for(t=0;t<e.A.length;++t){r=a.GetTypeAttribute(e.A[t].name,true);r.load(e.A[t])}}else if(jQuery.type(e.A)=="object"){r=a.GetTypeAttribute(e.A.name,true);r.load(e.A)}}if(e.N){var n;if(jQuery.type(e.N)=="array"){for(t=0;t<e.N.length;++t){a.m_datatypenodes.push(n=new VBI.DataTypeProvider.DataTypeNode(this,a.m_datatypenodes.length));n.load(e.N[t])}}else if(jQuery.type(e.N)=="object"){a.m_datatypenodes.push(n=new VBI.DataTypeProvider.DataTypeNode(this,a.m_datatypenodes.length));n.load(e.N)}}};a.GetTypeNode=function(e,t){var r=a.m_datatypenodes;for(var n=0,i=r.length;n<i;++n){if(r[n].m_Name==e){return r[n]}}if(!t){return null}var s;r.push(s=new VBI.DataTypeProvider.DataTypeNode(this,r.length));s.m_Name=e;return s};a.GetKeyTypeAttribute=function(){if(a.m_Key){return a.GetTypeAttribute(a.m_Key,true)}else{return a.GetTypeAttribute("VB:ix",true)}return null};a.GetSelectTypeAttribute=function(e){return a.GetTypeAttribute("VB:s",e)};a.GetPath=function(){var e=[];var t=this;do{e.splice(0,0,t.m_Name)}while((t=t.m_Parent)&&t["m_Name"]);return e};a.GetTypeAttribute=function(e,t){var r=a.m_datatypeattributes;for(var n=0,i=r.length;n<i;++n){var s=r[n];if(s.m_Alias==e||s.m_Name==e){return s}}if(t){var l;r.push(l=new VBI.DataTypeProvider.DataTypeAttribute(r.length));l.m_Name=e;l.m_Parent=this;l.m_Type=e=="VB:s"?VBI.Types.st_bool:VBI.Types.st_string;return l}return null};return a};VBI.DataTypeProvider.DataTypeAttribute=function(e){var t={};t.m_Name="";t.m_Alias="";t.m_bChangeable=false;t.m_Type=VBI.Types.st_unknown;t.m_nArrayIndex=e;t.m_Parent=null;t.clear=function(){t.m_Parent=null};t.load=function(e){if(e.name){t.m_Name=e.name}if(e.alias){t.m_Alias=e.alias}if(e.changeable){t.m_bChangeable=VBI.Types.string2bool(e.changeable)}if(e.type){switch(e.type){case"vectorarraymulti":t.m_Type=VBI.Types.st_vectorarraymulti;break;case"vectorarray":t.m_Type=VBI.Types.st_vectorarray;break;case"vector":t.m_Type=VBI.Types.st_vector;break;case"long":t.m_Type=VBI.Types.st_long;break;case"string":t.m_Type=VBI.Types.st_string;break;case"color":t.m_Type=VBI.Types.st_color;break;case"boolean":t.m_Type=VBI.Types.st_bool;break;case"float":t.m_Type=VBI.Types.st_float;break;default:t.m_Type=VBI.Types.st_string;break}}};return t};return e};VBI.DataProvider=function(){var e={};var t=0,a=1,r=2;e.vbiclass="DataProvider";e.m_datanodes=[];e.m_dtp=null;e.m_Ctx=null;e.clear=function(){var t,a=e.m_datanodes.length;for(var r=0;r<a;++r){if(t=e.m_datanodes[r]){t.clear()}}e.m_datanodes=[];e.m_Ctx=null;e.m_dtp=null};e.set=function(e,t){var a=t.m_DataTypeProvider;if(!a){jQuery.sap.log.error("Data types are not available");return}if(e.type&&e.name){if(e.type=="N"){if(jQuery.type(e.N)=="object"){var r;var n=e.name.split(".");if(r=this.FindNodeFromPath(n)){if(e.name!=e.N.name){jQuery.sap.log.error("Node loading delta operation failed");return}r.load(e.N,a.FindTypeNodeFromPath(n));return}}}}else{this.clear()}if(e.N){var i,s,l;if(jQuery.type(e.N)=="object"){i=a.GetTypeNode(l=e.N.name,true);this.m_datanodes[i.m_nArrayIndex]=s=new VBI.DataProvider.DataNode;s.m_Parent=this;s.m_Name=l;s.load(e.N,i)}else if(jQuery.type(e.N)=="array"){for(var d=0;d<e.N.length;++d){i=a.GetTypeNode(l=e.N[d].name,true);this.m_datanodes[i.m_nArrayIndex]=s=new VBI.DataProvider.DataNode;s.m_Parent=this;s.m_Name=l;s.load(e.N[d],i)}}}};e.remove=function(e,t){var a,r;if(e.type=="N"&&(r=e.name)){if(a=this.FindNodeFromPath(r.split("."))){a.m_Parent.RemoveNode(a)}}else if(e.type=="E"&&(r=e.name)){if(a=this.FindNodeFromPath(r.split("."))){a.RemoveElements(e.N)}}};e.load=function(t,a){var r=a.m_DataTypeProvider;if(t.Remove){if(jQuery.type(t.Remove)=="object"){this.remove(t.Remove,a)}else if(jQuery.type(t.Remove)=="array"){for(var n=0,i=t.Remove.length;n<i;++n){this.remove(t.Remove[n],a)}}}if(t.Set){if(jQuery.type(t.Set)=="object"){e.set(t.Set,a)}else if(jQuery.type(t.Set)=="array"){for(var s=0;s<t.Set.length;++s){e.set(t.Set[s],a)}}}e.m_dtp=r;e.m_Ctx=a};e.store=function(e){if(this.IsModified()){e.Data={};e.Data.Merge={};var t=e.Data.Merge.N=[];var a;for(var r=0;r<this.m_datanodes.length;++r){if((a=this.m_datanodes[r])&&a.IsModified()){var n={};t.push(n);a.store(n)}}}};e.OnAttributeChanged=function(t){var a;if(a=e.m_Ctx.m_Actions){var r;if(r=a.findAction("AttributeChanged",null,null)){var n=t.m_Parent.GetPath()+"."+t.m_dta.m_Name;e.m_Ctx.FireAction(r,null,null,null,null,n)}}};e.OnNodeChanged=function(t){var a;if(a=e.m_Ctx.m_Actions){var r;if(r=a.findAction("NodeChanged",null,null)){var n=null;if(t.m_Parent&&t.m_Parent.GetPath){n=t.m_Parent.GetPath()+"."}else{n=""}e.m_Ctx.FireAction(r,null,null,null,null,n+t.m_dtn.m_Name)}}};e.OnElementChanged=function(t){var a;if(a=e.m_Ctx.m_Actions){var r;if(r=a.findAction("ElementChanged",null,null)){e.m_Ctx.FireAction(r,null,null,null,null,t.GetPath())}}};e.IsModified=function(){var e;for(var t=0;t<this.m_datanodes.length;++t){if((e=this.m_datanodes[t])&&e.IsModified()){return true}}return false};e.RemoveNode=function(e){var t=e.m_dtn.m_nArrayIndex;this.m_datanodes[t].clear();this.m_datanodes[t]=null};e.FindFromPathEx=function(e,t,n,i,s){var l=false,d=null,m=null,o=null;if(s){l=true;o=s;d=s.m_dtn}else if(i){m=i;d=i.m_Parent.m_dtn}for(var u=t,f=e.length;u<f;++u){if(l){if(d.m_Key){if(m=o.FindElementByKey(e[u])){l=false;continue}}else if(VBI.isInt(e[u])){m=o.m_dataelements[parseInt(e[u],10)];l=false;continue}else{if(o.m_dataelements.length){m=o.m_dataelements[0]}if(!m){VBI.m_bTrace&&VBI.Trace("Error: invalid lead selected element")}}}if(n==r&&u+1==f){var _;if(_=d.GetTypeAttribute(e[u],false)){if(m){return m.m_dataattributes[_.m_nArrayIndex]}else{if(o.m_dataelements.length){m=o.m_dataelements[0];return m.m_dataattributes[_.m_nArrayIndex]}}}}d=d.GetTypeNode(e[u],true);if(!m){VBI.m_bTrace&&VBI.Trace("Error: Invalid Binding Path "+e);return false}o=m.m_datanodes[d.m_nArrayIndex];l=true}if(n==r||n==a){return null}return o};e.FindFromPath=function(t,a){if(!e.m_dtp){return null}var r=e.m_dtp.GetTypeNode(t[0],false);if(!r){return null}var n=e.m_datanodes[r.m_nArrayIndex];if(!n){return null}return e.FindFromPathEx(t,1,a,null,n)};e.FindAttributeFromPath=function(t){return e.FindFromPath(t,r)};e.FindNodeFromPath=function(a){return e.FindFromPath(a,t)};e.SetSelection=function(t,a){var r,n=e.m_datanodes;for(var i=0,s=n.length;i<s;++i){if(r=n[i]){r.SetSelection(t,a)}}};VBI.DataProvider.DataNode=function(){var e={};e.m_Name="";e.m_dataelements=[];e.m_Parent=null;e.m_dtn=null;e.m_bModified=false;e.clear=function(){e.m_dtn=null;for(var t=0;t<e.m_dataelements.length;++t){e.m_dataelements[t].clear();e.m_dataelements[t].m_Parent=null}e.m_dataelements=[];e.m_Parent=null};e.IsModifiedSelection=function(){return e.m_bModified?true:false};e.IsModifiedElements=function(){var t=e.m_dataelements;for(var a=0;a<t.length;++a){if(t[a].IsModified()){return true}}return false};e.IsModified=function(){if(e.IsModifiedSelection()||e.IsModifiedElements()){return true}return false};e.store=function(t){t.name=e.m_dtn.m_Name;if(e.IsModifiedElements()){t.E=[];for(var a=0;a<e.m_dataelements.length;++a){if(e.m_dataelements[a].IsModified()){var r={};t.E.push(r);e.m_dataelements[a].store(r)}}}};e.RemoveNode=function(t){var a=t.m_dtn.m_nArrayIndex;e.m_datanodes[a].clear();e.m_datanodes[a]=null};e.RemoveElements=function(t){var a=e.m_dtn.GetKeyTypeAttribute();var r=e.GetElementKeyMap(a);if(t.E){if(jQuery.type(t.E)=="object"){e.InternalFindAndRemoveExistingElement(t.E,0,a,r)}else if(jQuery.type(t.E)=="array"){for(var n=0;n<t.E.length;++n){e.InternalFindAndRemoveExistingElement(t.E[n],n,a,r)}}}};e.GetElementKeyMap=function(t){var a,r=[];var n=t?t:e.m_dtn.GetKeyTypeAttribute();for(var i=0;i<e.m_dataelements.length;++i){r[(a=e.m_dataelements[i]).m_dataattributes[n.m_nArrayIndex].m_Value]=a}return r};e.FindElementByKey=function(t,a,r){var n;if(r){return(n=r[t])?n:null}var i=a?a:e.m_dtn.GetKeyTypeAttribute();var s,l=this.m_dataelements;for(var d=0,m=l.length;d<m;++d){if(s=l[d]){if(s.m_dataattributes[i.m_nArrayIndex].m_Value==t){return s}}}return null};e.FindElementByIndex=function(e){return this.m_dataelements[e]};e.InternalFindAndRemoveExistingElement=function(e,t,a,r){var n=null,i=null;if(a.m_Alias&&(n=e[a.m_Alias])){i=this.FindElementByKey(n,a,r)}else if(a.m_Name&&(n=e[a.m_Name])){i=this.FindElementByKey(n,a,r)}else{i=this.FindElementByKey(n=t,a,r)}if(i){this.m_dataelements.splice(VBI.IndexOf(this.m_dataelements,i),1);if(r){r.splice(n,1)}i.clear()}};e.InternalFindOrCreateExistingElement=function(t,a,r,n){var i=null,s=null;if(r.m_Alias&&(i=t[r.m_Alias])){s=e.FindElementByKey(i,r,n)}else if(r.m_Name&&(i=t[r.m_Name])){s=e.FindElementByKey(i,r,n)}else{s=e.FindElementByKey(i=a,r,n)}if(s){return s}s=new VBI.DataProvider.DataElement;e.m_dataelements.push(s);if(n){n[i]=s}return s};e.load=function(t,a){e.m_dtn=a;var r=e.m_dtn.GetKeyTypeAttribute();var n=e.GetElementKeyMap(r);if(t.E){var i,s;if(jQuery.type(t.E)=="object"){s=e.InternalFindOrCreateExistingElement(t.E,0,r,n);s.m_Parent=e;s.load(t.E,a);if(s.m_dataattributes[r.m_nArrayIndex]==null){i=new VBI.DataProvider.DataAttribute(r,null,s);i.m_Value=0;s.m_dataattributes[r.m_nArrayIndex]=i}}else if(jQuery.type(t.E)=="array"){for(var l=0,d=t.E.length;l<d;++l){s=e.InternalFindOrCreateExistingElement(t.E[l],l,r,n);s.m_Parent=e;s.load(t.E[l],a);if(s.m_dataattributes[r.m_nArrayIndex]==null){i=new VBI.DataProvider.DataAttribute(r,null,s);i.m_Value=l;s.m_dataattributes[r.m_nArrayIndex]=i}}}}};e.GetName=function(){return this.m_Name};e.GetPath=function(){return this.m_dtn.GetPath()};e.SetModified=function(){this.m_bModified=true;var e=this;while(e.m_Parent){e=e.m_Parent}if(e){e.OnNodeChanged(this)}};e.GetSelectedElements=function(){var e=[];var t=this.m_dataelements;var a=this.m_dtn.GetTypeAttribute("VB:s",true);for(var r=0,n=t.length;r<n;++r){if(t[r].IsSelected(a)){e.push(t[r])}}return e};e.GetNumOfSelectedElements=function(){return e.m_NumSelectedEltes!=undefined?e.m_NumSelectedEltes:e.GetSelectedElements().length};e.SetNumOfSelectedElements=function(){e.m_NumSelectedEltes=e.GetSelectedElements().length};e.UnSetNumOfSelectedElements=function(){e.m_NumSelectedEltes=undefined};e.SetSelection=function(e,t){var a=this.m_dataelements;var r=null,n=this.m_dtn.GetTypeAttribute("VB:s",true);if(!e&&t){this.SetNumOfSelectedElements()}for(var i=0,s=a.length;i<s;++i){if(r=a[i]){if(t){r.Select(e)}else{r.SetElementSelectionState(e,n)}}}this.UnSetNumOfSelectedElements();return null};return e};VBI.DataProvider.DataElement=function(){this.m_dataattributes=[];this.m_datanodes=[];this.m_Parent=null;this.m_bChangeable=false};VBI.DataProvider.DataElement.prototype={m_dataattributes:null,m_datanodes:null,m_Parent:null,m_nModified:0,m_bChangeable:false,clear:function(){var e,t;for(e=0;e<this.m_datanodes.length;++e){if(t=this.m_datanodes[e]){t.clear();t.m_Parent=null}}this.m_datanodes=[];for(e=0;e<this.m_dataattributes.length;++e){if(t=this.m_dataattributes[e]){t.clear();t.m_Parent=null}}this.m_dataattributes=[]},load:function(e,t){var a=false;this.m_nModified=0;if(e["VB:m"]){if(a=VBI.Types.string2bool(e["VB:m"])){this.m_nModified=7}delete e["VB:m"]}if(e["VB:c"]){this.m_bChangeable=VBI.Types.string2bool(e["VB:c"]);delete e["VB:c"]}for(var r in e){if(!e.hasOwnProperty(r)){continue}if(r=="N"&&!(typeof e[r]=="string")){var n,i;if(jQuery.type(e[r])=="object"){n=t.GetTypeNode(e.N.name,true);this.m_datanodes[n.m_nArrayIndex]=i=new VBI.DataProvider.DataNode;i.m_Parent=this;i.m_Name=e.N.name;i.load(e[r],n)}else if(jQuery.type(e[r])=="array"){var s=e[r];for(var l=0;l<s.length;++l){var d=s[l];n=t.GetTypeNode(d.name,true);this.m_datanodes[n.m_nArrayIndex]=i=new VBI.DataProvider.DataNode;i.m_Parent=this;i.m_Name=d.name;i.load(d,n)}}}else{var m=t.GetTypeAttribute(r,true);this.m_dataattributes[m.m_nArrayIndex]=new VBI.DataProvider.DataAttribute(m,e[r],this,a)}}},IsModified:function(e){if(this.m_nModified){return true}var t,a,r;for(t=0,a=this.m_dataattributes.length;t<a;++t){if((r=this.m_dataattributes[t])&&r.IsModified()){return true}}for(t=0,a=this.m_datanodes.length;t<a;++t){if((r=this.m_datanodes[t])&&r.IsModified()){return true}}return false},IsChangeable:function(){return this.m_bChangeable},IsSelected:function(e){var t,a=e?e:this.m_Parent.m_dtn.GetSelectTypeAttribute(false);if(a&&(t=a.m_nArrayIndex)<this.m_dataattributes.length){var r;if(r=this.m_dataattributes[t]){if(a.m_Type==VBI.Types.st_string){return VBI.Types.string2bool(r.m_Value)}else{return r.m_Value?true:false}}}return false},SetModified:function(){this.m_nModified|=1;var e=this;while(e.m_Parent){e=e.m_Parent}if(e){e.OnElementChanged(this)}},store:function(e){var t=this.m_Parent.m_dtn.GetKeyTypeAttribute();var a=t.m_Alias?t.m_Alias:t.m_Name;e[a]=this.m_dataattributes[t.m_nArrayIndex].GetStringValue();if(this.m_nModified&2){e["VB:c"]=this.m_bChangeable?"true":"false"}if(this.m_nModified&4){e["VB:m"]="true"}var r,n,i;for(r=0,n=this.m_dataattributes.length;r<n;++r){if((i=this.m_dataattributes[r])&&i.IsModified()){var s=i.m_dta.m_Alias?i.m_dta.m_Alias:i.m_dta.m_Name;e[s]=i.GetStringValue()}}for(r=0,n=this.m_datanodes.length;r<n;++r){if((i=this.m_datanodes[r])&&i.IsModified()){i.store(e["N"]={})}}},GetKeyValue:function(){var e;if(this.m_Parent&&(e=this.m_Parent.m_dtn.GetKeyTypeAttribute())){return this.m_dataattributes[e.m_nArrayIndex].m_Value}return null},GetPath:function(){var e=null;var t=this;while(t){var a=t.GetKeyValue();if(e){e=a+"."+e}else{e=a}var r;if(r=this.m_Parent){e=this.m_Parent.m_dtn.m_Name+"."+e}else{break}if(r.m_Parent&&r.m_Parent.m_Parent){t=r.m_Parent?r.m_Parent:null}else{break}}return e},SetElementSelectionState:function(e,t){var a=t;if(!a){a=t?t:this.m_Parent.m_dtn.GetTypeAttribute("VB:s",true);a.m_Type=VBI.Types.st_bool}var r=a.m_nArrayIndex;if(this.m_dataattributes[r]==null){this.m_dataattributes[r]=new VBI.DataProvider.DataAttribute(a,null,this)}var n,i=this.m_dataattributes[r];if(n=i.m_Value!=(e?true:false)){i.m_Value=e?true:false;i.m_bModified=true}if(n){this.SetModified();return true}return false},GlobalSingleSelect:function(){var e=this.m_Parent.m_dtn;if(e.m_MaxSelect==0){return 0}this.m_Parent.SetSelection(false,false);this.Select(true);return 1},Select:function(e,t){var a=this.m_Parent.m_dtn;if(!t){t=0}var r;if(e){if(a.m_MaxSelect==0){return 0}if(a.m_MaxSelect<0){r=this.SetElementSelectionState(true)?1:0;return t+r}if(a.m_MaxSelect==1){this.m_Parent.SetSelection(false,false);this.SetElementSelectionState(true);return 1}}else{if(a.m_MinSelect==1&&this.m_Parent.GetNumOfSelectedElements()>1||a.m_MinSelect==0){r=this.SetElementSelectionState(false)?1:0;return t-r}}},FindNodeFromPath:function(a){return e.FindFromPathEx(a,0,t,this,null)},FindAttributeFromPath:function(t){return e.FindFromPathEx(t,0,r,this,null)}};VBI.DataProvider.DataAttribute=function(e,t,a,r){this.m_dta=e;this.m_Parent=a;if(r){this.m_bModified=true}if(t===null){return}var n=VBI.Types;if(e.m_Type==n.st_vectorarraymulti){this.m_Value=n.stringarray2vectorarray(t)}else if(e.m_Type==n.st_vectorarray||e.m_Type==n.st_vector){this.m_Value=n.string2vector(t)}else if(e.m_Type==n.st_long){this.m_Value=n.string2long(t)}else if(e.m_Type==n.st_float){this.m_Value=n.string2float(t)}else if(e.m_Type==n.st_bool){this.m_Value=n.string2bool(t)}else if(e.m_Type==n.st_color){this.m_Value=n.string2color(t)}else if(e.m_Type==n.st_string){this.m_Value=t}else{this.m_Value=t}};VBI.DataProvider.DataAttribute.prototype={m_dta:null,m_Value:null,m_Parent:null,m_bModified:false,clear:function(){this.m_Parent=null;this.m_dta=null},store:function(e){},set:function(e){if(e!=this.m_Value){this.SetModified()}this.m_Value=e},SetModified:function(){this.m_bModified=true;var e=this;while(e.m_Parent){e=e.m_Parent}if(e){e.OnAttributeChanged(this)}},IsModified:function(){return this.m_bModified},IsChangeable:function(){return this.m_dta.m_bChangeable&&this.m_Parent.m_bChangeable},GetStringValue:function(){var e="";switch(this.m_dta.m_Type){case VBI.Types.st_vectorarray:case VBI.Types.st_vector:return VBI.Types.vector2string(this.m_Value);case VBI.Types.st_long:e+=this.m_Value;return e;case VBI.Types.st_float:e+=this.m_Value;return e;case VBI.Types.st_string:return this.m_Value;case VBI.Types.st_bool:return this.m_Value?"true":"false";case VBI.Types.st_color:var t;if(t=/^rgba\(([\d]+),([\d]+),([\d]+),([\d]+|[\d]*.[\d]+)\)/.exec(this.m_Value)){t=[+t[1],+t[2],+t[3],parseInt(parseFloat(+t[4])*255,10)];return"RGBA("+t[0]+","+t[1]+","+t[2]+","+t[3]+")"}break;default:return this.m_Value}}};return e};VBI.Adaptor=function(e){var t=e;this.RecursiveLoadElement=function(e,t,a){var r;for(r=0;r<a.m_datatypeattributes.length;++r){var n=a.m_datatypeattributes[r];var i=t[n.m_Name];if(i===undefined){continue}if(n.m_Type==VBI.Types.st_vector&&jQuery.type(i)=="array"){e[n.m_Alias]=""+i[0]+";"+i[1]+";0"}else{e[n.m_Alias]=i.toString()}}if(a.m_datatypenodes.length){var s=e.N=[];for(r=0;r<a.m_datatypenodes.length;++r){var l=s[r]={};var d=a.m_datatypenodes[r];var m=t[d.m_Name];if(m){this.RecursiveLoad(l,m,d)}}}};this.RecursiveLoad=function(e,t,a){e.name=a.m_Name;e.E=[];var r;if(jQuery.type(t)=="array"){for(var n=0;n<t.length;++n){r=e.E[n]={};this.RecursiveLoadElement(r,t[n],a)}}else{r=e.E[0]={};this.RecursiveLoadElement(r,t,a)}};this.LoadFindRefNode=function(e){var a=t.m_DataTypeProvider.FindTypeRefs();for(var r=0,n=a.length;r<n;++r){var i=e;var s=a[r].m_Ref.split(".");for(var l=0,d=s.length;l<d;++l){i=i[s[l]];if(i&&l+1==d){a[r].m_Root=i;return a[r]}if(!i){break}}}return null};this.CreateLoadData=function(e){if(!t.m_DataTypeProvider){return null}var a=null;if(!(a=this.LoadFindRefNode(e))){return null}var r=a.m_DTN;var n=a.m_Root;var i={SAPVB:{version:"2.0",Data:{Remove:{type:"N",name:r.m_Name},Set:{type:"N",name:r.m_Name,N:{}}}}};var s=n;var l=i.SAPVB.Data.Set.N;this.RecursiveLoad(l,s,r);return i}}});
/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5) (c) Copyright 2009-2012 SAP AG. All rights reserved
 */
sap.ui.predefine("sap/ui/vbm/lib/sapevents", ["./sapvbi"],function(){"use strict";VBI.ScenePointerEvents=function(e,t){e.m_Gesture=null;this.m_Events=["msgesturehold","msgesturestart","msgestureend","msgesturechange","msgestureinertiastart","gesturehold","gesturestart","gestureend","gesturechange","gestureinertiastart","pointerdown","pointermove","pointerup","mspointerdown","mspointermove","mspointerup"];this.clear=function(){for(var e=0,n=this.m_Events.length;e<n;++e){t["on"+this.m_Events[e]]=null}};this.subscribe=function(){var n=this.m_Events;for(var r=0,o=n.length;r<o;++r){var i;if(n[r].slice(0,2)=="ms"){i="process"+n[r].slice(2)}else{i="process"+n[r]}if(!e[i]){if(VBI.m_bTrace){VBI.Trace("Error: Handler "+i+" not defined")}}t["on"+n[r]]=e[i]}};e.processgesturehold=function(t){if(VBI.m_bTrace){VBI.Trace("processgesturehold")}e.DispatchEvent(t,"sapsecclick");t.preventDefault()};e.processgesturestart=function(e){if(VBI.m_bTrace){VBI.Trace("processgesturestart")}};e.processgestureend=function(t){if(VBI.m_bTrace){VBI.Trace("processgestureend")}if(e.m_Gesture){e.m_Gesture.target=null}e.m_Gesture=null};e.processgesturechange=function(t){if(VBI.m_bTrace){VBI.Trace("processgesturechange mode: "+e.m_nInputMode)}if(e.m_nInputMode!=VBI.InputModeDefault&&e.m_nInputMode!=VBI.InputModeTrackMap){e.DispatchEvent(t,"sapmove");return}if(VBI.m_bTrace){VBI.Trace("processgesturechange");VBI.Trace("rotation:"+t.rotation);VBI.Trace("scale:"+t.scale);VBI.Trace("trans:"+t.translationX+","+t.translationY)}var n=t.gestureObject;var r=Math.round(n.tx)-n.txdone;var o=Math.round(n.ty)-n.tydone;var i=Math.round(t.translationX)+r;var s=Math.round(t.translationY)+o;n.tx+=t.translationX;n.ty+=t.translationY;n.txdone+=i;n.tydone+=s;if(VBI.m_bTrace){VBI.Trace("done:"+n.txdone+","+n.tydone);VBI.Trace("calc:"+n.tx+","+n.ty)}if(i||s){if(VBI.m_bTrace){VBI.Trace("scene.processgesturechange move")}e.MoveMap(i,s)}if(t.scale!=1){e.ZoomMap(t.scale,t.offsetX,t.offsetY);e.TriggerReRenderTimer(400)}t.stopPropagation();t.preventDefault();return true};e.processgestureinertiastart=function(e){if(VBI.m_bTrace){VBI.Trace("processgestureinertiastart")}e.preventDefault()};e.processpointerdown=function(t){if(VBI.m_bTrace){VBI.Trace("scene.processpointerdown ")}e.onsapdown(t);var n=e.m_Gesture;if(n&&t.pointerType!=n.pointerType){if(VBI.m_bTrace){VBI.Trace("processpointerdown gesture pointer type mismatch or gesture hasn't been started")}e.m_Gesture.target=null;n=e.m_Gesture=null}if(!n){if(VBI.m_bTrace){VBI.Trace("processpointerdown create gesture")}n=e.m_Gesture=new window.MSGesture;n.pointerCount=0;n.target=t.srcElement;n.pointerType=t.pointerType;n.tx=0;n.ty=0;n.txdone=0;n.tydone=0}if(t.pointerType==n.pointerType){n.addPointer(t.pointerId);n.pointerCount++}return};e.processpointerup=function(t){if(VBI.m_bTrace){VBI.Trace("processpointerup")}if(e.m_Gesture){e.m_Gesture.pointerCount--;if(!e.m_Gesture.pointerCount){e.m_Gesture.target=null;e.m_Gesture=null}}return e.onsapup(t)};e.processpointermove=function(t){if(VBI.m_bTrace){VBI.Trace("scene.processpointermove")}e.m_currentMouseX=t.clientX;e.m_currentMouseY=t.clientY;e.onsapmove(t);return};this.subscribe()};VBI.SceneTouchEvents=function(e,t){var n=e.m_SuppressedNavigation.move&&e.m_SuppressedNavigation.zoom;this.m_Events=["touchstart","touchend","touchmove","touchcancel"];this.clear=function(){for(var n=0,r=this.m_Events.length;n<r;++n){t.removeEventListener(this.m_Events[n],e["process"+this.m_Events[n]])}};this.subscribe=function(){var n=this.m_Events;for(var r=0,o=n.length;r<o;++r){var i="process"+n[r];if(e[i]){t.addEventListener(n[r],e[i])}else if(VBI.m_bTrace){VBI.Trace("Error: Handler "+i+" not defined")}}};e.processtouchstart=function(t){var r=false;var o=e.m_Ctx;if(o.m_strOpenMenu){o.m_Menus.findMenuByID(o.m_strOpenMenu).close();o.m_strOpenMenu=undefined}if(o.m_HitMenu){o.m_HitMenu.close();o.m_HitMenu.destroy()}if(VBI.m_bTrace){VBI.Trace("processtouchstart")}if(e.m_TapTimer){window.clearInterval(e.m_TapTimer)}if(e.DispatchEvent(t,"sapdown")==true){return}e.m_Touches.push(t);e.m_TouchStarted=true;e.m_Touches.m_bMoveWasDone=false;if(t.touches.length==1&&!e.m_SuppressedNavigation.move){e.SetInputMode(VBI.InputModeDefault);var i=t.touches[0];e.m_currentMouseX=i.clientX;e.m_currentMouseY=i.clientY;if(VBI.m_bTrace){VBI.Trace("processtouchstart"+"X:"+e.m_currentMouseX+"Y:"+e.m_currentMouseY)}e.RestartContextMenuTimer(t,i,700);r=true}else if(t.touches.length==2){e.SetInputMode(VBI.InputModeDefault);var s=t.touches[0];var a=t.touches[1];var c=(a.clientX+s.clientX)/2;var u=(a.clientY+s.clientY)/2;e.m_currentMouseX=c;e.m_currentMouseY=u;e.m_midPointX=c;e.m_midPointY=u;var m=Math.sqrt(Math.pow(s.clientX-a.clientX,2)+Math.pow(s.clientY-a.clientY,2));e.m_currentTouchDistance=m;if(VBI.m_bTrace){VBI.Trace("processtouchstart"+"X1:"+s.clientX+"Y1:"+s.clientY+"X2:"+a.clientX+"Y2:"+a.clientY)}r=true}if(r&&!n){t.preventDefault();return false}};e.RestartContextMenuTimer=function(t,n,r){if(e.m_ContextMenuTimer){window.clearInterval(e.m_ContextMenuTimer)}e.m_ContextMenuTimer=window.setInterval(function(){window.clearInterval(e.m_ContextMenuTimer);e.m_ContextMenuTimer=null;e.onPseudoRightClick(t,n)},r)};e.onPseudoRightClick=function(t,n){e.SetInputMode(VBI.InputModeDefault);if(VBI.m_bTrace){VBI.Trace("Pseudo Right Click")}if(e.DispatchEvent(t,"sapsecclick")==true){e.m_Touches=[];return}var r;if(r=e.m_Ctx.m_Actions.findAction("ContextMenu",e,"Map")){e.m_Touches=[];var o=e.GetInternalDivClientRect();e.m_Ctx.FireAction(r,e,"Map",null,{x:n.clientX-o.left,y:n.clientY-o.top,scene:e.m_ID})}};e.IsDoubleTap=function(e){if(e.length<4){return null}var t=e.length-4;var n=e.length-2;if(e[t].type=="touchstart"&&e[t].touches.length!=1){return null}if(e[n].type=="touchstart"&&e[n].touches.length!=1){return null}var r=e[t].touches[0].clientX-e[n].touches[0].clientX;var o=e[t].touches[0].clientY-e[n].touches[0].clientY;if(r*r+o*o>1e3){return null}var i=e.length-3;var s=e.length-1;var a=e[s].timeStamp-e[i].timeStamp;if(a>300){return null}return[e[n].touches[0].clientX,e[n].touches[0].clientY]};e.IsTwoFingerTap=function(e){if(e.length<2||e.m_bMoveWasDone){return null}var t=e.length-2;var n=e.length-1;if(e[t].type!="touchstart"||e[t].touches.length!=2){return null}var r=e[n].timeStamp-e[t].timeStamp;if(r>300){return null}var o=e[t].touches;return[(o[0].clientX+o[1].clientX)/2,(o[0].clientY+o[1].clientY)/2]};e.IsSingleTap=function(e){if(e.length!=2||e.m_bMoveWasDone){return null}var t=e.length-2;var n=e.length-1;if(e[t].type!="touchstart"||e[t].touches.length!=1){return null}if(e[n].type!="touchend"){return null}var r=[e[t].touches[0].clientX,e[t].touches[0].clientY];r.timeTouchDown=e[n].timeStamp-e[t].timeStamp;return r};e.processtouchend=function(t){if(e.m_DesignVO){if(e.DispatchEvent(t,"sapup")==true){return}}if(!e.m_Touches.length){return}if(t.m_delayedExamination){e.m_Touches.pop()}if(VBI.m_bTrace){VBI.Trace("touchend")}window.clearInterval(e.m_ContextMenuTimer);e.m_ContextMenuTimer=null;if(e.DispatchEvent(t,"sapup")==true){e.m_Touches=[];return}var r=e.GetInternalDivClientRect();if(r.width!=e.m_nDivWidth||r.height!=e.m_nDivHeight){e.resizeCanvas(0)}e.m_Touches.push(t);var o;if(o=e.IsDoubleTap(e.m_Touches)){if(e.DispatchEvent(t,"sapdblclick")==true){e.m_Touches=[];t.stopPropagation();return}if(!e.m_SuppressedNavigation.zoom){e.AnimateZoom(true,o[0],o[1],5)}e.m_Touches=[]}else if(o=e.IsTwoFingerTap(e.m_Touches)){if(!e.m_SuppressedNavigation.zoom){e.AnimateZoom(false,o[0],o[1],5)}e.m_Touches=[]}else{if(!(e.m_nInputMode==VBI.InputModeTrackMap)){e.InternalRenderLayer(e.m_Canvas[e.m_nOverlayIndex],false,true,true,e.m_Canvas[0].m_nExactLOD)}}if(e.m_Touches.length>2){e.m_Touches.splice(0,e.m_Touches.length-2)}e.SetInputMode(VBI.InputModeDefault);if(o=e.IsSingleTap(e.m_Touches)){if(o.timeTouchDown<300&&!t.m_delayedExamination){e.m_TapTimer=window.setInterval(function(){t.m_delayedExamination=true;e.processtouchend(t);window.clearInterval(e.m_TapTimer)},300)}else{if(e.DispatchEvent(t,"sapclick")){e.m_Touches=[];t.stopPropagation();return}var i,s=e.m_Ctx.m_Actions;if(s){if(i=s.findAction("Click",e,"Map")){var a=e.GetInternalDivClientRect();e.m_Ctx.FireAction(i,e,"Map",null,{x:o[0]-a.left,y:o[1]-a.top})}}e.m_Touches=[]}}if(!n){t.preventDefault()}};e.processtouchcancel=function(t){if(VBI.m_bTrace){VBI.Trace("touchcancel")}if(e.DispatchEvent(t,"sapup")==true){return}e.SetInputMode(VBI.InputModeDefault);if(!n){t.preventDefault()}};e.processtouchmove=function(t){if(VBI.m_bTrace){VBI.Trace("touchmove")}if(e.m_DesignVO){if(e.DispatchEvent(t,"sapmove")==true){return}}if(!e.m_Touches.length||!e.m_currentMouseX){return}var r,o,i={},s;if(t.touches.length==1){i=t.touches[0];r=i.clientX-e.m_currentMouseX;o=i.clientY-e.m_currentMouseY;if(e.m_TouchStarted){var a=sap.ui.Device.support.retina?4:2;if(Math.abs(r)<a||Math.abs(o)<a){t.stopPropagation();return true}else{e.m_TouchStarted=false;e.m_currentMouseX=i.clientX;e.m_currentMouseY=i.clientY}}}if(VBI.m_bIsAndroid&&t.touches.length==2){var c=t.touches[0];s=t.touches[1];r=c.clientX+s.clientX-2*e.m_currentMouseX;o=c.clientY+s.clientY-2*e.m_currentMouseY;if(r==0&&o==0){t.stopPropagation();return true}}e.m_Touches.m_bMoveWasDone=true;window.clearInterval(e.m_ContextMenuTimer);e.m_ContextMenuTimer=null;var u=false;e.m_nTapCount=0;e.SetInputMode(VBI.InputModeTrackMap);if(t.touches.length==1){e.RestartContextMenuTimer(t,i,1100);if(VBI.m_bTrace){VBI.Trace("ontouchmove "+"X1:"+i.pageX+"Y1:"+i.pageY)}e.m_currentMouseX=i.clientX;e.m_currentMouseY=i.clientY;e.MoveMap(r,o);u=true}else if(t.touches.length==2&&!e.m_SuppressedNavigation.zoom){var m=e.GetInternalDivClientRect();if(m.width!=e.m_nDivWidth||m.height!=e.m_nDivHeight){e.resizeCanvas(0)}s=t.touches[0];var l=t.touches[1];var p=s.clientX+(l.clientX-s.clientX)/2;var f=s.clientY+(l.clientY-s.clientY)/2;var _=e.m_Canvas[0].getBoundingClientRect();p-=_.left;f-=_.top;var h=Math.sqrt(Math.pow(s.clientX-l.clientX,2)+Math.pow(s.clientY-l.clientY,2));if(Math.abs(e.m_currentTouchDistance-h)>10){var d=h>e.m_currentTouchDistance?true:false;e.m_currentTouchDistance=h;if(VBI.m_bTrace){VBI.Trace("ontouchmove "+" X1:"+s.pageX+" Y1:"+s.pageY+" X2:"+l.pageX+" Y2:"+l.pageY)}e.ZoomMap(d?e.m_nLodFactorZoomIn:e.m_nLodFactorZoomOut,p,f,e.m_nTicksInALod);e.TriggerReRenderTimer(400)}u=true}if(u&&!n){t.stopPropagation();return true}};e.SetInputModeTrackMap=function(t){if(!t){e.m_currentMouseX=0;e.m_currentMouseY=0}};this.subscribe()};VBI.SceneEvent=function(e,t){this.m_DeviceHandlers=[];VBI.m_bMouseSupported=false;this.m_Events=["mousedown","mouseup","mousemove","mousewheel","wheel","mouseout","click","dblclick","contextmenu","selectstart","dragstart","dragenter","dragover","dragleave","drop","dragend","keydown","keypress","keyup"];t.dropzone="true";if(sap.ui.Device.support.pointer&&navigator.msMaxTouchPoints){this.m_DeviceHandlers.push(new VBI.ScenePointerEvents(e,t))}this.clear=function(){var e;for(e=0;e<this.m_DeviceHandlers.length;++e){this.m_DeviceHandlers[e].clear()}this.m_DeviceHandlers=[];for(e=0;e<this.m_Events.length;++e){var n="on"+this.m_Events[e];if(t[n]){t[n]=null}}};this.subscribe=function(){var n=this.m_Events;for(var r=0,o=n.length;r<o;++r){var i;if(n[r].slice(0,2)=="ms"){i="process"+n[r].slice(2)}else if(e.m_SuppressedNavigation.zoom&&(n[r]==="wheel"||n[r]==="mousewheel")){continue}else{i="process"+n[r]}if(!e[i]){jQuery.sap.log.error("Handler "+i+" not defined")}t["on"+n[r]]=e[i]}};if(sap.ui.Device.support.touch&&!(sap.ui.Device.support.pointer&&navigator.msMaxTouchPoints)){this.m_DeviceHandlers.push(new VBI.SceneTouchEvents(e,t));if(!sap.ui.Device.system.desktop){return}}VBI.m_bMouseSupported=true;e.SetInputModeTrackMap=function(t){if(t){document.addEventListener("mouseup",e.processmouseup,true);document.addEventListener("mousemove",e.processmousemove,true)}else{e.m_currentMouseX=0;e.m_currentMouseY=0;document.removeEventListener("mouseup",e.processmouseup,true);document.removeEventListener("mousemove",e.processmousemove,true)}};e.onsapdown=function(t){if(VBI.m_bTrace){VBI.Trace("scene.onsapdown")}e.m_currentMouseDownX=t.clientX;e.m_currentMouseDownY=t.clientY;e.m_currentMouseX=t.clientX;e.m_currentMouseY=t.clientY;if(e.DispatchEvent(t,"sapdown")==true){return true}};e.onsapup=function(t){if(VBI.m_bTrace){VBI.Trace("scene.onsapup")}if(e.DispatchEvent(t,"sapup")==true){return}if(e.vbiclass=="3DScene"){return}e.SetInputMode(VBI.InputModeDefault);t.preventDefault();return false};e.onsapclick=function(t){if(VBI.m_bTrace){VBI.Trace("scene.onsapclick")}var n=e.m_currentMouseDownX-t.clientX;var r=e.m_currentMouseDownY-t.clientY;if(n*n+r*r<=5){if(VBI.m_bTrace){VBI.Trace("process click dispatch")}if(e.DispatchEvent(t,"sapclick")==true){if(VBI.m_bTrace){VBI.Trace("process click handled in dispatch")}return}if(e.Click){var o=e.m_Canvas[e.m_nOverlayIndex].getBoundingClientRect();t.m_clientX=t.clientX-o.left;t.m_clientY=t.clientY-o.top;if(e.Click(t)){return}}var i,s=e.m_Ctx.m_Actions;if(s){if(i=s.findAction("Click",e,"Map")){e.m_Ctx.FireAction(i,e,"Map",null,e.GetEventVPCoordsObj(t))}t.preventDefault()}}};e.onsapmove=function(t){if(VBI.m_bTrace){VBI.Trace("scene.onsapmove")}if(e.DispatchEvent(t,"sapmove")==true){return true}if(e.vbiclass=="3DScene"){return true}e.SetToolTip("");e.SetCursor("default");e.InternalSetHotItem(null,null);return false};e.processmousedown=function(t){if(VBI.m_bTrace){VBI.Trace("scene.processmousedown")}if(e.m_Gesture){return}if(e.onsapdown(t)){return}if(e.vbiclass=="3DScene"){return}if(!e.m_SuppressedNavigation.move&&t.type.indexOf("pointer")<0&&(!sap.ui.Device.os.macintosh||t.which==1)){if(VBI.m_bTrace){VBI.Trace("set input mode track map")}e.SetInputMode(VBI.InputModeTrackMap);e.m_Canvas[e.m_nLabelIndex].focus({preventScroll:true})}};e.BuildKeyEventParams=function(e){return{key:e.key,code:e.keyCode,shift:e.shiftKey,ctrl:e.ctrlKey,alt:e.altKey,meta:e.metaKey}};e.processkeyup=function(t){if(VBI.m_bTrace){VBI.Trace("scene.processkeyup")}if(t.code==undefined){t.code=t.keyCode}var n=e.m_KeysDown.indexOf(t.code);var r=e.m_KeysSkipUp.indexOf(t.code);var o=e.m_KeysSkipPress.indexOf(t.code);if(n!=-1){e.m_KeysDown.splice(n,1)}if(o!=-1){e.m_KeysSkipPress.splice(o,1)}if(r!=-1){e.m_KeysSkipUp.splice(r,1);return}if(e.m_Ctx.m_Actions){var i=e.m_Ctx.m_Actions.findAction("KeyUp",e);if(i){e.m_Ctx.FireAction(i,e,this,null,e.BuildKeyEventParams(t))}}};e.processkeypress=function(t){if(VBI.m_bTrace){VBI.Trace("scene.processkeypress")}if(t.code==undefined){t.code=t.keyCode}var n=e.m_KeysSkipPress.indexOf(t.code);if(n!=-1){e.m_KeysSkipPress.splice(n,1);return}if(e.m_KeysDown.indexOf(t.code)==-1){return}if(e.m_Ctx.m_Actions){var r=e.m_Ctx.m_Actions.findAction("KeyPress",e);if(r){e.m_Ctx.FireAction(r,e,this,null,e.BuildKeyEventParams(t))}}};e.processkeydown=function(t){if(VBI.m_bTrace){VBI.Trace("scene.processkeydown")}if(e.DispatchEvent(t,"sapkeydown")==true){return}t.m_Repeat=t.repeat;if(t.code==undefined){t.code=t.keyCode}if(e.m_KeysDown.indexOf(t.code)!=-1){t.m_Repeat=true}else{e.m_KeysDown.push(t.code)}if(t.m_Repeat&&!e.m_Ctx.m_Control.getAllowKeyEventRepeat()){if(e.m_KeysSkipPress.indexOf(t.code)==-1){e.m_KeysSkipPress.push(t.code)}return}if(t.code==e.m_lastKey&&e.m_lastKeyDown!=null&&Date.now()-e.m_lastKeyDown<e.m_Ctx.m_Control.getKeyEventDelay()){if(e.m_KeysSkipPress.indexOf(t.code)==-1){e.m_KeysSkipPress.push(t.code)}if(!t.m_Repeat){if(e.m_KeysSkipUp.indexOf(t.code)==-1){e.m_KeysSkipUp.push(t.code)}}return}e.m_lastKey=t.code;e.m_lastKeyDown=Date.now();var n=e.GetInternalDivClientRect();if(n.width!=e.m_nDivWidth||n.height!=e.m_nDivHeight){e.resizeCanvas(0)}var r=true;if(e.m_Ctx.m_Actions){var o=e.m_Ctx.m_Actions.findAction("KeyDown",e);if(o){r=e.m_Ctx.FireAction(o,e,this,null,e.BuildKeyEventParams(t),null,true)}}if(r){var i=false;switch(t.keyCode){case 72:e.GoToInitialStart();i=true;break;case 90:e.endTrackingMode();new e.RectangularZoom;e.m_Ctx.onChangeTrackingMode(VBI.InputModeRectZoom,true);i=true;break;case 82:e.endTrackingMode();new e.RectSelection;e.m_Ctx.onChangeTrackingMode(VBI.InputModeRectSelect,true);i=true;break;case 65:e.endTrackingMode();new e.LassoSelection;e.m_Ctx.onChangeTrackingMode(VBI.InputModeLassoSelect,true);i=true;break}if(!e.m_SuppressedNavigation.zoom){var s=0;switch(t.keyCode){case 107:case 171:case 187:s=1;break;case 109:case 173:case 189:s=-1;break}if(s!=0){var a=e.GetCenterPos();var c=e.getCanvas().m_nExactLOD;var u=e.GetMinLOD();if(s>0&&c==u&&c!=Math.ceil(c)){c=Math.ceil(c)}else{c+=s}e.AnimateZoomToGeo(a,Math.round(c),5);i=true}}if(!e.m_SuppressedNavigation.move){var m=20;switch(t.keyCode){case 37:e.MoveMap(m,0);i=true;break;case 39:e.MoveMap(-m,0);i=true;break;case 38:e.MoveMap(0,m);i=true;break;case 40:e.MoveMap(0,-m);i=true;break}}if(i){t.preventDefault()}}};e.processcontextmenu=function(t){if(t.target!=e.m_Canvas[e.m_nLabelIndex]){return}if(VBI.m_bTrace){VBI.Trace("scene.processcontextmenu")}if(e.DispatchEvent(t,"sapsecclick")==true){return}var n,r=e.m_Ctx.m_Actions;if(r){if(n=r.findAction("ContextMenu",e,"Map")){e.m_Ctx.FireAction(n,e,"Map",null,e.GetEventVPCoordsObjWithScene(t))}t.preventDefault()}};e.processmouseout=function(t){if(VBI.m_bTrace){VBI.Trace("scene.processmouseout")}if(e.DispatchEvent(t,"sapout")==true){return}e.InternalSetHotItem(null,null);return false};e.processdblclick=function(t){if(VBI.m_bTrace){VBI.Trace("scene.processdblclick")}if(e.DispatchEvent(t,"sapdblclick")==true){return}return};e.processclick=function(t){if(t.target!=e.m_Canvas[e.m_nLabelIndex]){return}if(VBI.m_bTrace){VBI.Trace("scene.processclick")}if(e.m_Gesture){return}return e.onsapclick(t)};e.processmouseup=function(t){if(VBI.m_bTrace){VBI.Trace("scene.processmouseup")}e.dragclear();return e.onsapup(t)};e.processmousemove=function(t){if(VBI.m_bTrace){VBI.Trace("scene.processmousemove")}if(e.m_DragInfo){if(e.m_DragInfo.bDragStart){return false}return}var n=t.clientX-e.m_currentMouseX;var r=t.clientY-e.m_currentMouseY;e.m_currentMouseX=t.clientX;e.m_currentMouseY=t.clientY;if(e.m_Gesture){return}if(e.onsapmove(t)){return}if(e.m_nInputMode==VBI.InputModeTrackMap){if(!(t.buttons==1||t.which==1)){e.SetInputMode(VBI.InputModeDefault);return false}if(n||r){e.MoveMap(n,r)}return false}t.preventDefault()};e.processmousewheel=function(t){e.processcommonwheel(t,t.wheelDelta);return false};e.processwheel=function(t){e.processcommonwheel(t,-t.deltaY);return false};e.processcommonwheel=function(t,n){var r=e.m_Canvas[e.m_nLabelIndex].getBoundingClientRect();t.m_OffsetX=t.clientX-r.left;t.m_OffsetY=t.clientY-r.top;t.m_Delta=n;var o=Date.now();if(e.m_LastCWEvent!=undefined&&o-e.m_LastCWEvent<200){return}e.m_LastCWEvent=o;if(VBI.m_bTrace){VBI.Trace("processcommonwheel")}if(e.DispatchEvent(t)==true){return}if(e.vbiclass=="3DScene"){t.preventDefault()}else if(!e.m_SuppressedNavigation.zoom&&t.m_Delta){var r=e.GetInternalDivClientRect();if(r.width!=e.m_nDivWidth||r.height!=e.m_nDivHeight){e.resizeCanvas(0)}if(e.m_nZoomMode){var i=e.m_Canvas[0].getBoundingClientRect();e.AnimateZoom(t.m_Delta>0,t.m_OffsetX+i.left,t.m_OffsetY+i.top,5,t)}else{e.ZoomMap(t.m_Delta>0?e.m_nLodFactorZoomIn:e.m_nLodFactorZoomOut,t.m_OffsetX,t.m_OffsetY,e.m_nTicksInALod)}t.preventDefault()}return};e.dragclear=function(t){var n=document.getElementById(e.m_Target.id+"-transparentImg");if(n){e.m_Div.removeChild(n)}e.m_DragInfo=null;VBI.m_DndTarget=null};e.processdragleave=function(e){return};e.processdragend=function(t){t.preventDefault();t.stopPropagation();e.dragclear();return true};e.processselectstart=function(t){if(t.target.dragDrop&&e.m_DragInfo){t.target.dragDrop()}t.preventDefault();return true};e.processdragstart=function(t){if(e.m_DragInfo){if(e.m_DragInfo.strExtData){t.dataTransfer.setData("text",e.m_DragInfo.strExtData)}else{t.dataTransfer.setData("text","")}t.dataTransfer.effectAllowed="copy";e.m_DragInfo.bDragStart=true;VBI.m_DndTarget=t.target;if(t.dataTransfer.setDragImage||VBI.Utilities.SetDragImage){var n=VBI.Utilities.GetTransparentImage();n.id=e.m_Target.id+"-transparentImg";e.m_Div.appendChild(n);if(t.dataTransfer.setDragImage){t.dataTransfer.setDragImage(n,0,0)}else{VBI.Utilities.SetDragImage(n,0,0)}}if(e.m_Gesture){e.m_Gesture.target=null;e.m_Gesture=null}return true}return false};e.processdragenter=function(e){if(!e.dataTransfer){return false}if(e.dataTransfer){try{e.dataTransfer.dropEffect="copy"}catch(e){jQuery.sap.log.warning("scene.processdragenter exception occured: "+e.message)}}e.preventDefault();return true};e.processdragover=function(t){if(!t.dataTransfer){return false}if(e.m_Gesture){return}if(e.m_DragInfo&&e.m_DragInfo.bDragStart){e.DispatchEvent(t,"sapdrag")}else{t.preventDefault()}return};e.DesignCreateObject=function(t,n,r){var o=null;if(typeof t=="string"){o=t}else{o=JSON.stringify(t)}if(o.indexOf("{POS}")>=0){if(n){var i=""+n[0]+";"+n[1]+";"+"0.0";var s=o.replace(/{POS}/g,i);r(s)}else{new e.DesignPositionArray(null,o,r,"{POS}",1)}}else if(o.indexOf("{POSARRAY}")>=0){new e.DesignPositionArray(n?[n[0],n[1],0]:null,o,r,"{POSARRAY}",null)}else{r(t)}return};e.processdrop=function(t){if(!t.dataTransfer){e.dragclear();return false}if(e.m_DragInfo&&e.m_DragInfo.bDragStart){e.DispatchEvent(t,"sapdrop");t.preventDefault();t.stopPropagation();e.dragclear();return true}var n=t.dataTransfer.getData("text");var r=e.m_Canvas[0].getBoundingClientRect();var o=e.GetPosFromPoint([t.clientX-r.left,t.clientY-r.top,0]);var i=null,s=e.m_Ctx.m_Actions;if(s){i=e.m_Ctx.m_Actions.findAction("Drop",e,"Map")}var a=null;if(i){a=function(n){var r=e.GetEventVPCoordsObj(t);r.content=n;e.m_Ctx.FireAction(i,e,"Map",null,r)}}else{a=e.m_Ctx.m_Control.load.bind(e.m_Ctx.m_Control)}e.DesignCreateObject(n,o,a);t.preventDefault();t.stopPropagation();e.dragclear();return true};e.DesignTrack=function(t){this.m_Tcx=t;this.onsapkeydown=function(e){if(e.keyCode==27){this.UnHook(false);e.preventDefault();return true}};this.onsapclick=function(e){if(VBI.m_bTrace){VBI.Trace("Track sapclick")}this.UnHook();return false};this.onsapdown=function(e){if(VBI.m_bTrace){VBI.Trace("Track sapdown")}e.preventDefault();return true};this.onsapmove=function(e){if(VBI.m_bTrace){VBI.Trace("Track sapmove")}var t=this.m_Tcx;t.m_ClientX=e.offsetX;t.m_ClientY=e.offsetY;if(t.m_CBDrag){if(VBI.m_bTrace){VBI.Trace("Track sapmove: orig type "+e.type)}t.m_CBDrag(t,e)}e.preventDefault();e.stopPropagation();return true};this.onsapup=function(e){if(VBI.m_bTrace){VBI.Trace("Track sapup")}var t=this.m_Tcx;t.m_ClientX=e.offsetX;t.m_ClientY=e.offsetY;if(t.m_CBDrop){t.m_CBDrop(t,e)}if(t.m_CBEnd){t.m_CBEnd(t,e)}this.UnHook();e.preventDefault();e.stopPropagation();return true};this.Hook=function(){e.SetInputMode(VBI.InputModeTrackObject);e.m_DesignVO=this};this.UnHook=function(){if(e.m_DesignVO!=this){return}if(e.m_nInputMode==VBI.InputModeTrackObject){e.SetInputMode(VBI.InputModeDefault)}else{jQuery.sap.log.error("Wrong InputMode in UnHook: "+e.m_nInputMode)}e.m_DesignVO=null;this.m_Tcx=null;e.RenderAsync(true)};this.Render=function(e,t){return};this.Hook()};e.DesignPositionArray=function(t,n,r,o,i){this.m_PosArray=t?t:[];this.m_PosMove=null;this.m_Func=r;this.m_PlaceHolder=o;e.SetCursor("crosshair");this.onsapkeydown=function(e){if(e.keyCode==27){this.UnHook(false);e.preventDefault();return true}};this.onsapclick=function(t){if(VBI.m_bTrace){VBI.Trace("this.onsapclick "+t.type)}var n=e.m_Canvas[e.m_nOverlayIndex].getBoundingClientRect();var r=e.GetPosFromPoint([t.clientX-n.left,t.clientY-n.top,0]);var o=[r[0],r[1],0];var s=this.m_PosArray.length;var a=s/3;if(a>=1&&this.m_PosArray[s-3]==o[0]&&this.m_PosArray[s-2]==o[1]&&this.m_PosArray[s-1]==o[2]){return true}for(var c=0,u=o.length;c<u;++c){this.m_PosArray.push(o[c])}a=this.m_PosArray.length/3;e.RenderAsync(true);t.preventDefault();if(i&&a>=i){this.UnHook(true)}return true};this.onsapdown=function(e){e.preventDefault();return true};this.onsapmove=function(t){jQuery.sap.log.debug("this.onsapmove");jQuery.sap.log.error("Wrong InputMode in onsapmove: "+e.m_nInputMode);var n=e.m_Canvas[0].getBoundingClientRect();this.m_PosMove=e.GetPosFromPoint([t.clientX-n.left,t.clientY-n.top,0]);e.RenderAsync(true);t.preventDefault();return true};this.onsapdblclick=function(e){this.UnHook(true);return true};this.Hook=function(){e.SetInputMode(VBI.InputModeTrackDesign);e.m_DesignVO=this};this.UnHook=function(t){if(e.m_nInputMode==VBI.InputModeTrackDesign){e.SetInputMode(VBI.InputModeDefault)}else{jQuery.sap.log.error("Wrong InputMode in UnHook: "+e.m_nInputMode)}this.m_PosMove=null;var r=VBI.Types.vector2string(this.m_PosArray);var o=n.replace(new RegExp(this.m_PlaceHolder,"g"),r);e.m_DesignVO=null;e.RenderAsync(true);if(t&&this.m_Func){this.m_Func(o)}};this.Render=function(t,n){var r,o=1;if(!this.m_PosArray.length){return}var i=false;var s=this.m_PosArray.concat(this.m_PosMove);var a=e.GetNearestPosArray(s);var c=e.GetPointArrayFromPosArray(a,false);n.strokeStyle="rgba( 255, 0, 20, 0.5 )";n.lineWidth=o;var u=o*o/2;n.beginPath();var m=[c[0],c[1]];n.moveTo(c[0],c[1]);for(var l=0,p,f;l<c.length/3;++l){r=[c[l*3],c[l*3+1],0];if((p=m[0]-r[0])*p+(f=m[1]-r[1])*f<u){continue}i=true;n.lineTo(r[0],r[1]);m=r}if(i){n.stroke()}};this.Hook()};this.subscribe()};VBI.ThumbnailEvent=function(e,t){this.m_DeviceHandlers=[];this.m_Events=["click","contextmenu"];if(sap.ui.Device.support.touch&&!(sap.ui.Device.support.pointer&&navigator.msMaxTouchPoints)){var n=["touchstart","touchend"];if(!sap.ui.Device.system.desktop){this.m_Events=n}else{this.m_Events=this.m_Events.concat(n)}}this.clear=function(){var e;for(e=0;e<this.m_DeviceHandlers.length;++e){this.m_DeviceHandlers[e].clear()}this.m_DeviceHandlers=[];for(e=0;e<this.m_Events.length;++e){var n="on"+this.m_Events[e];if(t[n]){t[n]=null}}};this.subscribe=function(){var n=this.m_Events;for(var r=0,o=n.length;r<o;++r){var i;if(n[r].slice(0,2)=="ms"){i="process"+n[r].slice(2)}else{i="process"+n[r]}if(!e[i]){jQuery.sap.log.error("Handler "+i+" not defined")}t["on"+n[r]]=e[i]}};e.processclick=function(t){if(VBI.m_bTrace){VBI.Trace("thumbnail.processclick")}var n,r=e.m_Ctx.m_Actions;if(r){if(n=r.findAction("Click",e,"Thumbnail")){e.m_Ctx.FireAction(n,e,"Thumbnail",null,e.GetEventVPCoordsObj(t))}t.preventDefault()}};e.processcontextmenu=function(t){if(VBI.m_bTrace){VBI.Trace("thumbnail.processcontextMenu")}var n,r=e.m_Ctx.m_Actions;if(r){if(n=r.findAction("ContextMenu",e,"Thumbnail")){e.m_Ctx.FireAction(n,e,"Thumbnail",null,e.GetEventVPCoordsObj(t))}t.preventDefault()}};e.onPseudoThumbRightClick=function(t,n){if(VBI.m_bTrace){VBI.Trace("Pseudo Right Click")}var r;if(r=e.m_Ctx.m_Actions.findAction("ContextMenu",e,"Thumbnail")){e.m_Touches=[];var o=e.GetInternalDivClientRect();e.m_Ctx.FireAction(r,e,"Thumbnail",null,{x:n.clientX-o.left,y:n.clientY-o.top,scene:e.m_ID})}};e.RestartThumbnailCMTimer=function(t,n,r){if(e.m_ContextMenuTimer){window.clearInterval(e.m_ContextMenuTimer)}e.m_ContextMenuTimer=window.setInterval(function(){window.clearInterval(e.m_ContextMenuTimer);e.m_ContextMenuTimer=null;e.onPseudoThumbRightClick(t,n)},r)};e.processtouchstart=function(t){var n=true;if(VBI.m_bTrace){VBI.Trace("processtouchstart")}e.m_Touches.push(t);if(t.touches.length==1){var r=t.touches[0];e.m_currentMouseX=r.clientX;e.m_currentMouseY=r.clientY;e.RestartThumbnailCMTimer(t,r,700);n=true}if(n){t.preventDefault();t.stopPropagation();return false}};e.IsSingleTapOnThumb=function(e){if(e.length!=2){return null}var t=e.length-2;var n=e.length-1;if(e[t].type!="touchstart"||e[t].touches.length!=1){return null}if(e[n].type!="touchend"){return null}var r=[e[t].touches[0].clientX,e[t].touches[0].clientY];r.timeTouchDown=e[n].timeStamp-e[t].timeStamp;return r};e.processtouchend=function(t){if(!e.m_Touches.length){return}if(VBI.m_bTrace){VBI.Trace("touchend")}window.clearInterval(e.m_ContextMenuTimer);e.m_ContextMenuTimer=null;e.m_Touches.push(t);var n,r,o=e.m_Ctx.m_Actions;if((n=e.IsSingleTapOnThumb(e.m_Touches))&&o){if(r=o.findAction("Click",e,"Thumbnail")){var i=e.GetInternalDivClientRect();e.m_Ctx.FireAction(r,e,"Thumbnail",null,{x:n[0]-i.left,y:n[1]-i.top})}}e.m_Touches=[];t.stopPropagation();t.preventDefault()};this.subscribe()}});
/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5) (c) Copyright 2009-2012 SAP AG. All rights reserved
 */
sap.ui.predefine("sap/ui/vbm/lib/sapgeolocation", ["./sapvbi"],function(){"use strict";VBI.GeoLocation=function(){var o={};o.vbiclass="GeoLocation";o.m_coords={};o.m_bValid=false;o.m_coords.latiude=0;o.m_coords.longitude=0;o.m_coords.altitude=0;o.m_coords.accuracy=0;o.m_coords.altiudeAccuracy=0;o.m_coords.heading=0;o.m_coords.speed=0;o.m_timestamp=0;o.m_watch=null;o.OnError=function(o){jQuery.sap.log.debug("GeoLocation.OnError: "+(typeof o=="string"?o:"unknown"))};o.OnPosition=function(t){o.m_coords.latiude=t.coords.latitude*Math.PI/180;o.m_coords.longitude=t.coords.longitude*Math.PI/180;o.m_coords.altitude=t.coords.altitude;o.m_coords.accuracy=t.coords.accuracy;o.m_coords.altiudeAccuracy=t.coords.altiudeAccuracy;o.m_coords.heading=t.coords.heading;o.m_coords.speed=t.coords.speed;o.m_timestamp=t.timestamp;o.m_bValid=true;o.OnPositionChanged(o)};o.StartWatch=function(){if(o.watch){return}if(!navigator){return}o.m_watch=navigator.geolocation.watchPosition(o.OnPosition,o.OnError);return};o.StopWatch=function(){if(o.watch){navigator.geolocation.clearWatch(o.watch)}o.watch=null};o.GetWifiScan=function(o,t){var c=VBI.Utilities.CreateWifiObject();if(c){return c.ScanWifi("Scan "+t+","+o,0)}return null};o.OnPositionChanged=null;return o}});
/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5) (c) Copyright 2009-2012 SAP AG. All rights reserved
 */
sap.ui.predefine("sap/ui/vbm/lib/sapgeomath", ["./sapvbi"],function(){"use strict";VBI.MathLib=function(){var a={};a.min_longitude=-Math.PI;a.max_longitude=Math.PI;a.min_latitude=-85.05112878*2*Math.PI/360;a.max_latitude=85.05112878*2*Math.PI/360;a.mercator_for_max_latitude=3.1415942;a.div_mercator_for_max_latitude=.5/a.mercator_for_max_latitude;a.div_max_longitude=1/a.max_longitude;a.earthradius=6378137;a.piDiv180=Math.PI/180;a.One180DivPi=1/a.piDiv180;a.stdWorldBorder=-180;a.CreateGUID=function(){var a=[];for(var t=0;t<8;++t){a[t]=((Math.random()+1)*65536|0).toString(16).substring(1)}return a[0]+a[1]+"-"+a[2]+"-"+a[3]+"-"+a[4]+"-"+a[5]+a[6]+a[7]};a.DegToRad=function(t){return[t[0]*a.piDiv180,t[1]*a.piDiv180]};a.RadToDeg=function(t){return[t[0]*a.One180DivPi,t[1]*a.One180DivPi]};a.LonLatToUCS=function(t,r){var i=r[0];var n=r[1];var e=t[0];var o=t[1];if(o<a.min_latitude){o=a.min_latitude}else if(o>a.max_latitude){o=a.max_latitude}r[0]=e*a.div_max_longitude;r[0]=(r[0]+1)*i*.5;var v=Math.sin(o);r[1]=Math.log((1+v)/(1-v))*a.div_mercator_for_max_latitude;r[1]=.5*n*(1-r[1]);return r};a.UCSToLonLat=function(t,r){r[0]=t[0]*Math.PI;r[1]=Math.atan(a.sinh(-t[1]*a.mercator_for_max_latitude));return r};a.sinh=function(a){var t=Math.pow(Math.E,a);var r=Math.pow(Math.E,-a);return(t-r)/2};a.Distance=function(t,r){var i=a.earthradius;var n=t[1];var e=t[0];var o=r[1];var v=r[0];var f=o-n;var h=v-e;var M=Math.sin(f/2)*Math.sin(f/2)+Math.cos(n)*Math.cos(o)*Math.sin(h/2)*Math.sin(h/2);var u=2*Math.atan2(Math.sqrt(M),Math.sqrt(1-M));var s=i*u;return s};a.EquidistantLonLat=function(t,r,i){var n=[];i=i||64;var e,o,v;var f=r/a.earthradius;var h=t[0];var M=t[1];var u=Math.sin(f);var s=Math.cos(f);var d=Math.sin(M);var l=Math.cos(M);var _=h,m=h;var c=M,g=M;for(var x=0;x<i;++x){e=x*2*Math.PI/i;o=Math.asin(d*s+l*u*Math.cos(e));v=h+Math.atan2(Math.sin(e)*u*l,s-d*Math.sin(o));if(_>v){_=v}if(m<v){m=v}if(c>o){c=o}if(g<o){g=o}n.push([v,o])}n.m_MinX=_;n.m_MaxX=m;n.m_MinY=c;n.m_MaxY=g;return n};a.GetSurroundingBox=function(t,r,i,n,e){var o=100;var v=a.stdWorldBorder;if(r==undefined){r=360}var f=t[0].length==2;var h=0,M=1,u=2,s=3;if(f){M=0;u=s=1}var d=Number.MAX_VALUE,l=-Number.MAX_VALUE;var _,m,c,g,x;for(x=0;x<t.length;++x){c=t[x];if((_=c[h])<-180||_>180){g=Math.floor((_+180)/360);_=c[h]-=360*g;c[M]-=360*g}if((m=c[M])<_){g=Math.ceil((_-m)/360);m=c[M]+=360*g}if(c[u]<d){d=c[u]}if(c[s]>l){l=c[s]}}t.sort(function(a,t){return a[0]-t[0]});var D=-1,L=-1;var p=-1,P=-1;var b,I;var E=t[0];var U,A=E[M],B=E[h];var N,S;for(x=1;x<t.length;++x){E=t[x];B=E[h];U=E[M];if(B<A){if(U>A){A=U}}else{if(B-A>D){b=A;D=B-A;p=x}if(B-A>L){N=Math.abs((B-v+540)%360-180);S=Math.abs((A-v+540)%360-180);if(N<o||S<o){I=A;L=B-A;P=x}}A=U}}E=t[0];B=E[h];var T=B-A+360;if(T>L){N=Math.abs((B-v+540)%360-180);S=Math.abs((A-v+540)%360-180);if(N<o||S<o){I=A;L=T;P=0}}if(T>D){D=T;b=A}else{if(p<0){return[v,v+360,d,l,false]}E=t[p]}b-=360*Math.floor((b+180)/360);var X=Math.floor(i)+1;var q=i==undefined?0:360/Math.pow(2,X-i);var w=1e3;if(r==0){r=q;if(n!=undefined){w=Math.floor(n(d,l))}}var C=b-E[h]+360*(b<E[h]);var O=false;if(i!=undefined){var V=Math.floor(X+Math.log(q/(360-D))/Math.LN2);if(C>r||Math.min(V,w)<=i+e){return[v,v+360,d,l,false]}if(q&&L>=0){var G=Math.floor(X+Math.log(q/(360-L))/Math.LN2);O=V==G||V<=G}if(O){E=t[P];b=I-360*Math.floor((I+180)/360)}}return[E[h],b,d,l]};return a}()});
/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5) (c) Copyright 2009-2012 SAP AG. All rights reserved
 */
sap.ui.predefine("sap/ui/vbm/lib/sapgeotool", ["./sapvbi"],function(){"use strict";VBI.QuadTree=function(n,t,r){var i=0,e=1,u=2,c=3,f=4;var a=function(n,t,r,o){var s=[];var h=[];return{quc:function(n,t){var r;for(var i=0,e=h.length;i<e;++i){r=h[i];if(r[0]>n[2]||r[2]<n[0]||r[1]>n[3]||r[3]<n[1]){continue}t(r)}if(s.length){this.calcIntersectingNodes(n,t)}},qua:function(n,t){this.quc(n,function(n){t.push(n)})},calcIntersectingNodes:function(t,r){var f=n[0],a=n[1],o=(n[2]-f)/2,h=(n[3]-a)/2;if(t[0]<f+o){if(t[1]<a+h){s[i].quc(t,r)}if(t[3]>=a+h){s[u].quc(t,r)}}if(t[2]>=f+o){if(t[1]<a+h){s[e].quc(t,r)}if(t[3]>=a+h){s[c].quc(t,r)}}},calcQuadrant:function(t){var r,a,o=(n[2]-(r=n[0]))/2,s=(n[3]-(a=n[1]))/2;if(t[2]<r+o){if(t[3]<a+s){return i}if(t[1]>=a+s){return u}return f}if(t[0]>=r+o){if(t[3]<a+s){return e}if(t[1]>=a+s){return c}return f}return f},subdivide:function(){var t=n[0];var f=n[1];var l=(n[2]-t)/2,v=(n[3]-f)/2;var g=++this.m_D;var d,q;s[i]=a([d=t,q=f,d+l,q+v],g,r,o);s[e]=a([d=t+l,q=f,d+l,q+v],g,r,o);s[u]=a([d=t,q=f+v,d+l,q+v],g,r,o);s[c]=a([d=t+l,q=f+v,d+l,q+v],g,r,o);var m=h;h=[];for(var _=0,R=m.length;_<R;++_){this.insert(m[_])}},insert:function(n){var t;if(s.length){if((t=this.calcQuadrant(n))==f){h.push(n)}else{s[t].insert(n)}}else{h.push(n);if(h.length>r&&this.m_D<o){this.subdivide()}}},clear:function(){for(var n=0,t=s.length;n<t;++n){s[n].clear()}h.length=0;s.length=0},getNodes:function(){return s.length?s:null},m_R:n,m_D:t}};return{insertArray:function(n){for(var t=0,r=n.length;t<r;++t){this.m_Root.insert(n[t])}},insert:function(n){this.m_Root.insert(n)},queryArray:function(n,t){return this.m_Root.qua(n,t)},queryCallback:function(n,t){return this.m_Root.quc(n,t)},clear:function(){this.m_Root.clear()},m_Root:function(){return a(r,0,n,t)}()}}});
/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5) (c) Copyright 2009-2012 SAP AG. All rights reserved
 */
sap.ui.predefine("sap/ui/vbm/lib/sapheatmap", ["./sapvbi"],function(){"use strict";VBI.Tex=null;VBI.Shader=null;VBI.FB=null;VBI.Vals=null;VBI.Ro=null;VBI.Hm=null;VBI.Hook=function(){if(window.WebGLRenderingContext){var t=WebGLRenderingContext.prototype.getExtension;WebGLRenderingContext.prototype.getExtension=function(i){var e=["","MS","WEBKIT","MOZ","O"];var s,r;if((s=t.call(this,i))===null){for(var h=0,n=e.length;h<n;++h){r=e[h];if((s=t.call(this,r+"_"+i))!==null){return s}}return null}else{return s}};WebGLRenderingContext.prototype.getExtensions=function(t){return this.getExtension("OES_texture_float")}}}();VBI.Shader=function(){function t(t,i,e){this.m_GL=t;this.m_UL={};this.m_Prog=this.m_GL.createProgram();this.m_VS=this.m_GL.createShader(this.m_GL.VERTEX_SHADER);this.m_FS=this.m_GL.createShader(this.m_GL.FRAGMENT_SHADER);this.m_GL.attachShader(this.m_Prog,this.m_VS);this.Compile(this.m_VS,i);this.m_GL.attachShader(this.m_Prog,this.m_FS);this.Compile(this.m_FS,e);this.Link()}t.prototype.getShaderVar=function(t){return this.m_GL.getAttribLocation(this.m_Prog,t)};t.prototype.Compile=function(t,i){this.m_GL.shaderSource(t,i);this.m_GL.compileShader(t);if(!this.m_GL.getShaderParameter(t,this.m_GL.COMPILE_STATUS)){jQuery.sap.log.error("Shader Compilation Error");jQuery.sap.log.error(this.m_GL.getShaderInfoLog(t))}};t.prototype.Link=function(){this.m_GL.linkProgram(this.m_Prog);if(!this.m_GL.getProgramParameter(this.m_Prog,this.m_GL.LINK_STATUS)){jQuery.sap.log.error("Shader Link Error");jQuery.sap.log.error(this.m_GL.getProgramInfoLog(this.m_Prog))}};t.prototype.Apply=function(){this.m_GL.useProgram(this.m_Prog);return this};t.prototype.getLoc=function(t){var i=this.m_UL[t];if(typeof i==="undefined"){i=this.m_UL[t]=this.m_GL.getUniformLocation(this.m_Prog,t)}return i};t.prototype.SetInt=function(t,i){this.m_GL.uniform1i(this.getLoc(t),i);return this};return t}();VBI.FB=function(){function t(t){this.m_GL=t;this.m_FB=this.m_GL.createFramebuffer()}t.prototype.destroy=function(){return this.m_GL.deleteFramebuffer(this.m_FB)};t.prototype.BindFB=function(){this.m_GL.bindFramebuffer(this.m_GL.FRAMEBUFFER,this.m_FB);return this};t.prototype.UnBindFB=function(){this.m_GL.bindFramebuffer(this.m_GL.FRAMEBUFFER,null);return this};t.prototype.SetTex=function(t){this.m_GL.framebufferTexture2D(this.m_GL.FRAMEBUFFER,this.m_GL.COLOR_ATTACHMENT0,this.m_GL.TEXTURE_2D,t.m_Tex,0);var i=this.m_GL.checkFramebufferStatus(this.m_GL.FRAMEBUFFER);if(i!==this.m_GL.FRAMEBUFFER_COMPLETE){return null}return this};return t}();VBI.Tex=function(){function t(t,i){var e;this.m_GL=t;i=i?i:{};this.m_colFmt=this.m_GL[((e=i.colfmt)!=null?e:"rgba").toUpperCase()];if(typeof i.type==="number"){this.type=i.type}else{this.type=this.m_GL[((e=i.type)!=null?e:"unsigned_byte").toUpperCase()]}this.m_Tex=this.m_GL.createTexture()}t.prototype.destroy=function(){return this.m_GL.deleteTexture(this.m_Tex)};t.prototype.BindTex=function(t){if(t==null){t=0}this.m_GL.activeTexture(this.m_GL.TEXTURE0+t);this.m_GL.bindTexture(this.m_GL.TEXTURE_2D,this.m_Tex);return this};t.prototype.AdjustSize=function(t,i){this.m_W=t;this.m_H=i;this.m_GL.texImage2D(this.m_GL.TEXTURE_2D,0,this.m_colFmt,t,i,0,this.m_colFmt,this.type,null);return this};t.prototype.SetImage=function(t){this.m_W=t.width;this.m_H=t.height;this.m_GL.texImage2D(this.m_GL.TEXTURE_2D,0,this.m_colFmt,this.m_colFmt,this.type,t);return this};t.prototype.SetFilterNearest=function(){this.m_GL.texParameteri(this.m_GL.TEXTURE_2D,this.m_GL.TEXTURE_MAG_FILTER,this.m_GL.NEAREST);this.m_GL.texParameteri(this.m_GL.TEXTURE_2D,this.m_GL.TEXTURE_MIN_FILTER,this.m_GL.NEAREST);return this};t.prototype.SetWrapEdge=function(){this.m_GL.texParameteri(this.m_GL.TEXTURE_2D,this.m_GL.TEXTURE_WRAP_S,this.m_GL.CLAMP_TO_EDGE);this.m_GL.texParameteri(this.m_GL.TEXTURE_2D,this.m_GL.TEXTURE_WRAP_T,this.m_GL.CLAMP_TO_EDGE);return this};return t}();VBI.Ro=function(){function t(t,i,e){this.m_GL=t;this.m_W=i;this.m_H=e;var s=this.m_GL.getExtensions();var r=null;if(s){r=this.m_GL.FLOAT}this.m_Tex=new VBI.Tex(this.m_GL,{type:r});this.m_Tex.BindTex(0);this.m_Tex.AdjustSize(i,e);this.m_Tex.SetFilterNearest();this.m_Tex.SetWrapEdge();this.m_FB=new VBI.FB(this.m_GL);this.m_FB.BindFB();if(!this.m_FB.SetTex(this.m_Tex)){this.m_FB.UnBindFB();this.m_Tex=new VBI.Tex(this.m_GL,{type:null});this.m_Tex.BindTex(0);this.m_Tex.AdjustSize(i,e);this.m_Tex.SetFilterNearest();this.m_Tex.SetWrapEdge();this.m_FB=new VBI.FB(this.m_GL);this.m_FB.BindFB();this.m_FB.SetTex(this.m_Tex);this.m_FB.UnBindFB()}else{this.m_FB.UnBindFB()}}t.prototype.Apply=function(){return this.m_FB.BindFB()};t.prototype.BindRo=function(t){return this.m_Tex.BindTex(t)};t.prototype.UnBindRo=function(){this.m_FB.UnBindFB()};t.prototype.AdjustSize=function(t,i){this.m_W=t;this.m_H=i;return this.m_Tex.BindTex(0).AdjustSize(t,i)};return t}();VBI.Vals=function(){function t(t,i,e){this.m_GL=t;this.m_nPointChunk=10240;this.m_nVertexSize=8;this.m_W=i;this.m_H=e;this.m_Shader=new VBI.Shader(this.m_GL,"uniform vec4 uTM;"+"attribute vec4 aPos;"+"attribute float aValue;"+"varying vec3 vData;"+"void main(){"+"  gl_Position = vec4(aPos.xy * uTM.xy + uTM.zw, 0.0, 1.0);"+"  vData.xy = aPos.zw;"+"  vData.z = aValue;"+"}","#ifdef GL_FRAGMENT_PRECISION_HIGH\n"+"  precision highp int;"+"  precision highp float;\n"+"#else\n"+"  precision mediump int;"+"  precision mediump float;\n"+"#endif\n"+"varying vec3 vData;"+"void main(){"+"  float f = smoothstep(1.0, 0.0, length(vData.xy)) * vData.z;"+"  gl_FragColor = vec4(f);"+"}");this.m_Shader.aPos=this.m_Shader.getShaderVar("aPos");this.m_Shader.aValue=this.m_Shader.getShaderVar("aValue");this.m_Shader.uTM=this.m_Shader.getLoc("uTM");this.m_Ro=new VBI.Ro(this.m_GL,this.m_W,this.m_H);this.m_VB=this.m_GL.createBuffer();this.m_vBuf=new Float32Array(this.m_nPointChunk*this.m_nVertexSize*6);this.m_IB=this.m_GL.createBuffer();var s=new Uint16Array(this.m_nPointChunk*6);for(var r=0,h=0;r<s.length;h+=4){s[r++]=h;s[r++]=h+1;s[r++]=h+2;s[r++]=h+2;s[r++]=h+1;s[r++]=h+3}this.m_GL.bindBuffer(this.m_GL.ELEMENT_ARRAY_BUFFER,this.m_IB);this.m_GL.bufferData(this.m_GL.ELEMENT_ARRAY_BUFFER,s,this.m_GL.STATIC_DRAW);this.m_nIdx=0;this.m_nPoints=0}t.prototype.AdjustSize=function(t,i){this.m_W=t;this.m_H=i;this.m_Ro.AdjustSize(this.m_W,this.m_H);return};t.prototype.Render=function(){if(this.m_nPoints>0){var t=this.m_GL;t.enable(t.BLEND);this.m_Ro.Apply();t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.m_IB);t.bindBuffer(t.ARRAY_BUFFER,this.m_VB);t.bufferData(t.ARRAY_BUFFER,this.m_vBuf,t.STREAM_DRAW);this.m_Shader.Apply();t.enableVertexAttribArray(1);t.vertexAttribPointer(this.m_Shader.aPos,4,t.FLOAT,false,20,0);t.vertexAttribPointer(this.m_Shader.aValue,1,t.FLOAT,false,20,16);t.uniform4f(this.m_Shader.uTM,2/this.m_W,2/this.m_H,-1,-1);t.drawElements(t.TRIANGLES,this.m_nPoints*6,t.UNSIGNED_SHORT,0);t.disableVertexAttribArray(1);this.m_Ro.UnBindRo();t.disable(t.BLEND);this.m_nPoints=0;this.m_nIdx=0}};t.prototype.Clear=function(){this.m_Ro.Apply();this.m_GL.clearColor(0,0,0,0);this.m_GL.clear(this.m_GL.COLOR_BUFFER_BIT);return this.m_Ro.UnBindRo()};t.prototype.AddPoint=function(t,i,e,s){if(this.m_nPoints+1>=this.m_nPointChunk){this.Render()}i=this.m_H-i;this.PushVertex(t-s,i-s,-1,-1,e);this.PushVertex(t+s,i-s,+1,-1,e);this.PushVertex(t-s,i+s,-1,+1,e);this.PushVertex(t+s,i+s,+1,+1,e);this.m_nPoints+=1;return this.m_nPoints};t.prototype.PushVertex=function(t,i,e,s,r){var h=this.m_vBuf;var n=this.m_nIdx;h[n++]=t;h[n++]=i;h[n++]=e;h[n++]=s;h[n++]=r;this.m_nIdx=n};return t}();VBI.Hm=function(){function t(t){var i;var e;var s=t.scene;if(typeof(t.alphaBounds=="undefined")){t.alphaBounds=[0,1]}if(typeof(t.alpha=="undefined")){t.alpha=true}this.m_Canv=t.canvas;this.m_W=t.width;this.m_H=t.height;this.m_aFunc=t.aFunc.toFixed(8);this.m_cFunc=t.cFunc.toFixed(8);if(!this.m_Canv){this.m_Canv=document.createElement("canvas");this.m_Canv.setAttribute("role",sap.ui.core.AccessibleRole.Img)}var r={depth:false,antialias:false,alpha:true};if(!this.m_GL){this.m_GL=this.m_Canv.getContext("experimental-webgl",r)}if(!this.m_GL){this.m_GL=this.m_Canv.getContext("webgl",r)}if(!this.m_GL){jQuery.sap.log.error("WebGL not supported");return}this.m_GL.blendFunc(this.m_GL.ONE,this.m_GL.ONE);this.m_GL.enableVertexAttribArray(0);if(t.colorTexture){this.m_ColorTexture=new VBI.Tex(this.m_GL,{colfmt:"rgba"});this.m_ColorTexture.BindTex(0);this.m_ColorTexture.SetFilterNearest();this.m_ColorTexture.SetWrapEdge();this.m_ColorTexture.AdjustSize(2,2);this.m_ColorTexture.BindTex(0);this.m_ColorTexture.SetImage(t.colorTex);if(!t.colorTex.IsLoaded){s.RenderAsync(false)}e="uniform sampler2D colTex; "+"vec3 calcCol( float g ){ "+"  return texture2D( colTex, vec2( g, 0.5 )).rgb; "+"}"}else{e="vec3 calcCol( float g ){ "+"  return smoothstep( vec3( 0.0, 0.0, 1.0 ), vec3( 1.0, 1.0, 0.0 ), vec3( g ) ); "+"}"}if(t.alpha){i="vec4 calcAlpha(vec3 c,float i){ "+"  float a = smoothstep("+t.alphaBounds[0].toFixed(8)+","+t.alphaBounds[1].toFixed(8)+", pow(i, 1.0)); "+"  return vec4( c*a, a); "+"}"}else{i="vec4 calcAlpha(vec3 c, float i){ "+"  return vec4(c, 1.0);"+"}"}var h="#ifdef GL_FRAGMENT_PRECISION_HIGH \n"+"  precision highp int;"+"  precision highp float; \n"+"#else \n"+"  precision mediump int;"+"  precision mediump float; \n"+"#endif \n"+"uniform sampler2D src;"+"varying vec2 txy;";var n="void main(){ "+"  float f = clamp( texture2D(src, txy).r, 0.0, 1.0 ); "+"  vec3 color = calcCol(pow(f, "+this.m_cFunc+")); "+"  gl_FragColor = calcAlpha(color, pow(f, "+this.m_aFunc+")); "+"}";this.m_Shader=new VBI.Shader(this.m_GL,"attribute vec4 pos; "+"varying vec2 txy; "+"void main(){ "+"  txy = pos.xy * 0.5 + 0.5; "+"  gl_Position = pos; "+"}",h+e+"\n"+i+n);if(this.m_W==null){this.m_W=this.m_Canv.offsetWidth||2}if(this.m_H==null){this.m_H=this.m_Canv.offsetHeight||2}this.m_Canv.width=this.m_W;this.m_Canv.height=this.m_H;var m=new Float32Array([-1,-1,0,1,1,-1,0,1,-1,1,0,1,1,1,0,1]);this.m_Geo=this.m_GL.createBuffer();this.m_GL.viewport(0,0,this.m_W,this.m_H);this.m_GL.bindBuffer(this.m_GL.ARRAY_BUFFER,this.m_Geo);this.m_GL.bufferData(this.m_GL.ARRAY_BUFFER,m,this.m_GL.STATIC_DRAW);this.m_GL.bindBuffer(this.m_GL.ARRAY_BUFFER,null);this.m_V=new VBI.Vals(this.m_GL,this.m_W,this.m_H)}t.prototype.AdjustSize=function(){if(!this.m_GL){return}var t=this.m_Canv.offsetHeight||2;var i=this.m_Canv.offsetWidth||2;if(this.m_W!==i||this.m_H!==t){this.m_GL.viewport(0,0,i,t);this.m_Canv.width=i;this.m_Canv.height=t;this.m_W=i;this.m_H=t;this.m_V.AdjustSize(this.m_W,this.m_H)}};t.prototype.RenderColors=function(){if(!this.m_GL){return}this.m_GL.bindBuffer(this.m_GL.ARRAY_BUFFER,this.m_Geo);this.m_GL.vertexAttribPointer(0,4,this.m_GL.FLOAT,false,0,0);this.m_V.m_Ro.BindRo(0);if(this.m_ColorTexture){this.m_ColorTexture.BindTex(1)}this.m_Shader.Apply();this.m_Shader.SetInt("src",0);this.m_Shader.SetInt("colTex",1);this.m_GL.drawArrays(this.m_GL.TRIANGLE_STRIP,0,4);return};t.prototype.RenderValues=function(){if(!this.m_GL){return}if(this.m_V){this.m_V.Render()}};t.prototype.Render=function(){this.RenderValues();this.RenderColors()};t.prototype.Clear=function(){return this.m_V?this.m_V.Clear():null};t.prototype.AddPoint=function(t,i,e,s){return this.m_V?this.m_V.AddPoint(t,i,e,s):null};return t}();VBI.CreateHM=function(t){return new VBI.Hm(t)}});
/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5) (c) Copyright 2009-2012 SAP AG. All rights reserved
 */
sap.ui.predefine("sap/ui/vbm/lib/saplabels", ["sap/ui/core/IconPool","./sapvbi"],function(t){"use strict";VBI.addSceneLabelFunctions=function(i){i.InternalDrawLabelTexts=function(i,o,e,r){for(var s=0;s<o.m_Pos.length;++s){for(var l=0;l<o.m_Pos[s].length;l++){var m=Math.round(o.m_Height);var n=Math.round(o.m_Width);var a=Math.round(o.m_Pos[s][l][0]);var _=Math.round(o.m_Pos[s][l][1]);var h=o.m_Arrow?o.m_Align:0;var f=o.m_Rounded?m/2:10;var d;i.beginPath();i.lineWidth=2;i.moveTo(a+f,_);if(h==5){o.m_Pos[s][l].tri=[[a+n/2-3,_],[a+n/2,_-5],[a+n/2+3,_]];for(d=0;d<3;++d){i.lineTo(o.m_Pos[s][l].tri[d][0],o.m_Pos[s][l].tri[d][1])}}i.lineTo(a+n-f,_);i.arcTo(a+n,_,a+n,_+f,f);if(h==7&&!o.m_Rounded){o.m_Pos[s][l].tri=[[a+n,_+m/2-3],[a+n+5,_+m/2],[a+n,_+m/2+3]];for(d=0;d<3;++d){i.lineTo(o.m_Pos[s][l].tri[d][0],o.m_Pos[s][l].tri[d][1])}}i.lineTo(a+n,_+m-f);i.arcTo(a+n,_+m,a+n-f,_+m,f);if(h==1){o.m_Pos[s][l].tri=[[a+n/2+3,_+m],[a+n/2,_+m+5],[a+n/2-3,_+m]];for(d=0;d<3;++d){i.lineTo(o.m_Pos[s][l].tri[d][0],o.m_Pos[s][l].tri[d][1])}}i.lineTo(a+f,_+m);i.arcTo(a,_+m,a,_+m-f,f);if(h==3&&!o.m_Rounded){o.m_Pos[s][l].tri=[[a,_+m/2+3],[a-5,_+m/2],[a,_+m/2-3]];for(d=0;d<3;++d){i.lineTo(o.m_Pos[s][l].tri[d][0],o.m_Pos[s][l].tri[d][1])}}i.lineTo(a,_+f);i.arcTo(a,_,a+f,_,f);i.fillStyle=o.m_BgColor;i.fill();if(o.m_BrdrCol){i.strokeStyle=o.m_BrdrCol}else{i.strokeStyle=o.m_BgColor}i.stroke();var c=e.length==1?VBI.Utilities.RemToPixel(.75):VBI.Utilities.RemToPixel(.75)+1;var g=0;for(var P=0;P<e.length;++P){i.fillStyle=e[P];var I=0;for(d=0;d<r.length;d++){I=o.m_Padding[1]+c*d;i.fillText(r[d],a+o.m_Padding[0]+g,_+I+g+7)}g++}if(o.m_Icon){o.m_IcInfo=t.getIconInfo(o.m_Icon);if(o.m_IcInfo){var u=o.m_Align==7&&o.m_Arrow?a:a+n;i.fillStyle=o.m_IcBgrdCol;i.fillRect(u-7,_+m-7,14,14);o.m_Pos[s][l].rc=[u-7,_+m-7,u-7+14,_+m-7+14]}}}}};i.InternalDrawLabels=function(i,o,e,r){for(var s=0;s<o.m_Pos.length;++s){for(var l=0;l<o.m_Pos[s].length;l++){VBI.Utilities.SetTextAttributes(i,VBI.Utilities.RemToPixel(.75)+"px 'Lucida Sans Unicode',sans-serif",undefined,undefined,"start","middle");var m=Math.round(o.m_Height);var n=Math.round(o.m_Width);var a=Math.round(o.m_Pos[s][l][0]);var _=Math.round(o.m_Pos[s][l][1]);var h=o.m_Arrow?o.m_Align:0;var f=o.m_Rounded?m/2:6;var d;i.beginPath();i.lineWidth=2;i.moveTo(a+f,_);if(h==5){o.m_Pos[s][l].tri=[[a+n/2-3,_],[a+n/2,_-5],[a+n/2+3,_]];for(d=0;d<3;++d){i.lineTo(o.m_Pos[s][l].tri[d][0],o.m_Pos[s][l].tri[d][1])}}i.lineTo(a+n-f,_);i.arcTo(a+n,_,a+n,_+f,f);if(h==7&&!o.m_Rounded){o.m_Pos[s][l].tri=[[a+n,_+m/2-3],[a+n+5,_+m/2],[a+n,_+m/2+3]];for(d=0;d<3;++d){i.lineTo(o.m_Pos[s][l].tri[d][0],o.m_Pos[s][l].tri[d][1])}}i.lineTo(a+n,_+m-f);i.arcTo(a+n,_+m,a+n-f,_+m,f);if(h==1){o.m_Pos[s][l].tri=[[a+n/2+3,_+m],[a+n/2,_+m+5],[a+n/2-3,_+m]];for(d=0;d<3;++d){i.lineTo(o.m_Pos[s][l].tri[d][0],o.m_Pos[s][l].tri[d][1])}}i.lineTo(a+f,_+m);i.arcTo(a,_+m,a,_+m-f,f);if(h==3&&!o.m_Rounded){o.m_Pos[s][l].tri=[[a,_+m/2+3],[a-5,_+m/2],[a,_+m/2-3]];for(d=0;d<3;++d){i.lineTo(o.m_Pos[s][l].tri[d][0],o.m_Pos[s][l].tri[d][1])}}i.lineTo(a,_+f);i.arcTo(a,_,a+f,_,f);i.fillStyle=o.m_BgColor;i.fill();i.strokeStyle=o.m_BrdrCol?o.m_BrdrCol:o.m_BgColor;i.stroke();var c=e.length==1?VBI.Utilities.RemToPixel(.75):VBI.Utilities.RemToPixel(.75)+1;var g=0;for(var P=0;P<e.length;++P){i.fillStyle=e[P];var I=0;for(d=0;d<r.length;d++){I=o.m_Padding[1]+c*d;i.fillText(r[d],VBI.m_bIsRtl?a+n-o.m_Padding[0]+g:a+o.m_Padding[0]+g,_+I+g+7)}g++}if(o.m_Icon){o.m_IcInfo=t.getIconInfo(o.m_Icon);if(o.m_IcInfo){var u=o.m_Align==7&&o.m_Arrow?a:a+n;i.fillStyle=o.m_IcBgrdCol;i.fillRect(u-7,_+m-7,14,14);o.m_Pos[s][l].rc=[u-7,_+m-7,u-7+14,_+m-7+14];VBI.Utilities.SetTextAttributes(i,"12px SAP-icons",undefined,undefined,"center","middle");i.fillStyle=o.GetLabelIconColor();i.fillText(o.m_IcInfo.content,u,_+m)}}}}};i.InternalDrawLabelIcons=function(t,i){var o=Math.round(i.m_Height);var e=Math.round(i.m_Width);for(var r=0;r<i.m_Pos.length;++r){for(var s=0;s<i.m_Pos[r].length;s++){var l=Math.round(i.m_Pos[r][s][0]);var m=Math.round(i.m_Pos[r][s][1]);if(i.m_Icon&&i.m_IcInfo){t.fillStyle=i.GetLabelIconColor();var n=i.m_Align==7&&i.m_Arrow?l:l+e;t.fillText(i.m_IcInfo.content,n,m+o)}}}};i.InternalRenderLabels=function(t,o){var e=i.m_VOS;for(var r=0,s=e.length;r<s;++r){var l=e[r].getLabelData(true);for(var m=0;m<l.length;++m){var n=l[m];VBI.Utilities.SetTextAttributes(o,VBI.Utilities.RemToPixel(.75)+"px 'Lucida Sans Unicode',sans-serif",undefined,undefined,"start","middle");n.SetDimensions(o);n.AlignLabel();var a=n.GetLabelTextColor();var _=n.m_Text.split(/\r\n/);var h=i.GetViewport();for(var f=0;f<n.m_Pos.length;f++){for(var d=0;d<n.m_Pos[f].length;d++){var c=n.m_PosArray.pa,g=n.m_Pos[f][d];if(c.length!==3||c[0]>h[0]&&c[0]<h[2]){if(g[0]-h[0]<5){g[0]=h[0]+5}else if(g[0]+n.m_Width>h[2]-5){g[0]=h[2]-n.m_Width-5}if(g[1]-h[1]<5){g[1]=h[1]+5}else if(g[1]+n.m_Height>h[3]-5){g[1]=h[3]-n.m_Height-5}}else{if(g[0]+(n.m_aIO[1]||0)-h[0]<5){g[0]=h[0]+5}else if(g[0]+(n.m_aIO[1]||0)+n.m_Width>h[2]-5){g[0]=h[2]-n.m_Width-5}else{g[0]+=n.m_aIO[1]||0}if(g[1]-h[1]<5){g[1]=h[1]+5}else if(g[1]+n.m_Height>h[3]-5){g[1]=h[3]-n.m_Height-5}}}}i.InternalDrawLabels(o,n,a,_)}}}};VBI.Label=function(t,i,o,e,r,s){this.m_bAligned=false;this.mIndex=i;this.m_aIO=s;this.m_rcBox=r;this.m_Text=t.text;this.m_BgColor=t.bgColor;this.m_BrdrCol=t.brdrCol;this.m_Icon=t.icon;this.m_IcBgrdCol=t.icColor;this.m_IcTextCol=t.icTextColor;this.m_Arrow=t.arrow;this.m_Rounded=t.rounded;this.m_Align=t.Align;this.m_Offset=t.offset;this.m_Padding=[7,5];this.m_ArrowHeight=5;this.m_ArrowWidth=3;this.m_LineWidth=2;this.m_LabelIconColor=null;this.m_PosArray=e;this.m_Pos=[];this.m_Width=0;this.m_Height=0;this.m_LabelTextColor=[];if(!o){var l=Math.floor(this.m_PosArray.pa.length/3)*3;for(var m=0;m<s.length;m++){var n=[];for(var a=0;a<l;a+=3){var _=[this.m_PosArray.pa[a]+s[m],this.m_PosArray.pa[a+1]];n.push(_)}this.m_Pos.push(n)}}this.CalculateLabelPos=o;this.getContrastCol=function(t){var i=(299*250+587*250+114*250)/1e3;var o=(299*t[0]+587*t[1]+114*t[2])/1e3;return Math.abs(o-i)<=125?"#000000":"#FAFAFA"};this.GetLabelTextColor=function(){if(!this.m_LabelTextColor.length){var t=VBI.Types.string2rgba(this.m_BgColor);if(t[3]==0&&t[4]==1){this.m_LabelTextColor[0]="#FFFFFF";this.m_LabelTextColor[1]="#000000"}else{this.m_LabelTextColor[0]=this.getContrastCol(t)}}return this.m_LabelTextColor};this.GetLabelIconColor=function(){if(!this.m_LabelIconColor){if(this.m_IcTextCol){this.m_LabelIconColor=this.m_IcTextCol}else{var t=VBI.Types.string2rgba(this.m_IcBgrdCol);this.m_LabelIconColor=t[3]==0&&t[4]==1?"#000000":this.getContrastCol(t)}}return this.m_LabelIconColor};this.SetDimensions=function(t){if(!this.m_Width||!this.m_Height){var i=this.m_Text.split(/\r\n/);var o=0;var e=0;var r=VBI.Utilities.RemToPixel(.75);for(var s=0;s<i.length;s++){var l=i[s].length;if(l>o){o=l;e=s}}this.m_Width=t.measureText(i[e]).width+this.m_Padding[0]*2;this.m_Height=r*i.length+this.m_Padding[1]*2}};this.AlignLabel=function(){if(!this.m_bAligned){var t=[0,0,0,0];var i;var o=this.m_ArrowHeight+this.m_LineWidth;if(this.m_rcBox){t=this.m_rcBox}for(var e=0;e<this.m_Pos.length;e++){for(var r=0;r<this.m_Pos[e].length;r++){i=this.m_rcBox?[this.m_rcBox[0]+(this.m_rcBox[2]-this.m_rcBox[0])/2,this.m_rcBox[1]+(this.m_rcBox[3]-this.m_rcBox[1])/2]:this.m_Pos[e][r];switch(this.m_Align){case 0:i[0]-=this.m_Width/2;i[1]-=this.m_Height/2;break;case 1:i[0]-=this.m_Width/2;i[1]-=(t[3]-t[1])/2+this.m_Height;if(this.m_Arrow){i[1]-=o}break;case 2:i[0]+=(t[2]-t[0])/2;i[1]-=(t[3]-t[1])/2+this.m_Height;break;case 3:i[0]+=(t[2]-t[0])/2;i[1]-=this.m_Height/2;if(this.m_Arrow&&!this.m_Rounded){i[0]+=o}break;case 4:i[0]+=(t[2]-t[0])/2;i[1]+=(t[3]-t[1])/2;break;case 5:i[0]-=this.m_Width/2;i[1]+=(t[3]-t[1])/2;if(this.m_Arrow){i[1]+=o}break;case 6:i[0]-=(t[2]-t[0])/2+this.m_Width;i[1]+=(t[3]-t[1])/2;break;case 7:i[0]-=(t[2]-t[0])/2+this.m_Width;i[1]-=this.m_Height/2;if(this.m_Arrow&&!this.m_Rounded){i[0]-=o}break;case 8:i[0]-=(t[2]-t[0])/2+this.m_Width;i[1]-=(t[3]-t[1])/2+this.m_Height;break;default:if(VBI.m_bIsRtl){i[0]-=this.m_Width}i[1]+=(t[3]-t[1])/2;break}if(!this.CalculateLabelPos){i[0]+=this.m_aIO[e]}i[0]+=this.m_Offset[0];i[1]+=this.m_Offset[1];this.m_Pos[e][r]=i}}}this.m_bAligned=true};this.clear=function(){this.CalculateLabelPos=null;this.m_Pos=null;this.m_PosArray=null;this.m_rcBox=null;this.m_aIO=null;this.m_LabelTextColor=null;this.m_LabelIconColor=null};return this}});
/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5) (c) Copyright 2009-2012 SAP AG. All rights reserved
 */
sap.ui.predefine("sap/ui/vbm/lib/saplassotrack", ["./sapvbi"],function(){"use strict";VBI.addSceneLassoTrackingFunctions=function(e){e.LassoTracking=function(){this.m_PosMoves=[];this.m_bTrack=false;this.m_keycode=0};e.LassoTracking.prototype.onsapkeydown=function(e){if(e.keyCode==this.m_keycode){this.ExitMode();e.preventDefault();return true}};e.LassoTracking.prototype.onsapdown=function(t){var o=e.m_Canvas[e.m_nOverlayIndex].getBoundingClientRect();var n=e.GetStretchFactor4Mode();this.m_PosMoves.push([(t.clientX-o.left)/n[0],(t.clientY-o.top)/n[1]]);this.m_bTrack=true;if(t.type=="mousedown"){document.addEventListener("mouseup",this,true)}else if(t.type=="touchstart"){document.addEventListener("touchend",this,true)}else if(t.type=="pointerdown"){document.addEventListener("pointerup",this,true)}t.preventDefault();e.m_Canvas[e.m_nLabelIndex].focus({preventScroll:true});return true};e.LassoTracking.prototype.handleEvent=function(t){if(t.type=="mouseup"){document.removeEventListener("mouseup",this,true)}else if(t.type=="touchend"){document.removeEventListener("touchend",this,true)}else if(t.type=="pointerup"){document.removeEventListener("pointerup",this,true);if(e.m_Gesture){e.m_Gesture.pointerCount--;if(!e.m_Gesture.pointerCount){e.m_Gesture.target=null;e.m_Gesture=null}}}this.TrackEnd(t)};e.LassoTracking.prototype.TrackEnd=function(t){if(!this.m_bTrack){return false}if(this.m_PosMoves.length>2){this.execute(t)}this.m_PosMoves=[];this.m_bTrack=false;e.RenderAsync(true);t.preventDefault();t.stopPropagation();return true};e.LassoTracking.prototype.onsapmove=function(t){if(this.m_bTrack){var o=e.GetStretchFactor4Mode();var n=e.m_Canvas[e.m_nOverlayIndex].getBoundingClientRect();this.m_PosMoves.push([(t.clientX-n.left)/o[0],(t.clientY-n.top)/o[1]])}e.SetCursor("crosshair");e.RenderAsync(true);t.preventDefault();return true};e.LassoTracking.prototype.onsapout=function(e){};e.LassoTracking.prototype.execute=function(e){};e.LassoTracking.prototype.Hook=function(){e.SetInputMode(VBI.InputModeLassoSelect);e.m_Ctx.m_Control.setLassoSelection(true);e.m_DesignVO=this;e.SetCursor("crosshair");e.RenderAsync(true)};e.LassoTracking.prototype.UnHook=function(){if(e.m_nInputMode==VBI.InputModeLassoSelect){e.m_Ctx.onChangeTrackingMode(e.m_nInputMode,false);e.SetInputMode(VBI.InputModeDefault);e.m_Ctx.m_Control.setLassoSelection(false)}else{jQuery.sap.log.error("Wrong InputMode in UnHook: "+e.m_nInputMode)}this.m_PosMoves=[];this.m_bTrack=false;e.m_DesignVO=null;e.RenderAsync(true)};e.LassoTracking.prototype.ExitMode=function(){this.UnHook();e.SetCursor("default");e.RenderAsync(true)};e.LassoSelection=function(){e.LassoTracking.call(this);this.m_keycode=65;this.Hook()};e.LassoSelection.prototype=Object.create(e.LassoTracking.prototype);e.LassoSelection.prototype.constructor=e.LassoSelection;e.LassoSelection.prototype.execute=function(t){e.PerFormMultiSelect(t,this)};e.LassoSelection.prototype.Render=function(e,t){if(!this.m_bTrack){return false}if(this.m_PosMoves.length){VBI.Utilities.DrawTrackingLasso(t,this.m_PosMoves)}}}});
/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5) (c) Copyright 2009-2012 SAP AG. All rights reserved
 */
sap.ui.predefine("sap/ui/vbm/lib/sapmaplayer", ["./sapvbi"],function(){"use strict";VBI.MapLayerStackManager=function(){var r={};r.vbiclass="MapLayerStackManager";r.m_MapLayerStackArray=[];r.clear=function(){for(var a=0;a<r.m_MapLayerStackArray.length;++a){r.m_MapLayerStackArray[a].clear()}r.m_MapLayerStackArray=[]};r.load=function(a,e){if(a.Set){r.clear();var i;if(jQuery.type(a.Set.MapLayerStack)=="object"){i=new VBI.MapLayerStack;i.load(a.Set.MapLayerStack,e);r.Add(i)}else if(jQuery.type(a.Set.MapLayerStack)=="array"){for(var t=0;t<a.Set.MapLayerStack.length;++t){i=new VBI.MapLayerStack;i.load(a.Set.MapLayerStack[t],e);r.Add(i)}}}};r.Add=function(r){this.m_MapLayerStackArray.push(r)};r.GetMapLayerStack=function(r){for(var a=0;a<this.m_MapLayerStackArray.length;++a){if(this.m_MapLayerStackArray[a].m_Name==r){return this.m_MapLayerStackArray[a]}}return null};return r};VBI.MapLayerStacks=VBI.MapLayerStackManager();VBI.MapLayerStack=function(r,a){var e={};e.vbiclass="MapLayerStack";e.m_MapLayerArray=[];e.m_Name=r;e.m_Description=a;e.m_nMaxSquare=0;e.m_colBkgnd=null;e.clear=function(){for(var r=0;r<e.m_MapLayerArray.length;++r){e.m_MapLayerArray[r].clear()}e.m_MapLayerArray=[]};e.load=function(r,a){if(r.name){e.m_Name=r.name}if(r.description){e.m_Description=r.description}if(r.copyright){e.m_Copyright=r.copyright}if(r.copyrightLink){e.m_CopyrightLink=r.copyrightLink}if(r.copyrightImage){e.m_CopyrightImage=r.copyrightImage}if(r.maxSquare){e.m_nMaxSquare=r.maxSquare}if(r.previewPosition){e.m_PreviewPosition=r.previewPosition}if(r.colBkgnd){e.m_colBkgnd=r.colBkgnd}e.m_bSingleBMP=r.singleBMP&&r.singleBMP=="true";var i;if(r.MapLayer){if(jQuery.type(r.MapLayer)=="object"){i=new VBI.MapLayer;i.load(r.MapLayer,a);e.Add(i)}else if(jQuery.type(r.MapLayer)=="array"){for(var t=0;t<r.MapLayer.length;++t){i=new VBI.MapLayer;i.load(r.MapLayer[t],a);e.Add(i)}}}};e.Add=function(r){this.m_MapLayerArray.push(r)};e.GetMaxLOD=function(){var r,a=0;var e=this.m_MapLayerArray;for(var i=0;i<e.length;++i){r=parseInt(e[i].GetMaxLOD(),10);if(r>a){a=r}}return a};e.GetMinLOD=function(){var r,a=Number.MAX_VALUE;var e=this.m_MapLayerArray;for(var i=0;i<e.length;++i){r=e[i].GetMinLOD();if(r<a){a=r}}return a};e.GetCopyright=function(){if(this.m_Copyright){return VBI.Utilities.AssembleCopyrightString(this.m_Copyright,this.m_CopyrightLink,this.m_CopyrightImage)}var r=null;for(var a=0;a<this.m_MapLayerArray.length;a++){var e=this.m_MapLayerArray[a].GetMapProvider();if(!r){r=e.GetCopyright()}else{r=r+", "+e.GetCopyright()}}return r};return e};VBI.MapLayer=function(){var r={};r.vbiclass="MapLayer";r.m_Name=null;r.m_refMapProvider=null;r.m_fOpacity=1;r.clear=function(){r.m_refMapProvider=null};r.load=function(a,e){if(a.name){r.m_Name=a.name}if(a.opacity){r.m_fOpacity=a.opacity}if(a.refMapProvider){if(e.m_MapProviders){r.m_refMapProvider=e.m_MapProviders.GetMapProviderByName(a.refMapProvider)}}if(!r.m_refMapProvider){jQuery.sap.log.error("MapLayer: no valid mapprovider specified")}};r.GetMinLOD=function(){if(r.m_refMapProvider){return r.m_refMapProvider.GetMinLOD()}};r.GetMaxLOD=function(){if(r.m_refMapProvider){return r.m_refMapProvider.GetMaxLOD()}};r.GetMapProvider=function(){if(r.m_refMapProvider){return r.m_refMapProvider}return null};return r}});
/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5) (c) Copyright 2009-2012 SAP AG. All rights reserved
 */
sap.ui.predefine("sap/ui/vbm/lib/sapmapmanager", ["./sapvbi"],function(){"use strict";VBI.MapManager=function(){var e={};e.vbiclass="MapManager";e.m_nRequest=0;e.m_tileWidth=256;e.m_tileHeight=256;e.m_runningRequests=0;e.m_runningXhrRequests=0;e.m_limitRequests=12;e.m_requestQueue=[];e.m_renderQueue=[];e.m_renderRequestID=0;e.m_failedSendTimer=0;e.m_renderJunksize=100;e._modifyReqCounters=function(r,t){if(r.m_Headers){e.m_runningXhrRequests+=t}else{e.m_runningRequests+=t}if(VBI.m_bTrace){VBI.Trace("Running Requests - Xhr: "+e.m_runningXhrRequests+", src: "+e.m_runningRequests)}};e.onAbort=function(r){var t=r.srcElement;if(VBI.m_bTrace){VBI.Trace("onAbort "+t.src)}e._modifyReqCounters(t,-1);e.CheckReqQueue();e.UnlinkImage(t);e.CheckTmpCanvas(t.m_Target,t.m_nRequest,t.m_nLayersAbove)};e.onFailedSend=function(r){if(VBI.m_bTrace){VBI.Trace("onFailedSend "+r.src)}e._modifyReqCounters(r,-1);e.m_bRequestError=true;if(!e.m_failedSendTimer){e.m_failedSendTimer=setInterval(function(){e.RetrySending()},750)}};e.onError=function(r){var t=r.srcElement;if(VBI.m_bTrace){VBI.Trace("onError "+t.src)}e._modifyReqCounters(t,-1);e.CheckReqQueue();var n=null;if(t.m_Next!=null){t.m_Next.m_FillStyle=t.m_FillStyle}if(t.m_Prev==null&&t.m_Next!=null&&t.m_Next.complete==true){n=t.m_Next}e.UnlinkImage(t);if(n!=null){e.m_renderQueue.push(n);if(!e.m_renderRequestID){e.m_renderRequestID=window.requestAnimationFrame(e.RenderTiles)}}else{e.CheckTmpCanvas(t.m_Target,t.m_nRequest,t.m_nLayersAbove)}};e.onLoad=function(r){var t=r.target;if(!t.complete){return}if(t.m_Headers){(window.URL||window.webkitURL).revokeObjectURL(t.src)}if(VBI.m_bTrace){VBI.Trace("VBI.MapManager: onLoad "+(t.m_Headers?"(xhr) ":" ")+(t.m_Headers?t.src2execute:t.src))}e._modifyReqCounters(t,-1);e.CheckReqQueue();var n=true;var a;for(a=t.m_Prev;a!=null;a=a.m_Prev){n&=a.complete}for(a=t.m_Next;a!=null;a=a.m_Next){n&=a.complete}if(!n){if(VBI.m_bTrace){VBI.Trace("VBI.MapManager: onLoad skip as there is a a not yet loaded tile ")}return}e.m_renderQueue.push(t);if(!e.m_renderRequestID){e.m_renderRequestID=window.requestAnimationFrame(e.RenderTiles)}};e.RetrySending=function(){clearInterval(e.m_failedSendTimer);e.m_failedSendTimer=0;e.m_bRequestError=false;e.CheckReqQueue()};e.CheckReqQueue=function(){while(e.m_requestQueue.length&&!e.m_bRequestError){var r=e.m_requestQueue.shift();var t=r.m_Target;if(r.m_nLOD!=t.m_nCurrentLOD||t.m_bInvalid){e.UnlinkImage(r);e.CheckTmpCanvas(t,r.m_nRequest,r.m_nLayersAbove)}else{try{if(r.m_Headers){e._createHttpRequest(r)}else{e.m_bRequestError=false;e._modifyReqCounters(r,1);r.src=r.src2execute}}catch(t){e.m_requestQueue.unshift(r);e.onFailedSend(r)}return}}};e.RenderTiles=function(){var r=Math.min(e.m_renderQueue.length,e.m_renderJunksize);for(var t=0;t<r;++t){e.RenderTile(e.m_renderQueue.shift())}e.m_renderRequestID=e.m_renderQueue.length>0?window.requestAnimationFrame(e.RenderTiles):0};e.RenderTile=function(r){if(!r.bRendered){var t=r.m_Target;if(t.m_CanvasRedirect!=undefined&&t.m_CanvasRedirRequest==r.m_nRequest){t=t.m_CanvasRedirect}var n=t.m_Scene;if(!n){return}var a=t.getPixelWidth();var m=t.getPixelHeight();t.m_nAppliedRequest=Math.max(t.m_nAppliedRequest,r.m_nRequest);var i=t.getContext("2d");var s=1<<i.canvas.m_nCurrentLOD;var _=((r.m_nReqX-i.canvas.m_nCurrentX)%s+s)%s;if(s<n.m_nTilesX){_=r.m_nCol+r.m_nXOrigin-i.canvas.m_nCurrentX}var o=r.m_nReqY-i.canvas.m_nCurrentY;if(r.m_bOutdated||_<0||o<0||_>=r.m_numCol||o>=r.m_numRow||(r.m_nLOD!=t.m_nCurrentLOD||t.m_bInvalid)){e.UnlinkImage(r);if(VBI.m_bTrace){VBI.Trace("VBI.MapManager: RenderTile  "+r.src+" is outdated")}e.CheckTmpCanvas(t,r.m_nRequest,r.m_nLayersAbove);return}if(VBI.m_bTrace){VBI.Trace("VBI.MapManager: RenderTile  "+r.src)}var u=n.m_nWidthCanvas;var l=n.m_nHeightCanvas;t.setPixelWidth(u);t.setPixelHeight(l);var c=u/n.m_nTilesX;var d=l/n.m_nTilesY;var f=_*c;var v=o*d;var g=r.m_nXExpansion*c;var h=r.m_nYExpansion*d;var R=r;var I;while(R.m_Prev!=null){R=R.m_Prev}while(R!=null&&R.complete==true){if(R.m_FillStyle!=null){if(VBI.m_bTrace){VBI.Trace("RenderTile fillRect "+R.src)}I=i.fillStyle;i.fillStyle=R.m_FillStyle;i.fillRect(f,v,g,h);i.fillStyle=I}if(VBI.m_bTrace){VBI.Trace("RenderTile drawImage "+R.src)}i.globalAlpha=R.m_Opacity;i.drawImage(R,f,v,g,h);R.bRendered=true;if(R.m_Next!=null){R.m_Next.m_Prev=null}R=R.m_Next}if(VBI.m_bTrace){I=i.fillStyle;i.fillStyle="#FF0000";i.font="18px Arial";i.fillText(r.m_nRequest+"."+r.m_nCount+":"+r.m_nLOD+"/"+r.m_nReqX+"/"+r.m_nReqY+"@("+f/256+","+v/256+")",f+10,v+30);i.fillStyle=I}t.setPixelWidth(a);t.setPixelHeight(m);if(t.onTileLoaded){t.onTileLoaded(r)}i.globalAlpha=1;e.CheckTmpCanvas(t,r.m_nRequest,0);if(n.m_Ctx.moThumbnail){n.Copy2Thumbnail()}}};e.CheckTmpCanvas=function(e,r,t){if(e.m_nTilesBefSwitch!=undefined&&e.m_nRequest==r&&!t){e.m_nTilesBefSwitch--;if(!e.m_nTilesBefSwitch){e.m_Scene.SwitchTmpCanvasToActive()}}};e.RequestTiles=function(r,t,n,a,m,i,s,_,o,u,l,c){e.m_bRequestError=false;if(l<0){return false}var d=r.m_Scene;if(!t||d.AnimZoomTarget&&Math.abs(d.AnimZoomTarget-l)>d.m_nMaxAnimLodDiff){r.m_nCurrentX=n;r.m_nCurrentY=a;r.m_nCurrentLOD=l;return false}var f=0;var v=1<<l;var g=d.m_Proj.m_nXYRatio;var h=v*g;var R=2/v;if(c){var I=r.getContext("2d");I.fillStyle="white";I.clearRect(0,0,I.canvas.width,I.canvas.height)}var T=t.m_MapLayerArray;r.m_nRequest=e.m_nRequest++;r.m_bInvalid=false;r.m_nCurrentX=n;r.m_nCurrentY=a;r.m_nCurrentLOD=l;var p,q,b,C=1;var x=a;if(t.m_bSingleBMP){q=1;x=Math.max(0,a);b=Math.min(i-_-u,v-x)}else{q=i-_-u;b=1}var w=T.length;p=m-s-o;for(var y=0;y<p;++y){C--;if(!C){for(var L=0;L<q;++L){f++;var B=null;var M=null;var S=(n+s+y)%h;if(S<0){S=h+S}var V=x+_+L;if(V+b<=0||V>=v){if(r.m_nTilesBefSwitch!=undefined&&r.m_nTilesBefSwitch>0){r.m_nTilesBefSwitch--}continue}C=t.m_bSingleBMP?Math.min(h-S,p-y):1;for(var O=0;O<w;++O){var P=T[O];if(t.fillStyle){M=t.fillStyle}else if(t.m_colBkgnd){M=t.m_colBkgnd}if(P.GetMinLOD()>l||P.GetMaxLOD()<l){continue}var k=new Image;k.m_nLayersAbove=w-O-1;k.m_nXOrigin=n;k.m_nYOrigin=a;k.m_nCol=y+s;k.m_nRow=L+_;k.m_numCol=m;k.m_numRow=i;k.m_Target=r;k.m_nRequest=r.m_nRequest;k.m_Opacity=P.m_fOpacity;k.m_bOutdated=false;k.m_Prev=B;if(B!=null){B.m_Next=k}if(k.m_Prev==null){k.m_FillStyle=M}k.m_nReqX=S;k.m_nReqY=V;k.m_nXExpansion=C;k.m_nYExpansion=b;k.m_nLOD=l;var H=P.GetMapProvider();var D;if(H.m_bPosRequired){var A=[S*R/g-1,V*R-1];var Q=[(S+C)*R/g-1,(V+b)*R-1];D=H.CombineUrlWPos(S,V,l,R,A,Q,C,b,e.m_requestTileWidth,e.m_requestTileHeight)}else{D=H.CombineUrl(S,V,l)}k.onload=e.onLoad;k.onerror=e.onError;k.onabort=e.onAbort;if(H.m_Headers&&D.substring(0,5).toLowerCase()!="data:"){k.m_Headers=H.m_Headers;k.src2execute=D;e._createHttpRequest(k)}else if(e.m_runningRequests<e.m_limitRequests&&!e.m_bRequestError){try{e._modifyReqCounters(k,1);k.src=D}catch(r){k.src2execute=D;e.m_requestQueue.push(k);e.onFailedSend(k)}}else{k.src2execute=D;e.m_requestQueue.push(k)}k.m_nCount=f;if(VBI.m_bTrace){VBI.Trace("RequestTiles "+D)}B=k}}}}return true};e.UnlinkImage=function(e){var r;for(r=e.m_Prev;r;r=r.m_Prev){r.m_bOutdated=true}for(r=e.m_Next;r;r=r.m_Next){r.m_bOutdated=true}var t=e.m_Prev;var n=e.m_Next;if(t!=null){e.m_Prev.m_Next=n;e.m_Prev=null}if(n!=null){e.m_Next.m_Prev=t;e.m_Next=null}};e.GetPreviewImage=function(r,t,n,a,m,i){if(!i||!a||!r||!n||!t||!m){return}var s=Math.min(Math.max(n,m.GetMinLOD()),m.GetMaxLOD());n=Math.floor(s);var _=m.m_MapManager.m_tileWidth;var o=m.m_MapManager.m_tileHeight;var u=m.m_Proj.m_nXYRatio;var l=1<<n;var c=2/l;var d=VBI.MathLib.DegToRad([parseFloat(r),parseFloat(t)]);var f=[l*_,l*o];m.m_Proj.LonLatToUCS(d,f);var v=Math.floor(f[0]/_);var g=Math.floor(f[1]/o);var h=a.m_MapLayerArray;var R={m_Callback:i,m_Images:[],m_ImagesRemain:h.length,m_MapLayerStack:a,compose:function(){this.m_ImagesRemain-=1;if(this.m_ImagesRemain<=0){var e=document.createElement("canvas");R=e.getContext("2d");var r=this.m_MapLayerStack.m_colBkgnd;R.fillStyle=r;R.fillRect(0,0,e.width,e.height);for(var t=0;t<this.m_Images.length;++t){if(this.m_Images[t]){R.globalAlpha=this.m_Images[t].m_Opacity;var n=0;var a=0;var m=this.m_Images[t].width;var s=this.m_Images[t].height;var _=0;var o=0;var u=e.width;var l=e.height;R.drawImage(this.m_Images[t],n,a,m,s,_,o,u,l)}}var c=new Image;c.src=e.toDataURL();i(c)}}};var I=function(e){if(VBI.m_bTrace){VBI.Trace("onLoad "+e.target.src)}var r=e.target;if(r.m_Headers){(window.URL||window.webkitURL).revokeObjectURL(r.src)}r.m_Context.compose()};var T=function(e){if(VBI.m_bTrace){VBI.Trace("onAbort "+e.target.src)}var r=e.target;r.m_Context.m_Images[r.m_Index]=null;r.m_Context.compose()};var p=function(e){if(VBI.m_bTrace){VBI.Trace("onError "+e.target.src)}var r=e.target;r.m_Context.m_Images[r.m_Index]=null;r.m_Context.compose()};for(var q=0;q<h.length;++q){var b=h[q];var C=b.GetMapProvider();if(b.GetMinLOD()>n||b.GetMaxLOD()<n){continue}var x;if(C.m_bPosRequired){var w=[v*c/u-1,g*c-1];var y=[(v+1)*c/u-1,(g+1)*c-1];x=C.CombineUrlWPos(v,g,n,c,w,y,1,1,_,o)}else{x=C.CombineUrl(v,g,n)}var L=new Image;L.setAttribute("crossOrigin","anonymous");R.m_Images[q]=L;L.m_Index=q;L.m_Context=R;if(b.m_fOpacity){L.m_Opacity=b.m_fOpacity}L.onload=I;L.onabort=T;L.onerror=p;try{if(C.m_Headers&&x.substring(0,5).toLowerCase()!="data:"){L.m_Headers=C.m_Headers;L.src2execute=x;e._createHttpRequest(L,true)}else{L.src=x}}catch(e){if(VBI.m_bTrace){VBI.Trace("GetPreviewImage "+e)}L.m_Context.m_Images[L.m_Index]=null;L.m_Context.compose()}}};e._createHttpRequest=function(r,t){if(t||e.m_runningXhrRequests<e.m_limitRequests){if(!t){e._modifyReqCounters(r,1)}var n=typeof window.sinon==="object"&&window.sinon.xhr&&window.sinon.xhr.XMLHttpRequest?window.sinon.xhr.XMLHttpRequest:XMLHttpRequest;var a=new n;a.m_Image=r;a.onerror=function(e){if(this.m_Image&&this.m_Image.onerror){this.m_Image.onerror({srcElement:this.m_Image,target:this.m_Image})}jQuery.sap.log.error("Download error: "+this.statusText)};if(!t){a.onprogress=function(e){if(this.m_Image&&this.m_Image.m_bOutdated){this.abort();this.m_Image.onabort({srcElement:this.m_Image});jQuery.sap.log.error("Download error: image outdated")}}}a.onload=function(r){if(this.status===200||this.status===0){var n=this.getResponseHeader("Content-Type");if(n.split("/")[0]=="image"){this.m_Image.src=(window.URL||window.webkitURL).createObjectURL(this.response)}else{this.m_Image.onerror({srcElement:this.m_Image,target:this.m_Image});jQuery.sap.log.error("Download error: image response type expected. Recieved: "+n)}}else{if(t){this.m_Image.onerror({target:this.m_Image})}else{if(this.m_Image&&!this.m_Image.m_bOutdated){e.m_requestQueue.push(this.m_Image)}e.onFailedSend(this.m_Image)}jQuery.sap.log.error("Download error: "+this.statusText)}};a.open("GET",r.src2execute,true);r.m_Headers.forEach(function(e){a.setRequestHeader(e.name,e.value)});a.responseType="blob";a.send(null)}else{e.m_requestQueue.push(r);return}};return e}()});
/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5) (c) Copyright 2009-2012 SAP AG. All rights reserved
 */
sap.ui.predefine("sap/ui/vbm/lib/sapmapprovider", ["./sapvbi"],function(){"use strict";VBI.MapProviders=function(){var e={};e.vbiclass="MapProviders";e.m_MapProviderArray=[];e.clear=function(){for(var r=0;r<e.m_MapProviderArray.length;++r){e.m_MapProviderArray[r].clear()}e.m_MapProviderArray=[]};e.load=function(r,i){if(r.Set){var a;e.clear();if(r.Set.MapProvider){if(jQuery.type(r.Set.MapProvider)=="object"){a=new VBI.MapProvider;a.load(r.Set.MapProvider);e.Add(a)}else if(jQuery.type(r.Set.MapProvider)=="array"){for(var o=0;o<r.Set.MapProvider.length;++o){a=new VBI.MapProvider;a.load(r.Set.MapProvider[o]);e.Add(a)}}}}};e.Add=function(e){this.m_MapProviderArray.push(e)};e.GetMapProviderByName=function(r){for(var i=0;i<e.m_MapProviderArray.length;++i){if(e.m_MapProviderArray[i].m_Name==r){return e.m_MapProviderArray[i]}}return null};return e};VBI.MapProvider=function(e,r,i,a,o,t,n,l,m,u,c){var d={};d.vbiclass="MapProvider";d.m_SourceArray=[];d.m_Name=e;d.m_Description=r;d.m_Copyright=i;d.m_tileX=typeof a!=="undefined"?a:256;d.m_tileY=typeof o!=="undefined"?o:256;d.m_maxLOD=typeof n!=="undefined"?n:19;d.m_minLOD=typeof t!=="undefined"?t:0;d.m_nResolution=typeof m!="undefined"?m:256;d.m_nProjection=typeof u!="undefined"?u:1;d.m_Headers=c;if(l!=null){d.fillStyle=l}d.clear=function(){for(var e=0;e<d.m_SourceArray.length;++e){d.m_SourceArray[e].clear()}d.m_SourceArray=[]};d.GetCopyright=function(){return VBI.Utilities.AssembleCopyrightString(this.m_Copyright,this.m_CopyrightLink,this.m_CopyrightImage)};d.addMapBase=function(e,r,i,a,o,t){var n={};if(e){n.left=parseFloat(e)}if(r){n.right=parseFloat(r)}if(i){n.top=parseFloat(i)}if(a){n.bottom=parseFloat(a)}n.round=o!=undefined?parseFloat(o):0;n.xSize=r-e;n.ySize=i-a;if(t!=undefined){n.relXSize=n.xSize/t.xSize;n.relYSize=n.ySize/t.ySize}return n};d.addMapBaseBorder=function(e,r,i,a,o){e.leftBorder=r;e.rightBorder=i;e.bottomBorder=a;e.topBorder=o};d.load=function(e){if(e.name){d.m_Name=e.name}if(e.description){d.m_Description=e.description}if(e.copyright){d.m_Copyright=e.copyright}if(e.copyrightLink){d.m_CopyrightLink=e.copyrightLink}if(e.copyrightImage){d.m_CopyrightImage=e.copyrightImage}if(e.tileX){d.m_tileX=e.tileX}if(e.tileY){d.m_tileY=e.tileY}if(e.maxLOD){d.m_maxLOD=e.maxLOD}if(e.minLOD){d.m_minLOD=e.minLOD}if(e.resolution){d.m_nResolution=e.resolution}if(e.projection){if(e.projection==="Linear"){d.m_nProjection=2}else if(e.projection==="Elliptical"){d.m_nProjection=3}}if(e.Header){[].concat(e.Header).forEach(function(e){if(e.name){if(!d.m_Headers){d.m_Headers=[]}d.m_Headers.push(e)}})}var r=e.MapBase;d.m_StdMapBase=d.addMapBase(-1,1,1,-1,10);if(e.MapBase){d.m_MapBase=d.addMapBase(r.left,r.right,r.top,r.bottom,r.round,d.m_StdMapBase);d.addMapBaseBorder(d.m_MapBase,r.minX,r.maxX,r.minY,r.maxY)}else{d.m_MapBase=d.addMapBase(-180,180,90,-90,10,d.m_StdMapBase)}if(e.Source){var i;if(jQuery.type(e.Source)=="object"){i=new VBI.Source(null);d.m_bPosRequired=i.load(e.Source);d.Add(i)}else if(jQuery.type(e.Source)=="array"){d.m_bPosRequired=false;for(var a=0;a<e.Source.length;++a){i=new VBI.Source(null);d.m_bPosRequired=i.load(e.Source[a])||d.m_bPosRequired;d.Add(i)}}}};d.Add=function(e){this.m_SourceArray.push(e)};d.CombineUrlWPos=function(e,r,i,a,o,t,n,l,m,u){var c=1<<i;var f=10;if(d.m_MapBase){var p=d.m_StdMapBase;var _=d.m_MapBase;o[0]=(o[0]-p.left)*_.relXSize+_.left;o[1]=-((o[1]-p.bottom)*_.relYSize+_.bottom);t[0]=(t[0]-p.left)*_.relXSize+_.left;t[1]=-((t[1]-p.bottom)*_.relYSize+_.bottom);f=_.round}if(this.m_SourceArray.length==0){return null}return this.m_SourceArray[(r+e*c)%this.m_SourceArray.length].CombineUrlWPos(e,r,i,a,o,t,n,l,f,Math.min(m,d.m_nResolution),Math.min(u,d.m_nResolution))};d.CombineUrl=function(e,r,i){var a=1<<i;if(e<0||r<0||e>=a||r>=a){return null}if(this.m_SourceArray.length==0){return null}return this.m_SourceArray[(r+e*a)%this.m_SourceArray.length].CombineUrl(e,r,i)};d.GetMaxLOD=function(){return this.m_maxLOD};d.GetMinLOD=function(){return this.m_minLOD};return d};VBI.Source=function(e){var r={};r.vbiclass="Source";r.m_ID=null;r.m_Url=e;r.m_Callback=undefined;r.clear=function(){};r.load=function(e){if(e.url){r.m_Url=e.url}if(e.id){r.m_ID=e.id}if(e.callback&&e.callback instanceof Function){r.m_Callback=e.callback}r.m_bQuadkey=r.m_Url.indexOf("{QUAD}")>=0;r.m_bNumkey=r.m_Url.indexOf("{NUMT}")>=0;return r.m_Url.indexOf("LU_LAT")>=0||r.m_Url.indexOf("LU_LONG")>=0||r.m_Url.indexOf("RL_LAT")>=0||r.m_Url.indexOf("RL_LONG")>=0};r.CombineUrl=function(e,i,a){var o=r.m_Url;var t,n;if(r.m_bQuadkey){t=this.TileXYToQuadKey(e,i,a);o=o.replace("{QUAD}",t)}if(r.m_bNumkey){n=this.TileXYToNumKey(e,i,a);o=o.replace("{NUMT}",n)}if(r.m_Callback){var l=r.m_Callback(r.m_Url,e,i,a,t,(1<<a)-i-1,n);if(typeof l==="string"||l instanceof String){return l}else{jQuery.sap.log.error("The function referenced in the Map Provider source parameter 'callback' did not return a string. Fallback to url.")}}o=o.replace("{X}",e);o=o.replace("{Y}",i);o=o.replace("{-Y}",(1<<a)-i-1);o=o.replace("{LOD}",a);return o};r.CombineUrlWPos=function(e,i,a,o,t,n,l,m,u,c,d){var f=r.m_Url;var p=Math.pow(10,u);var _,s;var y=Math.round(t[0]*p)/p;var v=Math.round(t[1]*p)/p;var h=Math.round(n[0]*p)/p;var M=Math.round(n[1]*p)/p;if(r.m_bQuadkey){_=this.TileXYToQuadKey(e,i,a);f=f.replace("{QUAD}",_)}if(r.m_bNumkey){s=this.TileXYToNumKey(e,i,a);f=f.replace("{NUMT}",s)}if(r.m_Callback){var S=r.m_Callback(r.m_Url,e,i,a,c*l,d*m,_,(1<<a)-i-1,s,y,v,h,M);if(typeof S==="string"||S instanceof String){return S}else{jQuery.sap.log.error("The function referenced in the Map Provider source parameter 'callback' did not return a string. Fallback to url.")}}f=f.replace("{X}",e);f=f.replace("{Y}",i);f=f.replace("{-Y}",(1<<a)-i-1);f=f.replace("{LOD}",a);f=f.replace("{WIDTH}",c*l);f=f.replace("{HEIGHT}",d*m);f=f.replace("{LU_LONG}",y);f=f.replace("{LU_LAT}",v);f=f.replace("{RL_LONG}",h);f=f.replace("{RL_LAT}",M);return f};r.TileXYToQuadKey=function(e,r,i){var a=[];for(var o=i;o>0;--o){var t="0";var n=1<<o-1;if(e&n){t++}if(r&n){t++;t++}a.push(t)}var l=a.join("");return l};r.TileXYToNumKey=function(e,r,i){var a=0;for(var o=1;o<i;++o){a+=(1<<o)*(1<<o)}a+=r*(1<<i)+e+1;return a};return r}});
/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5) (c) Copyright 2009-2012 SAP AG. All rights reserved
 */
sap.ui.predefine("sap/ui/vbm/lib/sapnavigation", ["./sapvbi"],function(){"use strict";VBI.NavigationControl=function(e){var o={};o.scene=null;o.suppressedVisibility=e;o.m_MinLOD=null;o.m_MaxLOD=null;o.m_lengthScrollLine=94-18;o.m_startScrollPoint=null;o.m_ID=null;o.zoomtimerfrq=40;o.zoomtimer=0;o.movetimer=0;o.bInitDrag=false;o.offsetX=0;o.offsetY=0;o.curMoveX=0;o.curMoveY=0;o.curZoomY=0;o.tint=20;o.midpointForZoom=[0,0];o.timer_mapnav=null;o.m_Div=o.m_Divmapnav=o.m_Divmapscrollarea=o.m_Divmapscrollpoint=o.m_Divmapcursorgrip=o.m_Divmapcursor=o.m_Divmapcursorreset=o.m_Divmapcursorleft=o.m_Divmapcursortop=o.m_Divmapcursorright=o.m_Divmapcursordown=o.m_DivmapmobileHome=o.m_DivmapmobileHomeIcon=o.m_DivmapmobileZoomin=o.m_DivmapmobileZoominIcon=o.m_DivmapmobileZoomout=o.m_DivmapmobileZoomoutIcon=null;o.clear=function(){if(o.timer_mapnav){window.clearInterval(o.timer_mapnav)}o.DetachEvents();o.scene=null;o.m_Div=o.m_Divmapnav=o.m_Divmapscrollarea=o.m_Divmapscrollpoint=o.m_Divmapcursorgrip=o.m_Divmapcursor=o.m_Divmapcursorreset=o.m_Divmapcursorleft=o.m_Divmapcursortop=o.m_Divmapcursorright=o.m_Divmapcursordown=o.m_DivmapmobileHome=o.m_DivmapmobileHomeIcon=o.m_DivmapmobileZoomin=o.m_DivmapmobileZoominIcon=o.m_DivmapmobileZoomout=o.m_DivmapmobileZoomoutIcon=null};o.getId=function(e,o){return o+"-"+e};o.DetachEvents=function(){if(VBI.m_bIsMobile){jQuery(o.m_DivmapmobileHome).off();jQuery(o.m_DivmapmobileZoomin).off();jQuery(o.m_DivmapmobileZoomout).off()}else{jQuery(o.m_Divmapnav).off();jQuery(o.m_Divmapscrollpoint).off();jQuery(o.m_Divmapcursorgrip).off();jQuery(o.m_Divmapcursorleft).off();jQuery(o.m_Divmapcursorright).off();jQuery(o.m_Divmapcursortop).off();jQuery(o.m_Divmapcursordown).off();jQuery(o.m_Divmapcursorreset).off();document.removeEventListener("mouseup",o.zoom_processmouseup,true);document.removeEventListener("mousemove",o.zoom_processmousemove,true)}};o.AttachEvents=function(){if(VBI.m_bIsMobile){o.AttachTouchEvents()}else{o.AttachMouseEvents()}};o.AttachTouchEvents=function(){jQuery(o.m_DivmapmobileHome).on("click",function(){if(VBI.m_bTrace){VBI.Trace("Home Button : click")}o.scene.GoToInitialStart()});jQuery(o.m_DivmapmobileHome).on("touchstart",function(){if(VBI.m_bTrace){VBI.Trace("Home Button : touchstart")}o.scene.GoToInitialStart()});jQuery(o.m_DivmapmobileHome).on("touchend",function(e){if(VBI.m_bTrace){VBI.Trace("Home Button : touchend")}e.preventDefault()});jQuery(o.m_DivmapmobileZoomin).on("touchstart",function(){if(VBI.m_bTrace){VBI.Trace("ZoomIn Button : touchstart")}o.StartAnimatedZoom(1)});jQuery(o.m_DivmapmobileZoomin).on("touchend",function(e){if(VBI.m_bTrace){VBI.Trace("ZoomIn Button : touchend")}if(o.zoomtimer){window.clearInterval(o.zoomtimer);o.ZoomToNextIntegerLOD(true)}e.preventDefault()});jQuery(o.m_DivmapmobileZoomin).on("touchleave",function(){if(VBI.m_bTrace){VBI.Trace("ZoomIn Button : touchleave")}if(o.zoomtimer){window.clearInterval(o.zoomtimer);o.ZoomToNextIntegerLOD(true)}});jQuery(o.m_DivmapmobileZoomout).on("touchstart",function(){if(VBI.m_bTrace){VBI.Trace("ZoomOut Button : touchstart")}o.StartAnimatedZoom(-1)});jQuery(o.m_DivmapmobileZoomout).on("touchend",function(e){if(VBI.m_bTrace){VBI.Trace("ZoomOut Button : touchend")}if(o.zoomtimer){window.clearInterval(o.zoomtimer);o.ZoomToNextIntegerLOD(false)}e.preventDefault()});jQuery(o.m_DivmapmobileZoomout).on("touchleave",function(){if(VBI.m_bTrace){VBI.Trace("ZoomOut Button : touchleave")}if(o.zoomtimer){window.clearInterval(o.zoomtimer);o.ZoomToNextIntegerLOD(false)}})};o.AttachMouseEvents=function(){var e=1;var i=50;o.timer_mapnav=null;var t=null;if(o.suppressedVisibility.fade){o.m_Divmapnav.style.opacity=1}jQuery(o.m_Divmapnav).on("mouseenter",function(e){t=e.fromElement});jQuery(o.m_Divmapnav).on("mouseup",function(){if(t){t.focus({preventScroll:true})}});jQuery(o.m_Divmapnav).on("mouseleave",function(){if(!o.suppressedVisibility.fade){e=1;o.timer_mapnav=window.setInterval(function(){if(!o.m_Divmapnav||e<=.5){window.clearInterval(o.timer_mapnav)}else{e-=.01;o.m_Divmapnav.style.opacity=e}},i)}});jQuery(o.m_Divmapnav).on("mouseenter",function(){window.clearInterval(o.timer_mapnav);o.m_Divmapnav.style.opacity=1});if(!o.suppressedVisibility.zoom){if(o.suppressedVisibility.move){jQuery(o.m_Divmapscrollarea).css("top",10+"px")}jQuery(o.m_Divmapscrollpoint).on("mousedown",function(e){if(e.which==1){o.midpointForZoom=o.scene.GetCenterPos();o.curZoomY=jQuery(o.m_Divmapscrollpoint).position().top;o.offsetY=e.pageY-o.curZoomY;document.addEventListener("mouseup",o.zoom_processmouseup,true);document.addEventListener("mousemove",o.zoom_processmousemove,true)}});jQuery(o.m_Divmapscrollpoint).on("dragstart",function(e){e.preventDefault()})}if(!o.suppressedVisibility.move){jQuery(o.m_Divmapcursorgrip).on("mouseenter",function(){jQuery(o.m_Divmapcursor).css("background-position","-5px 228px")}).on("mouseleave",function(){jQuery(o.m_Divmapcursor).css("background-position","-5px 305px")});var r=10;jQuery(o.m_Divmapcursorleft).on("mousedown",function(e){if(e.which==1){jQuery(this).css("background-position","-134px 194px");window.clearInterval(o.movetimer);o.movetimer=window.setInterval(function(){o.scene.MoveMap(r,0)},o.tint)}}).on("mouseup",function(e){window.clearInterval(o.movetimer);jQuery(this).css("background-position","-134px 211px")}).on("mouseout",function(e){if(o.bInitDrag==false){window.clearInterval(o.movetimer);jQuery(this).css("background-position","-134px 228px")}}).on("mousemove",function(e){if(o.bInitDrag==true){jQuery(this).css("background-position","-134px 177px")}});jQuery(o.m_Divmapcursorright).on("mousedown",function(e){if(e.which==1){jQuery(this).css("background-position","-116px 194px");window.clearInterval(o.movetimer);o.movetimer=window.setInterval(function(){o.scene.MoveMap(-r,0)},o.tint)}}).on("mouseup",function(e){window.clearInterval(o.movetimer);jQuery(this).css("background-position","-116px 211px")}).on("mouseout",function(e){if(o.bInitDrag==false){window.clearInterval(o.movetimer);jQuery(this).css("background-position","-116px 228px")}}).on("mousemove",function(e){if(o.bInitDrag==true){jQuery(this).css("background-position","-116px 177px")}});jQuery(o.m_Divmapcursortop).on("mousedown",function(e){if(e.which==1){jQuery(this).css("background-position","-82px 192px");window.clearInterval(o.movetimer);o.movetimer=window.setInterval(function(){o.scene.MoveMap(0,r)},o.tint)}}).on("mouseup",function(e){window.clearInterval(o.movetimer);jQuery(this).css("background-position","-82px 210px")}).on("mouseout",function(e){if(o.bInitDrag==false){window.clearInterval(o.movetimer);jQuery(this).css("background-position","-82px 228px")}}).on("mousemove",function(e){if(o.bInitDrag==true){jQuery(this).css("background-position","-82px 174px")}});jQuery(o.m_Divmapcursordown).on("mousedown",function(e){if(e.which==1){jQuery(this).css("background-position","-99px 192px");window.clearInterval(o.movetimer);o.movetimer=window.setInterval(function(){o.scene.MoveMap(0,-r)},o.tint)}}).on("mouseup",function(e){window.clearInterval(o.movetimer);jQuery(this).css("background-position","-99px 210px")}).on("mouseout",function(e){if(o.bInitDrag==false){window.clearInterval(o.movetimer);jQuery(this).css("background-position","-99px 228px")}}).on("mousemove",function(e){if(o.bInitDrag==true){jQuery(this).css("background-position","-99px 174px")}});jQuery(o.m_Divmapcursorreset).on("dragstart",function(e){e.preventDefault()});jQuery(o.m_Divmapcursorreset).on("mousedown",function(e){if(e.which==1){o.curMoveX=jQuery(o.m_Divmapcursorreset).position().left;o.curMoveY=jQuery(o.m_Divmapcursorreset).position().top;jQuery(o.m_Divmapcursorleft).css("background-position","-134px 177px");jQuery(o.m_Divmapcursorright).css("background-position","-116px 177px");jQuery(o.m_Divmapcursordown).css("background-position","-99px 174px");jQuery(o.m_Divmapcursortop).css("background-position","-82px 174px");jQuery(this).css("background-position","-222px 263px");o.offsetX=e.pageX-o.curMoveX;o.offsetY=e.pageY-o.curMoveY;window.clearInterval(o.movetimer);o.movetimer=0;o.bInitDrag=true;document.addEventListener("mouseup",o.processmouseup,true);document.addEventListener("mousemove",o.processmousemove,true)}});jQuery(o.m_Divmapcursorreset).css("position","");jQuery(o.m_Divmapcursorreset).on("dblclick",function(){o.scene.GoToInitialStart()})}};o.AppendButton=function(){o.m_Divmapnav=VBI.Utilities.CreateGeoSceneDivCSS(o.getId("vbi-nav",o.m_ID),"vbi-nav");o.m_Divmapnav.setAttribute("role",sap.ui.core.AccessibleRole.Navigation);o.m_Divmapnav.setAttribute("tabindex","-1");o.m_Divmapnav.m_VBIType="N";o.m_DivmapmobileHome=VBI.Utilities.CreateGeoSceneDivCSS(o.getId("vbi-navmobile-home",o.m_ID),"vbi-navmobile-home");o.m_DivmapmobileHome.setAttribute("role",sap.ui.core.AccessibleRole.Button);o.m_DivmapmobileHome.setAttribute("tabindex","-1");o.m_DivmapmobileHome.innerHTML="";o.m_Divmapnav.appendChild(o.m_DivmapmobileHome);if(!o.suppressedVisibility.zoom){o.m_DivmapmobileZoomin=VBI.Utilities.CreateGeoSceneDivCSS(o.getId("vbi-navmobile-zoomin",o.m_ID),"vbi-navmobile-zoomin");o.m_DivmapmobileZoomin.setAttribute("role",sap.ui.core.AccessibleRole.Button);o.m_DivmapmobileZoomin.setAttribute("tabindex","-1");o.m_DivmapmobileZoomin.innerHTML="+";o.m_Divmapnav.appendChild(o.m_DivmapmobileZoomin);o.m_DivmapmobileZoomout=VBI.Utilities.CreateGeoSceneDivCSS(o.getId("vbi-navmobile-zoomout",o.m_ID),"vbi-navmobile-zoomout");o.m_DivmapmobileZoomout.setAttribute("role",sap.ui.core.AccessibleRole.Button);o.m_DivmapmobileZoomout.setAttribute("tabindex","-1");o.m_DivmapmobileZoomout.innerHTML="-";o.m_Divmapnav.appendChild(o.m_DivmapmobileZoomout)}o.scene.m_Div.appendChild(o.m_Divmapnav)};o.AppendDiv=function(){var e=sap.ui.getCore().getLibraryResourceBundle("sap.ui.vbm.i18n");var i=e.getText("NAVCTL_TITLE_ZOOM",[0]);i=i.substr(0,i.search(/[0-9]/));o.m_Divmapnav=VBI.Utilities.CreateGeoSceneDivCSS(o.getId("vbi-nav",o.m_ID),"vbi-nav");o.m_Divmapnav.setAttribute("role",sap.ui.core.AccessibleRole.Navigation);o.m_Divmapnav.setAttribute("tabindex","-1");o.m_Divmapnav.m_VBIType="N";o.m_Divmapcursor=VBI.Utilities.CreateGeoSceneDivCSS(o.getId("vbi-cursor",o.m_ID),"vbi-cursor");o.m_Divmapcursor.setAttribute("role",sap.ui.core.AccessibleRole.Presentation);o.m_Divmapcursor.setAttribute("tabindex","-1");o.m_Divmapscrollarea=VBI.Utilities.CreateGeoSceneDivCSS(o.getId("vbi-scrollarea",o.m_ID),"vbi-scrollarea");o.m_Divmapscrollarea.setAttribute("role",sap.ui.core.AccessibleRole.Slider);o.m_Divmapscrollarea.setAttribute("tabindex","0");o.m_Divmapcursorgrip=VBI.Utilities.CreateGeoSceneDivCSS(o.getId("vbi-cursor-grip",o.m_ID),"vbi-cursor-grip");o.m_Divmapcursorgrip.setAttribute("role",sap.ui.core.AccessibleRole.Img);o.m_Divmapcursorgrip.setAttribute("tabindex","-1");var t=VBI.Utilities.CreateGeoSceneDivCSS(o.getId("vbi-cursor-middle",o.m_ID),"vbi-cursor-middle");t.setAttribute("role",sap.ui.core.AccessibleRole.Img);t.setAttribute("tabindex","0");var r=VBI.Utilities.CreateGeoSceneDivCSS(o.getId("vbi-scrolllineupperending",o.m_ID),"vbi-scrolllineupperending");r.setAttribute("role",sap.ui.core.AccessibleRole.Img);r.setAttribute("tabindex","-1");var m=VBI.Utilities.CreateGeoSceneDivCSS(o.getId("vbi-scrollline",o.m_ID),"vbi-scrollline");m.setAttribute("role",sap.ui.core.AccessibleRole.Img);m.setAttribute("tabindex","-1");var n=VBI.Utilities.CreateGeoSceneDivCSS(o.getId("vbi-scrolllinelowerending",o.m_ID),"vbi-scrolllinelowerending");n.setAttribute("role",sap.ui.core.AccessibleRole.Img);n.setAttribute("tabindex","-1");o.m_Divmapscrollpoint=VBI.Utilities.CreateGeoSceneDivCSS(o.getId("vbi-scrollpoint",o.m_ID),"vbi-scrollpoint",i);o.m_Divmapscrollpoint.setAttribute("role",sap.ui.core.AccessibleRole.Button);o.m_Divmapscrollpoint.setAttribute("aria-label",i);o.m_Divmapscrollpoint.setAttribute("tabindex","0");o.m_Divmapcursorleft=VBI.Utilities.CreateGeoSceneDivCSS(o.getId("vbi-cursor-left",o.m_ID),"vbi-cursor-left",e.getText("NAVCTL_TITLE_MOVE_LEFT"));o.m_Divmapcursorleft.setAttribute("role",sap.ui.core.AccessibleRole.Button);o.m_Divmapcursorleft.setAttribute("aria-label",e.getText("NAVCTL_TITLE_MOVE_LEFT"));o.m_Divmapcursorleft.setAttribute("tabindex","2");o.m_Divmapcursorright=VBI.Utilities.CreateGeoSceneDivCSS(o.getId("vbi-cursor-right",o.m_ID),"vbi-cursor-right",e.getText("NAVCTL_TITLE_MOVE_RIGHT"));o.m_Divmapcursorright.setAttribute("role",sap.ui.core.AccessibleRole.Button);o.m_Divmapcursorright.setAttribute("aria-label",e.getText("NAVCTL_TITLE_MOVE_RIGHT"));o.m_Divmapcursorright.setAttribute("tabindex","4");o.m_Divmapcursortop=VBI.Utilities.CreateGeoSceneDivCSS(o.getId("vbi-cursor-top",o.m_ID),"vbi-cursor-top",e.getText("NAVCTL_TITLE_MOVE_UP"));o.m_Divmapcursortop.setAttribute("role",sap.ui.core.AccessibleRole.Button);o.m_Divmapcursortop.setAttribute("aria-label",e.getText("NAVCTL_TITLE_MOVE_UP"));o.m_Divmapcursortop.setAttribute("tabindex","1");o.m_Divmapcursordown=VBI.Utilities.CreateGeoSceneDivCSS(o.getId("vbi-cursor-down",o.m_ID),"vbi-cursor-down",e.getText("NAVCTL_TITLE_MOVE_DOWN"));o.m_Divmapcursordown.setAttribute("role",sap.ui.core.AccessibleRole.Button);o.m_Divmapcursordown.setAttribute("aria-label",e.getText("NAVCTL_TITLE_MOVE_DOWN"));o.m_Divmapcursordown.setAttribute("tabindex","5");o.m_Divmapcursorreset=VBI.Utilities.CreateGeoSceneDivCSS(o.getId("vbi-cursor-reset",o.m_ID),"vbi-cursor-reset",e.getText("NAVCTL_TITLE_MOVE"));o.m_Divmapcursorreset.setAttribute("role",sap.ui.core.AccessibleRole.Button);o.m_Divmapcursorreset.setAttribute("aria-label",e.getText("NAVCTL_TITLE_MOVE"));o.m_Divmapcursorreset.setAttribute("tabindex","3");t.appendChild(o.m_Divmapcursorleft);t.appendChild(o.m_Divmapcursorright);t.appendChild(o.m_Divmapcursortop);t.appendChild(o.m_Divmapcursordown);t.appendChild(o.m_Divmapcursorreset);o.m_Divmapcursorgrip.appendChild(t);o.m_Divmapscrollarea.appendChild(r);o.m_Divmapscrollarea.appendChild(m);o.m_Divmapscrollarea.appendChild(n);o.m_Divmapscrollarea.appendChild(o.m_Divmapscrollpoint);if(!o.suppressedVisibility.zoom){o.m_Divmapnav.appendChild(o.m_Divmapscrollarea)}if(!o.suppressedVisibility.move){o.m_Divmapnav.appendChild(o.m_Divmapcursor);o.m_Divmapnav.appendChild(o.m_Divmapcursorgrip)}o.scene.m_Div.appendChild(o.m_Divmapnav)};o.AdaptMinMaxLOD=function(e){o.m_MinLOD=o.scene.GetMinLOD();o.m_MaxLOD=o.scene.GetMaxLOD()};o.Awake=function(e,i){o.scene=e;o.m_MinLOD=o.scene.GetMinLOD();o.m_MaxLOD=o.scene.GetMaxLOD();var t=jQuery.sap.byId(i);o.m_ID=jQuery(t).attr("id");if(VBI.m_bIsMobile){o.AppendButton()}else{o.AppendDiv();o.m_Divmapnav.style.opacity=.5;o.m_startScrollPoint=0}o.AttachEvents()};o.AdjustScrollPoint=function(e){if(VBI.m_bIsMobile){return}var i;if(e){i=o.m_lengthScrollLine*(e-o.m_MinLOD)/(o.m_MaxLOD-o.m_MinLOD)+o.m_startScrollPoint;jQuery(o.m_Divmapscrollpoint).css("top",i+"px")}else{var t=o.scene.GetCurrentZoomlevel();i=o.m_lengthScrollLine*(t-o.m_MinLOD)/(o.m_MaxLOD-o.m_MinLOD)+o.m_startScrollPoint;jQuery(o.m_Divmapscrollpoint).css("top",i+"px")}};o.StopAnimatedMove=function(){window.clearInterval(o.movetimer);o.movetimer=0;jQuery(o.m_Divmapcursorleft).removeAttr("style");jQuery(o.m_Divmapcursorright).removeAttr("style");jQuery(o.m_Divmapcursordown).removeAttr("style");jQuery(o.m_Divmapcursortop).removeAttr("style");jQuery(o.m_Divmapcursorreset).removeAttr("style");jQuery(o.m_Divmapcursorreset).css("top",o.curMoveX+"px");jQuery(o.m_Divmapcursorreset).css("left",o.curMoveY+"px")};o.ZoomToNextIntegerLOD=function(e){var i=o.scene.m_Canvas[0].m_nExactLOD;var t=e?Math.ceil(i):Math.floor(i);if(i!=t){o.scene.AnimateZoomToGeo(o.scene.GetCenterPos(),t,o.zoomtimerfrq)}else{o.scene.InternalOnZoomLayer(o.scene.m_Canvas[o.scene.m_nOverlayIndex])}};o.StartAnimatedZoom=function(e){var i=o.scene.GetCenterPos();if(o.zoomtimer){window.clearInterval(o.zoomtimer)}o.zoomtimer=window.setInterval(function(){var t=o.scene.GetCurrentZoomlevel()+.2*e;o.scene.ZoomToZoomlevel(i,t,true)},o.zoomtimerfrq)};o.processmouseup=function(){o.bInitDrag=false;o.StopAnimatedMove();document.removeEventListener("mouseup",o.processmouseup,true);document.removeEventListener("mousemove",o.processmousemove,true)};o.zoom_processmouseup=function(e){document.removeEventListener("mouseup",o.zoom_processmouseup,true);document.removeEventListener("mousemove",o.zoom_processmousemove,true);if(o.bInitDrag){var i=e.pageY-o.offsetY;if(i<0){i=0}if(i>o.m_lengthScrollLine){i=o.m_lengthScrollLine}var t=o.m_MinLOD+(o.m_MaxLOD-o.m_MinLOD)*i/o.m_lengthScrollLine;o.scene.AnimateZoomToGeo(o.midpointForZoom,Math.round(t),5)}o.bInitDrag=false};o.processmousemove=function(e){var i,t;if(o.bInitDrag==true){window.clearInterval(o.movetimer);o.movetimer=0;var r=e.pageX-o.offsetX;var m=e.pageY-o.offsetY;var n=parseInt(Math.sqrt(Math.pow(r-o.curMoveX,2)+Math.pow(m-o.curMoveY,2)),10);var s=17;if(n>s){var a=Math.atan2(r-o.curMoveX,m-o.curMoveY);i=Math.ceil(o.curMoveX+Math.sin(a)*s);t=Math.ceil(o.curMoveY+Math.cos(a)*s);n=s}else{i=r;t=m}jQuery(o.m_Divmapcursorreset).css("top",t+"px");jQuery(o.m_Divmapcursorreset).css("left",i+"px");var u=-(jQuery(o.m_Divmapcursorreset).position().left-o.curMoveX)*(n/s);var c=-(jQuery(o.m_Divmapcursorreset).position().top-o.curMoveY)*(n/s);o.movetimer=window.setInterval(function(){o.scene.MoveMap(u,c)},o.tint)}};o.zoom_processmousemove=function(e){var i=e.pageY-o.offsetY;if(!o.bInitDrag){if(i!=o.curZoomY){o.bInitDrag=true}}if(o.bInitDrag){if(i<0){i=0}if(i>o.m_lengthScrollLine){i=o.m_lengthScrollLine}jQuery(o.m_Divmapscrollpoint).css("top",i+"px");var t=o.m_MinLOD+(o.m_MaxLOD-o.m_MinLOD)*i/o.m_lengthScrollLine;o.scene.ZoomToZoomlevel(o.midpointForZoom,t)}};return o}});
/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5) (c) Copyright 2009-2012 SAP AG. All rights reserved
 */
sap.ui.predefine("sap/ui/vbm/lib/sapparsing", ["./sapvbi"],function(){"use strict";VBI.Parser=function(){var e={};e.formulas=[];e.fPos=0;e.fCode="";e.fAttributes=[];e.clear=function(){var r;while((r=e.formulas.shift())!=undefined){e.clearExpression(r.dTree)}};e.evaluate=function(r,t,a){e.vo=r;e.voi=t;e.ctx=a;e.pos=undefined;var n=e.formulas.length;for(var o=0;o<n;++o){var s=e.formulas[o];if(e.evalF(s.dTree)){return s.index}}return-1};e.evalF=function(r){if(r.operator==false||r.operator==true){return r.operator}var t;if(r.operator==600){t=e.evalF(r.operand1);return t?e.evalF(r.operand2):false}if(r.operator==700){t=e.evalF(r.operand1);return t?true:e.evalF(r.operand2)}var a;var n=e.vo;switch(r.operand1){case"text":a=n.m_Text.GetValueString(e.ctx);break;case"itext":a=parseInt(n.m_Text.GetValueString(e.ctx),10);break;case"id":a=n.m_ID;break;case"image":a=n.m_Image.GetValueString(e.ctx);break;case"x":if(!e.pos){e.pos=e.vo.m_Pos.GetValueVector(e.ctx)}a=e.pos[0];break;case"y":if(!e.pos){e.pos=e.vo.m_Pos.GetValueVector(e.ctx)}a=e.pos[1];break;case"tooltip":a=n.m_Tooltip.GetValueString(e.ctx);break;default:var o=e.fAttributes[e.voi];a="";for(var s=0;s<o.length;++s){if(o[s].name==r.operand1){var u=n.m_DataSource.m_CurElement.m_dataattributes[o[s].index];if(u!=undefined){a=u.m_Value}}}}switch(r.operator){case 50:return a==r.operand2;case 51:return a>=r.operand2;case 52:return a>r.operand2;case 55:return a!=r.operand2;case 56:return a<=r.operand2;case 57:return a<r.operand2;default:break}};e.verifyAttribute=function(r,t,a){if(jQuery.type(r.operand2)=="object"){e.verifyAttribute(r.operand2,t,a)}if(jQuery.type(r.operand1)=="object"){e.verifyAttribute(r.operand1,t,a)}else{var n=r.operand1;if(n!="id"&&n!="image"&&n!="x"&&n!="y"&&n!="tooltip"){if(!e.fAttributes){e.buildAttributeTable(t)}for(var o=0;o<a.m_datatypenodes.length;++o){var s=a.m_datatypenodes[o];var u=s.m_Name;var f=s.m_datatypeattributes;for(var i=0;i<f.length;++i){var d=f[i];if(d.m_Name==n){for(var p=0;p<e.fAttributes.length;++p){var c=e.fAttributes[p];if(c.m_Name==u){var l=false;for(var v=0;v<c.length;++v){if(c[v].name==n){l=true}}if(!l){c.push({name:n,index:i})}}}}}}}}};e.buildAttributeTable=function(r){e.fAttributes=[];for(var t=0;t<r.length;++t){var a=[];var n=r[t].m_DataSource;if(n!=undefined){a.m_Name=n.m_NPath[0];e.fAttributes.push(a)}}};e.verifyAttributes=function(r,t){e.fAttributes=undefined;var a=t.m_DataTypeProvider;for(var n=0;n<e.formulas.length;++n){e.verifyAttribute(e.formulas[n].dTree,r,a)}};e.clearExpression=function(r){if(jQuery.type(r)!="object"){return}e.clearExpression(r.operand1);e.clearExpression(r.operand2);r.operand1=r.operand2=undefined};e.addFormula=function(r,t){e.formulas.push({index:r,formula:t,dTree:e.buildDecisionTree(t)});return e.formulas.length-1};e.buildDecisionTree=function(r){e.fPos=0;e.fCode=r;var t={};if(!e.parseExpression(t)){VBI.Trace("Error: "+r+" could not be interpreted");t.operator=false}return t};e.parseExpression=function(r){var t=e.scan();if(t==-1){r.operator=true;return r.operator}if(t==10){r.operand1={};if(!e.parseExpression(r.operand1)){return false}if(e.scan()!=20){return false}r.operator=e.scan();if(e.ttype!=2){return false}if(e.scan()!=10){return false}r.operand2={};if(!e.parseExpression(r.operand2)){return false}if(e.scan()!=20){return false}return true}if(t==500){r.operand1=e.token;r.operator=e.scan();if(e.ttype!=1){return false}e.scan();if(e.ttype!=10){return false}r.operand2=e.token;return true}return false};e.scan=function(){var r;var t=0;if(e.fPos>=e.fCode.length){return-1}var a=e.fCode.substr(e.fPos,1);switch(true){case a=="(":return e.getToken(a,10,0);case a==")":return e.getToken(a,20,0);case a=="=":return e.getToken(a,50,1);case a=="!":return e.fCode.substr(e.fPos+1,1)=="="?e.getToken("!=",55,1):false;case a=="<":case a==">":t=5*(a=="<");r=e.fCode.substr(e.fPos+1,1);if(r=="="){return e.getToken(a+r,51+t,1)}if(a=="<"&&r==">"){return e.getToken("!=",55,1)}return e.getToken(a,52+t,1);case a=="|":case a=="&":t=100*(a=="|");r=e.fCode.substr(e.fPos+1,1);if(a!=r){r=""}return e.getToken(a+r,600+t,2);case a>="0"&&a<="9":return e.readNumber(a);case a>="a"&&a<="z"||a>="A"&&a<="Z":return e.readString(a);default:return-2}};e.readNumber=function(r){var t=r;var a=1;var n=e.fCode.substr(e.fPos+a,1);while(n>="0"&&n<="9"){t+=n;a++;n=e.fCode.substr(e.fPos+a,1)}return e.getToken(t,600,10)};e.readString=function(r){var t=r;var a=1;var n=e.fCode.substr(e.fPos+a,1);while(n>="a"&&n<="z"||n>="A"&&n<="Z"||n>="0"&&n<="9"||n=="_"||n=="."||n=="/"||n=="\\"){t+=n;a++;n=e.fCode.substr(e.fPos+a,1)}return e.getToken(t,500,10)};e.getToken=function(r,t,a){e.fPos+=r.length;e.token=r;e.ttype=a;return t};return e}});
/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5) (c) Copyright 2009-2012 SAP AG. All rights reserved
 */
sap.ui.predefine("sap/ui/vbm/lib/sappositioning", ["./sapvbi"],function(){"use strict";VBI.addScenePositioningFunctions=function(a){a.GetNearestPosArray=function(a){var t=a.slice();var e=Math.floor(t.length/3)*3;var r=t[0];var n=t[1];var i=r,v=r;var o=n,m=n;for(var s=3;s<e;s+=3){while(t[s]-r>180){t[s]-=360}while(r-t[s]>180){t[s]+=360}r=t[s];n=t[s+1];if(i>r){i=r}if(v<r){v=r}if(o>n){o=n}if(m<n){m=n}}t.m_MinX=i;t.m_MaxX=v;t.m_MinY=o;t.m_MaxY=m;return t};a.GetNearestPos=function(a,t){var e=a.slice();var r=t[0];while(e[0]-r>180){e[0]-=360}while(r-e[0]>180){e[0]+=360}return e};a.BuildCacheDataObj=function(){var t={};t.mul=Math.PI/180;var e=a.m_Canvas[0];var r=a.m_Canvas[a.m_nOverlayIndex];var n=e.m_nCurrentLOD;t.minLOD=a.GetMinLOD();t.lod=n;t.nMaxLODTiles=1<<n;t.tilePixelWidth=a.m_nWidthCanvas/a.m_nTilesX;t.tilePixelHeight=a.m_nHeightCanvas/a.m_nTilesY;t.completeX=t.nMaxLODTiles*t.tilePixelWidth;t.completeY=t.nMaxLODTiles*t.tilePixelHeight;t.fx=r.getPixelWidth()/a.m_nWidthCanvas;t.fy=r.getPixelHeight()/a.m_nHeightCanvas;var i=a.m_Proj;t.ucs_min=i.m_nUCSMin*t.completeX;t.ucs_max=i.m_nUCSMax*t.completeX;t.ucs_compl=i.m_nXYRatio*t.completeX;t.ox=e.m_nCurrentX*t.tilePixelWidth+t.ucs_min;t.oy=e.m_nCurrentY*t.tilePixelHeight;t.factX=t.completeX*t.fx;t.factY=t.completeY*t.fy;t.addX=-t.ox*t.fx;t.addY=-t.oy*t.fy;a.m_CacheVars=t};a.DestroyCacheDataObj=function(){a.m_CacheVars=undefined};a.FillPositionCache=function(t,e){var r=a.m_CacheVars;var n=[1,1],i=[];var v=e?0:t[0];var o,m;var s=t[0],h=t[0];var l=t[1],_=t[1];var c=a.m_Proj.LonLatToUCS;var f=r.mul;for(var C=0,u=t.length;C<u;C+=3){o=t[C];m=t[C+1];while(o-v>180){o-=360}while(v-o>180){o+=360}if(o<s){s=o}if(o>h){h=o}if(m<l){l=m}if(m>_){_=m}n=c([f*o,f*m],[1,1]);i.push(n[0],n[1],0);if(!e){v=o}}t.cache={data:i,ref:a.m_CacheVars,lt:c([f*s,f*_],[1,1]),rb:c([f*h,f*l],[1,1]),minLod:-Math.log(Math.max(h-s,_-l))/Math.log(2)}};a.GetVOExtension=function(t){if(t.cache==undefined){a.FillPositionCache(t)}return t.cache.BB};a.GetPointArrayFromPosArrayWCache=function(t){if(t.cache==undefined){a.FillPositionCache(t)}return t.cache.data};a.GetPointFromUCSPoint=function(t){var e=a.m_CacheVars;return[t[0]*e.factX+e.addX,t[1]*e.factY+e.addY]};a.GetPointArrayFromUCSArray=function(t){var e=a.m_CacheVars;var r=e.factX,n=e.factY;var i=e.addX,v=e.addY;var o=[];for(var m=0;m<=t.length-3;m+=3){o.push(t[m]*r+i,t[m+1]*n+v,0)}return o};a.GetShortPointArrayFromUCSArray=function(t){var e=a.m_CacheVars;var r=e.factX,n=e.factY;var i=e.addX,v=e.addY;var o=[];for(var m=0;m<=t.length-3;m+=3){o.push(t[m]*r+i,t[m+1]*n+v)}return o};a.GetPointArrayFromPosArray=function(t,e,r){var n=[0,0],i=[];var v=a.m_Canvas[0];var o=1<<v.m_nCurrentLOD;var m=a.m_nWidthCanvas/a.m_nTilesX;var s=a.m_nHeightCanvas/a.m_nTilesY;var h=o*m;var l=o*s;var _=a.m_Canvas[a.m_nOverlayIndex];var c=r?1:_.getPixelWidth()/a.m_nWidthCanvas;var f=r?1:_.getPixelHeight()/a.m_nHeightCanvas;var C=a.m_Proj.LonLatToUCS;var u=[0,0],d=Math.PI/180;var P=a.m_Proj;var g=P.m_nUCSMin*h;var x=P.m_nUCSMax*h;var X=P.m_nXYRatio*h;var G=v.m_nCurrentX*m+g;var O=v.m_nCurrentY*s;var Y,L;for(Y=0,L=t.length;Y<L;Y+=3){n[0]=d*t[Y];n[1]=d*t[Y+1];u[0]=h;u[1]=l;u=C(n,u);u[0]=u[0]-G;u[1]=u[1]-O;if(e){while(u[0]<g){u[0]+=X}while(u[0]>x){u[0]-=X}}i.push(u[0]*c,u[1]*f,0)}if(L==1&&u){var M,y;i.m_bVisible=(M=u[0])>0&&(y=u[1])>0&&M<a.m_nWidthCanvas&&y<a.m_nHeightCanvas}return i};a.GetPointFromGeo=function(t,e){return a.GetPointArrayFromPosArray(VBI.MathLib.RadToDeg(t),e)};a.GetInstanceOffsets=function(t){var e=t.slice();var r=a.m_Canvas[0];var n=a.m_nWidthCanvas/a.m_nTilesX;var i=(1<<r.m_nCurrentLOD)*n*a.m_Proj.m_nXYRatio;var v=[0,0,a.m_nWidthCanvas,a.m_nHeightCanvas];var o=0;while(e[2]>0){--o;VBI.Utilities.RectOffset(e,-i,0)}var m=[];while(e[0]<a.m_nWidthCanvas){o++;VBI.Utilities.RectOffset(e,i,0);if(VBI.Utilities.RectIntersect(e,v)){m.push(o*i)}}return m};a.GetCorrectedInstanceOffsets=function(t,e){var r=t.slice();var n=a.m_Canvas[0];var i=a.m_nWidthCanvas/a.m_nTilesX;var v=e[0]*(1<<n.m_nCurrentLOD)*i*a.m_Proj.m_nXYRatio;var o=[0,0,e[0]*a.m_nWidthCanvas,e[1]*a.m_nHeightCanvas];var m=0;while(r[2]>0){--m;VBI.Utilities.RectOffset(r,-v,0)}var s=[];while(r[0]<a.m_nWidthCanvas){m++;VBI.Utilities.RectOffset(r,v,0);if(VBI.Utilities.RectIntersect(r,o)){s.push(m*v)}}return s};a.GetPosFromVPPoint=function(t){var e=a.m_Canvas[a.m_nOverlayIndex];var r=[t[0]-e.getPixelLeft(),t[1]-e.getPixelTop(),0];var n=this.GetGeoFromPoint(r);return VBI.MathLib.RadToDeg(n)};a.GetPosFromPoint=function(a){var t=this.GetGeoFromPoint(a);return VBI.MathLib.RadToDeg(t)};a.GetGeoFromPoint=function(t){var e=a.m_Canvas[0];var r=e.m_nCurrentLOD;var n=1<<r;var i=t[0]*a.m_nWidthCanvas/e.getPixelWidth();var v=t[1]*a.m_nHeightCanvas/e.getPixelHeight();var o=a.m_nWidthCanvas/a.m_nTilesX;var m=a.m_nHeightCanvas/a.m_nTilesY;var s=e.m_nCurrentX*o;var h=e.m_nCurrentY*m;var l=s+i;var _=h+v;var c=n*o;var f=n*m;var C=[0,0];var u=[l/c*2-1,_/f*2-1];return a.m_Proj.UCSToLonLat(u,C)}}});
/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5) (c) Copyright 2009-2012 SAP AG. All rights reserved
 */
sap.ui.predefine("sap/ui/vbm/lib/sapprojection", ["./sapvbi"],function(){"use strict";VBI.LinearProjection=function(a){var t={};t.vbiclass="Projection/Linear";t.m_nXYRatio=2;t.m_nXMin=-2;t.m_nXMax=2;t.m_nGeometrySize=4;t.m_nUCSMin=-.5;t.m_nUCSMax=1.5;t.m_bIsIsogonal=true;t.LonLatToUCS=function(a,t){var n=t[0];var r=t[1];t[0]=n*(.5+a[0]/Math.PI);t[1]=r*(.5-a[1]/Math.PI);return t};t.UCSToLonLat=function(a,n){n[0]=Math.PI*(t.m_nUCSMin+a[0]/2);n[1]=-Math.PI*(a[1]/2);return n};return t};VBI.MercatorProjection=function(a){var t={};t.vbiclass="Projection/Mercator";t.m_nXYRatio=1;t.m_nXMin=-1;t.m_nXMax=1;t.m_nGeometrySize=2;t.m_nUCSMin=0;t.m_nUCSMax=1;t.m_bIsIsogonal=true;t.LonLatToUCS=VBI.MathLib.LonLatToUCS;t.UCSToLonLat=VBI.MathLib.UCSToLonLat;return t};VBI.ElliMercatorProjection=function(a){var t={};t.vbiclass="Projection/EllipticalMercator";t.m_nXYRatio=1;t.m_nXMin=-1;t.m_nXMax=1;t.m_nGeometrySize=2;t.m_nUCSMin=0;t.m_nUCSMax=1;t.m_bIsIsogonal=true;t.m_rmajor=6378137;t.m_rminor=6356752.3142;var n=t.m_rminor/t.m_rmajor;t.m_eccent=Math.sqrt(1-n*n);t.m_halfEccent=.5*t.m_eccent;t.m_PI_Div_180=Math.PI/180;t.m_PI_Div_2=Math.PI/2;t.m_PI_Div_4=Math.PI/4;t.m_majMultPIDiv180=t.m_PI_Div_180*t.m_rmajor;t.m_tolerance=1e-10;t.m_EllipticalBorder=89.5*t.m_PI_Div_180;t.m_PIx2=2*Math.PI;t.m_yMax=2*Math.PI*t.m_rmajor;t.LonLatToUCS=function(a,n){var r=a[0],_=Math.max(Math.min(a[1],t.m_EllipticalBorder),-t.m_EllipticalBorder);var o=t.m_eccent*Math.sin(_);o=Math.pow((1-o)/(1+o),t.m_halfEccent);var i=.5+r/t.m_PIx2;var m=.5+Math.log(Math.tan(t.m_PI_Div_4-_/2)/o)/t.m_PIx2;n[0]=n[0]*i;n[1]=n[1]*m;return n};t.UCSToLonLat=function(a,t){t[0]=Math.PI*a[0];t[1]=this.CalcPhi(Math.exp(Math.PI*a[1]));return t};t.CalcPhi=function(a){var n=15,r,_,o=t.m_PI_Div_2-2*Math.atan(a);do{_=t.m_eccent*Math.sin(o);r=t.m_PI_Div_2-2*Math.atan(a*Math.pow((1-_)/(1+_),t.m_halfEccent))-o;o+=r}while(Math.abs(r)>t.m_tolerance&&--n);return o};return t}});
/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5) (c) Copyright 2009-2012 SAP AG. All rights reserved
 */
sap.ui.predefine("sap/ui/vbm/lib/saprecttrack", ["./sapvbi"],function(){"use strict";VBI.addSceneRectangularTrackingFunctions=function(t){t.RectangularTracking=function(){this.m_PosStart=null;this.m_PosMove=null;this.m_bTrack=false;this.m_keycode=0};t.RectangularTracking.prototype.onsapkeydown=function(t){if(t.keyCode==this.m_keycode){this.ExitMode();t.preventDefault();return true}};t.RectangularTracking.prototype.onsapdown=function(e){var o=t.m_Canvas[t.m_nOverlayIndex].getBoundingClientRect();this.m_PosStart=t.GetPosFromPoint([e.clientX-o.left,e.clientY-o.top,0]);this.m_bTrack=true;if(e.type=="mousedown"){document.addEventListener("mouseup",this,true)}else if(e.type=="touchstart"){document.addEventListener("touchend",this,true)}else if(e.type=="pointerdown"){document.addEventListener("pointerup",this,true)}e.preventDefault();t.m_Canvas[t.m_nLabelIndex].focus({preventScroll:true});return true};t.RectangularTracking.prototype.handleEvent=function(e){if(e.type=="mouseup"){document.removeEventListener("mouseup",this,true)}else if(e.type=="touchend"){document.removeEventListener("touchend",this,true)}else if(e.type=="pointerup"){document.removeEventListener("pointerup",this,true);if(t.m_Gesture){t.m_Gesture.pointerCount--;if(!t.m_Gesture.pointerCount){t.m_Gesture.target=null;t.m_Gesture=null}}}this.TrackEnd(e)};t.RectangularTracking.prototype.TrackEnd=function(e){if(!this.m_bTrack){return false}if(this.m_PosStart&&this.m_PosMove){this.execute(e)}this.m_PosStart=null;this.m_PosMove=null;this.m_bTrack=false;t.RenderAsync(true);e.preventDefault();e.stopPropagation();return true};t.RectangularTracking.prototype.onsapmove=function(e){if(this.m_bTrack){var o=t.m_Canvas[t.m_nOverlayIndex].getBoundingClientRect();this.m_PosMove=t.GetPosFromPoint([e.clientX-o.left,e.clientY-o.top,0])}t.SetCursor("crosshair");t.RenderAsync(true);e.preventDefault();return true};t.RectangularTracking.prototype.onsapout=function(t){};t.RectangularTracking.prototype.execute=function(t){};t.RectangularTracking.prototype.Hook=function(e){t.SetInputMode(e);if(e==VBI.InputModeRectSelect){t.m_Ctx.m_Control.setProperty("rectangularSelection",true,true)}else{t.m_Ctx.m_Control.setProperty("rectZoom",true,true)}t.m_DesignVO=this;t.SetCursor("crosshair");t.RenderAsync(true)};t.RectangularTracking.prototype.UnHook=function(){if(t.m_nInputMode==VBI.InputModeRectSelect||t.m_nInputMode==VBI.InputModeRectZoom){t.m_Ctx.onChangeTrackingMode(t.m_nInputMode,false);if(t.m_nInputMode==VBI.InputModeRectSelect){t.m_Ctx.m_Control.setProperty("rectangularSelection",false,true)}else{t.m_Ctx.m_Control.setProperty("rectZoom",false,true)}t.SetInputMode(VBI.InputModeDefault)}else{jQuery.sap.log.error("Wrong InputMode in UnHook: "+t.m_nInputMode)}this.m_PosStart=null;this.m_PosMove=null;this.m_bTrack=false;t.m_DesignVO=null;t.RenderAsync(true)};t.RectangularTracking.prototype.ExitMode=function(){this.UnHook();t.SetCursor("default");t.RenderAsync(true)};t.RectangularZoom=function(){t.RectangularTracking.call(this);this.m_keycode=90;this.Hook(VBI.InputModeRectZoom)};t.RectangularZoom.prototype=Object.create(t.RectangularTracking.prototype);t.RectangularZoom.prototype.constructor=t.RectangularZoom;t.RectangularZoom.prototype.execute=function(e){var o=[];var r=[];o[0]=this.m_PosStart[0];o[1]=this.m_PosMove[0];r[0]=this.m_PosStart[1];r[1]=this.m_PosMove[1];t.ZoomToMultiplePositions(o,r,1)};t.RectangularZoom.prototype.Render=function(e,o){if(!this.m_bTrack){return false}if(this.m_PosMove&&this.m_PosStart){var r=t.GetPointFromPos(this.m_PosStart,false);var n=t.GetPointFromPos(this.m_PosMove,false);var i=n.slice(0);var a=n[0]-r[0];var s=n[1]-r[1];var c=t.GetInternalDivClientRect();var u=Math.abs(c.width/c.height);var l=Math.abs(a/s);var m=0;var p=0;if(l<u){p=n[0]-r[0];m=p/u;if(n[0]<r[0]&&n[1]>r[1]||n[0]>r[0]&&n[1]<r[1]){i[1]=r[1]-m}else{i[1]=r[1]+m}}else{m=n[1]-r[1];p=u*m;if(n[0]<r[0]&&n[1]>r[1]||n[0]>r[0]&&n[1]<r[1]){i[0]=r[0]-p}else{i[0]=r[0]+p}}VBI.Utilities.DrawTrackingRect(o,r[0],r[1],i[0],i[1]);var h=t.GetStretchFactor4Mode();i[0]*=h[0];i[1]*=h[1];this.m_PosMove=t.GetPosFromPoint([i[0],i[1]])}};t.RectSelection=function(){t.RectangularTracking.call(this);this.m_keycode=82;this.Hook(VBI.InputModeRectSelect)};t.RectSelection.prototype=Object.create(t.RectangularTracking.prototype);t.RectSelection.prototype.constructor=t.RectSelection;t.RectSelection.prototype.execute=function(e){var o=t.GetPointFromPos(this.m_PosStart,false);var r=t.GetPointFromPos(this.m_PosMove,false);var n=[];var i=[];var a;for(a=0;a<=1;a++){if(o[a]<r[a]){n[a]=o[a];i[a]=r[a]}else{n[a]=r[a];i[a]=o[a]}}var s=t.GetStretchFactor4Mode();n[0]/=s[0];i[0]/=s[0];n[1]/=s[1];i[1]/=s[1];this.selectionRect=[n[0],n[1],i[0],i[1]];t.PerFormMultiSelect(e,this)};t.RectSelection.prototype.Render=function(e,o){if(!this.m_bTrack){return false}if(this.m_PosMove&&this.m_PosStart){var r=t.GetPointFromPos(this.m_PosStart,false);var n=t.GetPointFromPos(this.m_PosMove,false);VBI.Utilities.DrawTrackingRect(o,r[0],r[1],n[0],n[1])}}}});
/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5) (c) Copyright 2009-2012 SAP AG. All rights reserved
 */
sap.ui.predefine("sap/ui/vbm/lib/sapresources", ["./sapvbi"],function(){"use strict";VBI.ResourceManager=function(){var e={};e.m_DummyData="iVBORw0KGgoAAAANSUhEUgAAABcAAAAfCAYAAAAMeVbNAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA3FpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNS1jMDIxIDc5LjE1NDkxMSwgMjAxMy8xMC8yOS0xMTo0NzoxNiAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDowNzUzN2NlNC1jZDhiLTE5NDQtYTQ0Ni01MTkxY2RjZDI4MDUiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6Q0YzODU2OThGNEM3MTFFNDlBRDQ5OUJGNUQ2N0Q4NjMiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6Q0YzODU2OTdGNEM3MTFFNDlBRDQ5OUJGNUQ2N0Q4NjMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIChXaW5kb3dzKSI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOmRiODhkOTNmLThiOTAtNDg0Zi1iMjljLThjNTEwOTYxZDNlOCIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDowNzUzN2NlNC1jZDhiLTE5NDQtYTQ0Ni01MTkxY2RjZDI4MDUiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz4LelIfAAADWklEQVR42qyWbUhTYRTHz+7UvTRfZls4FWe+a74wl1EfbFJpfsiMQjAlIcm3vhTUhyIl0KIvJRSF1ocoA78YSIhoJLalYoEvBb3oB80NlkYFLi1sNtc513un5jbn3IH/fc69z93vOXue85z7COx2O2xgR1A5qGxUFOojqg/1AjXg7ocCqNU77bA36K5hk4fKcvN7A6oNdc9Zp58TaC42t1BpdD9knoOnH76B/rMFTJYFSFFug9w4ORSlKiFGLtbhK6RC1BmUyWXkCL6PTSX5/UYL1PZMgWFq1mnIQkYARbuU0HAoGuJCJfTIgjqIGl4HR3ATNtW2JTvU641w3WAC8jeyIJEQmo4mQEn6Dv7Rbn4AhgNrCUxrW94+DvUvjR6ByX7+sUFp2ye4PWjmH7XQH3PA0erpcue1GVrefgVv7EL3BD+FKai77LRgKu7FdvD770WIbXzDRuKtZYTJYPSsFgSC5WShyAvIezQysyUw2buZeXhldCRAAcNtDugY/wG+sI4xByeb4BryRr7M+wQ+Ou3gaAgu+2W1wbzV5hP49JyVd1Vstiz8XQJf2SqWiIUHi/18Bg9ZYVkIbvLDrawOEfsEHrNcCsgmCT7E7tmIQJ/AM1Uy3h1huNoM+fFyn8Dz40N5t4/g3eQdS1ZAgFCwtSmRi0GzEnk/I6gzjKHTq5D6szV6K1aZFc5vfSpeS3zhoq8J1OrUQIvrjVHGVWWp+NsHjqqI0Tdjo09SSqE8M8wr+OX9UXwadvLfVmZV/0O6XD0QDYEi4abAiQopnN8Xwd/e4B0HHKN/gk1XeGAA3MyP9RhM09hyIglEbIFlAxxYB+fsIl0qtCooxOzxxK7oomBPJLtH6NNWvbpvDRyjpzNJM6344+OJkKCQuAXnxsqhLkfN315CLbqEcwPUYNNKq995Kg3kEud1JxkXv604hT0FcNnR8/87jIugTtOJio4Mz0pTQeq/9rXIIBE7MFfwWlFVziBO4Ri9lRvgfbY6GNpLUkHCDaDCBe8tz4CdcrbQ0e4uczVtjMtzXp3BzJ2kJvLwhNVVlgaZ4TLor9BA/HZ2LWgaTqJsm4ZzA0xic5gOn7roEBiu0bL1A+05qhj7Z92m6UaphoAJPDSlo9vIfcz78Nk5T9L0nwADACJ96CJRTtd4AAAAAElFTkSuQmCC";return e}();VBI.Resources=function(){var e={};e.m_resourcedata=[];e.m_resourceinstance=[];e.clear=function(){e.m_resourcedata=[];e.m_resourceinstance=[]};e.load=function(a,t){if(a.Set){e.clear();var i=a.Set.Resource;if(jQuery.type(i)=="object"){e.m_resourcedata[i.name]=i.value}else if(jQuery.type(i)=="array"){for(var r=0,m=i.length;r<m;++r){e.m_resourcedata[i[r].name]=i[r].value}}}};e.GetData=function(a){return e.m_resourcedata[a]};e.GetImageBits=function(a,t,i,r){var m,n=a;if(t){n+=t}if(i){n+=i}m=e.m_resourceinstance[a];if(m&&m.m_Bits){return[m.m_Bits,m.m_Image.naturalWidth,m.m_Image.naturalHeight]}var I=e.GetImage(a,null,null,r);if(I){var u=VBI.Utilities.GetImagePixelData(I).data;e.m_resourceinstance[a].m_Bits=u;return[e.m_resourceinstance[a].m_Bits,I.naturalWidth,I.naturalHeight]}return null};e.GetImage=function(a,t,i,r){var m,n;var I="";if(a!=undefined){var u=a.lastIndexOf(".");if(u>=0){I="/"+a.substring(u+1)}}var c=a;if(t){c+=t}if(i){c+=i}m=e.m_resourceinstance[c];if(m&&m.m_Image){return m.m_Image}if(m){if(t||i){m.m_Image=VBI.Utilities.CreateDOMColorShiftedImageFromData(e.m_resourcedata[a],I,t,i,r);return m.m_Image}m.m_Image=VBI.Utilities.CreateDOMImageFromData(e.m_resourcedata[a],I,r);return m.m_Image}else{var l=n=e.m_resourcedata[a];if(!l){if(VBI.m_bTrace){VBI.Trace("resource not found; default image loaded")}I="/png";n=VBI.ResourceManager.m_DummyData}if(t||i){e.m_resourceinstance[c]={m_Image:VBI.Utilities.CreateDOMColorShiftedImageFromData(n,I,t,i,r)};return e.GetImage(a,null,null,r)}return(e.m_resourceinstance[c]={m_Image:VBI.Utilities.CreateDOMImageFromData(n,I,r)}).m_Image}};return e}});
/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5) (c) Copyright 2009-2012 SAP AG. All rights reserved
 */
sap.ui.predefine("sap/ui/vbm/lib/sapscale", ["./sapvbi"],function(){"use strict";VBI.SupportedUnitsOfLength=[{RequestedUnit:"km",DisplayUnitDefault:"m",DisplayUnit2:"km",ConvFactor:1e3,ConvFactorMeter:1},{RequestedUnit:"mi",DisplayUnitDefault:"ft",DisplayUnit2:"mi",ConvFactor:5280,ConvFactorMeter:.3048},{RequestedUnit:"nm",DisplayUnitDefault:"ft",DisplayUnit2:"nm",ConvFactor:6076.12,ConvFactorMeter:.3048}];VBI.Scale=function(){var t={};t.scene=null;t.m_ID=null;t.m_Image=null;t.m_CurrentUnit=null;t.m_DisplayUnit=null;t.m_nDivider=0;t.m_nScalerLength=0;t.m_nDistance=0;t.m_bRtl=false;t.clear=function(){var e=document.getElementById(t.m_canvas.id);if(e){e.parentNode.removeChild(e)}t.m_Image=null;t.scene=null};t.Awake=function(e,n){t.scene=e;var a=jQuery.sap.byId(n);t.m_ID=jQuery(a).attr("id");t.AppendCanvas()};t.getId=function(t,e){return e+"-"+t};t.AppendCanvas=function(){t.m_bRtl=document.dir=="rtl"?true:false;t.m_canvas=document.createElementNS("http://www.w3.org/2000/svg","svg");t.m_canvas.setAttribute("role",sap.ui.core.AccessibleRole.Note);t.m_canvas.setAttribute("class","vbi-scale");t.m_canvas.setAttribute("id",t.getId("vbi-scale-canvas",t.m_ID));t.m_canvas.m_VBIType="S";t.scene.m_MapDecoDiv.appendChild(t.m_canvas)};t.getConfig=function(){if(t.m_CurrentUnit){return t.m_CurrentUnit}else{var e=t.scene.m_Ctx;var n,a;if(e){n=e.GetConfig()}if(n){a=n.GetData("UnitOfLength")}if(a){for(var i=0;i<VBI.SupportedUnitsOfLength.length;++i){if(VBI.SupportedUnitsOfLength[i].RequestedUnit==a){t.m_CurrentUnit=VBI.SupportedUnitsOfLength[i];break}}}}if(!t.m_CurrentUnit){t.m_CurrentUnit=VBI.SupportedUnitsOfLength[0]}return t.m_CurrentUnit};t.getImage=function(e){if(t.m_Image){return t.m_Image}var n=new Image;if(e){n.onload=function(){if(typeof e==="function"){e(n)}this.onload=null}}n.src=sap.ui.resource("sap.ui.vbm","themes/base/img/sapvisualbusiness.png");t.m_Image=n;return n};t.CalcScaleDimensions=function(){if(t.scene.m_Canvas[0].m_nCurrentLOD<1){return false}var e=t.scene.GetInternalDivClientRect();var n=t.getConfig();var a=[parseInt(e.width/2-75,10),parseInt(e.height/2,10)];var i=[a[0]+180,a[1]];var r=t.scene.GetDistance(a,i);var s;r=r*(1/n.ConvFactorMeter);if(r>=n.ConvFactor){s=parseInt(r/n.ConvFactor,10);t.m_DisplayUnit=n.DisplayUnit2}else{s=r;t.m_DisplayUnit=n.DisplayUnitDefault}var l=parseInt(Math.log(s)/Math.LN10,10);s=parseInt(s/Math.pow(10,l),10);if(s<2){s=1}else if(s<5){s=2}else if(s<10){s=5}s=parseInt(s*Math.pow(10,l),10);var o;if(r>=n.ConvFactor){o=s*n.ConvFactor;o=o*n.ConvFactorMeter}else{o=s*n.ConvFactorMeter}var u=t.scene.GetTargetPointForDistance(o,a);var c=[u[0]+t.scene.m_Canvas[0].getPixelLeft(),u[1]+t.scene.m_Canvas[0].getPixelTop()];var m=s;var v=0;while(v==0&&m>0){v=m%5;m/=10}if(v!=2){v=5}var p=Math.round(c[0]-a[0]);if(p>60&&p<e.right-e.left){t.m_nScalerLength=p;t.m_nDistance=s;t.m_nDivider=v;return true}return false};t.Update=function(){t.CalcScaleDimensions();var e=(t.m_nScalerLength+t.m_nDivider)/2,n=t.m_nDistance/2;var a=document.getElementById(t.m_canvas.id);if(a){a.setAttribute("height",15);a.setAttribute("width",e+1);jQuery(a).empty();var i=document.createElementNS("http://www.w3.org/2000/svg","path");i.setAttribute("d","M 1 4 V 10 H "+e+" V 4");i.setAttribute("stroke","black");i.setAttribute("stroke-width",2);i.setAttribute("fill","none");a.appendChild(i);var r=document.createElementNS("http://www.w3.org/2000/svg","text");var s;if(document.dir==="rtl"){s=(n.toString().length+t.m_DisplayUnit.length+1)*6+2}else{s=e-2-(n.toString().length+t.m_DisplayUnit.length+1)*6}r.setAttribute("x",s);r.setAttribute("y",8);r.setAttribute("font-size",10);r.textContent=n+" "+t.m_DisplayUnit;a.appendChild(r)}};return t}});
/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5) (c) Copyright 2009-2012 SAP AG. All rights reserved
 */
sap.ui.predefine("sap/ui/vbm/lib/sapscene", ["./sapvbi","sap/ui/core/Popup"],function(){"use strict";VBI.InputModeDefault=0;VBI.InputModeTrackObject=1;VBI.InputModeTrackMap=2;VBI.InputModeTrackDesign=3;VBI.InputModeRectSelect=4;VBI.InputModeLassoSelect=5;VBI.InputModeRectZoom=6;VBI.SceneManager=function(){var e={};e.vbiclass="SceneManager";e.m_SceneArray=[];e.find=function(n){for(var a=0;a<e.m_SceneArray.length;++a){if(e.m_SceneArray[a].m_ID==n){return e.m_SceneArray[a]}}return null};e.clear=function(){for(var n=0;n<e.m_SceneArray.length;++n){e.m_SceneArray[n].clear()}e.m_SceneArray=[]};e.load=function(n,a){if(n.Set){e.loadScenes(n.Set,false,n,a)}if(n.Merge){e.loadScenes(n.Merge,true,n,a)}};e.loadScenes=function(n,a,t,i){if(jQuery.type(n)=="array"){for(var r=0;r<n.length;++r){e.loadScene(n[r],a,t,i)}}else{e.loadScene(n,a,t,i)}};e.loadScene=function(n,a,t,i){var r;var m=false;if(n.name){r=e.find(n.name);if(r){if(!a){r.clear()}if(n.SceneGeo){m=r.load(n.SceneGeo,i,a)}else if(n.Scene3D){m=r.load(n.Scene3D,i,a)}else{m=r.load(n.Scene,i,a)}if(m){r.ReAwake()}return}}else if(!a){e.clear()}if(n.SceneGeo){e.loadNewScene(n.SceneGeo,"geo",i)}if(n.Scene3D){e.loadNewScene(n.Scene3D,"3d",i)}if(n.Scene){e.loadNewScene(n.Scene,"default",i)}};e.loadNewScene=function(n,a,t){var i=null;if(jQuery.type(n)=="object"){if(a=="geo"){i=new VBI.GeoScene(null,null,null)}else if(a=="3d"){i=new VBI.Scene3D(null)}else{i=new VBI.Scene(null,null,null)}i.load(n,t);e.Add(i)}else if(jQuery.type(n)=="array"){for(var r=0;r<n.length;++r){i=null;if(a=="geo"){i=new VBI.GeoScene(null,null,null)}else if(a=="3d"){i=new VBI.Scene3D(null)}else{i=new VBI.Scene(null,null,null)}i.load(n[r],t);e.Add(i)}}};e.Add=function(n){e.m_SceneArray.push(n)};e.GetScene=function(n){for(var a=0;a<e.m_SceneArray.length;++a){if(e.m_SceneArray[a].m_TargetName==n){return e.m_SceneArray[a]}}return null};e.GetSceneByName=function(n){for(var a=0;a<e.m_SceneArray.length;++a){if(e.m_SceneArray[a].m_ID==n){return e.m_SceneArray[a]}}return null};return e};VBI.Scene=function(e){var n={};n.vbiclass="Scene";n.m_TargetName=e;n.m_EvtCont=new VBI.Events;n.m_ID="";n.m_Ctx=null;n.m_Div=null;n.m_Parent=null;n.m_CaptureVO=null;n.m_DesignVO=null;n.m_VOS=[];n.m_Events=null;n.m_Proj=null;n.m_LastDefinedCenterPos=n.m_LastZoomArea=undefined;n.m_HotItem={m_VO:null,m_Index:null,m_Design:null,m_HitObj:null};n.m_DragInfo=null;n.m_Target=e;n.m_KeysDown=[];n.m_KeysSkipUp=[];n.m_KeysSkipPress=[];n.LoadSingleVO=function(e,a,t,i){if(jQuery.type(e)=="object"){var r=null;if(n.vbiclass=="3DScene"){r=a.Factory3D.CreateInstance(e.type)}else{r=a.Factory.CreateInstance(e.type)}r.m_Scene=n;r.load(e,t);if(i){var m=r.m_ID;for(var o=n.m_VOS.length;o--;){if(n.m_VOS[o].m_ID==m){n.m_VOS[o]=r;return}}}n.m_VOS.push(r)}};n.BaseLoad=function(e,a,t){if(!t){VBI.RegisterKeyboardHook();n.m_Ctx=a;if(e.id){n.m_ID=e.id}}if(e.VO){var i=new VBI.VisualObjects;if(jQuery.type(e.VO)=="array"){for(var r=0;r<e.VO.length;++r){n.LoadSingleVO(e.VO[r],i,a,t)}}else{n.LoadSingleVO(e.VO,i,a,t)}}};n.BaseClear=function(){for(var e=0,a=n.m_VOS.length;e<a;++e){n.m_VOS[e].clear()}n.m_VOS=[];n.m_Ctx=null;n.m_CaptureVO=null;n.m_DesignVO=null;if(n.m_Parent){n.m_Parent.m_refSceneInstance=null}n.m_HotItem=null;if(n.m_Events){n.m_Events.clear();n.m_Events=null}VBI.UnRegisterKeyboardHook()};n.BaseGetVO=function(e){for(var a=0,t=n.m_VOS.length;a<t;++a){if(n.m_VOS[a].m_ID==e){return n.m_VOS[a]}}return null};n.load=function(e,a,t){n.BaseLoad(e,a,t);return false};n.clear=function(){n.BaseClear();n.m_Div=null};n.VerifyHotItem=function(e,a){var t=n.m_HotItem;if(a!=t.m_Index&&e==t.m_VO){var i=e.m_BBRefs[a];if(t.cI==i.cI&&t.nI==i.i){t.m_Index=a}}n.m_LastHotItem=undefined};n.CheckHotItem=function(){if(this.m_LastHotItem){var e=this.m_LastHotItem;var a=e.cI!=undefined?n.m_PreassembledData.clust[e.cI]:n.m_PreassembledData.base[n.m_LastHotItem.m_VO];if(a.m_nRecalcs!=e.recalcs){n.InternalSetHotItem(null,null,true);this.m_LastHotItem=undefined}}};n.SetLastHotItem=function(e){if(e.m_VO&&e.m_VO.m_BBRefs!=undefined){var a=e.m_VO.m_BBRefs[e.m_Index];var t=a.cI!=undefined?n.m_PreassembledData.clust[a.cI]:n.m_PreassembledData.base[e.m_VO.m_nPreDataIndex];n.m_LastHotItem={cI:a.cI,i:a.i,m_VO:e.m_VO.m_nPreDataIndex,recalcs:t.m_nRecalcs}}};n.InvalidateInvisibleHots=function(){if(this.m_LastHotItem!=undefined){var e=this.m_LastHotItem;var a=e.cI!=undefined?n.m_PreassembledData.clust[e.cI]:n.m_PreassembledData.base[n.m_LastHotItem.m_VO];if(a[e.i]!=undefined){a[e.i].h=false;n.InternalSetHotItem(null,null,true)}this.m_LastHotItem=undefined}};n.InternalSetHotItem=function(e,a,t){var i=n.m_HotItem;var r=false;var m=i.m_Index;var o=i.m_VO;if(a){if(i.m_Index!=a.m_Index){i.m_Index=a.m_Index;r=true}if(i.m_Design!=a.m_Design){i.m_Design=a.m_Design;r=true}if(i.m_Entity!=a.m_Entity){i.m_Entity=a.m_Entity;r=true}}else if(i.m_Entity||i.m_Detail){r=true;i.m_Entity=null;i.m_Detail=null}if(i.m_VO!=e){i.m_VO=e;r=true}if(!r){var l;if(a&&(l=i.m_HitObj)){if(!jQuery.sap.equal(l,a,2)){r=true}}else if(a!=null||i.m_HitObj!=null){r=true}}i.m_HitObj=a;if(r){if(o&&!t){o.InternalChangeHotItem(m,false,i)}if(e){e.InternalChangeHotItem(i.m_Index,true,i)}n.RenderAsync(false)}return r};n.InternalRenderVisualObjects=function(e,a){var t=Date.now();var i=n.m_VOS;VBI.Utilities.BackupFont(a);for(var r=0;r<n.m_VOS.length;++r){i[r].Render(e,a)}VBI.Utilities.RestoreFont(a);n.m_nLastRenderingTime=Date.now()-t};n.Render=function(){};n.Awake=function(e){n.InternalRenderVisualObjects(null,n.m_Ctx)};n.NotifyDataChange=function(){for(var e=0;e<n.m_VOS.length;++e){n.m_VOS[e].NotifyDataChange(n.m_Ctx)}n.m_nDataVersion++};n.GetPointArrayFromPosArray=function(e,n){return e};n.GetPosFromPoint=function(e){return e};n.GetPointFromPos=function(e,a,t){return n.GetPointArrayFromPosArray(e,a,t)};n.GetInternalDivClientRect=function(){var e=n.m_Div.getBoundingClientRect();if(this.m_Ctx.moThumbnail&&this.m_Ctx.moThumbnail.nOrgWidth&&this.m_Ctx.moThumbnail.nOrgHeight){return{left:e.left,top:e.top,width:n.m_Ctx.moThumbnail.nOrgWidth,height:n.m_Ctx.moThumbnail.nOrgHeight,right:e.left+n.m_Ctx.moThumbnail.nOrgWidth,bottom:e.top+n.m_Ctx.moThumbnail.nOrgHeight}}return e};n.GetEventVPCoords=function(e){if(!e){return[0,0]}var a=n.GetInternalDivClientRect();if(VBI.m_bIsRtl){return[a.right-e.clientX,e.clientY-a.top]}else{return[e.clientX-a.left,e.clientY-a.top]}};n.GetEventVPCoordsObj=function(e){var a=n.GetEventVPCoords(e);return{x:a[0].toString(),y:a[1].toString()}};n.GetEventVPCoordsObjWithScene=function(e){var a=n.GetEventVPCoords(e);return{x:a[0].toString(),y:a[1].toString(),scene:n.m_ID}};n.GetEventDropObjWithScene=function(e){return{strSource:n.m_DragInfo.strScene+"|"+n.m_DragInfo.strID+"|"+n.m_DragInfo.strInstance,scene:n.m_ID}};n.DispatchEvent=function(e,a){if(VBI.m_bTrace){VBI.Trace("DispatchEvent "+e.type+" as "+a+" mode:"+n.m_nInputMode+(n.m_Gesture?" gesture active":""))}if(n.m_nInputMode==VBI.InputModeTrackMap){return false}var t,i=e.type;if(a){e.m_evName=i=a}e.m_Scene=n;if(e.offsetX==undefined||e.offsetY==undefined){var r;if(e.clientX!==undefined&&e.clientY!==undefined){r=e.target.getBoundingClientRect();e.offsetX=e.clientX-r.left;e.offsetY=e.clientY-r.top}else if(e.changedTouches!==undefined&&e.changedTouches.length>0){r=e.target.getBoundingClientRect();e.clientX=e.changedTouches[0].clientX;e.clientY=e.changedTouches[0].clientY;e.offsetX=e.clientX-r.left;e.offsetY=e.clientY-r.top}}if(e.shiftKey==undefined){e.shiftKey=VBI.m_shiftKey}if(e.ctrlKey==undefined){e.ctrlKey=VBI.m_ctrlKey}if(n.m_DesignVO){if(VBI.m_bTrace){VBI.Trace("DispatchEvent to Design VO")}if((t=n.m_DesignVO["on"+i])&&typeof t=="function"){if(t.call(n.m_DesignVO,e)){return true}}}if(n.m_CaptureVO){if((t=n.m_CaptureVO["on"+i])&&typeof t=="function"){if(t.call(n.m_CaptureVO,e)){return true}}}var m=n.m_Ctx.m_Control;if(i.indexOf("click")!=-1&&m instanceof sap.ui.vbm.GeoMap&&m.getEnableOverlappingTest()){e.hitTests=[];for(var o=0;o<n.m_VOS.length;++o){if((t=n.m_VOS[o]["on"+i])&&typeof t=="function"){t.call(n.m_VOS[o],e)}}if(e.hitTests.length>1){e.hitTests=e.hitTests.filter(function(e){var n=m.getAggregatorContainer(e.m_Vo.m_ID);var a=e.m_Vo.m_ID==="Region"&&m instanceof sap.ui.vbm.AnalyticMap;switch(i){case"sapclick":if(n){return n.isSubscribed("click",e.m_Index)||n.isSelectable()}else if(a){return m.hasListeners("regionClick")||m.isRegionSubscribed("click",e.m_Entity)}break;case"sapsecclick":if(n){return n.isSubscribed("contextMenu",e.m_Index)}else if(a){return m.hasListeners("regionContextMenu")||m.isRegionSubscribed("contextMenu",e.m_Entity)}break}return false});if(e.hitTests.length>1){n.showHitMenu(e,e.hitTests);delete e.hitTests;e.preventDefault();return true}}if(e.hitTests.length>0){e.hitCached=e.hitTests[0];delete e.hitTests;if(e.hitCached.m_Vo){return e.hitCached.m_Vo["on"+i].call(e.hitCached.m_Vo,e)}else{delete e.hitCached}}else{return false}}for(var o=n.m_VOS.length-1;o>=0;--o){if((t=n.m_VOS[o]["on"+i])&&typeof t=="function"){if(t.call(n.m_VOS[o],e)){return true}}}return false};return n};VBI.Scene3D=function(e){var n=new VBI.Scene(e);n.vbiclass="3DScene";n.m_DivCopyright=null;n.m_bMainSceneInitialized=false;n.m_Events=null;n.m_Canvas=[];n.m_nMaxCanvasDimension=VBI.m_bIsMobile?6144:8192;n.clear=function(){n.BaseClear();n.clearCanvases();n.m_TargetName=null;n.m_Proj=null;n.m_DivCopyright=null;n.m_Target=null};n.clearCanvas=function(e){n.m_Canvas[e].m_Scene=null;n.m_Canvas[e]=null};n.clearCanvases=function(){for(var e=0,a=n.m_Canvas.length;e<a;++e){n.clearCanvas(e)}n.m_Canvas=[]};n.Init=function(){};n.InitializeCanvas=function(e){e.m_Scene=n;e.m_nCurrentX=undefined;e.m_nCurrentY=undefined;e.m_bInvalid=false;if(!e.m_bNotInDOM){n.m_Div.appendChild(e)}};n.CreateCanvases=function(){n.m_Canvas.push(VBI.Utilities.Create3DSceneCanvas("layer1",n.m_nWidthCanvas,n.m_nHeightCanvas,2));for(var e=0;e<n.m_Canvas.length;++e){n.InitializeCanvas(n.m_Canvas[e])}};n.Awake=function(e){if(!(n.m_Target=VBI.Utilities.GetDOMElement(e))){n.m_Target=VBI.Utilities.CreateDOMElement(e,"1px","1px")}if(n.m_Div){if(n.m_Div.parentNode==n.m_Target){return}n.m_Target.appendChild(n.m_Div);return}n.m_TargetName=e;n.m_Div=VBI.Utilities.Create3DSceneDiv(e+"-3Dscene");n.m_Target.appendChild(n.m_Div);n.DoAwake(e)};n.DoAwake=function(e){n.CalculateCanvasDimensions();n.CreateCanvases();n.Init();
// // append copyright
// scene.AddCopyright();
var a=n.m_Canvas[0];n.m_Events=new VBI.SceneEvent(this,a)};n.CalculateCanvasDimensions=function(){var e=n.m_Target.offsetWidth;var a=n.m_Div.getBoundingClientRect();var t=a.width?a.width:n.m_Div.clientWidth;var i=a.height?a.height:n.m_Div.clientHeight;if(t==n.m_nDivWidth&&i==n.m_nDivHeight){return}if(VBI.m_bTrace){VBI.Trace("Calculating Canvas Dimensions to "+t+","+i+", Dummy:"+e)}n.m_nDivWidth=t;n.m_nDivHeight=i;n.m_nWidthCanvas=t;n.m_nHeightCanvas=i};n.Render=function(){var e=null;var a=0;for(var t=n.m_VOS.length;t--;){e=n.m_VOS[t];a+=e.Render(n.m_Canvas[0])}};if(e){n.Awake(e)}return n};VBI.GeoScene=function(e,n,a){var t=new VBI.Scene(e);t.vbiclass="GeoScene";t.m_RefMapLayerStack="";t.m_DivCopyright=null;t.m_Canvas=[];t.m_ZoomFactors=[1,1];t.m_StretchFactors=[1,1];t.m_MapManager=n;t.m_MapLayerStack=a;t.m_nMaxCanvasDimension=VBI.m_bIsMobile?6144:8192;t.Click=null;t.m_nOverlayIndex=2;t.m_nLabelIndex=3;t.m_nNonDomIndex=4;t.m_nTapCount=0;t.GetHomeLocation=null;t.m_Touches=[];t.m_currentMouseX=0;t.m_currentMouseY=0;t.m_oldMouseX=0;t.m_oldMouseY=0;t.m_currentMouseDownX=0;t.m_currentTouchCount=0;t.m_currentMouseDownY=0;t.m_midPointX=0;t.m_midPointY=0;t.m_currentTouchDistance=0;t.m_nInputMode=VBI.InputModeDefault;t.m_AnimZoomTimer=null;t.m_startPointLonLat=[0,0];t.m_startLOD=0;t.m_bNavControlVisible=true;t.m_NavControl=null;t.m_RenderRequestID=0;t.m_SuppressedNavigation={zoom:false,move:false};t.m_bScaleVisible=true;t.m_Scale=null;t.m_nInitialTrackingMode=VBI.InputModeDefault;t.m_nCanvasXOversize=2.2;t.m_nCanvasYOversize=2.2;t.m_nCanvasStdXPos=t.m_nCanvasXOversize/4;t.m_nCanvasStdYPos=t.m_nCanvasYOversize/4;t.m_nTicksInALod=VBI.m_bIsMobile?6:12;t.m_nLodFactorZoomIn=Math.pow(2,1/t.m_nTicksInALod);t.m_nLodFactorZoomOut=1/t.m_nLodFactorZoomIn;t.m_nLodFactorZoomInHalf=Math.pow(2,1/(2*t.m_nTicksInALod));t.m_nLodFactorZoomOutHalf=1/t.m_nLodFactorZoomInHalf;t.m_nMaxAnimLodDiff=3;t.m_nZoomMode=1;t.m_nLastRenderingTime=0;t.m_nRenderTimeTarget=250;t.m_nNumOfScalingVOInst=0;t.m_nLastClusteringTime=0;t.m_nDataVersion=0;t.m_bObjCanvasMode=1;t.m_nlstWidth=t.m_nlstHeight=0;t.m_nGetImageDataIncidents=0;t.onTileLoaded=null;t.clear=function(){t.BaseClear();t.m_Touches=[];if(t.m_NavControl){t.m_NavControl.clear();t.m_NavControl=null}if(t.m_Scale){t.m_Scale.clear();t.m_Scale=null}t.clearTimers();t.clearCanvases();t.SetInputMode(VBI.InputModeDefault);t.Remove();t.m_RefMapLayerStack="";t.m_MapManager=null;t.m_MapLayerStack=null;t.m_TargetName=null;t.m_Proj=null;t.m_DivCopyright=null;t.m_Target=null};t.loadSingleRemoveOnScene=function(e,n){if(jQuery.type(e)=="object"){switch(e.type){case"VO":var a=e.id;for(var i=t.m_VOS.length;i--;){if(t.m_VOS[i].m_ID==a){t.m_VOS[i].clear();t.m_VOS.splice(i,1);return}}break;default:break}}};t.loadRemoveOnScene=function(e,n){if(jQuery.type(e)=="array"){for(var a=0;a<e.length;++a){t.loadSingleRemoveOnScene(e[a],n)}}else{t.loadSingleRemoveOnScene(e,n)}};t.load=function(e,n,a){var i=false;if(a&&e.Remove){t.loadRemoveOnScene(e.Remove,n)}t.BaseLoad(e,n,a);if(e.refMapLayerStack){var r=n.m_MapLayerStackManager.GetMapLayerStack(e.refMapLayerStack);if(t.m_RefMapLayerStack!=r){t.m_RefMapLayerStack=r;i=true}}else if(VBI.m_bTrace){VBI.Trace("no map layer specified in geo scene")}if(a){return i}var m=-1e3,o=1e3;var l=-90,s=90;t.m_nMinLodVisualBorder=0;t.m_nMaxLodVisualBorder=99;t.m_nOffsetMinLod=0;t.m_bYBorderExists=false;if(e.VisualFrame){if(e.VisualFrame.minLon!=undefined){m=e.VisualFrame.minLon}else{m=e.VisualFrame.minX!=undefined?e.VisualFrame.minX:m}if(e.VisualFrame.maxLon!=undefined){o=e.VisualFrame.maxLon}else{o=e.VisualFrame.maxX!=undefined?e.VisualFrame.maxX:o}if(e.VisualFrame.minLat!=undefined){l=e.VisualFrame.minLat}else{l=e.VisualFrame.minY!=undefined?e.VisualFrame.minY:l}if(e.VisualFrame.maxLat!=undefined){s=e.VisualFrame.maxLat}else{s=e.VisualFrame.maxY!=undefined?e.VisualFrame.maxY:s}if(e.VisualFrame.minLOD!=undefined){t.m_nMinLodVisualBorder=e.VisualFrame.minLOD}if(e.VisualFrame.maxLOD!=undefined){t.m_nMaxLodVisualBorder=e.VisualFrame.maxLOD}if(e.VisualFrame.maxFraction!=undefined){t.m_fMaxMinLODFraction=e.VisualFrame.maxFraction}if(e.VisualFrame.offsetMinLOD!=undefined){t.m_nOffsetMinLod=e.VisualFrame.offsetMinLOD}}t.m_bXBorderExists=m!=-1e3||o!=1e3;t.m_nBorderMinPoint=VBI.MathLib.DegToRad([m,s]);t.m_nBorderMaxPoint=VBI.MathLib.DegToRad([o,l]);t.m_Proj=t.setProjection();var _=[1,1],v=[1,1];t.m_Proj.LonLatToUCS(t.m_nBorderMinPoint,_);t.m_Proj.LonLatToUCS(t.m_nBorderMaxPoint,v);t.m_nXSizeVisualBorder=Math.max(0,Math.min(1,v[0]-_[0]));t.m_nYSizeVisualBorder=Math.max(0,Math.min(1,v[1]-_[1]));if(e.initialStartPosition){var d=e.initialStartPosition.split(";");t.m_startPointLonLat=VBI.MathLib.DegToRad([parseFloat(d[0]),parseFloat(d[1])])}if(e.initialZoom){t.m_startLOD=parseInt(e.initialZoom,10)}if(e.ariaLabel){t.ariaLabel=e.ariaLabel}var u={zoom:false,move:false,fade:false};if(e.NavigationDisablement){if(e.NavigationDisablement.zoom){t.m_SuppressedNavigation.zoom=VBI.Types.string2bool(e.NavigationDisablement.zoom)}if(e.NavigationDisablement.move){t.m_SuppressedNavigation.move=VBI.Types.string2bool(e.NavigationDisablement.move)}}if(e.navControlVisible){t.m_bNavControlVisible=VBI.Types.string2bool(e.navControlVisible)}u.zoom=t.m_SuppressedNavigation.zoom;u.move=t.m_SuppressedNavigation.move;if(t.m_SuppressedNavigation.zoom&&t.m_SuppressedNavigation.move){t.m_bNavControlVisible=false}else if(t.m_bNavControlVisible){if(e.SuppressedNavControlVisibility){if(!u.zoom&&e.SuppressedNavControlVisibility.zoom){u.zoom=VBI.Types.string2bool(e.SuppressedNavControlVisibility.zoom)}if(!u.move&&e.SuppressedNavControlVisibility.move){u.move=VBI.Types.string2bool(e.SuppressedNavControlVisibility.move)}if(e.SuppressedNavControlVisibility.fade){u.fade=VBI.Types.string2bool(e.SuppressedNavControlVisibility.fade)}}if(u.move&&u.zoom){t.m_bNavControlVisible=false}}if(e.scaleVisible){t.m_bScaleVisible=VBI.Types.string2bool(e.scaleVisible)}if(t.m_Ctx.moThumbnail){t.m_SuppressedNavControlVisibility=u}else if(t.m_bNavControlVisible){t.m_NavControl=new VBI.NavigationControl(u)}if(t.m_bScaleVisible&&!t.m_Ctx.moThumbnail){t.m_Scale=new VBI.Scale(t)}if(e.rectZoom&&VBI.Types.string2bool(e.rectZoom)){t.m_nInitialTrackingMode=VBI.InputModeRectZoom}else if(e.rectSelect&&VBI.Types.string2bool(e.rectSelect)){t.m_nInitialTrackingMode=VBI.InputModeRectSelect}else if(e.lassoSelect&&VBI.Types.string2bool(e.lassoSelect)){t.m_nInitialTrackingMode=VBI.InputModeRectSelect}else{t.m_nInitialTrackingMode=VBI.InputModeDefault}return false};t.SetInputMode=function(e){if(VBI.m_bTrace){VBI.Trace("SetInputMode: "+this.m_nInputMode)}if(this.m_nInputMode==e){return}switch(this.m_nInputMode){case VBI.InputModeTrackMap:t.SetInputModeTrackMap(false);break;default:break}switch(e){case VBI.InputModeTrackMap:t.SetInputModeTrackMap(true);break;default:break}this.m_nInputMode=e};t.SetToolTip=function(e,n,a,i){var r=t.m_Canvas[t.m_nLabelIndex];if(e instanceof sap.ui.core.TooltipBase){if(n==true&&!e._getPopup().isOpen()){var m=a+" "+(i+20);e.setMyPosition(sap.ui.core.Popup.Dock.BeginTop);e.setAtPosition(sap.ui.core.Popup.Dock.BeginTop);e.setOffset(m);e.setCollision("fit fit");e.openPopup(e.getParent());r.title=""}else if(n==false&&e._getPopup().isOpen()){e.closePopup()}}else if(r.title!=e){r.title=e}};t.SetCursor=function(e){var n=t.m_Canvas[t.m_nLabelIndex];if(n.style.cursor!=e){n.style.cursor=e}};t.RenderAsync=function(e){if(e!=false){t.bForceRecluster=true}if(!t.m_RenderRequestID){t.m_RenderRequestID=window.requestAnimationFrame(t.DoRender)}};t.DoRender=function(){t.Render(!t.bForceRecluster)};t.Render=function(e){t.m_RenderRequestID=0;t.bForceRecluster=false;if(t.m_Canvas.length){t.InternalRenderLayer(t.m_Canvas[t.m_nOverlayIndex],false,true,e!=true,t.m_Canvas[0].m_nExactLOD)}};t.GoToInitialStart=function(){if(t.m_nMaxLodVisualBorder<Math.ceil(t.GetMinLOD())){t.m_nMaxLodVisualBorder=Math.ceil(t.GetMinLOD())}if(!t.ZoomToGeoPosition(t.m_startPointLonLat,t.m_startLOD,true,false,true)){var e=VBI.MathLib.RadToDeg(t.m_nBorderMinPoint);var n=VBI.MathLib.RadToDeg(t.m_nBorderMaxPoint);var a=[e[0],n[0]];var i=[e[1],n[1]];t.ZoomToMultiplePositions(a,i,1.1,true)}t.RenderAsync(true)};t.GetDistance=function(e,n){var a=t.GetPosFromVPPoint(e);var i=t.GetPosFromVPPoint(n);return VBI.MathLib.Distance(VBI.MathLib.DegToRad(a),VBI.MathLib.DegToRad(i))};t.GetTargetPointForDistance=function(e,n){var a=VBI.MathLib.DegToRad(t.GetPosFromVPPoint(n));var i=90*Math.PI/180;var r=Math.asin(Math.sin(a[1])*Math.cos(e/VBI.MathLib.earthradius)+Math.cos(a[1])*Math.sin(e/VBI.MathLib.earthradius)*Math.cos(i));var m=a[0]+Math.atan2(Math.sin(i)*Math.sin(e/VBI.MathLib.earthradius)*Math.cos(a[1]),Math.cos(e/VBI.MathLib.earthradius)-Math.sin(a[1])*Math.sin(r));return t.GetPointFromGeo([m,r],false)};t.ZoomToMultiplePositions=function(e,n,a,i){var r=[];var m=[];if(e.length!=n.length){return}var o;for(o=0;o<e.length;o++){var l=parseFloat(e[o]);if(l<0){l+=360}r.push(l);m.push(parseFloat(n[o]))}if(r.length!=m.length||!r.length){return}r.sort(function(e,n){return e-n});m.sort(function(e,n){return e-n});var s=0,_=0,v,d;v=m[0];d=m[m.length-1];var u,c,f,h;c=r[r.length-1];for(o=0;o<r.length;o++){f=r[o];h=f<c?f+360-c:f-c;if(u==undefined||h>u){u=h;s=f<c?f+360:f;_=c}c=f}t.ZoomToArea(s,_,v,d,a?a:1,true,i)};t.ZoomToAreas=function(e,n){var a=Math.log(t.m_nDivWidth/(t.m_MapManager.m_tileWidth*t.m_nXSizeVisualBorder))*Math.LOG2E;var i=VBI.MathLib.GetSurroundingBox(e,0,a,t.CalculateYMinLod,t.m_bObjCanvasMode==1?.5:0);t.ZoomToArea(i[0],i[1],i[2],i[3],n,true);var r=(new Date).getTime();t.m_LastZoomArea=[r,"Areas",e,n];return true};t.ZoomTo=function(e,n){var a=[],i=[];var r=function(e,n,a,t,i){e.forEach(m.bind(this,i,n,a,t))};var m=function(e,n,a,t,i){if(e===i.m_Value){if(n.m_Pos){var r=n.m_Pos.GetValueVector(this.m_Ctx);for(var m=0;m<r.length/3;++m){a.push(r[m*3+0]);t.push(r[m*3+1])}}}};for(var o=0;o<this.m_VOS.length;++o){var l=this.m_VOS[o];var s=l.m_DataSource.GetCurrentNode(this.m_Ctx);if(s&&s.m_dataelements.length){for(var _=0;_<s.m_dataelements.length;++_){l.m_DataSource.Select(_);var v=s.m_dataelements[_].m_dataattributes;e.forEach(r.bind(this,v,l,i,a))}}}if(i.length){t.ZoomToMultiplePositions(i,a,n)}return true};t.ZoomToAll=function(e,n){var a=[],i=[];for(var r=0;r<t.m_VOS.length;++r){var m=t.m_VOS[r];var o=m.m_DataSource?m.m_DataSource.GetCurrentNode(t.m_Ctx):null;if(o&&o.m_dataelements.length){for(var l=0;l<o.m_dataelements.length;++l){m.m_DataSource.Select(l);if(m.m_Pos){var s=m.m_Pos.GetValueVector(t.m_Ctx);for(var _=0;_<s.length/3;++_){i.push(s[_*3+0]);a.push(s[_*3+1])}}else if(m.m_PosM){var s=m.m_PosM.GetValueVector(t.m_Ctx);for(var _=0;_<s.length;++_){for(var v=0;v<s[_].length;++v){for(var d=0;d<s[_][v].length/3;++d){i.push(s[_][v][d*3+0]);a.push(s[_][v][d*3+1])}}}}}}}if(i.length){t.ZoomToMultiplePositions(i,a,e,n)}};t.CalculateYMinLod=function(e,n){if(e==n){return 1e3}var a=[256,256];var i=[256,256];t.m_Proj.LonLatToUCS(VBI.MathLib.DegToRad([0,e]),a);t.m_Proj.LonLatToUCS(VBI.MathLib.DegToRad([0,n]),i);var r=t.m_nDivHeight/Math.abs(i[1]-a[1]);r=Math.log(r)*Math.LOG2E;return r};t.ZoomToArea=function(e,n,a,i,r,m,o){var l=256,s=256;if(t.m_MapManager){l=t.m_MapManager.m_tileWidth;s=t.m_MapManager.m_tileHeight}var _=t.m_nDivHeight?t.m_nDivHeight:s;var v=t.m_nDivWidth?t.m_nDivWidth:l;var d;var u;if(jQuery.type(r)=="array"){if(r.length>=4){var c=r[0]+r[2];var f=r[1]+r[3];if(c<v&&f<_){if(r[0]!=r[2]||r[1]!=r[3]){u=[(r[2]-r[0])/2,(r[3]-r[1])/2]}v-=c;_-=f;d=c<0||f<0}}}else{_*=r;v*=r;d=r>1}if(n<e){n+=360}while(e>180){e-=360}while(n>180){n-=360}var h=[e,a];var C=[n,i];h=VBI.MathLib.DegToRad(h);C=VBI.MathLib.DegToRad(C);var g=[l,s];var M=[l,s];t.m_Proj.LonLatToUCS(h,g);t.m_Proj.LonLatToUCS(C,M);var I=g[0]+M[0]+(M[0]<g[0])*l;var p=g[1]+M[1];var D=[I/l-1,p/s-1];var S=[1,1];t.m_Proj.UCSToLonLat(D,S);var x=14,b=14;if(i!=a){x=_/Math.abs(M[1]-g[1]);x=Math.log(x)*Math.LOG2E}if(n!=e){b=v/Math.abs(M[0]-g[0]+(M[0]<=g[0])*l);b=Math.log(b)*Math.LOG2E}var T=d?Math.max(b,x):Math.min(b,x);if(m){T=Math.floor(T)}t.ZoomToGeoPosition(S,T,false,false,o,u);if(T!=Math.floor(T)){setTimeout(function(){t.AnimateZoomToGeo(S,Math.floor(T),5)},20)}var L=(new Date).getTime();t.m_LastZoomArea=[L,"Area",e,n,a,i,r]};t.getInfoForCluster=function(e,n){var a=JSON.parse(e);var i=t.m_Ctx.m_Clustering;return i.getInfoForCluster(a,n,t)};t.AdaptOtherCanvas=function(e,n,a,i){var r=a?1:0;var m=t.m_Canvas[1-r];if(a<=1&&a>=-2){var o=n-m.m_nCurrentLOD;var l=Math.pow(2,-o);var s=Math.max(1,l);var _=m.getPixelLeft(),v=m.getPixelTop();var d=m.getPixelWidth(),u=m.getPixelHeight();var c=d/t.m_nWidthCanvas;var f=[this.m_MapManager.m_tileWidth*m.m_nCurrentX+(t.m_nDivWidth/2-_)/c,this.m_MapManager.m_tileHeight*m.m_nCurrentY+(t.m_nDivHeight/2-v)/c];var h=[f[0]-l*e[0],f[1]-l*e[1]];if(Math.abs(h[0])<s*t.m_nWidthCanvas&&Math.abs(h[1])<s*t.m_nHeightCanvas){var C=Math.pow(2,i);var g=C*(_-t.m_nDivWidth/2+c*h[0])+t.m_nDivWidth/2;var M=C*(v-t.m_nDivHeight/2+c*h[1])+t.m_nDivHeight/2;this.MoveCanvas(m,g,M,d*C,u*C);return r}}return 0};t.ZoomToGeoPosition=function(e,n,a,i,r,m){if(e.pixelShift!=undefined&&m==undefined){m=e.pixelShift}if(t.m_Canvas[t.m_nNonDomIndex].m_bCanvasValid){t.SwitchTmpCanvasToActive()}var o=0,l=0;var s=t.m_Canvas[0];var _=s.m_nExactLOD;var v=t.m_MapManager.m_tileWidth;var d=t.m_MapManager.m_tileHeight;var u=Math.min(Math.max(n,t.GetMinLOD()),t.GetMaxLOD());n=Math.floor(u);var c=Math.pow(2,u-n);var f=1<<n;if(m!=undefined){o=m[0]/c;l=m[1]/c}var h=[f*v,f*d];t.m_Proj.LonLatToUCS(e,h);var C=[h[0]-t.m_nDivWidth/2+o,h[1]-t.m_nDivHeight/2+l];var g=t.m_Proj.m_nUCSMin*f;var M=t.AdaptOtherCanvas(h,n,n-s.m_nCurrentLOD,u-s.m_nExactLOD);var I=Math.round(C[0]/v-t.m_nCanvasStdXPos-g);var p=Math.round(C[1]/d-t.m_nCanvasStdYPos);var D=-Math.floor(C[0]-(I+g)*v);var S=-Math.floor(C[1]-p*d);var x=Math.round(D+(c-1)*(D-t.m_nDivWidth/2));var b=Math.round(S+(c-1)*(S-t.m_nDivHeight/2));var T=Math.round(t.m_nWidthCanvas*c);var L=Math.round(t.m_nHeightCanvas*c);var V=[f,f];var y=[f,f];t.m_Proj.LonLatToUCS(t.m_nBorderMinPoint,V);t.m_Proj.LonLatToUCS(t.m_nBorderMaxPoint,y);var O=L/t.m_nHeightCanvas;var P=d*(p-V[1])*O-b;var B=d*(p-y[1])*O+t.m_nDivHeight-b;var w;var A=true;if(P<-t.m_nMaxPixelBeyondPoles){b=d*(p-V[1])*O+t.m_nMaxPixelBeyondPoles}else if(B>t.m_nMaxPixelBeyondPoles){b=d*(p-y[1])*O+t.m_nDivHeight-t.m_nMaxPixelBeyondPoles}else{A=false}if(A){if(a){return false}var R=(b+(c-1)*t.m_nDivHeight/2)/c;w=-Math.round(t.m_nCanvasStdYPos+R/d);p+=w;b+=c*w*d}if(t.m_bXBorderExists){var H=v*(I-V[0])*O-x;var G=v*(I-y[0])*O+t.m_nDivWidth-x;var k=true;if(H<-t.m_nMaxPixelBeyondPoles){x=v*(I-V[0])*O+t.m_nMaxPixelBeyondPoles}else if(G>t.m_nMaxPixelBeyondPoles){x=v*(I-y[0])*O+t.m_nDivWidth-t.m_nMaxPixelBeyondPoles}else{k=false}if(k){if(a){return false}var W=(x+(c-1)*t.m_nDivWidth/2)/c;w=-Math.round(t.m_nCanvasStdXPos+W/d);I+=w;x+=c*w*v}}var F=s.m_nCurrentX==I&&s.m_nCurrentY==p&&s.m_nCurrentLOD==n;if(F){t.MoveCanvas(s,x,b,T,L);s.m_nExactLOD=u}else{t.InvalidateCanvas(t.m_Canvas[1]);if(M==0){var Z=s.getContext("2d");Z.clearRect(0,0,s.width,s.height)}var N=t.m_Canvas[M];t.MoveCanvas(N,x,b,T,L);t.m_MapManager.RequestTiles(N,t.m_MapLayerStack,I,p,t.m_nTilesX,t.m_nTilesY,0,0,0,0,n,false);N.m_nExactLOD=u;if(M==1){t.ToggleCanvas(t)}}if(r!=true){t.InternalRenderLayer(t.m_Canvas[t.m_nOverlayIndex],false,!F,!F,u)}t.m_LastDefinedCenterPos=m?undefined:e;t.InternalOnMoveLayer(s,i);if(u!=_){t.InternalOnZoomLayer(t.m_Canvas[t.m_nOverlayIndex],i)}if(t.m_bNavControlVisible&&t.m_NavControl){t.m_NavControl.AdjustScrollPoint(u)}return true};t.RefreshMapLayerStack=function(){var e=t.m_RefMapLayerStack?t.m_RefMapLayerStack.m_Name:t.m_MapLayerStack.m_Name;if(e){t.SetMapLayerStack(e);t.AddCopyright()}};t.SetMapLayerStack=function(e){var n=t.m_Ctx.m_MapLayerStackManager.GetMapLayerStack(e);if(n==null){return}if(t.m_Canvas[t.m_nNonDomIndex].m_bCanvasValid){t.SwitchTmpCanvasToActive()}t.m_MapLayerStack=n;var a=t.m_Canvas[0];t.m_MapManager.RequestTiles(a,t.m_MapLayerStack,a.m_nCurrentX,a.m_nCurrentY,t.m_nTilesX,t.m_nTilesY,0,0,0,0,a.m_nCurrentLOD,false);t.InternalRenderLayer(t.m_Canvas[t.m_nOverlayIndex],false,true,true,a.m_nCurrentLOD)};t.ZoomToZoomlevel=function(e,n,a){var i=t.GetInternalDivClientRect();if(i.width!=t.m_nDivWidth||i.height!=t.m_nDivHeight){t.resizeCanvas(0)}t.ZoomToGeoPosition(e,n,false,a)};t.GetMapLayerStack=function(){return t.m_MapLayerStack};t.GetMinLOD=function(){var e=Math.max(t.m_nDivWidth/(t.m_MapManager.m_tileWidth*t.m_nXSizeVisualBorder),t.m_nDivHeight/(t.m_MapManager.m_tileHeight*t.m_nYSizeVisualBorder));var n=Math.log(e)*Math.LOG2E;var a=t.m_MapLayerStack;var i=Math.max(t.m_nMinLodVisualBorder-t.m_nOffsetMinLod,a?a.GetMinLOD():0);var r=Math.max(n,i);if(t.m_fMaxMinLODFraction!=undefined&&r-Math.floor(r)>t.m_fMaxMinLODFraction){return Math.ceil(r)}return r};t.GetMinLODForWidth=function(e){var n=e/t.m_MapManager.m_tileWidth;var a=Math.log(n)*Math.LOG2E;var i=t.m_MapLayerStack;var r=Math.max(t.m_nMinLodVisualBorder,i?i.GetMinLOD():0)-t.m_nOffsetMinLod;return Math.max(a,r)};t.GetMaxLOD=function(){var e=t.m_MapLayerStack;return Math.min(e?e.GetMaxLOD():20,t.m_nMaxLodVisualBorder)};t.GetCurrentZoomlevel=function(){return t.m_Canvas[0].m_nExactLOD};t.GetCenterPos=function(){if(t.m_LastDefinedCenterPos!=undefined){return t.m_LastDefinedCenterPos}var e=t.getCanvas();var n=[t.m_nDivWidth/2-e.getPixelLeft(),t.m_nDivHeight/2-e.getPixelTop()];return t.GetGeoFromPoint(n)};t.InternalRenderVisualObjects=function(e,n,a){var i=Date.now();var r=t.m_VOS;var m=r.length;var o;t.m_nNumOfScalingVOInst=0;VBI.Utilities.BackupFont(n);var l,s;if(a){if(t.m_nShadowIndex!=undefined){l=t.m_Canvas[t.m_nShadowIndex];s=l.getContext("2d");s.clearRect(0,0,l.width,l.height)}}t.BuildCacheDataObj();for(var _=0;_<m;++_){r[_].Init4Render()}for(var v=0;v<m;++v){var d=r[v];if(d.m_Label&&d.m_Label.length){for(var u=0;u<d.m_Label.length;++u){d.m_Label[u].clear()}}d.m_Label=[];if(a){var c=a.base[v];d.m_nPreDataIndex=v;o=d.Render(e,n,c);for(var f=c.clusterings.length;f--;){o+=d.Render(e,n,a.clust[c.clusterings[f].i],l,s,true)}}else{o=d.Render(e,n)}if(o!=undefined){t.m_nNumOfScalingVOInst+=o}}this.InvalidateInvisibleHots();if(t.m_DesignVO){t.m_DesignVO.Render(e,n)}var h=t.m_Canvas[t.m_nLabelIndex];var C=h.getContext("2d");VBI.Utilities.BackupFont(C);C.clearRect(0,0,h.width,h.height);t.InternalRenderLabels(h,C);VBI.Utilities.RestoreFont(C);VBI.Utilities.RestoreFont(n);t.DestroyCacheDataObj();t.m_nLastRenderingTime=Date.now()-i;if(t.m_Ctx.moThumbnail){t.Copy2Thumbnail()}};t.TriggerReRenderTimer=function(e){window.clearInterval(t.m_ReRenderTimer);t.m_ReRenderTimer=window.setInterval(function(){window.clearInterval(t.m_ReRenderTimer);t.m_ReRenderTimer=null;if(!t.m_bNonIntPosStable){t.m_bNonIntPosStable=Date.now()}t.RenderAsync(true);if(t.m_bLineAnimationRunning){t.TriggerReRenderTimer(15)}},e)};t.AddThumbnailText=function(e,n){var a,t,i,r;var m=e.getContext("2d");switch(n.nFontPos){case 2:case 3:case 4:a=e.width;i="right";break;case 0:case 1:case 5:a=e.width/2;i="center";break;default:a=0;i="left";break}switch(n.nFontPos){case 4:case 5:case 6:t=e.height;r="bottom";break;case 7:case 0:case 3:t=e.height/2;r="middle";break;default:t=0;r="top";break}var o=VBI.Types.string2rgba(n.strCol);m.font=n.strFont;m.fillStyle=m.strokeStyle=VBI.Utilities.RgbToHex(o[0],o[1],o[2]);m.textAlign=i;m.textBaseline=r;m.fillText(n.strText,a,t)};t.GetOverlayPicture=function(e){var n;var a;var i=t.GetStretchFactor4Mode();var r=VBI.Utilities.CreateGeoSceneCanvas("temporarynondomlayer",t.m_nDivWidth,t.m_nDivHeight,0,2);var m=r.getContext("2d");if(e&2){n=t.m_Canvas[0];var o=t.GetCurrentZoomFactors();m.drawImage(n,-n.m_pixelLeft/o[0],-n.m_pixelTop/o[1],t.m_nDivWidth/o[0],t.m_nDivHeight/o[1],0,0,t.m_nDivWidth,t.m_nDivHeight)}n=t.m_Canvas[t.m_nOverlayIndex];m.drawImage(n,-n.m_pixelLeft/i[0],-n.m_pixelTop/i[1],t.m_nDivWidth/i[0],t.m_nDivHeight/i[1],0,0,t.m_nDivWidth,t.m_nDivHeight);if(e&1){n=t.m_Canvas[t.m_nLabelIndex];m.drawImage(n,-n.m_pixelLeft/i[0],-n.m_pixelTop/i[1],t.m_nDivWidth/i[0],t.m_nDivHeight/i[1],0,0,t.m_nDivWidth,t.m_nDivHeight)}try{a=r.toDataURL("png")}catch(e){VBI.Trace(e.message);return""}return a};t.Copy2Thumbnail=function(){var e=t.m_Canvas[t.m_nThumbnailIndex];var n=t.m_Canvas[0];var a=e.getContext("2d");var i=t.GetCurrentZoomFactors();var r=t.GetStretchFactor4Mode();a.clearRect(0,0,e.width,e.height);a.drawImage(n,-n.m_pixelLeft/i[0],-n.m_pixelTop/i[1],t.m_Ctx.moThumbnail.nOrgWidth/i[0],t.m_Ctx.moThumbnail.nOrgHeight/i[1],0,0,e.clientWidth,e.clientHeight);n=t.m_Canvas[t.m_nOverlayIndex];a.drawImage(n,-n.m_pixelLeft/r[0],-n.m_pixelTop/r[1],t.m_Ctx.moThumbnail.nOrgWidth/r[0],t.m_Ctx.moThumbnail.nOrgHeight/r[1],0,0,e.clientWidth,e.clientHeight);var m=t.m_Ctx.moThumbnail;if(m.strFont&&m.nFontPos!=undefined&&m.strText){t.AddThumbnailText(e,m)}};t.CopyCanvasAway=function(e,n){var a=n.getContext("2d");a.clearRect(0,0,n.width,n.height);a.drawImage(e,0,0,e.width,e.height)};t.UpdatePreData4Selected=function(e,n){var a=t.m_Ctx.m_Clustering;if(e!=undefined&&a){a.VerifyCurrentSelection(t.m_VOS,t.m_PreassembledData,t.m_Ctx);a.AddSingle2Selected(e,t.m_VOS,n,t.m_PreassembledData,t.m_Ctx)}};t.UpdatePreData4SelArray=function(e){var n=t.m_Ctx.m_Clustering;if(n){n.VerifyCurrentSelection(t.m_VOS,t.m_PreassembledData,t.m_Ctx);n.AddMultiple2Selected(e,t.m_VOS,t.m_PreassembledData,t.m_Ctx)}};VBI.addSceneLabelFunctions(t);t.InvalidatePreassembledData=function(e,n){var a=t.m_HotItem.m_VO;var i;if(a!=undefined&&a.IsClusterable()){i=a.SwitchHotItemToStandard()}t.m_PreassembledData=undefined;if(t.m_nShadowIndex!=undefined){t.DisableShadowLayer()}return i};t.DisableShadowLayer=function(){var e=t.m_Canvas[t.m_nShadowIndex];var n=e.getContext("2d");n.clearRect(0,0,e.width,e.height);t.clearCanvas(t.m_nShadowIndex);t.m_Canvas.splice(t.m_nShadowIndex,1);t.m_nShadowIndex=undefined};t.SwitchCanvasSize=function(e,n,a){var i=[n,a];var r=i[0]*i[1]/1024;if(t.m_nCanvasMaxPixel<r){var m=Math.sqrt(r/t.m_nCanvasMaxPixel);i[0]=Math.floor(i[0]/m);i[1]=Math.floor(i[1]/m);t.m_bObjCanvasMode=2}else{t.m_bObjCanvasMode=1}e.width=t.m_Canvas[t.m_nLabelIndex].width=i[0];e.height=t.m_Canvas[t.m_nLabelIndex].height=i[1];if(t.m_nShadowIndex){t.m_Canvas[t.m_nShadowIndex].width=i[0];t.m_Canvas[t.m_nShadowIndex].height=i[1]}e.setPixelWidth(e.width);e.setPixelHeight(e.height);return i};t.InternalRenderLayer=function(e,n,a,i,r,m){var o=t.m_Canvas[0];var l;var s=t.m_Ctx.m_Clustering;var _=s!=undefined&&s.m_Clusters.length;if(t.m_PreassembledData!=undefined&&!_){l=t.InvalidatePreassembledData(s,o.m_nCurrentLOD)}if(a==false&&r!=undefined){var v=Math.floor(r);if(r==t.m_nLastRenderLOD){return}if(v==Math.floor(t.m_nLastRenderLOD)&&(r!=v&&r>t.GetMinLOD()+.001)){var d=Math.abs(r-t.m_nLastRenderLOD);if(d<t.m_nLastRenderingTime/t.m_nRenderTimeTarget){return}}}t.m_OverlayImage=null;t.m_nLastRenderLOD=r==undefined?-1:r;var u,c=e.getPixelWidth();var f,h=e.getPixelHeight();if(t.m_bObjCanvasMode){var C=t.SwitchCanvasSize(e,c,h);t.m_StretchFactors=[c/C[0],h/C[1]];t.m_ZoomFactors=[C[0]/t.m_nWidthCanvas,C[1]/t.m_nHeightCanvas];u=c;f=h}else{u=t.m_nWidthCanvas;f=t.m_nHeightCanvas;e.setPixelWidth(u);e.setPixelHeight(f);t.m_ZoomFactors=[1,1];t.m_StretchFactors=[c/t.m_nWidthCanvas,h/t.m_nHeightCanvas]}var g=e.getContext("2d");if(n){g.clearRect(0,0,e.width,e.height);e.setPixelWidth(c);e.setPixelHeight(h);return}var M=false;if(_){this.SetLastHotItem(t.m_HotItem);var I=Date.now();t.m_PreassembledData=s.DoClustering(this,o.m_nCurrentLOD,o.m_nCurrentX,o.m_nCurrentY,t.m_nTilesX,t.m_nTilesY,t.m_VOS,t.m_Ctx,l,a,i,t.m_nDataVersion);this.CheckHotItem();if(t.m_PreassembledData.config.bNeedsShadowLayer&&t.m_nShadowIndex==undefined){t.m_nShadowIndex=t.m_Canvas.length;t.m_Canvas.push(VBI.Utilities.CreateGeoSceneCanvas(t.m_TargetName+"-"+t.m_ID+"-shadow",u,f));t.InitializeCanvas(t.m_Canvas[t.m_nShadowIndex],t.m_Canvas[t.m_nOverlayIndex]);M=true}if(!t.m_PreassembledData.config.bNeedsShadowLayer&&t.m_nShadowIndex!=undefined){t.DisableShadowLayer()}t.m_nLastClusteringTime=Date.now()-I}g.clearRect(0,0,e.width,e.height);t.InternalRenderVisualObjects(e,g,t.m_PreassembledData);if(t.m_bObjCanvasMode!=1){e.setPixelWidth(c);e.setPixelHeight(h)}if(M){t.MoveCanvas2ObjectCanvas(t.m_Canvas[t.m_nShadowIndex])}t.InternalOnRenderLayer(e);if(t.m_Scale){t.m_Scale.Update()}if(t.m_bSwitch2OldCanvasMode&&o.m_nExactLOD==Math.round(o.m_nExactLOD)){t.m_bSwitch2OldCanvasMode=undefined;t.m_bObjCanvasMode=0;VBI.Trace("Switching back to old object canvas rendering style due to performance issues ")}};t.InternalOnMoveLayer=function(e,n){t.m_Ctx.m_Windows.NotifySceneMove(this);var a;if((a=t.m_Ctx.m_Actions)&&n!=true){var i=a.findAction("CenterChanged",t,"Map");if(i){var r=t.m_Canvas[t.m_nOverlayIndex];var m=r.getPixelWidth();var o=r.getPixelHeight();var l=t.GetPosFromPoint([0,0]);var s=t.GetPosFromPoint([m,o]);if(!t.m_Proj.m_bIsIsogonal){var _=t.GetPosFromPoint([m,0]);var v=t.GetPosFromPoint([0,o]);l=[Math.min(l[0],v[0]),Math.min(l[1],_[1])];s=[Math.max(_[0],s[0]),Math.max(v[1],s[1])]}var d=t.GetInternalDivClientRect();var u=-r.getPixelLeft();var c=-r.getPixelTop();var f=t.GetPosFromPoint([u,c]);var h=t.GetPosFromPoint([u+d.width,c+d.height]);var C={level:t.GetCurrentZoomlevel().toString(),min:l[0].toString()+";"+l[1].toString()+";0",max:s[0].toString()+";"+s[1].toString()+";0",vpmin:f[0].toString()+";"+f[1].toString()+";0",vpmax:h[0].toString()+";"+h[1].toString()+";0"};t.m_Ctx.FireAction(i,t,this,null,C)}}this.m_EvtCont.fire("onMove",{canvas:e});t.m_Ctx.onMoveLayer(e)};t.InternalOnZoomLayer=function(e,n){t.m_Ctx.m_Windows.NotifySceneZoom(this);if(n!=true){var a=t.m_Ctx.m_Actions;if(a){var i=a.findAction("ZoomChanged",t,"Map");if(i){var r=t.m_Canvas[t.m_nOverlayIndex];var m=r.getPixelWidth();var o=r.getPixelHeight();var l=t.GetPosFromPoint([0,0]);var s=t.GetPosFromPoint([m,0]);var _=t.GetPosFromPoint([0,o]);var v=t.GetPosFromPoint([m,o]);var d=t.GetInternalDivClientRect();var u=-r.getPixelLeft();var c=-r.getPixelTop();var f=t.GetPosFromPoint([u,c]);var h=t.GetPosFromPoint([u+d.width,c+d.height]);var C={level:t.GetCurrentZoomlevel().toString(),min:Math.min(l[0],_[0]).toString()+";"+Math.min(l[1],s[1]).toString()+";0",max:Math.max(v[0],s[0]).toString()+";"+Math.max(_[1],v[1]).toString()+";0",vpmin:f[0].toString()+";"+f[1].toString()+";0",vpmax:h[0].toString()+";"+h[1].toString()+";0"};if(n!=undefined&&n!=false){C.x=n.x.toString()-d.left;C.y=n.y.toString()-d.top}t.m_Ctx.FireAction(i,t,this,null,C)}}}this.m_EvtCont.fire("onZoom",{canvas:e});t.m_Ctx.onZoomLayer(e)};t.InternalOnRenderLayer=function(e){t.m_Ctx.onRenderLayer(e);if(t.GetHomeLocation){var n=e.getPixelWidth();var a=e.getPixelHeight();var i=[0,0];var r=t.GetHomeLocation();i[0]=r[0];i[1]=r[1];var m=t.GetPointFromGeo(i);e.setPixelWidth(t.m_nWidthCanvas);e.setPixelHeight(t.m_nHeightCanvas);var o=e.getContext("2d");o.clearRect(0,0,e.width,e.height);o.fillStyle="yellow";o.beginPath();o.arc(m[0],m[1],5,0,Math.PI*2,true);o.closePath();o.fill();var l=null;if(t.m_Ctx){l=t.m_Ctx.GetImage("dummy",t.RenderAsync.bind())}if(l){o.drawImage(l,m[0]-l.naturalWidth/2,m[1]-l.naturalHeight)}e.setPixelWidth(n);e.setPixelHeight(a)}};t.MoveObject=function(e,n,a,t,i){e.m_pixelLeft=Math.round(n);e.m_pixelTop=Math.round(a);e.style.left=e.m_pixelLeft.toString()+"px";e.style.top=e.m_pixelTop.toString()+"px";if(t!==undefined){e.m_pixelWidth=Math.round(t);e.style.width=e.m_pixelWidth.toString()+"px"}if(i!==undefined){e.m_pixelHeight=Math.round(i);e.style.height=e.m_pixelHeight.toString()+"px"}};t.InvalidateCanvas=function(e){var n=e.getContext("2d");n.fillStyle="white";n.clearRect(0,0,e.width,e.height);e.m_bInvalid=true};t.MoveCanvas=function(e,n,a,i,r){t.MoveObject(t.m_Canvas[t.m_nOverlayIndex],n,a,i,r);t.MoveObject(t.m_Canvas[t.m_nLabelIndex],n,a,i,r);if(t.m_nShadowIndex!=undefined){t.MoveObject(t.m_Canvas[t.m_nShadowIndex],n,a,i,r)}t.MoveObject(e,n,a,i,r)};t.MoveOnlyThisCanvas=function(e,n,a,i,r){t.MoveObject(e,n,a,i,r)};t.MoveCanvas2ObjectCanvas=function(e){var n=t.m_Canvas[t.m_nOverlayIndex];t.MoveObject(e,n.m_pixelLeft,n.m_pixelTop,n.m_pixelWidth,n.m_pixelHeight)};t.MoveMap=function(e,n){if(VBI.m_bTrace){VBI.Trace("MoveMap"+" DX:"+e+" DY:"+n)}var a=t.m_Canvas[t.m_nNonDomIndex];var i=t.m_Canvas[0];var r=a.m_bCanvasValid?a:i;var m=t.m_MapManager;var o=r.getPixelWidth();var l=r.getPixelHeight();var s=r.getPixelLeft()+e;var _=r.getPixelTop()+n;var v=m.m_tileWidth,d=m.m_tileHeight;var u=o/t.m_nTilesX;var c=l/t.m_nTilesY;var f=l/t.m_nHeightCanvas;var h=1<<i.m_nCurrentLOD;var C=[h,h];var g=[h,h];t.m_Proj.LonLatToUCS(t.m_nBorderMinPoint,C);t.m_Proj.LonLatToUCS(t.m_nBorderMaxPoint,g);if(n>0&&d*f*(r.m_nCurrentY-C[1])-_<-t.m_nMaxPixelBeyondPoles||n<0&&d*f*(r.m_nCurrentY-g[1])+t.m_nDivHeight-_>t.m_nMaxPixelBeyondPoles){if(e==0){return}n=0;_=r.getPixelTop()}if(t.m_bXBorderExists&&(e>0&&v*f*(r.m_nCurrentX-C[0])-s<-t.m_nMaxPixelBeyondPoles||e<0&&v*f*(r.m_nCurrentX-g[0])+t.m_nDivWidth-s>t.m_nMaxPixelBeyondPoles)){if(n==0){return}e=0;s=r.getPixelLeft()}var M=0;var I=0;var p;if(e>0&&(p=s+t.m_nMapMoveXPreLoad)>0){M=Math.ceil(p/u)}else if(e<0&&(p=t.m_nMapMoveXPreLoad+t.m_nDivWidth-(s+o))>0){M=-Math.ceil(p/u)}var D=r.m_nCurrentX-M;if(n>0&&(p=_+t.m_nMapMoveYPreLoad)>0){I=Math.ceil(p/c)}else if(n<0&&(p=t.m_nMapMoveYPreLoad+t.m_nDivHeight-(_+l))>0){I=-Math.ceil(p/c)}var S=r.m_nCurrentY-I;var x=t.m_MapLayerStack;var b=x?x.m_bSingleBMP:false;if(M||I){var T=0,L=0;if(!t.m_Canvas[1].m_bInvalid){t.InvalidateCanvas(t.m_Canvas[1])}t.MoveCanvas(i,i.getPixelLeft()+e,i.getPixelTop()+n);if(a.m_bCanvasValid){if(a.m_nTilesBefSwitch<a.m_nForceSwitchLimit){t.SwitchTmpCanvasToActive()}else{T=a.m_nOffsetX;L=a.m_nOffsetY}}a.m_nTilesBefSwitch=b||Math.abs(M)>=t.m_nTilesX||Math.abs(I)>=t.m_nTilesY?1:(t.m_nTilesX-Math.abs(M))*(t.m_nTilesY-Math.abs(I));a.m_nForceSwitchLimit=Math.ceil(a.m_nTilesBefSwitch/2);a.m_nOffsetX=M+T;a.m_nOffsetY=I+L;t.MoveOnlyThisCanvas(a,s-M*u,_-I*c,o,l);var V=a.getContext("2d");V.clearRect(0,0,i.getPixelWidth(),i.getPixelHeight());if(m.RequestTiles(a,t.m_MapLayerStack,D,S,t.m_nTilesX,t.m_nTilesY,0,0,0,0,i.m_nCurrentLOD,false)){a.m_bCanvasValid=true}else{t.SwitchTmpCanvasToActive()}}else{t.MoveCanvas(i,i.getPixelLeft()+e,i.getPixelTop()+n);t.MoveObject(t.m_Canvas[1],t.m_Canvas[1].getPixelLeft()+e,t.m_Canvas[1].getPixelTop()+n);if(a.m_bCanvasValid){t.MoveOnlyThisCanvas(a,s,_)}}var y=t.m_VOS;var O=false;for(var P=0,B=y.length;P<B;++P){if(y[P].m_Label.length>0&&y[P].CalculateLabelPos){O=true;break}}if(O){var w=t.m_Canvas[t.m_nLabelIndex].getContext("2d");w.clearRect(0,0,t.m_Canvas[t.m_nLabelIndex].width,t.m_Canvas[t.m_nLabelIndex].height);VBI.Utilities.BackupFont(w);t.InternalRenderLabels(t.m_Canvas[t.m_nLabelIndex],w);VBI.Utilities.RestoreFont(w)}t.InternalOnMoveLayer(t.m_Canvas[t.m_nOverlayIndex]);t.m_LastDefinedCenterPos=undefined};t.AdaptZoomFactor=function(e,n,a,i,r){var m={};m.bZoomNotPossible=true;var o=1<<e.m_nCurrentLOD;if(e.m_nCurrentY<0&&i<-e.m_nCurrentY*(e.getPixelHeight()/t.m_nTilesY)){return m}if(e.m_nCurrentY+t.m_nTilesY>o&&i>(o-e.m_nCurrentY)*(e.getPixelHeight()/t.m_nTilesY)){return m}if(n<1){var l=Math.max(t.m_nDivWidth/(e.getPixelWidth()*t.m_nXSizeVisualBorder)*(t.m_nTilesX/o),t.m_nDivHeight/(e.getPixelHeight()*t.m_nYSizeVisualBorder)*(t.m_nTilesY/o));if(n<l){if(l>=1&&n!=0){return m}n=l}}var s=r&&(t.m_nZoomMode||n==t.m_nLodFactorZoomIn||n==t.m_nLodFactorZoomOut);var _=e.m_nExactLOD+Math.log(n)*Math.LOG2E;var v=t.GetMinLOD();if(v!=Math.round(v)&&n!=1&&e.m_nExactLOD<=Math.ceil(v)&&Math.round(r*_)==Math.round(r*v)){s=false}if(s&&Math.round(r*_)!=r*_){_=Math.round(r*_)/r;n=Math.pow(2,_-e.m_nExactLOD)}else if(_<v){_=v;n=Math.pow(2,_-e.m_nExactLOD)}m.factor=n;m.nNewLod=Math.floor(_);m.lodFallsOnInteger=Math.round(_)==_;m.bZoomNotPossible=_>t.GetMaxLOD()||_<v;return m};t.ZoomMap=function(e,n,a,i,r){t.m_bNonIntPosStable=false;if(t.m_Canvas[t.m_nNonDomIndex].m_bCanvasValid){t.SwitchTmpCanvasToActive()}var m=t.m_Canvas[0];var o=t.m_Canvas[1];var l=t.m_MapManager;var s=l.m_tileWidth,_=l.m_tileHeight;var v,d,u=0,c=0;var f=m.getPixelLeft(),h=m.getPixelTop();var C=m.getPixelWidth(),g=m.getPixelHeight();var M=o.getPixelWidth();var I=t.AdaptZoomFactor(m,e,n,a,i);if(I.bZoomNotPossible){return}e=I.factor;var p=I.nNewLod;if(VBI.m_bTrace){VBI.Trace("Zoom by "+e+" to "+n+"/"+a)}var D=Math.round(C*e);var S=Math.round(D*m.height/m.width);var x=Math.round(f-(e-1)*n);var b=Math.round(h-(e-1)*a);if(e<1){var T=1<<m.m_nCurrentLOD;var L=[T,T];var V=[T,T];t.m_Proj.LonLatToUCS(t.m_nBorderMinPoint,L);t.m_Proj.LonLatToUCS(t.m_nBorderMaxPoint,V);var y=S/t.m_nHeightCanvas;var O=(m.m_nCurrentY-L[1])*_*y-b;if(O<-t.m_nMaxPixelBeyondPoles){b=Math.round(_*(m.m_nCurrentY-L[1])*y+t.m_nMaxPixelBeyondPoles);a=(h-b)/(e-1)}else{var P=_*(m.m_nCurrentY-V[1])*y+t.m_nDivHeight-b;if(P>t.m_nMaxPixelBeyondPoles){b=Math.round(_*(m.m_nCurrentY-V[1])*y+t.m_nDivHeight-t.m_nMaxPixelBeyondPoles);a=(h-b)/(e-1)}}if(t.m_bXBorderExists){var B=(m.m_nCurrentX-L[0])*s*y-x;if(B<-t.m_nMaxPixelBeyondPoles){x=Math.round(s*(m.m_nCurrentX-L[0])*y+t.m_nMaxPixelBeyondPoles);n=(f-x)/(e-1)}var w=(m.m_nCurrentX-V[0])*s*y+t.m_nDivWidth-x;if(w>t.m_nMaxPixelBeyondPoles){x=Math.round(s*(m.m_nCurrentX-V[0])*y+t.m_nDivWidth-t.m_nMaxPixelBeyondPoles);n=(f-x)/(e-1)}}}t.MoveCanvas(m,x,b,D,S);var A=D/t.m_nTilesX;var R=S/t.m_nTilesY;var H=false;if(p==m.m_nCurrentLOD){if(!o.m_bInvalid){var G=Math.round(M*e);var k=Math.round(o.getPixelHeight()*e);if(G<=t.m_nMaxCanvasDimension&&k<=t.m_nMaxCanvasDimension){var W=o.getPixelLeft();var F=o.getPixelTop();var Z=Math.round(W-(e-1)*(n+f-W));var N=Math.round(F-(e-1)*(a+h-F));t.MoveObject(o,Z,N,Math.round(M*e),Math.round(o.getPixelHeight()*e))}else{t.InvalidateCanvas(t.m_Canvas[1])}}m.m_nExactLOD=m.m_nCurrentLOD+Math.log(A/s)*Math.LOG2E;if(x>0||b>0||x+D<t.m_nDivWidth||b+S<t.m_nDivHeight){H=true;v=-Math.ceil(x/A);d=-Math.ceil(b/R);u=x+v*A;c=b+d*R;x=m.m_nCurrentX+v;b=m.m_nCurrentY+d;if(VBI.m_bTrace){VBI.Trace("run out viewport newTop="+b+" nTilesY="+d+" nPosY="+c+" yOffset="+a+"\n")}}}else{H=true;var E=Math.pow(2,m.m_nCurrentLOD-p);var Y=g/t.m_nHeightCanvas;var j=n/Y+E*(t.m_nDivWidth/2-f-n);var X=a/Y+E*(t.m_nDivHeight/2-h-a);if(p>m.m_nCurrentLOD){v=Math.round(j/E/s-t.m_nTilesX/2);d=Math.round(X/E/_-t.m_nTilesY/2);u=Math.ceil(x+v*A*E);c=Math.ceil(b+d*R*E)}else{var U=(m.m_nCurrentX%E+E)%E;var z=(m.m_nCurrentY%E+E)%E;v=Math.round((j/s+U)/E-t.m_nTilesX/2);d=Math.round((X/_+z)/E-t.m_nTilesY/2);u=x+A*(v*E-U);c=b+R*(d*E-z)}x=Math.floor(m.m_nCurrentX/E+v);b=Math.floor(m.m_nCurrentY/E+d);D=I.lodFallsOnInteger?s*t.m_nTilesX:Math.ceil(D*E);S=I.lodFallsOnInteger?_*t.m_nTilesY:Math.ceil(S*E)}var q=p+Math.log(D/t.m_nWidthCanvas)*Math.LOG2E;if(H){o.m_nExactLOD=q;t.MoveCanvas(o,u,c,D,S);t.m_MapManager.RequestTiles(t.m_Canvas[1],t.m_MapLayerStack,x,b,t.m_nTilesX,t.m_nTilesY,0,0,0,0,p,true);m.m_Scene.ToggleCanvas(m.m_Scene)}t.InternalRenderLayer(t.m_Canvas[t.m_nOverlayIndex],false,H,H,q);if(t.m_bNavControlVisible&&t.m_NavControl){t.m_NavControl.AdjustScrollPoint(q)}t.InternalOnMoveLayer(m,r);t.InternalOnZoomLayer(t.m_Canvas[t.m_nOverlayIndex],r);t.m_LastDefinedCenterPos=t.m_LastZoomArea=undefined};t.ZoomOtherCanvas=function(e,n,a,i,r){var m=Math.round(e.getPixelLeft()-(a-1)*i);var o=Math.round(e.getPixelTop()-(a-1)*r);var l=Math.round(e.getPixelWidth()*a);var s=Math.round(e.getPixelHeight()*a);t.MoveObject(e,m,o,l,s)};t.AnimationStep=function(){var e=t.m_Canvas[0].m_nExactLOD;var n=t.m_Canvas[0].getBoundingClientRect();if(e!=t.AnimZoomTarget){var a=Math.min((Date.now()-t.AnimZoomTimestamp)/t.AnimZoomDuration,1);var i=Math.min(a*(2-a),1);var r=Math.pow(2,t.AnimZoomOrigin+(t.AnimZoomTarget-t.AnimZoomOrigin)*i)/Math.pow(2,e);t.ZoomMap(r,t.AnimZoomClientX-n.left,t.AnimZoomClientY-n.top,a<1?0:1,true);if(a<1){t.m_AnimZoomRequestID=window.requestAnimationFrame(t.AnimationStep);return}}t.ZoomMap(1,t.AnimZoomClientX-n.left,t.AnimZoomClientY-n.top,1,true);t.InternalOnMoveLayer(t.m_Canvas[t.m_nOverlayIndex],t.AnimZoomClickCoords);t.InternalOnZoomLayer(t.m_Canvas[t.m_nOverlayIndex],t.AnimZoomClickCoords);t.m_AnimZoomRequestID=0;t.AnimZoomClientX=t.AnimZoomClientY=t.AnimZoomClickCoords=undefined;t.AnimZoomTimestamp=t.AnimZoomDuration=t.AnimZoomOrigin=t.AnimZoomTarget=undefined};t.AnimateZoom=function(e,n,a,i,r){var m=r!=undefined&&r.clientX!=undefined?{x:r.clientX,y:r.clientY}:undefined;t.AnimZoomClientX=n;t.AnimZoomClientY=a;t.AnimZoomClickCoords=m;t.AnimZoomOrigin=t.m_Canvas[0].m_nExactLOD;t.AnimZoomTarget=Math.round(t.AnimZoomTarget?t.AnimZoomTarget:t.AnimZoomOrigin)+(e?1:-1);t.AnimZoomTimestamp=Date.now();t.AnimZoomDuration=Math.pow(Math.abs(t.AnimZoomTarget-t.AnimZoomOrigin),.8)*300;if(t.m_AnimZoomRequestID){window.cancelAnimationFrame(t.m_AnimZoomRequestID)}t.m_AnimZoomRequestID=window.requestAnimationFrame(t.AnimationStep)};t.AnimationToGeoStep=function(e,n,a,i,r){if(--t.m_nAnimOpenTicks){t.ZoomToZoomlevel(n,a-(t.m_nAnimOpenTicks-1)*(a-i)/(t.m_nAnimTicks-1),true);var m=Date.now(),o=e;if(t.m_AnimTimestamp){var l=Math.max(0,m-t.m_AnimTimestamp);o=Math.max(10,2*e-l)}t.m_AnimTimestamp=m;t.m_AnimZoomTimer=window.setTimeout(function(){t.AnimationToGeoStep(e,n,a,i,r)},o);return}t.InternalOnZoomLayer(t.m_Canvas[t.m_nOverlayIndex]);if(t.m_AnimZoomTimer){t.m_nAnimOpenTicks=t.m_nAnimationTicks=undefined;window.clearTimeout(t.m_AnimZoomTimer);t.m_AnimZoomTimer=null;t.InternalRenderLayer(t.m_Canvas[t.m_nOverlayIndex],false,false,false,t.m_Canvas[0].m_nExactLOD)}};t.AnimateZoomToGeo=function(e,n,a){var i=t.m_Canvas[0].m_nExactLOD;if(i==n){return}t.m_bNonIntPosStable=false;var r=2*t.m_nTicksInALod;if(t.m_AnimZoomTimer){window.clearTimeout(t.m_AnimZoomTimer)}t.m_nAnimTicks=2+Math.abs(Math.round((i-n)*r));t.m_nAnimOpenTicks=t.m_nAnimTicks;var m=i;var o=n;var l=a*r/t.m_nAnimTicks;t.m_AnimZoomTimer=window.setTimeout(function(){t.AnimationToGeoStep(l,e,o,m,r)},l)};t.PerFormMultiSelect=function(e,n){if(t.m_nInputMode!=VBI.InputModeLassoSelect&&t.m_nInputMode!=VBI.InputModeRectSelect){return}var a,i;if(e.type.indexOf("touch")>=0||e.type.indexOf("pointer")>=0){a=i=false}else{i=e.ctrlKey;a=e.shiftKey}var r=t.m_VOS.length;var m=false;var o=[],l=[];var s,_,v,d,u,c;var f=false;for(var h=0;h<r;++h){l[h]=[];o=[];if(t.m_nInputMode==VBI.InputModeLassoSelect&&!t.m_VOS[h].LassoSelect){continue}if(t.m_nInputMode==VBI.InputModeLassoSelect){f=t.m_VOS[h].LassoSelect(n.m_PosMoves,o,l[h])}else{f=t.m_VOS[h].RectSelect(n.selectionRect,o,l[h])}if(f){c=t.m_VOS[h];if(!(u=c.m_DataSource)){continue}if(!a&&!i&&u){if(v=u.GetCurrentNode(t.m_Ctx)){for(_=0;_<=1;_++){for(s=0;s<v.m_dataelements.length;++s){u.Select(s);if(d=u.GetIndexedElement(t.m_Ctx,s)){if(c.IsSelected(t.m_Ctx)){if(VBI.IndexOf(o,s)==-1){c.Select(d,t.m_Ctx,false);m=true}}else if(VBI.IndexOf(o,s)!=-1){c.Select(d,t.m_Ctx,true);m=true}}}}}}else if(a){for(s=0;s<o.length;s++){u.Select(o[s]);if(d=u.GetIndexedElement(t.m_Ctx,o[s])){if(!c.IsSelected(t.m_Ctx)){c.Select(d,t.m_Ctx,true);m=true}}}}else if(i){var C=[];for(s=0;s<o.length;s++){u.Select(o[s]);var g={};if(c.IsSelected(t.m_Ctx)){g.toSelect=false}else{g.toSelect=true}g.idx=s;C.push(g)}for(_=0;_<=1;_++){for(s=0;s<C.length;s++){u.Select(o[C[s]]);if(d=c.m_DataSource.GetIndexedElement(t.m_Ctx,o[C[s].idx])){if(_==0&&C[s].toSelect){c.Select(d,t.m_Ctx,true);m=true}if(_==1&&!C[s].toSelect){c.Select(d,t.m_Ctx,false);m=true}}}}}}}if(t.m_PreassembledData&&l.length){t.UpdatePreData4SelArray(l)}var M;if(m&&(M=t.m_Ctx.m_Actions)){var I;if(I=M.findAction("Select",t,"General")){t.m_Ctx.FireAction(I,t,"General",null,null)}}};t.endTrackingMode=function(){if(t.m_nInputMode==VBI.InputModeRectSelect||t.m_nInputMode==VBI.InputModeLassoSelect||t.m_nInputMode==VBI.InputModeRectZoom){t.m_DesignVO.ExitMode()}};t.GetViewport=function(){var e=t.GetStretchFactor4Mode();var n=t.GetInternalDivClientRect();var a=n.width/e[0];var i=n.height/e[1];var r=t.m_Canvas[0].getPixelLeft()/e[0];var m=t.m_Canvas[0].getPixelTop()/e[1];return[-r,-m,-r+a,-m+i]};t.IsTransparent=function(e,n){var a=t.m_Canvas[t.m_nOverlayIndex];if(!a){return false}var i=a.getContext("2d");var r=a.getBoundingClientRect();var m=Date.now();var o=i.getImageData(Math.round(e-r.left),Math.round(n-r.top),1,1);if(t.m_bObjCanvasMode&&VBI.m_bIsMyChromeTest&&(a.width!=t.m_nlstWidth||a.height!=t.m_nlstHeight)){var l=Date.now()-m;t.m_nlstWidth=a.width;t.m_nlstHeight=a.height;if(l>40){t.m_nGetImageDataIncidents++;if(t.m_nGetImageDataIncidents>2||l>200){t.m_bSwitch2OldCanvasMode=true}}}var s=o.data[3];return s?false:true};t.GetCurrentZoomFactors=function(){return[t.m_StretchFactors[0]*t.m_ZoomFactors[0],t.m_StretchFactors[1]*t.m_ZoomFactors[1]]};t.GetStretchFactor4Mode=function(){return t.m_StretchFactors};t.GetZoomFactor4Mode=function(){return t.m_ZoomFactors};t.ToggleCanvas=function(e){var n=e.m_Canvas[0];e.m_Canvas[0]=e.m_Canvas[1];e.m_Canvas[1]=n;e.m_Canvas[0].className="vbi-geoscenecanvas vbi-map-inactive";e.m_MapsLayerDiv.insertBefore(e.m_Canvas[1],e.m_Canvas[0]);jQuery.sap.delayedCall(0,this,function(n){if(e.m_Canvas[0]){e.m_Canvas[0].className="vbi-geoscenecanvas vbi-map-active"}})};VBI.addScenePositioningFunctions(t);t.getCanvas=function(){return t.m_Canvas[0]};t.SetEdgeTransition=function(e,n,a,t,i,r,m){e[n+9*t]=1;e[n+9*a]=m;e[n+9*i]=m;e[a+9*n]=m;e[i+9*n]=m;e[n+9*r]=m;e[r+9*n]=m};t.SetCornerTransition=function(e,n,a,t){e[n+9*a]=t;e[a+9*n]=t};t.BuildQuarterTransistionTable=function(){var e=[];var n;for(n=0;n<81;++n){e.push(0)}for(n=0;n<9;++n){e[n]=1;e[9*n]=1}t.SetEdgeTransition(e,3,7,6,8,2,16);t.SetEdgeTransition(e,2,4,1,7,6,8);t.SetEdgeTransition(e,6,4,3,5,1,4);t.SetEdgeTransition(e,1,5,2,8,3,2);t.SetCornerTransition(e,4,8,18);t.SetCornerTransition(e,5,7,24);return e};t.clearTimers=function(){if(t.m_AnimZoomTimer){window.clearTimeout(t.m_AnimZoomTimer);t.m_AnimZoomTimer=null}};t.clearCanvas=function(e){t.m_Canvas[e].m_Scene=null;t.m_Canvas[e]=null};t.clearCanvases=function(){for(var e=0,n=t.m_Canvas.length;e<n;++e){t.clearCanvas(e)}t.m_Canvas=[]};t.Remove=function(){if(t.m_Div){t.SetInputMode(VBI.InputModeDefault);while(t.m_Div.firstChild){t.m_Div.removeChild(t.m_Div.firstChild)}if(t.m_Div.parentElement){t.m_Div.parentElement.removeChild(t.m_Div)}t.m_Div=null;t.clearTimers();t.clearCanvases()}if(t.m_Target){while(t.m_Target.firstChild){t.m_Target.removeChild(t.m_Target.firstChild)}t.m_Target=null}};t.AddCopyright=function(){if(!t.m_MapLayerStack){return}if(!t.m_DivCopyright){var e=VBI.Utilities.CreateGeoSceneDivCSS(t.m_Target.id+"-copyright","vbi-copyright");e.setAttribute("role",sap.ui.core.AccessibleRole.ContentInfo);e.m_VBIType="C";t.m_MapDecoDiv.appendChild(e);t.m_DivCopyright=e}var n=t.m_MapLayerStack.GetCopyright();if(n){t.m_DivCopyright.innerHTML=n}else{t.m_DivCopyright.style.paddingRight=0;t.m_DivCopyright.style.paddingLeft=0}};t.ReAwake=function(){t.m_MapLayerStack=t.m_RefMapLayerStack;t.AddCopyright();t.resizeCanvas(0,true)};t.Awake=function(e,n,a){t.m_Target=VBI.Utilities.GetDOMElement(e);if(!t.m_Target){t.m_Target=VBI.Utilities.CreateDOMElement(e,"1px","1px")}if(t.m_Div){if(!t.m_Div.children||!t.m_Div.children.length){t.m_awakeFrame={pos:t.GetCenterPos(),lod:t.GetCurrentZoomlevel()}}else{if(t.m_Div.parentNode==t.m_Target){return}t.m_Target.appendChild(t.m_Div);if(t.m_bNavControlVisible&&t.m_NavControl){t.m_NavControl.AttachEvents()}return}}t.m_TargetName=e;t.m_MapManager=typeof n!=="undefined"?n:VBI.MapManager;t.m_MapLayerStack=typeof a!=="undefined"?a:t.m_RefMapLayerStack;t.m_Div=VBI.Utilities.CreateGeoSceneDivCSS(e+"-geoscene-viewport","vbi-viewport");t.m_Div.setAttribute("role",sap.ui.core.AccessibleRole.Presentation);t.m_Target.appendChild(t.m_Div);t.m_MoveableLayer=VBI.Utilities.CreateGeoSceneDivCSS(e+"-geoscene-moveable-layer","vbi-moveable-layer");t.m_MoveableLayer.setAttribute("role",sap.ui.core.AccessibleRole.Group);t.m_MoveableLayer.setAttribute("tabindex","0");t.m_Div.appendChild(t.m_MoveableLayer);t.m_MapsLayerDiv=VBI.Utilities.CreateGeoSceneDivCSS(e+"-geoscene-mapslayer","vbi-map-layer");t.m_MapsLayerDiv.setAttribute("role",sap.ui.core.AccessibleRole.Presentation);t.m_MoveableLayer.appendChild(t.m_MapsLayerDiv);
// add a layer div for map deco like scale and copyright
t.m_MapDecoDiv=VBI.Utilities.CreateGeoSceneDivCSS(e+"-geoscene-decolayer","vbi-structure-layer");t.m_MapDecoDiv.setAttribute("role",sap.ui.core.AccessibleRole.Presentation);t.m_Div.appendChild(t.m_MapDecoDiv);t.m_LegendLayerDiv=VBI.Utilities.CreateGeoSceneDivCSS(e+"-geoscene-legendlayer","vbi-structure-layer");t.m_LegendLayerDiv.setAttribute("role",sap.ui.core.AccessibleRole.Group);t.m_LegendLayerDiv.setAttribute("tabindex","0");t.m_Div.appendChild(t.m_LegendLayerDiv);t.m_WindowLayerDiv=VBI.Utilities.CreateGeoSceneDivCSS(e+"-geoscene-winlayer","vbi-structure-layer");t.m_WindowLayerDiv.setAttribute("role",sap.ui.core.AccessibleRole.Presentation);if(VBI.m_bIsPhone){t.m_Div.appendChild(t.m_WindowLayerDiv)}else{t.m_MoveableLayer.appendChild(t.m_WindowLayerDiv)}t.DoAwake(e)};t.setProjection=function(){if(!t.m_RefMapLayerStack||!t.m_RefMapLayerStack.m_MapLayerArray||!t.m_RefMapLayerStack.m_MapLayerArray.length){return new VBI.MercatorProjection}var e=t.m_RefMapLayerStack.m_MapLayerArray;var n=e[0].GetMapProvider().m_nProjection;for(var a=2;a<e.length;++a){if(e[a].GetMapProvider().m_nProjection!=n){if(VBI.m_bTrace){VBI.Trace("projection of layer "+a+" is inconsistent to base layer. Choosing projection of base layer")}}}switch(n){case 1:return new VBI.MercatorProjection;case 2:return new VBI.LinearProjection;case 3:return new VBI.ElliMercatorProjection;default:return new VBI.MercatorProjection}};t.DoAwake=function(e){t.CalculateCanvasDimensions();t.CreateCanvases();
// append copyright
if(!t.m_Ctx.moThumbnail){t.AddCopyright()}var n=t.m_Canvas[t.m_nLabelIndex];if(t.m_Events){t.m_Events.clear()}t.m_Events=new VBI.SceneEvent(this,n.parentElement);if(t.m_bNavControlVisible&&t.m_NavControl){t.m_NavControl.Awake(t,e)}if(t.m_bScaleVisible&&t.m_Scale){t.m_Scale.Awake(t,e)}var a=t.GetMinLOD();if(t.m_startLOD<a){var i=Math.ceil(a);t.m_startLOD=i-a<.6?i:a}if(t.m_bObjCanvasMode&&VBI.m_bIsMyChromeTest&&!t.m_bObjCanvasModeChecked){t.ChromePerformanceCheck(n)}if(t.m_awakeFrame){t.ZoomToGeoPosition(t.m_awakeFrame.pos,t.m_awakeFrame.lod,true,false,true);t.RenderAsync(true);t.m_awakeFrame=null}else{t.GoToInitialStart()}if(t.m_nInitialTrackingMode==VBI.InputModeRectSelect){new t.RectSelection}else if(t.m_nInitialTrackingMode==VBI.InputModeLassoSelect){new t.LassoSelection}else if(t.m_nInitialTrackingMode==VBI.InputModeRectZoom){new t.RectangularZoom}t.m_nInitialTrackingMode=VBI.InputModeDefault};t.ChromePerformanceCheck=function(e){var n=false;var a=[855,672,1512,240,801,901,1222,1392,1023,1024];var i=e.width,r=e.height;var m;var o=e.getContext("2d");e.width=e.height=1024;m=o.getImageData(500,500,1,1);var l,s=Date.now();for(var _=0;_<10;++_){l=Date.now();e.width=e.height=a[_];m=o.getImageData(500,500,1,1);if(Date.now()-l>60){n=true;break}}e.width=i;e.height=r;if(n||Date.now()-s>80){t.m_bObjCanvasMode=0;var v=n?"("+(Date.now()-l)+" ms peak)":"("+(Date.now()-s)/10+" ms average)";VBI.Trace("Setting Object Canvas Mode to Old Style due to Performance issues "+v);if(VBI.m_bTrace){VBI.Trace("Some Pixel was "+m)}}else{VBI.Trace("Chrome Performance Test passed with "+(Date.now()-s)/10+" ms average time.")}t.m_bObjCanvasModeChecked=true};t.CalcCanvasWidth=function(e,n){return Math.floor(e/n+t.m_nCanvasXOversize)*n};t.CalcCanvasHeight=function(e,n){return Math.floor(e/n+t.m_nCanvasYOversize)*n};t.GetInternalDivWidth=function(){if(this.m_Ctx.moThumbnail&&this.m_Ctx.moThumbnail.nOrgWidth){return this.m_Ctx.moThumbnail.nOrgWidth}var e=t.m_Div.parentNode.getBoundingClientRect();return e.width?e.width:t.m_Div.clientWidth};t.GetInternalDivHeight=function(){if(this.m_Ctx.moThumbnail&&this.m_Ctx.moThumbnail.nOrgHeight){return this.m_Ctx.moThumbnail.nOrgHeight}var e=t.m_Div.parentNode.getBoundingClientRect();return e.height?e.height:t.m_Div.clientHeight};t.GetPreviewImage=function(e,n){var a=e;if(a.m_PreviewPosition){t.m_MapManager.GetPreviewImage(a.m_PreviewPosition.longitude,a.m_PreviewPosition.latitude,a.m_PreviewPosition.lod,a,t,n)}else{var i=t.m_Ctx.m_Control.getInitialPosition();var r=t.m_Ctx.m_Control.getInitialZoom();var m=i.split(";");t.m_MapManager.GetPreviewImage(m[0],m[1],r,a,t,n)}};t.CalculateCanvasDimensions=function(){var e=t.m_Target.offsetWidth;var n=t.m_MapManager;var a=t.GetInternalDivWidth();var i=t.GetInternalDivHeight();if(a==t.m_nDivWidth&&i==t.m_nDivHeight){return}t.m_nDivWidth=a;t.m_nDivHeight=i;t.m_nWidthCanvas=t.CalcCanvasWidth(a,n.m_tileWidth);t.m_nHeightCanvas=t.CalcCanvasHeight(i,n.m_tileHeight);t.m_nTilesX=t.m_nWidthCanvas/n.m_tileWidth;t.m_nTilesY=t.m_nHeightCanvas/n.m_tileHeight;n.m_requestTileWidth=n.m_tileWidth;n.m_requestTileHeight=n.m_tileHeight;var r=t.m_MapLayerStack;if(r.m_nMaxSquare&&r.m_MapLayerArray.length){var m=0;for(var o=0;o<r.m_MapLayerArray.length;++o){if(!o||r.m_MapLayerArray[o].m_refMapProvider.m_nResolution<m){m=parseInt(r.m_MapLayerArray[o].m_refMapProvider.m_nResolution,10)}}var l=r.m_nMaxSquare*m;if(t.m_nTilesX*n.m_tileWidth>l||t.m_nTilesY*n.m_tileHeight>l){var s=Math.floor(l/Math.max(t.m_nTilesX,t.m_nTilesY));n.m_requestTileWidth=s;n.m_requestTileHeight=s}}if(VBI.m_bTrace){VBI.Trace("Setting Canvas Size to ("+t.m_nWidthCanvas+","+t.m_nHeightCanvas+") on div with size ("+a+","+i+"). Dummy is "+e)}t.m_nMapMoveXPreLoad=Math.min(120,n.m_tileWidth*(t.m_nTilesX-1)-a);t.m_nMapMoveYPreLoad=Math.min(120,n.m_tileHeight*(t.m_nTilesY-1)-i);t.m_nCanvasStdXPos=(t.m_nWidthCanvas-t.m_nDivWidth)/n.m_tileWidth/2;t.m_nCanvasStdYPos=(t.m_nHeightCanvas-t.m_nDivHeight)/n.m_tileHeight/2;t.m_nMaxPixelBeyondPoles=0};t.SwitchTmpCanvasToActive=function(){var e=t.m_Canvas[0],n=t.m_Canvas[t.m_nNonDomIndex];var a=e.getContext("2d");a.clearRect(0,0,e.getPixelWidth(),e.getPixelHeight());a.drawImage(t.m_Canvas[t.m_nNonDomIndex],0,0);t.MoveCanvas(e,e.getPixelLeft()-n.m_nOffsetX*e.getPixelWidth()/t.m_nTilesX,e.getPixelTop()-n.m_nOffsetY*e.getPixelHeight()/t.m_nTilesY);e.m_nCurrentX=n.m_nCurrentX;e.m_nCurrentY=n.m_nCurrentY;n.m_bCanvasValid=false;n.m_CanvasRedirect=e;n.m_CanvasRedirRequest=n.m_nRequest;n.m_nOffsetX=n.m_nOffsetY=0;n.m_nTilesBefSwitch=undefined;t.InternalRenderLayer(t.m_Canvas[t.m_nOverlayIndex],false,true,true,e.m_nExactLOD)};t.InitializeCanvas=function(e,n){e.m_Scene=t;e.m_nCurrentLOD=2;e.m_nExactLOD=2;e.m_nCurrentX=undefined;e.m_nCurrentY=undefined;e.m_nAppliedRequest=0;e.m_bInvalid=false;if(e.m_bNotInDOM!=2){if(!n){t.m_MapsLayerDiv.appendChild(e)}else{t.m_MapsLayerDiv.insertBefore(e,n)}}};t.AttachCanvasesToDOM=function(){var e=t.m_Div.firstChild,n;while(e){var a=e.m_VBIType;n=e.nextSibling;if(a=="L"||a=="N"||a=="S"||a=="C"){t.m_Div.removeChild(e)}else if(e.m_VBIHidden){e.m_VBIHidden=false;e.style.display=e.m_VBIOrgDiplay}e=n}for(var i=0;i<t.m_Canvas.length;++i){if(t.m_Canvas[i].m_bNotInDOM!=2){t.m_Canvas[i].m_bNotInDOM=!t.m_Canvas[i].m_bNotInDOM}}t.m_bThumbnailedCanvases=false;if(t.m_bNavControlVisible){t.m_NavControl=new VBI.NavigationControl(t.m_SuppressedNavControlVisibility);t.m_NavControl.AttachEvents();t.m_NavControl.Awake(t,t.m_TargetName)}if(t.m_bScaleVisible){t.m_Scale=new VBI.Scale(t);t.m_Scale.Awake(t,t.m_TargetName)}t.AddCopyright()};t.DetachCanvasesFromDOM=function(){for(var e=0;e<t.m_Canvas.length;++e){if(t.m_Canvas[e].m_bNotInDOM!=2){t.m_Canvas[e].m_bNotInDOM=!t.m_Canvas[e].m_bNotInDOM}}var n=t.m_TargetName+"-"+t.m_ID+"-";var a=t.m_Div.firstChild,i;while(a){var r=a.m_VBIType;i=a.nextSibling;if(r=="L"||r=="N"||r=="S"||r=="C"){t.m_Div.removeChild(a)}else{a.m_VBIHidden=true;a.m_VBIOrgDiplay=a.style.display;a.style.display="none"}a=i}var m;if(t.m_nThumbnailIndex){m=t.m_Canvas[t.m_nThumbnailIndex];m.width=t.m_Div.clientWidth;m.setPixelWidth(m.width);m.height=t.m_Div.clientHeight;m.setPixelHeight(m.height)}else{m=VBI.Utilities.CreateGeoSceneCanvas(n+"thumbnail",t.m_Div.clientWidth,t.m_Div.clientHeight,0,false);t.m_ThumbnaiEvents=new VBI.ThumbnailEvent(this,m);t.m_Canvas.push(m);t.m_nThumbnailIndex=t.m_Canvas.length-1}t.m_Div.appendChild(m);t.m_bThumbnailedCanvases=true;if(t.m_NavControl){t.m_SuppressedNavControlVisibility=t.m_NavControl.suppressedVisibility;t.m_NavControl.clear();t.m_NavControl=null}if(t.m_Scale){t.m_Scale.clear();t.m_Scale=null}t.m_DivCopyright=null};t.CreateCanvases=function(){var e=t.m_TargetName+"-"+t.m_ID+"-";var n=false;if(t.m_Ctx.moThumbnail){n=true;if(!t.m_Ctx.moThumbnail.bThumbnailed){t.m_Ctx.DoMinimize(t)}}t.clearCanvases();t.m_Canvas.push(VBI.Utilities.CreateGeoSceneCanvas(e+"layer1",t.m_nWidthCanvas,t.m_nHeightCanvas,-1,n,"vbi-map-active"));t.m_Canvas.push(VBI.Utilities.CreateGeoSceneCanvas(e+"layer2",t.m_nWidthCanvas,t.m_nHeightCanvas,-1,n,"vbi-map-inactive"));t.m_Canvas.push(VBI.Utilities.CreateGeoSceneCanvas(e+"objectlayer",t.m_nWidthCanvas,t.m_nHeightCanvas,-1,n));t.m_Canvas.push(VBI.Utilities.CreateGeoSceneCanvas(e+"labellayer",t.m_nWidthCanvas,t.m_nHeightCanvas,0,n,undefined,t.ariaLabel));t.m_Canvas.push(VBI.Utilities.CreateGeoSceneCanvas(e+"nondomlayer",t.m_nWidthCanvas,t.m_nHeightCanvas,-1,2));if(n){t.m_Canvas.push(VBI.Utilities.CreateGeoSceneCanvas(e+"thumbnail",t.m_Div.clientWidth,t.m_Div.clientHeight,0,false));t.m_nThumbnailIndex=t.m_Canvas.length-1;t.m_ThumbnaiEvents=new VBI.ThumbnailEvent(this,t.m_Canvas[t.m_nThumbnailIndex]);t.m_bThumbnailedCanvases=true}t.m_nShadowIndex=undefined;for(var a=0;a<t.m_Canvas.length;++a){t.InitializeCanvas(t.m_Canvas[a])}t.ToggleCanvas(t);if(t.m_Ctx.moThumbnail){t.DetachCanvasesFromDOM()}if(t.m_nCanvasMaxPixel==undefined){var i=8192;if(VBI.m_bIsMyChromeTest){i=32767}if(VBI.m_bIsIDevice){i=5120}if(VBI.m_bIsAndroid){i=16384}t.m_nCanvasMaxPixel=t.CalculateCanvasMaxPixel(t.m_Canvas[2],i,16384)}};t.CalculateCanvasMaxPixel=function(e,n,a){var i=e.width;var r=e.height;if(n>a-100){return n}var m=e.getContext("2d");if(t.CanvasSizeTest(e,m,Math.floor(n*1.05))){while(a-n>50){var o=Math.floor((n+a)/2);if(t.CanvasSizeTest(e,m,o)){n=o}else{a=o}}}e.width=i;e.height=r;return n};t.CanvasSizeTest=function(e,n,a){e.height=1024;e.width=a;n.fillStyle="#050000";n.fillRect(a-1,1023,1,1);var t=n.getImageData(a-1,1023,1,1).data;return t[0]+256*(t[1]+256*t[2])==5};t.DivIsAlive=function(){var e=t.m_Div.getBoundingClientRect();return e.width!=0||e.height!=0};t.resizeCanvas=function(e,n,a){if(!t.DivIsAlive()){return}if(!t.m_Canvas.length){t.DoAwake();return}if(t.m_Canvas[t.m_nNonDomIndex].m_bCanvasValid){t.SwitchTmpCanvasToActive()}var i=t.m_MapManager;var r=t.m_Canvas[0];var m=t.m_nDivWidth;var o=t.m_nDivHeight;var l=t.GetMinLODForWidth(m);var s=r.getPixelWidth()/t.m_nWidthCanvas;t.m_nLastRenderLOD=-1;t.CalculateCanvasDimensions();if(t.m_Ctx.moThumbnail){if(!t.m_bThumbnailedCanvases){t.DetachCanvasesFromDOM()}else{var _=t.m_Canvas[t.m_nThumbnailIndex];_.width=t.m_Div.clientWidth;_.height=t.m_Div.clientHeight;_.setPixelWidth(t.m_Div.clientWidth);_.setPixelHeight(t.m_Div.clientHeight)}}else if(t.m_bThumbnailedCanvases){t.AttachCanvasesToDOM()}else if(!n&&t.m_nDivWidth==m&&t.m_nDivHeight==o){return}if(VBI.m_bTrace){VBI.Trace("Resizing ("+m+","+o+") to ("+t.m_nDivWidth+","+t.m_nDivHeight+")")}var v=r.m_nCurrentX;var d=r.m_nCurrentY;var u=r.m_nCurrentLOD;var c=r.getPixelLeft()+(t.m_nDivWidth-m)/2;var f=Math.round((-c/i.m_tileWidth-t.m_nCanvasStdXPos)/s);c+=s*f*i.m_tileWidth;var h=r.getPixelTop()+(t.m_nDivHeight-o)/2;var C=Math.round((-h/i.m_tileHeight-t.m_nCanvasStdYPos)/s);h+=s*C*i.m_tileHeight;for(var g=0;g<t.m_Canvas.length;++g){if(g!=t.m_nThumbnailIndex){if(t.m_Canvas[g].width!=t.m_nWidthCanvas){t.m_Canvas[g].width=t.m_nWidthCanvas}if(t.m_Canvas[g].height!=t.m_nHeightCanvas){t.m_Canvas[g].height=t.m_nHeightCanvas}}}t.InvalidateCanvas(t.m_Canvas[1]);t.MoveCanvas(r,c,h,s*t.m_nWidthCanvas,s*t.m_nHeightCanvas);t.m_MapManager.RequestTiles(r,t.m_MapLayerStack,v+f,d+C,t.m_nTilesX,t.m_nTilesY,0,0,0,0,u,true);var M=t.m_LastZoomArea;var I=false;if(M!=undefined){var p=(new Date).getTime();if(p-M[0]<3e3){switch(M[1]){case"Area":t.ZoomToArea(M[2],M[3],M[4],M[5],M[6]);I=true;break;case"Areas":t.ZoomToAreas(M[2],M[3]);I=true;break;default:break}}}if(!I){var D=t.GetMinLOD();if(r.m_nExactLOD<D){t.ZoomMap(Math.pow(2,D-r.m_nExactLOD)*1.000001,t.m_nDivWidth/2-c,t.m_nDivHeight/2-h)}else if(!a&&r.m_nExactLOD!=Math.floor(r.m_nExactLOD)){t.AnimateZoomToGeo(t.GetCenterPos(),Math.floor(r.m_nExactLOD),5)}else{t.InternalRenderLayer(t.m_Canvas[t.m_nOverlayIndex],false,true,true,r.m_nExactLOD);t.InternalOnMoveLayer(t.m_Canvas[t.m_nOverlayIndex])}var S=t.GetMaxLOD();if(r.m_nExactLOD>S){t.ZoomMap(Math.pow(2,S-r.m_nExactLOD),t.m_nDivWidth/2-c,t.m_nDivHeight/2-h)}}if((n||t.GetMinLOD()!=l)&&t.m_NavControl){t.m_NavControl.AdaptMinMaxLOD(t)}if(t.m_bNavControlVisible&&t.m_NavControl){t.m_NavControl.AdjustScrollPoint(t.m_Canvas[0].m_nExactLOD)}t.InternalRenderLayer(t.m_Canvas[t.m_nOverlayIndex],false,false,true,t.m_Canvas[0].m_nExactLOD)};t.showHitMenu=function(e,n){sap.ui.require(["sap/ui/unified/Menu","sap/ui/unified/MenuItem"],function(a,i){var r=t.m_Ctx;if(r.m_strOpenMenu){r.m_Menus.findMenuByID(r.m_strOpenMenu).close();r.m_strOpenMenu=undefined}if(r.m_HitMenu){r.m_HitMenu.close();r.m_HitMenu.destroy()}var m=new a({maxVisibleItems:5});var o=t.GetEventVPCoordsObj(e);var l=sap.ui.getCore().getConfiguration().getLanguageTag();var s=function(e){var n=e.m_Vo;var a=n.getLabelText(r,e);if(!a||a==""){a=n.getTooltip(r,e);if(!a||a==""){a=n.m_DataSource.m_Path+"."+n.m_DataSource.GetCurrentElement(r).GetKeyValue()}}return a};n.sort(function(e,n){if(!e.txt){e.txt=s(e)}if(!n.txt){n.txt=s(n)}return e.txt.localeCompare(n.txt,l)});n.forEach(function(n){m.addItem(new i({text:n.txt,select:function(){e.hitCached=n;n.m_Vo["on"+e.m_evName](e)}}))});r.m_HitMenu=m;m.open(true,0,"begin top","begin top",t.m_Div,parseInt(o.x,10)+5+" "+(parseInt(o.y,10)+5),"fit")})};VBI.addSceneLassoTrackingFunctions(t);VBI.addSceneRectangularTrackingFunctions(t);t.m_TransitionTable=t.BuildQuarterTransistionTable();if(e){t.Awake(e,n,a)}return t}});
/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5) (c) Copyright 2009-2012 SAP AG. All rights reserved
 */
sap.ui.predefine("sap/ui/vbm/lib/saputilities", ["./sapvbi"],function(){"use strict";VBI.Utilities=VBI.Utilities||{};HTMLCanvasElement.prototype.getPixelWidth=function(){if(this.m_pixelWidth){return this.m_pixelWidth}if(this.style.pixelWidth!==undefined){return this.style.pixelWidth}return parseInt(this.style.width,10)};HTMLCanvasElement.prototype.getPixelHeight=function(){if(this.m_pixelHeight){return this.m_pixelHeight}if(this.style.pixelHeight!==undefined){return this.style.pixelHeight}return parseInt(this.style.height,10)};HTMLCanvasElement.prototype.getPixelLeft=function(){if(this.m_pixelLeft){return this.m_pixelLeft}if(this.style.pixelLeft!==undefined){return this.style.pixelLeft}return parseInt(this.style.left,10)};HTMLCanvasElement.prototype.getPixelTop=function(){if(this.m_pixelTop){return this.m_pixelTop}if(this.style.pixelTop!==undefined){return this.style.pixelTop}return parseInt(this.style.top,10)};HTMLCanvasElement.prototype.setPixelWidth=function(e){this.m_pixelWidth=e;if(this.style.pixelWidth!==undefined){this.style.pixelWidth=e}else{this.style.width=e+"px"}};HTMLCanvasElement.prototype.setPixelHeight=function(e){this.m_pixelHeight=e;if(this.style.pixelHeight!==undefined){this.style.pixelHeight=e}else{this.style.height=e+"px"}};HTMLCanvasElement.prototype.setPixelLeft=function(e){this.m_pixelLeft=e;if(this.style.pixelLeft!==undefined){this.style.pixelLeft=e}else{this.style.left=e+"px"}};HTMLCanvasElement.prototype.setPixelTop=function(e){this.m_pixelTop=e;if(this.style.pixelTop!==undefined){this.style.pixelTop=e}else{this.style.top=e+"px"}};VBI.Utilities.CreateWifiObject=function(){var e=document.createElement("object");if(!e){return null}e.classid="CLSID:00100000-2013-0070-2000-651572487E69";return e};VBI.Utilities.CreateDOMElement=function(e,t,i,r){var l=document.createElement(e);l.style.height=i?i:"1px";l.style.width=r?r:"1px";l.id=t;return l};VBI.Utilities.GetDOMElement=function(e){var t=[];for(var i=0,r=arguments.length;i<r;i++){var l=arguments[i];if(typeof l=="string"){l=document.getElementById(l)}if(arguments.length==1){return l}t.push(l)}return t};VBI.Utilities.CreateDOMVBIDivElement=function(e,t,i){var r=document.createElement("div");r.setAttribute("role",sap.ui.core.AccessibleRole.Secondary);r.id=e;r.style.height="300x";r.style.width="300px";r.style.overflow="hidden";r.style.position="absolute";r.style.left="0px";r.style.top="0px";return r};VBI.Utilities.Create3DSceneDiv=function(e){var t=document.createElement("div");t.setAttribute("role",sap.ui.core.AccessibleRole.Img);t.id=e;t.style.left="0px";t.style.top="0px";t.style.width="100%";t.style.height="100%";t.style.position="relative";t.style.overflow="hidden";return t};VBI.Utilities.Create3DSceneCanvas=function(e,t,i,r,l,a){var n=document.createElement("canvas");n.setAttribute("role",sap.ui.core.AccessibleRole.Img);n.id=e;n.m_pixelLeft=n.m_pixelTop=0;n.width=n.m_pixelWidth=t?t:512;n.height=n.m_pixelHeight=i?i:512;n.style.left=n.style.top="0px";n.style.width=n.m_pixelWidth+"px";n.style.height=n.m_pixelHeight+"px";n.style.position="absolute";n.style.zIndex=r;n.style.touchaction="none";n.className="vbi-3Dscenecanvas";n.m_bNotInDOM=a!=undefined?a:false;n.m_CanvasValid=!n.m_bNotInDOM;if(n.m_bNotInDOM){n.m_nMoveCount=0}if(l!=undefined){n.tabIndex=l}return n};VBI.Utilities.CreateGeoSceneCanvas=function(e,t,i,r,l,a,n){var s=document.createElement("canvas");s.setAttribute("role",sap.ui.core.AccessibleRole.Img);s.id=e;s.m_pixelLeft=s.m_pixelTop=0;s.width=s.m_pixelWidth=t?t:512;s.height=s.m_pixelHeight=i?i:512;s.style.left=s.style.top="0px";s.style.width=s.m_pixelWidth+"px";s.style.height=s.m_pixelHeight+"px";s.style.position="absolute";s.style.touchaction="none";s.className="vbi-geoscenecanvas";if(a){s.className+=" "+a}if(n){s.setAttribute("aria-label",n)}s.m_bNotInDOM=l!=undefined?l:false;s.m_CanvasValid=!s.m_bNotInDOM;s.m_VBIType="L";if(s.m_bNotInDOM){s.m_nMoveCount=0}if(r!=undefined){s.tabIndex=r}return s};VBI.Utilities.Align=["","left","center","","right"];VBI.Utilities.CreateCaption=function(e,t,i,r,l,a,n,s,o,u){var c=document.createElement("div");c.setAttribute("role",sap.ui.core.AccessibleRole.Note);c.id=e;c.style.left=i+"px";c.style.top=r+"px";c.style.width=(l-i).toString()+"px";c.style.height=(a-r).toString()+"px";c.style.textAlign=VBI.Utilities.Align[u];c.style.title=n;switch(o){case 3:c.style.fontSize="14px";c.style.fontWeight="bold";break}c.className="vbi-2d-caption vbi-2d-common";c.innerHTML=jQuery.sap.encodeHTML(t);return c};VBI.Utilities.CreateLabel=function(e,t,i,r,l,a,n,s){var o=document.createElement("div");o.setAttribute("role",sap.ui.core.AccessibleRole.Description);o.id=e;o.style.left=i+"px";o.style.top=r+"px";o.style.width=(l-i).toString()+"px";o.style.height=(a-r).toString()+"px";o.style.textAlign=VBI.Utilities.Align[s];o.style.title=n;o.className="vbi-2d-label vbi-2d-common";o.innerHTML=jQuery.sap.encodeHTML(t);return o};VBI.Utilities.CreateLink=function(e,t,i,r,l,a,n,s,o){var u=document.createElement("a");u.setAttribute("role",sap.ui.core.AccessibleRole.Link);u.id=e;u.style.left=i+"px";u.style.top=r+"px";u.style.width=(l-i).toString()+"px";u.style.height=(a-r).toString()+"px";u.style.textAlign=VBI.Utilities.Align[o];u.className="vbi-2d-link vbi-2d-common";u.href=n?n:"javascrip"+"t:void(0)";u.title=s;u.innerHTML=jQuery.sap.encodeHTML(t);return u};VBI.Utilities.CreateImage=function(e,t,i,r,l,a,n,s){var o=t.cloneNode(true);o.setAttribute("role",sap.ui.core.AccessibleRole.Img);o.id=e;o.style.left=i+"px";o.style.top=r+"px";o.style.width=(l-i).toString()+"px";o.style.height=(a-r).toString()+"px";o.style.textAlign=VBI.Utilities.Align[s];o.className="vbi-2d-image vbi-2d-common";o.title=n;return o};VBI.Utilities.CreateButton=function(e,t,i,r,l,a,n,s){var o=document.createElement("button");o.id=e;o.style.left=i+"px";o.style.top=r+"px";o.style.width=(l-i).toString()+"px";o.style.height=(a-r).toString()+"px";o.style.textAlign=VBI.Utilities.Align[s];o.className="vbi-2d-button vbi-2d-common";o.innerHTML=jQuery.sap.encodeHTML(t);o.title=n;return o};VBI.Utilities.CreateContainer=function(e,t,i,r,l,a,n,s){var o=document.createElement("div");o.setAttribute("role",sap.ui.core.AccessibleRole.Group);o.id=e;o.style.left=i+"px";o.style.top=r+"px";o.title=n;o.style.position="absolute";if(!s){o.className="vbi-container-vo"}o.m_Key=t;return o};VBI.Utilities.CreateDetailPhone=function(e,t,i,r,l,a,n){var s=document.createElement("div");s.setAttribute("role",sap.ui.core.AccessibleRole.Directory);s.id=e;s.style.left=t+"px";s.style.top=i+"px";var o=12;var u=6;var c=14;o=VBI.Utilities.RemToPixel(.75);u=VBI.Utilities.RemToPixel(.375);c=VBI.Utilities.RemToPixel(.875);if(l){s.style.minHeight=l+c+4+u+2*o+"px"}s.className=".vbi-detail vbi-detail-phone";var v=document.createElement("div");v.setAttribute("role",sap.ui.core.AccessibleRole.Heading);v.id=e+"-window-header";v.className="vbi-detail-header-phone";s.appendChild(v);var f=document.createElement("div");f.setAttribute("role",sap.ui.core.AccessibleRole.Heading);f.id=e+"-window-title";f.className="vbi-detail-title-phone";f.innerHTML=jQuery.sap.encodeHTML(a);v.appendChild(f);var d=document.createElement("div");d.setAttribute("role",sap.ui.core.AccessibleRole.Button);d.id=e+"-window-close";d.className="vbi-detail-closebutton vbi-detail-closebutton-tablet";v.appendChild(d);var p=document.createElement("div");p.setAttribute("role",sap.ui.core.AccessibleRole.Secondary);p.id=e+"-window-content";p.className="vbi-detail-content";p.style.fontSize=VBI.Utilities.RemToPixel(.875)+"px";s.appendChild(p);return{m_Div:s,m_Content:p,m_CloseButton:d,m_Arrow:null,GetAnchorPoint:null}};VBI.Utilities.CreateDetail=function(e,t,i,r,l,a,n){if(VBI.m_bIsPhone){return VBI.Utilities.CreateDetailPhone(e,t,i,r,l,a,n)}var s=document.createElement("div");s.setAttribute("role",sap.ui.core.AccessibleRole.Secondary);s.id=e;s.style.left=t+"px";s.style.top=i+"px";var o=VBI.m_bIsPhone;if(!o){var u=16;var c=16;var v=16;u=VBI.Utilities.RemToPixel(1);c=VBI.Utilities.RemToPixel(1);v=VBI.Utilities.RemToPixel(1);if(r){s.style.width=r+2*u+"px"}if(l){s.style.minHeight=l+v+4+c+2*u+"px"}}else{var f=12;var d=6;var p=14;f=VBI.Utilities.RemToPixel(.75);d=VBI.Utilities.RemToPixel(.375);p=VBI.Utilities.RemToPixel(.875);if(l){s.style.minHeight=l+p+4+d+2*f+"px"}}s.className="vbi-detail vbi-detail-border";var h=document.createElement("div");h.setAttribute("role",sap.ui.core.AccessibleRole.Heading);h.id=e+"-window-header";h.className="vbi-detail-header";s.appendChild(h);var m=document.createElement("div");m.setAttribute("role",sap.ui.core.AccessibleRole.Heading);m.id=e+"-window-title";m.className="vbi-detail-title";m.innerHTML=jQuery.sap.encodeHTML(a);h.appendChild(m);var g=document.createElement("div");g.setAttribute("role",sap.ui.core.AccessibleRole.Button);g.id=e+"-window-close";var I=sap.ui.getCore().getLibraryResourceBundle("sap.ui.vbm.i18n");g.title=I.getText("WINDOW_CLOSE");g.setAttribute("aria-label",I.getText("WINDOW_CLOSE"));g.className="vbi-detail-closebutton vbi-detail-closebutton-"+(VBI.m_bIsMobile?"tablet":"desktop");h.appendChild(g);var b=document.createElement("div");b.setAttribute("role",sap.ui.core.AccessibleRole.Secondary);b.id=e+"-window-content";b.className="vbi-detail-content";s.appendChild(b);var y=document.createElement("b");y.setAttribute("role",sap.ui.core.AccessibleRole.Presentation);y.className="vbi-detail-arrow vbi-detail-left vbi-detail-border-arrow";if(!o){s.appendChild(y)}var B;B=document.createElement("b");B.setAttribute("role",sap.ui.core.AccessibleRole.Presentation);B.className="vbi-detail-arrow vbi-detail-left";if(!o){s.appendChild(B)}return{m_Div:s,m_Content:b,m_CloseButton:g,m_Arrow:B,GetAnchorPoint:function(){if(VBI.m_bIsRtl){return[this.m_Arrow.offsetLeft+this.m_Arrow.offsetWidth+2,this.m_Arrow.offsetTop+this.m_Arrow.offsetHeight/2]}else{return[this.m_Arrow.offsetLeft,this.m_Arrow.offsetTop+this.m_Arrow.offsetHeight/2]}}}};VBI.Utilities.CreateLegendPhone=function(e,t,i,r,l,a,n){};VBI.Utilities.CreateLegend=function(e,t,i,r,l){var a=document.createElement("div");a.setAttribute("role",sap.ui.core.AccessibleRole.Group);a.setAttribute("tabindex","0");a.id=e;if(VBI.m_bIsRtl){a.style.left="0px";a.style.right=""}else{a.style.right="0px";a.style.left=""}a.style.top=t+"px";a.className="vbi-legend";var n=sap.ui.getCore().getLibraryResourceBundle("sap.ui.vbm.i18n");var s=document.createElement("div");s.id=e+"-button-collapse";s.title=n.getText("LEGEND_COLLAPSE");s.setAttribute("role",sap.ui.core.AccessibleRole.Button);s.setAttribute("aria-label",s.title);s.className="vbi-legend-button vbi-legend-button-col";a.appendChild(s);var o=document.createElement("div");o.id=e+"-button-expand";o.title=n.getText("LEGEND_EXPAND");o.setAttribute("role",sap.ui.core.AccessibleRole.Button);o.setAttribute("aria-label",o.title);o.className="vbi-legend-button vbi-legend-button-exp";a.appendChild(o);o.style.visibility="hidden";var u=document.createElement("div");u.id=e+"-header";u.className="vbi-legend-header";u.setAttribute("role",sap.ui.core.AccessibleRole.Presentation);a.appendChild(u);var c=document.createElement("div");c.setAttribute("role",sap.ui.core.AccessibleRole.Heading);c.id=e+"-title";c.className="vbi-legend-title";c.innerHTML=jQuery.sap.encodeHTML(i);u.appendChild(c);var v=document.createElement("div");v.setAttribute("role",sap.ui.core.AccessibleRole.Presentation);v.id=e+"-content";v.className="vbi-legend-content";a.appendChild(v);var f=document.createElement("table");f.setAttribute("role",sap.ui.core.AccessibleRole.Grid);f.setAttribute("tabindex","0");f.id=e+"-table";f.className=l?"vbi-legend-table vbi-legend-table-click":"vbi-legend-table";v.appendChild(f);return{m_Div:a,m_Header:u,m_Content:v,m_Table:f,m_ButtonCol:s,m_ButtonExp:o}};VBI.Utilities.CreateGeoSceneDivCSS=function(e,t,i){var r=document.createElement("div");r.id=e;if(t){r.className=t}if(i){r.title=i}return r};VBI.Utilities.CreateDOMColorShiftedImageFromData=function(e,t,i,r,l){var a=null,n=i?VBI.Types.string2rhls(i):null;if(!n){a=i?VBI.Types.string2rgba(i):null}var s=null,o=r?VBI.Types.string2rhls(r):null;if(!o){s=r?VBI.Types.string2rgba(r):null}var u=document.createElement("img");var c=document.createElement("img");if(l){u.onload=function(){if(typeof l==="function"){l(u)}this.onload=null};c.onload=function(){var e=document.createElement("canvas");var t=e.getContext("2d");e.width=c.width;e.height=c.height;t.drawImage(c,0,0,c.naturalWidth,c.naturalHeight,0,0,c.width,c.height);var i=t.getImageData(0,0,c.width,c.height);var r=i.data;function l(e,t,i,r){var l=e[t];var a=e[t+1];var n=e[t+2];var s=e[t+3];if(i){var o=VBI.Utilities.RGB2HLS(l,a,n);var u=VBI.Utilities.HLS2RGB(o[0]+i[0],o[1]*i[1],o[2]*i[2]);e[t]=Math.min(Math.round(u[0]),255);e[t+1]=Math.min(Math.round(u[1]),255);e[t+2]=Math.min(Math.round(u[2]),255);e[t+3]=Math.min(Math.round(i[3]*s),255)}else if(r){e[t]=r[0];e[t+1]=r[1];e[t+2]=r[2];if(e[t+3]){e[t+3]=r[4]?Math.floor(Math.min(r[3]*255,255)):255}}}for(var v=0,f=c.width*c.height;v<f;++v){var d=v*4;if(n||a){l(r,d,n,a)}if(o||s){l(r,d,o,s)}}t.putImageData(i,0,0);u.src=e.toDataURL("image/png");this.onload=null}}c.src=e.indexOf("data:image")==0?e:"data:image"+t+";base64,"+e;return u};VBI.Utilities.CreateDOMImageFromData=function(e,t,i){var r=document.createElement("img");if(i){r.onload=function(){if(typeof i==="function"){i(r)}this.onload=null}}r.src=e.indexOf("data:image")==0?e:"data:image"+t+";base64,"+e;return r};VBI.Utilities.GetTransparentImage=function(){var e="iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNgYAAAAAMAASsJTYQAAAAASUVORK5CYII=";if(!this.m_TransparentImage){this.m_TransparentImage=VBI.Utilities.CreateDOMImageFromData(e,"/png",null);this.m_TransparentImage.id="TransparentImage"}return this.m_TransparentImage};VBI.Utilities.PtOnRect=function(e,t){return e[0]>=t[0]&&e[0]<=t[2]&&e[1]>=t[1]&&e[1]<=t[3]?true:false};VBI.Utilities.PtInRect=function(e,t){return e[0]>t[0]&&e[0]<t[2]&&e[1]>t[1]&&e[1]<t[3]?true:false};VBI.Utilities.RectIntersect=function(e,t){return!(t[0]>e[2]||t[2]<e[0]||t[3]<e[1]||t[1]>e[3])};VBI.Utilities.RectOffset=function(e,t,i){e[0]+=t;e[1]+=i;e[2]+=t;e[3]+=i};VBI.Utilities.cImg;VBI.Utilities.GetImagePixelData=function(e){if(!VBI.Utilities.cImg){VBI.Utilities.cImg=document.createElement("canvas")}VBI.Utilities.cImg.width=e.naturalWidth;VBI.Utilities.cImg.height=e.naturalHeight;VBI.Utilities.cImg.style.width=e.naturalWidth+"px";VBI.Utilities.cImg.style.height=e.naturalHeight+"px";VBI.Utilities.cImg.style.top="0px";VBI.Utilities.cImg.style.left="0px";VBI.Utilities.cImg.style.position="absolute";var t=VBI.Utilities.cImg.getContext("2d");t.drawImage(e,0,0);var i=t.getImageData(0,0,VBI.Utilities.cImg.width,VBI.Utilities.cImg.height);return i};VBI.Utilities.pointOnLine=function(e,t,i,r,l){function a(e,t){return(e[0]-t[0])*(e[0]-t[0])+(e[1]-t[1])*(e[1]-t[1])}var n=-1,s=-1,o=r*r,u=o;var c,v,f;var d=VBI.Utilities.sqDistance;var p,h;for(p=0,h=e.length-1;p<h;++p){v=e[p];f=e[p+1];if((c=d(v[0],v[1],f[0],f[1],t,i))<o){o=c;n=p}}if(n>=0){if((c=a([t,i],e[n]))<u){u=c;s=n}if(a([t,i],e[n+1])<u){u=c;s=n+1}}if(l&&h>0){v=e[0];f=e[h];if((c=d(v[0],v[1],f[0],f[1],t,i))<o){o=c;n=p}if(n>=0){if((c=a([t,i],e[n]))<u){u=c;s=n}if(a([t,i],e[0])<u){u=c;s=0}}}return{m_edge:n,m_node:s}};VBI.Utilities.polyInPolygon=function(e,t,i){var r=false,l=false;for(var a=i.length-1;a>=0;--a){var n=i[a];r=false;if(VBI.Utilities.pointInPolygon(e,t[0][0]+n,t[0][1])){r=true;for(var s=0;s<t.length&&r&&!l;++s){var o=[t[s][0]+n,t[s][1]];var u=s+1==t.length?[t[0][0]+n,t[0][1]]:[t[s+1][0]+n,t[s+1][1]];var c,v;l=false;for(var f=0;f<e.length;++f){c=e[f];v=f+1==e.length?e[0]:e[f+1];if(VBI.Utilities.LineLineIntersection(o,u,c,v,true)){l=true}}}}if(r&&!l){break}}return r&&!l};VBI.Utilities.pointInPolygon=function(e,t,i){var r,l,a=e.length;var n,s,o,u,c,v;if(jQuery.type(e[0])=="array"){if(jQuery.type(e[0][0])=="array"){n=this.pointInPolygon(e[0],t,i);if(n){for(u=false,v=1,a=e.length;!u&&v<a;++v){u=this.pointInPolygon(e[v],t,i);if(u){n=false}}}}else{for(n=false,s=-1,o=a,c=o-1;++s<o;c=s){r=e[s];l=e[c];if((r[1]<=i&&i<l[1]||l[1]<=i&&i<r[1])&&t<(l[0]-r[0])*(i-r[1])/(l[1]-r[1])+r[0]){n=!n}}}}else{for(n=false,s=0,o=a,c=o-2;s<=o-2;s+=2){r=[e[s],e[s+1]];l=[e[c],e[c+1]];if((r[1]<=i&&i<l[1]||l[1]<=i&&i<r[1])&&t<(l[0]-r[0])*(i-r[1])/(l[1]-r[1])+r[0]){n=!n}c=s}}return n};VBI.Utilities.pointInTriangle=function(e,t){var i=e[2][0]-e[0][0];var r=e[2][1]-e[0][1];var l=e[1][0]-e[0][0];var a=e[1][1]-e[0][1];var n=t[0]-e[0][0];var s=t[1]-e[0][1];var o=i*i+r*r;var u=i*l+r*a;var c=i*n+r*s;var v=l*l+a*a;var f=l*n+a*s;var d=1/(o*v-u*u);var p=(v*c-u*f)*d;var h=(o*f-u*c)*d;return p>=0&&h>=0&&p+h<1};VBI.Utilities.INSIDE=0;VBI.Utilities.LEFT=1;VBI.Utilities.RIGHT=2;VBI.Utilities.BOTTOM=4;VBI.Utilities.TOP=8;VBI.Utilities.ComputeOutCode=function(e,t,i){var r=i[0];var l=i[2];var a=i[1];var n=i[3];var s=VBI.Utilities.INSIDE;if(e<r){s|=VBI.Utilities.LEFT}else if(e>l){s|=VBI.Utilities.RIGHT}if(t<a){s|=VBI.Utilities.BOTTOM}else if(t>n){s|=VBI.Utilities.TOP}return s};VBI.Utilities.LineIntersectRect=function(e,t,i,r,l){var a={};var n=l[0];var s=l[2];var o=l[1];var u=l[3];var c=VBI.Utilities.ComputeOutCode(e,t,l);var v=VBI.Utilities.ComputeOutCode(i,r,l);var f=false;var d=true;while(d){if(!(c|v)){f=true;break}else if(c&v){break}else{var p,h;var m=c?c:v;if(m&VBI.Utilities.TOP){p=e+(i-e)*(u-t)/(r-t);h=u}else if(m&VBI.Utilities.BOTTOM){p=e+(i-e)*(o-t)/(r-t);h=o}else if(m&VBI.Utilities.RIGHT){h=t+(r-t)*(s-e)/(i-e);p=s}else if(m&VBI.Utilities.LEFT){h=t+(r-t)*(n-e)/(i-e);p=n}if(m==c){e=p;t=h;c=VBI.Utilities.ComputeOutCode(e,t,l)}else{i=p;r=h;v=VBI.Utilities.ComputeOutCode(i,r,l)}}}a.bReturn=false;if(f){a.x0=e;a.y0=t;a.x1=i;a.y1=r;a.bReturn=true}return a};VBI.Utilities.LineLineIntersection=function(e,t,i,r,l){var a=t[1]-e[1];var n=e[0]-t[0];var s=a*e[0]+n*e[1];var o=r[1]-i[1];var u=i[0]-r[0];var c=o*i[0]+u*i[1];var v=a*u-o*n;if(!v){return null}var f=[(u*s-n*c)/v,(a*c-o*s)/v];if(l){var d=[],p=[],h=[],m=[];for(var g=0;g<=1;++g){if(e[g]<t[g]){d[g]=e[g];p[g]=t[g]}else{d[g]=t[g];p[g]=e[g]}if(i[g]<r[g]){h[g]=i[g];m[g]=r[g]}else{h[g]=r[g];m[g]=i[g]}}if(f[0]>=d[0]&&f[0]<=p[0]&&f[0]>=h[0]&&f[0]<=m[0]&&f[1]>=d[1]&&f[1]<=p[1]&&f[1]>=h[1]&&f[1]<=m[1]){return true}else{return false}}return[(u*s-n*c)/v,(a*c-o*s)/v]};VBI.Utilities.IsClockwise=function(e){var t=e.length;if(e.length%2){t-=1}var i,r,l,a,n;n=0;i=e[t-2];l=e[t-1];for(var s=0;s<t;s+=2){r=e[s];a=e[s+1];n+=(r-i)*(a+l);i=r;l=a}return n<0};VBI.Utilities.GetClippedPolygon=function(e,t,i){var r=t;var l=e.slice(0);var a=[];var n;for(var s=0;s<=3;++s,r=0){a=l.slice(0);l=[];var o=[a[a.length-2],a[a.length-1]];var u=[o[0]+r,o[1]];for(var c=0;c<=a.length-2;c+=2){o=[a[c],a[c+1]];var v=[o[0]+r,o[1]];var f=false;var d=false;var p=[];switch(s){case 0:f=v[1]>i[1];d=u[1]>i[1];p=[[i[0],i[1]],[i[2],i[1]]];break;case 1:f=v[0]<i[2];d=u[0]<i[2];p=[[i[2],i[1]],[i[2],i[3]]];break;case 2:f=v[1]<i[3];d=u[1]<i[3];p=[[i[0],i[3]],[i[2],i[3]]];break;case 3:f=v[0]>i[0];d=u[0]>i[0];p=[[i[0],i[1]],[i[0],i[3]]];break;default:break}if(f){if(!d){n=VBI.Utilities.LineLineIntersection(u,v,p[0],p[1],false);if(n){l.push(n[0],n[1])}}l.push(v[0],v[1])}else if(d){n=VBI.Utilities.LineLineIntersection(u,v,p[0],p[1],false);if(n){l.push(n[0],n[1])}}u=[v[0],v[1]]}}return l};VBI.Utilities.GetBarycenterForPolygon=function(e,t){var i=e.slice(0);var r=[i[0],i[1]];var l=[i[i.length-2],i[i.length-1]];if(r!=l){i.push(i[0],i[1])}var a=i.length-2;var n=0;var s=0;var o;var u;for(var c=0;c<a;c+=2){n+=(i[c]+t)*i[c+3]-(i[c+2]+t)*i[c+1]}s=n/2;if(s){n=0;for(var v=0;v<a;v+=2){n+=(i[v]+t+i[v+2]+t)*((i[v]+t)*i[v+3]-(i[v+2]+t)*i[v+1])}o=n/(s*6);n=0;for(var f=0;f<a;f+=2){n+=(i[f+1]+i[f+3])*((i[f]+t)*i[f+3]-(i[f+2]+t)*i[f+1])}u=n/(s*6)}if(o&&u){return[o,u]}return null};VBI.Utilities.GetMidpointForPolygon=function(e,t,i,r){var l=i;var a=[];var n=t[0];var s=t[1];var o=VBI.Utilities.PtInRect([n[0]+l,n[1]],r);var u=VBI.Utilities.PtInRect([s[0]+l,s[1]],r);if(!o||!u){e=VBI.Utilities.GetClippedPolygon(e,l,r);l=0}var c=VBI.Utilities.GetBarycenterForPolygon(e,l);if(c){var v=VBI.Utilities.getNextPoint(c[0],c[1],e,l);a.push(v);return{max:0,aPos:a}}return null};VBI.Utilities.GetClippedPolygons=function(e,t,i){var r=[];var l=e.slice(0);var a=l.length;var n=a-2;var s=VBI.Utilities.IsClockwise(e);if(s>0){l.push(i[0],i[1],i[2],i[1],i[2],i[3],i[0],i[3])}else{l.push(i[0],i[1],i[0],i[3],i[2],i[3],i[2],i[1])}var o=l.length;var u=[];var c=[];var v=[];var f=[];for(var d=0;d<a;d+=2){v.push(d)}var p,h,m,g;var I;p=[l[n]+t,l[n+1]];for(var b=0;b<=n;b+=2){h=[l[b]+t,l[b+1]];var y=VBI.Utilities.LineIntersectRect(p[0],p[1],h[0],h[1],i);if(y.bReturn==true){if((y.x0!=p[0]||y.y0!=p[1])&&(y.x1!=h[0]||y.y1!=h[1])){if(!(y.x0==y.x1&&y.y0==y.y1)){var B=l.push(y.x0,y.y0);I=l.push(y.x1,y.y1);u.push(B-2);c.push(I-2);var x=v.indexOf(b);v.splice(x,0,B-2,I-2)}}else if(y.x0!=p[0]||y.y0!=p[1]){if(y.x0!=h[0]||y.y0!=h[1]){I=l.push(y.x0,y.y0);u.push(I-2);var V=v.indexOf(b);v.splice(V,0,I-2)}}else if(y.x1!=h[0]||y.y1!=h[1]){I=l.push(y.x1,y.y1);c.push(I-2);var U=v.indexOf(b);v.splice(U,0,I-2)}}p=h}for(var A=a,C=0;C<4;A+=2,++C){var T=[];f.push(A);m=[l[A],l[A+1]];if(C==3){g=[l[a],l[a+1]]}else{g=[l[A+2],l[A+3]]}var R=m[0]==g[0]?1:0;var L=R?0:1;for(var w=o;w<=l.length-2;w+=2){if(l[w+L]==m[L]){T.push({pt:l[w+R],idx:w})}}if(C<2){T.sort(VBI.Utilities.StandardSort1)}else{T.sort(VBI.Utilities.StandardSort2)}for(var M=0;M<T.length;++M){f.push(T[M].idx)}m=g}for(var _=a;_<=l.length-2;_+=2){l[_]-=t}for(var E=0;E<u.length;++E){var P=[];var H=u[E];var S=v.indexOf(u[E]);var D=v;var N=f;var O=c;var k=u;P.push(l[u[E]],l[u[E]+1]);var G=0;var W=true;while(W){S++;if(S>D.length-1){S=0}if(D[S]==H){r.push(P);break}P.push(l[D[S]],l[D[S]+1]);var j=O.indexOf(D[S]);if(j>-1){G++;S=N.indexOf(D[S]);var Q=D;D=N;N=Q;Q=O;O=k;k=Q}}}return r};VBI.Utilities.StandardSort1=function(e,t){return e.pt-t.pt};VBI.Utilities.StandardSort2=function(e,t){return t.pt-e.pt};VBI.Utilities.GetMidpointsForPolygon=function(e,t,i,r){var l=[];var a=i;var n=[];var s=t[0];var o=t[1];if(VBI.Utilities.RectIntersect([s[0]+a,s[1],o[0]+a,o[1]],r)){var u=VBI.Utilities.PtOnRect([s[0]+a,s[1]],r);var c=VBI.Utilities.PtOnRect([o[0]+a,o[1]],r);if(!u||!c){l=VBI.Utilities.GetClippedPolygons(e,a,r);if(!l.length){var v=[r[0]+(r[2]-r[0])/2,r[1]+(r[3]-r[1])/2];if(VBI.Utilities.pointInPolygon(e,v[0],v[1])){n.push(v)}}}else{l.push(e)}for(var f=0;f<l.length;++f){var d=VBI.Utilities.GetBarycenterForPolygon(l[f],a);if(d){var p=VBI.Utilities.getNextPoint(d[0],d[1],l[f],a);n.push(p)}}if(n.length>0){return{max:0,aPos:n}}}return null};VBI.Utilities.GetMidpointsForLine=function(e,t,i){var r=[];var l={};var a=[Number.MAX_VALUE,Number.MAX_VALUE];var n=false;var s;var o=[];if(e.length>5){for(var u=0;u<=e.length-6;u+=3){var c=e[u];var v=e[u+1];var f=e[u+3];var d=e[u+4];l=VBI.Utilities.LineIntersectRect(c+t,v,f+t,d,i);if(l.bReturn==true){if(s&&n&&(l.x0!=a[0]||l.y0!=a[1])){o.push(s);n=false}if(!n){s=[];s.push(l.x0);s.push(l.y0);n=true}s.push(l.x1);a[0]=l.x1;s.push(l.y1);a[1]=l.y1}else if(n){o.push(s);n=false}}if(n){o.push(s);n=false}}var p=0;var h=0;for(var m=0;m<o.length;m++){var g=o[m];if(g.length>3){var I=0;var b;var y=[];for(var B=0;B<=g.length-4;B+=2){b=Math.sqrt(Math.pow(g[B+2]-g[B],2)+Math.pow(g[B+3]-g[B+1],2));I+=b;y.push(b)}var x=I;var V=I/2;var U=-1;var A=0;for(var C=y.length-1;C>=0;C--){I-=y[C];if(I<=V){A=V-I;U=C;break}}if(U>-1){var T=[g[U*2+2]-g[U*2],g[U*2+3]-g[U*2+1]];var R=Math.sqrt(Math.pow(T[0],2)+Math.pow(T[1],2));var L=[T[0]/R,T[1]/R];var w=[L[0]*A,L[1]*A];r.push([g[U*2]+parseInt(w[0],10),g[U*2+1]+parseInt(w[1],10)]);if(x>p){p=x;h=m}}}}return{max:h,aPos:r}};VBI.Utilities.updateBoundRect=function(e,t){var i,r=e.length;var l=t[0];var a=t[2];var n=t[1];var s=t[3];for(var o=0;o<r;++o){i=e[o];if(l>i[0]){l=i[0]}if(a<i[0]){a=i[0]}if(n>i[1]){n=i[1]}if(s<i[1]){s=i[1]}}t[0]=l;t[2]=a;t[1]=n;t[3]=s};VBI.Utilities.inflateRect=function(e,t){e[0]-=t;e[1]-=t;e[2]+=t;e[3]+=t};VBI.Utilities.sqDistance=function(e,t,i,r,l,a){var n=i-e;var s=r-t;var o=n*n+s*s;if(!o){return(l-e)*(l-e)+(a-t)*(a-t)}var u=((l-e)*n+(a-t)*s)/o;if(u>1){u=1}else if(u<0){u=0}var c=e+u*n-l;var v=t+u*s-a;return c*c+v*v};VBI.Utilities.getNextPoint=function(e,t,i,r){var l,a,n=i.length;var s=[];var o=[];var u=false;for(var c=0,v=n,f=v-2;c<=v-2;c+=2){l=[i[c]+r,i[c+1]];a=[i[f]+r,i[f+1]];var d=0;var p=[];var h=e-l[0];var m=t-l[1];var g=a[0]-l[0];var I=a[1]-l[1];var b=h*g+m*I;var y=g*g+I*I;if(!y){d=(e-l[0])*(e-l[0])+(t-l[1])*(t-l[1]);p=[l[0],l[1]]}else{var B=b/y;if(B<0){p=[l[0],l[1]]}else if(B>1){p=[a[0],a[1]]}else{p=[l[0]+B*g,l[1]+B*I]}var x=e-(l[0]+B*g);var V=t-(l[1]+B*I);d=x*x+V*V}s.push(p);o.push(d);if((l[1]<=t&&t<a[1]||a[1]<=t&&t<l[1])&&e<(a[0]-l[0])*(t-l[1])/(a[1]-l[1])+l[0]){u=!u}f=c}if(u){return[e,t]}else{var U=1e4;var A=-1;if(o.length){for(var C=0;C<o.length;++C){if(o[C]<U){A=C;U=o[C]}}if(A>-1){return s[A]}}return[i[0]+r,i[1]]}};VBI.Utilities.DrawSelectIndicator=function(e,t){var i=4;e.lineWidth=1;e.strokeStyle="rgba( 0, 0, 0, 1.0 )";e.fillStyle="rgba( 10, 10, 255, 1.0 )";e.beginPath();e.arc(t[0],t[1],i,0,2*Math.PI);e.closePath();e.fill();e.stroke()};VBI.Utilities.DrawDesignRect=function(e,t,i,r,l,a){var n,s,o=3,u=e.setLineDash?true:false;e.save();e.lineWidth=1;e.strokeStyle="rgba( 0, 0, 0, 1.0 )";if(typeof i=="object"){var c=i[2]-i[0];var v=i[3]-i[1];var f=c/2;var d=v/2;if(u){e.setLineDash([1,2])}e.strokeRect(i[0],i[1],c,v);var p="rgba( 255, 255, 255, 1.0 )";var h="rgba( 128, 128, 128, 1.0 )";if(u){e.setLineDash([0,0])}e.fillStyle=p;for(n=0;n<3;++n){for(s=0;s<3;++s){e.fillStyle=t[s*3+n]?p:h;if(n==1&&s==1){continue}e.beginPath();e.arc(i[0]+n*f,i[1]+s*d,o,0,2*Math.PI);e.closePath();e.fill();e.stroke()}}}else{e.strokeRect(i-1,r-1,l-i,a-r);e.strokeStyle="rgba( 255, 255, 255, 1.0 )";e.strokeRect(i,r,l-i,a-r)}e.restore()};VBI.Utilities.DrawFrameRect=function(e,t,i,r,l,a){e.lineWidth=1;e.strokeStyle=t;if(typeof i=="object"){e.strokeRect(i[0],i[1],i[2]-i[0],i[3]-i[1])}else{e.strokeRect(i,r,l-i,a-r)}};VBI.Utilities.AssembleCopyrightString=function(e,t,i){var r=/\{LINK\|IMG\}/;var l=/\{IMG\}/;var a=/\{LINK\|([^\}]+)\}/;if(e){if(!t&&!i){e=jQuery.sap.encodeHTML(e)}t=t?jQuery.sap.encodeHTML(t):t;i=i?jQuery.sap.encodeHTML(i):i;var n=e.replace(r,"<a href='"+t+"'><img src='"+i+"' width='10' height='10' border='none'></a>");n=n.replace(l,"<img src='"+i+"' width='10' height='10' border='none' >");return n.replace(a,"<a  href='"+t+"'>$1</a>")}return e};VBI.Utilities.DrawTrackingRect=function(e,t,i,r,l){e.save();e.strokeStyle="black";e.lineWidth=1;if(e.setLineDash){e.setLineDash([1,2])}e.beginPath();e.rect(t,i,r-t,l-i);e.stroke();e.fillStyle="rgba( 0, 192, 192, 0.2 )";e.fill();e.restore()};VBI.Utilities.DrawTrackingLasso=function(e,t){e.save();e.strokeStyle="black";e.lineWidth=1;if(e.setLineDash){e.setLineDash([1,2])}e.beginPath();e.moveTo(t[0][0],t[0][1]);for(var i=1;i<t.length;++i){e.lineTo(t[i][0],t[i][1])}e.closePath();e.stroke();e.fillStyle="rgba( 0, 192, 192, 0.2 )";e.fill();e.restore()};VBI.Utilities.RGB2HLS=function(e,t,i){e/=255;t/=255;i/=255;var r=Math.max(e,t,i);var l=Math.min(e,t,i);var a=0,n,s=(r+l)/2;if(r==l){a=n=0}else{var o=r-l;n=s>.5?o/(2-r-l):o/(r+l);switch(r){case e:a=(t-i)/o+(t<i?6:0);break;case t:a=(i-e)/o+2;break;case i:a=(e-t)/o+4;break}a/=6}return[a,s,n]};VBI.Utilities.HLS2RGB=function(e,t,i){var r=0,l=0,a=0;if(i==0){r=l=a=t}else{var n=t<.5?t*(1+i):t+i-t*i;var s=2*t-n;r=VBI.Utilities.HUE2RGB(s,n,e+1/3);l=VBI.Utilities.HUE2RGB(s,n,e);a=VBI.Utilities.HUE2RGB(s,n,e-1/3)}return[Math.round(r*255),Math.round(l*255),Math.round(a*255)]};VBI.Utilities.HUE2RGB=function(e,t,i){if(i<0){i+=1}else if(i>1){i-=1}if(i<1/6){return e+(t-e)*6*i}if(i<1/2){return t}if(i<2/3){return e+(t-e)*(2/3-i)*6}return e};VBI.Utilities.RemToPixel=function(e){return e*parseFloat(getComputedStyle(document.documentElement).fontSize)};VBI.Utilities.ColorHex2rgba=function(e){var t=e.charAt(0)==="#"?e.substring(1,7):e;return"rgba("+parseInt(t.substring(0,2),16)+","+parseInt(t.substring(2,4),16)+","+parseInt(t.substring(4,6),16)+",1.0)"};VBI.Utilities.String2VBColor=function(e){var t=VBI.Types.string2rgba(e);if(t[4]===1){return"RGBA("+t[0]+";"+t[1]+";"+t[2]+";"+parseInt(t[3]*255,10)+")"}else{return"RGB("+t[0]+";"+t[1]+";"+t[2]+")"}};VBI.Utilities.CompToHex=function(e){var t=e.toString(16);return t.length==1?"0"+t:t};VBI.Utilities.RgbToHex=function(e,t,i){return"#"+VBI.Utilities.CompToHex(e)+VBI.Utilities.CompToHex(t)+VBI.Utilities.CompToHex(i)}});
/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5) (c) Copyright 2009-2012 SAP AG. All rights reserved
 */
sap.ui.predefine("sap/ui/vbm/lib/sapvbcluster", ["./sapvbi"],function(){"use strict";VBI.Clustering=function(e){var t={};var r={};var a=1/1048576;t.m_Clusters=[];t.m_Clustergroups=[];t.m_loadCount=0;t.m_Parser=VBI.Parser();t.m_nClustertypes=5;t.clear=function(){t.m_Clusters=[]};t.load=function(e,r){if(e.Set){t.clear();t.m_Parser.clear();t.m_loadCount++;var a,n=e.Set.Cluster;if(jQuery.type(n)=="object"){a=new VBI.Clustering.Cluster;a.load(n,r,t.m_Clusters.length);t.m_Clusters.push(a);t.UpdateAutomaticClusterGroup(a.m_groupID)}else if(jQuery.type(n)=="array"){var i=t.m_Clusters.length;for(var s=0,l=n.length;s<l;++s){a=new VBI.Clustering.Cluster;a.load(n[s],r,i++);t.m_Clusters.push(a);t.UpdateAutomaticClusterGroup(a.m_groupID)}}for(var o=0;o<t.m_Clustergroups.length;++o){t.m_Clusters.push(t.m_Clustergroups.shift())}}};t.UpdateAutomaticClusterGroup=function(e){if(e==""){return}var r=t.m_Clusters[t.m_Clusters.length-1];var a,n,i,s;for(var l=0;l<t.m_Clustergroups.length;++l){i=t.m_Clustergroups[l];if(i.m_id==e){a=l}}if(a!=undefined){s=t.m_Clustergroups[a];s.m_limit=Math.min(r.m_limitOnSum,s.m_limit);r.m_bPartOfGrp=true}else{for(var o=0,u=t.m_Clusters.length-1;o<u;++o){i=t.m_Clusters[o];if(i.m_type=="grid"&&i.m_groupID==e){n=o}}if(n!=undefined){var f=t.m_Clusters[n];s=new VBI.Clustering.Cluster;s.m_type="clustergroup";s.m_nType=2;s.m_id=e;s.m_dividerX=f.m_dividerX;s.m_dividerY=f.m_dividerY;s.m_limit=Math.min(r.m_limitOnSum,f.m_limitOnSum);s.initializeFunctions();t.m_Clustergroups.push(s);r.m_bPartOfGrp=f.m_bPartOfGrp=true}}};t.PreassembleDataForVO=function(e,r,a,n,i){var s;var l=r.config.m_BaseLod;var o=t.tw*(l>=0?1<<l:1/(1<<-l));if(s=n.m_DataSource.GetCurrentNode(i)){var u=n.m_ID;var f=r.base[a];if(s.m_dataelements.length){n.m_DataSource.Select(0);var m=n.m_DataSource.GetIndexedElement(i,0);var d=m.GetPath();var c=m.GetKeyValue().length;f.strDataPath=d.substring(0,d.length-c);for(var _=0;_<s.m_dataelements.length;++_){var g=[o,o];n.m_DataSource.Select(_);m=n.m_DataSource.GetIndexedElement(i,_);var v=n.m_Pos.GetValueVector(i);e.m_Proj.LonLatToUCS(VBI.MathLib.DegToRad(v),g);var h=t.m_Parser.evaluate(n,a,i);if(h>=0){g.t=t.m_Clusters[h].m_nType;f.targets[h]++}else{g.t=-1}g.h=n.BaseIsHot(_,i);g.hscale=n.GetHotScale(i);g.hcol=n.m_HotDeltaColor.GetValueString(i);if(g.s=n.IsSelected(i)){g.scol=n.m_SelectColor.GetValueString(i);g.simag=n.m_ImageSelected.GetValueString(i);r.m_SelectedVOs.unshift({m_vo:a,m_index:f.length,m_dataIndex:_})}if(g.im==undefined){g.im=n.m_Image.GetValueString(i)}g.ic=n.m_Icon.GetValueString(i);g.tx=n.m_Text.GetValueString(i);g.ctcol=n.m_ContentColor.GetValueString(i);g.ctoffs=n.m_ContentOffset.GetValueVector(i);g.ctfont=n.m_ContentFont.GetValueString(i);g.ctsz=n.m_ContentSize.GetValueLong(i);g.sc=n.m_Scale.GetValueVector(i);g.al=n.m_Alignment.GetValueString(i);g.m_ID=u;g.nI=_;g.b2Ignore=false;g.cI=h;g.vI=a;g.key=m.GetKeyValue();g.label=n.GetLabel(i);f.push(g)}}for(var C=f.targets.length;C--;){var p=t.m_Clusters[C].m_nType;f.targTypes[p]+=f.targets[C];r.base.targTypes[p]+=f.targets[C]}}};t.InitializeResultVector=function(e,r,a,n,i,s,l,o){t.tw=e.m_tileWidth;t.th=e.m_tileHeight;var u={};var f=t.m_Clusters.length;u.base=[];u.hotItem={};var m,d,c;for(m=0;m<r;++m){c=[];c.clusterings=[];c.m_lodOffset=1;c.m_BaseX=n;c.m_BaseY=i;u.base.push(c);c.targets=[];c.targTypes=[];c.hotItem=u.hotItem;for(d=f;d--;){c.targets.push(0)}for(d=t.m_nClustertypes;d--;){c.targTypes.push(0)}c.m_nNumIgnore=0}u.base.targTypes=[];for(d=t.m_nClustertypes;d--;){u.base.targTypes.push(0)}u.clust=[];for(var _=0;_<f;++_){c=[];c.cI=_;c.m_lodOffset=1;c.m_BaseX=n;c.m_BaseY=i;c.hotItem=u.hotItem;c.m_nRecalcs=0;u.clust.push(c)}u.config={};var g=u.config;g.m_version=t.m_loadCount;g.bNeedsShadowLayer=false;g.m_lod=a;g.m_lodOffset=1;g.m_x=n;g.m_y=i;g.m_nx=s;g.m_ny=l;g.m_nData=o;g.m_calcMode=2;g.m_BaseX=n*t.tw;g.m_BaseY=i*t.tw;g.m_BaseLod=a;u.hotItem={};u.m_SelectedVOs=[];return u};t.CheckNonClusteredVOs=function(e,t){if(!e.base.targTypes[1]){return}for(var r=0;r<e.base.length;++r){var a=e.base[r];if(!a.targTypes[1]){continue}var n,i,s=0;for(n=0,i=a.length;n<i;++n){var l=a[n];if(!l.isCl){if(l.cI!=undefined&&l.sq!=undefined&&t[l.cI][l.sq].b2Cluster){a.m_nNumIgnore++;l.b2Ignore=true}if(!l.b2Ignore){l.bbInd=s;s++}}}a.m_NumVisVOs=s}};t.FetchClusterVOData=function(e,r,a){var n=t.m_Clusters;var i=n.length;var s=[];for(var l=0;l<i;++l){s.push({})}var o=r.length;for(var u=0;u<o;++u){for(var f=0;f<i;++f){if(r[u].m_ID==n[f].m_VO){s[f].m_index=u;s[f].m_image=r[u].m_Image!=undefined?r[u].m_Image.GetValueString(a):"";s[f].m_scale=r[u].m_Scale!=undefined?r[u].m_Scale.GetValueVector(a):[1,1,1];s[f].m_hotscale=r[u].m_HotScale!=undefined?r[u].m_HotScale.GetValueVector(a):[1,1,1];s[f].m_hotcol=r[u].m_HotDeltaColor!=undefined?r[u].m_HotDeltaColor.GetValueString(a):"";s[f].m_alignment=r[u].m_Alignment!=undefined?r[u].m_Alignment.GetValueString(a):0}}}return s};t.FetchClusterGroupData=function(){var e=t.m_Clusters;var r=e.length;var a=[];for(var n=0;n<r;++n){var i=[];if(e[n].m_type=="clustergroup"){for(var s=0;s<r;++s){if(n!=s&&e[n].m_id==e[s].m_groupID){i.push({index:s,limit:e[s].m_limit})}}}a.push(i)}return a};t.AdaptOffsets=function(e,t,r,a,n,i,s){e.config.m_calcMode=1;var l=r-e.config.m_BaseLod;var o=l>=0?1<<l:1/(1<<-l);var u;for(var f=e.base.length-1;f>=0;--f){u=e.base[f];u.m_lodOffset=o;u.m_BaseX=a;u.m_BaseY=n}for(var m=e.clust.length-1;m>=0;--m){u=e.clust[m];u.m_lodOffset=o;u.m_BaseX=a;u.m_BaseY=n}e.config.m_lod=r;e.config.m_x=a;e.config.m_y=n;e.config.m_nx=i;e.config.m_ny=s;e.config.m_lodOffset=o};t.DetermineChanges=function(e,r,a,n,i,s,l){var o={};o.bPosChanged=true;o.bDataChanged=true;o.bClusteringChanged=true;o.lodDiff=0;o.lodFactor=1;o.posDiff=[0,0];if(e!=undefined){var u=e.config;o.lodDiff=r-u.m_lod;if(o.lodDiff==0){o.lodFactor=1<<o.lodDiff;o.posDiff=[t.tw*(a-o.lodFactor*u.m_x),t.th*(n-o.lodFactor*u.m_y)]}else if(o.lodDiff>0){o.lodFactor=1<<o.lodDiff;o.posDiff=[t.tw*(a-o.lodFactor*u.m_x),t.th*(n-o.lodFactor*u.m_y)]}else{o.lodFactor=1/(1<<-o.lodDiff);o.posDiff=[t.tw*(a-o.lodFactor*u.m_x),t.th*(n-o.lodFactor*u.m_y)]}if(u.m_nData==l){o.bDataChanged=false}if(u.m_version==t.m_loadCount){o.bClusteringChanged=false}if(!o.lodDiff&&u.m_x==a&&u.m_y==n&&u.m_nx==i&&u.m_ny==s){o.bPosChanged=false}}o.bNothingChanged=!o.bDataChanged&&!o.bPosChanged&&!o.bClusteringChanged;return o};t.InvalidateOutdatedClustering=function(e,t){var r=t.bDataChanges||t.bClusteringChanged;var a=r;for(var n=0;n<e.base.length;++n){var i=e.base[n];for(var s=i.clusterings.length-1;s>=0;--s){var l=i.clusterings[s];var o=true;switch(l.t){case 0:o=true;break;case 1:o=r||t.lodDiff!=0;break;case 2:o=r;break;default:break}if(o){i.clusterings.splice(s,1);var u=e.clust[l.i];u.m_nRecalcs++;u.splice(0,u.length);a=true}}}return a};t.ClearTreeClusterNode=function(e){if(e.bw){for(var r=e.bw.length;r--;){t.ClearTreeClusterNode(e.bw[r])}for(var a=e.bw.length;a--;){e.bw[a]=undefined}e.bw=undefined}e.e=undefined;e.c=undefined};t.ClearClusterFromPreData=function(e,r){if(e[r].m_TreeFatherNode!=undefined){t.ClearTreeClusterNode(e[r].m_TreeFatherNode)}e[r]=undefined};t.ClearPreassembledData=function(e){var r=e.m_PreassembledData;var a;if(r==undefined){return}for(a=r.clust.length;a--;){t.ClearClusterFromPreData(r.clust,a)}r.clust=undefined;for(a=r.base.length;a--;){r.base[a]=undefined}e.m_PreassembledData=undefined};t.getEdge=function(e,t){if(e[1]!=undefined){return e}var r=t[e];var a=t[e+1];return[[r.c[0],r.c[1]],[a.c[0],a.c[1]]]};t.createEdgeIndex=function(e,r){var a,n=[];var i;for(a=r.length;a--;){i=t.getEdge(r[a],e);i[0].ot=i[1];i[0].i=a;i[1].ot=i[0];i[1].i=-a;var s={};s.i=a;s.c=0;s.p=i[0];i[0].li=s;n.push(s);var l={};l.p=i[1];l.i=-a;l.c=1;i[1].li=l;n.push(l)}n.sort(function(e,t){var r=e.p[0]-t.p[0];return r?r:e.p[1]-t.p[1]});for(a=0;a<n.length;a+=2){n[a].ot=a+1;n[a+1].ot=a}return n};t.getTreeClusterIndex=function(e){var t=e;while(t.c!=undefined){t=t.c}return t.cI};t.getNodeIdent=function(e,r,a){if(r.bw!=undefined){return t.getClusterIdent(e,a,r.nJ)}else{return e.base[r.vI].strDataPath+r.key}};t.getClusterIdent=function(e,t,r){if(!e){return""}var a=e.config;var n=e.clust[t];if(!n){return""}return"["+a.m_version+","+a.m_nData+","+n.m_nRecalcs+","+t+","+r+"]"};t.getClusterArea=function(e,t){if(!t.bo){return undefined}var r=e.m_PreassembledData;var a=e.m_Canvas[0].m_nCurrentX*e.m_MapManager.m_tileWidth;var n=e.m_Canvas[0].m_nCurrentY*e.m_MapManager.m_tileHeight;var i=r.config.m_lodOffset;var s=[i*t.bo[0]-a,i*t.bo[1]-n];var l=[i*t.bo[2]-a,i*t.bo[3]-n];var o=VBI.MathLib.RadToDeg(e.GetGeoFromPoint(s));var u=VBI.MathLib.RadToDeg(e.GetGeoFromPoint(l));return o[0].toString()+";"+o[1].toString()+";"+u[0].toString()+";"+u[1].toString()};t.getClusterPosition=function(e,t){var r=e.m_PreassembledData;var a=e.m_Canvas[0].m_nCurrentX*e.m_MapManager.m_tileWidth;var n=e.m_Canvas[0].m_nCurrentY*e.m_MapManager.m_tileHeight;var i=r.config.m_lodOffset;var s=[i*t[0]-a,i*t[1]-n];return VBI.MathLib.RadToDeg(e.GetGeoFromPoint(s))};t.getInfoForCluster=function(e,r,a){var n=a.m_PreassembledData;var i=n.config;var s;var l=n.clust[e[3]];var o=[];if(i.m_version==e[0]&&i.m_nData==e[1]&&l.m_nRecalcs==e[2]){var u=l[e[4]];if(r==10){var f=u.bw?u.bw.length:0;return{pos:t.getClusterPosition(a,u),bb:t.getClusterArea(a,u),image:u.im,lod:u.lod,ulod:u.c?u.c.lod:undefined,cnt:u.cnt,subs:f,type:u.isCl}}if(u.bw){switch(r){case 0:t.collectNodes(o,u,n);break;case 1:s=t.getTreeClusterIndex(u);for(var m=0;m<u.bw.length;++m){o.push(t.getNodeIdent(n,u.bw[m],s))}break;case 2:s=t.getTreeClusterIndex(u);if(u.c){o.push(t.getNodeIdent(n,u.c,s))}break;case 11:s=t.getTreeClusterIndex(u);return t.collectEdges(a,u,n.clust[s].m_edges);default:break}}}o.sort();return o};t.collectEdges=function(e,r,a){var n=[];if(!r.e||!r.e.length){return[]}var i=t.createEdgeIndex(a,r.e);var s=e.m_PreassembledData;var l=e.m_Canvas[0].m_nCurrentX*e.m_MapManager.m_tileWidth;var o=e.m_Canvas[0].m_nCurrentY*e.m_MapManager.m_tileHeight;var u=s.config.m_lodOffset;var f=i[0].p,m,d,c,_=r.e.length-1;n.push(VBI.MathLib.RadToDeg(e.GetGeoFromPoint([u*f[0]-l,u*f[1]-o])));for(var g=_;g--;){m=f.ot;n.push(VBI.MathLib.RadToDeg(e.GetGeoFromPoint([u*m[0]-l,u*m[1]-o])));c=m.li;d=i[c.ot];f=d.p}return n};t.collectNodes=function(e,r,a){if(r.bw!=undefined){for(var n=0;n<r.bw.length;++n){t.collectNodes(e,r.bw[n],a)}}else{var i=a.base[r.vI];e.push(i.strDataPath+r.key)}};t.DoClustering=function(e,r,a,n,i,s,l,o,u,f,m,d){var c=1<<r;var _=a;while(_<0){_+=c}while(_>c){_-=c}var g=t.DetermineChanges(e.m_PreassembledData,r,_,n,i,s,d);var v;if(g.bNothingChanged){e.m_PreassembledData.config.m_calcMode=0;return e.m_PreassembledData}var h;var C=t.FetchClusterVOData(e,l,o);var p=t.FetchClusterGroupData();t.m_Parser.verifyAttributes(l,o);var b=t.InitializeClusterData(e,r,_,n,i,s);if(g.bDataChanged||g.bClusteringChanged){t.ClearPreassembledData(e);v=t.InitializeResultVector(e.m_MapManager,l.length,r,_,n,i,s,d);for(h=0;h<l.length;++h){var I=l[h];if(I.IsClusterable()){t.PreassembleDataForVO(e,v,h,I,o)}}}else{v=e.m_PreassembledData;t.AdaptOffsets(v,g.posDiff,r,_,n,i,s);if(!t.InvalidateOutdatedClustering(v,g)){return v}}for(h=0;h<t.m_Clusters.length;++h){t.m_Clusters[h].ClusterPass1(h,v,b,g)}for(h=0;h<t.m_Clusters.length;++h){t.m_Clusters[h].ClusterPass2(h,v,b,p)}for(h=0;h<t.m_Clusters.length;++h){t.m_Clusters[h].DecisionPass(e,h,v,b,C,p,g)}t.CheckNonClusteredVOs(v,b);return v};t.InitializeClusterData=function(e,r,a,n,i,s){var l=[];var o=1<<r;l.numTiles=o;l.completeX=o*e.m_nWidthCanvas/e.m_nTilesX;l.completeY=o*e.m_nHeightCanvas/e.m_nTilesY;l.minLOD=e.GetMinLOD();for(var u=0;u<t.m_Clusters.length;++u){var f=t.m_Clusters[u];var m=(i+2)*f.m_dividerX;var d=(s+2)*f.m_dividerY;l.push(f.InitializeClusterData(e,u,a-1,n-1,m,d))}return l};t.VerifyCurrentSelection=function(e,t,r){for(var a=t.m_SelectedVOs.length-1;a>=0;--a){var n=t.m_SelectedVOs[a];var i=e[n.m_vo];i.m_DataSource.Select(n.m_dataIndex);if(!i.IsSelected(r)){var s=n.cI!=undefined?t.clust[n.cI]:t.base[n.m_vo];s[n.m_index].s=false;t.m_SelectedVOs.splice(a,1)}}};t.AddSingle2Selected=function(e,t,r,a,n){var i=t[e];if(i.IsClusterable()){var s=r.cI!=undefined?a.clust[r.cI]:a.base[e];var l=s[r.i];i.m_DataSource.Select(l.nI);if(i.IsSelected(n)){a.m_SelectedVOs.unshift({m_vo:e,m_index:r.i,m_dataIndex:l.nI,cI:r.cI});l.scol=i.m_SelectColor.GetValueString(n);l.simag=i.m_ImageSelected.GetValueString(n);l.s=true}}};t.AddMultiple2Selected=function(e,r,a,n){for(var i=0;i<e.length;++i){var s=e[i];var l=r[i];if(l.IsClusterable()){for(var o=0;o<s.length;++o){t.AddSingle2Selected(i,r,l.GetInternalIndex(s[o]),a,n)}}}};VBI.Clustering.Cluster=function(){var e={};e.m_additionalProperties=[];e.clear=function(){e.m_addProperties=null};e.load=function(r,a,n){e.m_id=r.id;e.m_type=r.type;e.m_type2=r.type2;e.m_switch=parseInt(r.typeswitch,10);e.m_bPartOfGrp=false;e.m_VO=r.VO;e.m_order=parseInt(r.order,10);e.m_dispOffsetX=parseInt(r.offsetX,10);if(isNaN(e.m_dispOffsetX)){e.m_dispOffsetX=0}e.m_dispOffsetY=parseInt(r.offsetY,10);if(isNaN(e.m_dispOffsetY)){e.m_dispOffsetY=0}t.m_Parser.addFormula(n,r.rule==undefined?"":r.rule);e.m_textcolor=r.textcolor;if(e.m_textcolor==undefined){e.m_textcolor="rgba(0,0,0,0.7)"}e.m_textfont=r.textfont;e.m_textfontscale=r.textfontscale;e.m_textfontsize=r.textfontsize;if(isNaN(e.m_textfontscale)){e.m_textfontscale=2}e.m_textoffset=parseInt(r.textoffset,10);e.m_textoffsetY=parseInt(r.textoffsetY,10);if(isNaN(e.m_textoffset)){e.m_textoffset=0}if(isNaN(e.m_textoffsetY)){e.m_textoffsetY=0}e.m_spotcol=r.spotcol;e.m_spotsize=parseInt(r.spotsize,10);e.m_bordersize=r.areabordersize?parseInt(r.areabordersize,10):2;e.m_bordercol=r.areabordercol;if(e.m_type=="grid"){e.m_nType=1;e.m_distanceX=r.distanceX==undefined||r.distanceX<=0?256:r.distanceX;e.m_dividerX=Math.max(1,Math.round(256/e.m_distanceX));e.m_distanceY=r.distanceY==undefined||r.distanceY<=0?256:r.distanceY;e.m_dividerY=Math.max(1,Math.round(256/e.m_distanceY));e.m_groupID=(r.groupID==undefined?"&":r.groupID)+e.m_dividerX+"_"+e.m_dividerY;e.m_omitEmpties=r.showEmpties!="true";e.m_fillcol=r.areafillcol;e.m_permanentArea=r.areapermanent=="true"}if(e.m_type=="distance"){e.m_nType=3;e.m_distance=r.distance;if(e.m_distance==undefined||e.m_distance<=0){e.m_distance=128}}if(e.m_type=="tree"){e.m_nType=4;e.m_distance=r.distance;if(e.m_distance==undefined||e.m_distance<=0){e.m_distance=16}e.m_bordercol2=r.areabordercol2;e.m_bordercol3=r.areabordercol3;e.m_fillcol=r.areafillcol;e.m_fillcol2=r.areafillcol2;e.m_fillcol3=r.areafillcol3;e.m_animated=r.animation=="true"?"2":r.animation;e.m_permanentArea=r.areapermanent=="true"}e.m_limit=parseInt(r.limit,10);e.m_limitOnSum=r.limitOnSum==undefined?999999:parseInt(r.limitOnSum,10);e.initializeFunctions()};e.initializeFunctions=function(){switch(e.m_type){case"grid":e.InitializeClusterData=e.InitializeGridClusterData;e.ClusterPass1=e.gridClusteringCounting;e.ClusterPass2=e.NothingToDo;e.DecisionPass=e.gridBasedDecision;e.CheckClusterData=e.CheckSingleClusterData;break;case"clustergroup":e.InitializeClusterData=e.InitializeGridClusterData;e.ClusterPass1=e.NothingToDo;e.ClusterPass2=e.gridClustergroupCounting;e.DecisionPass=e.gridBasedDecision;e.CheckClusterData=e.CheckGroupClusterData;break;case"distance":e.InitializeClusterData=e.InitializeDistClusterData;e.ClusterPass1=e.NothingToDo;e.ClusterPass2=e.NothingToDo;e.DecisionPass=e.distanceBasedDecision;e.CheckClusterData=e.NothingToDo;break;case"tree":e.InitializeClusterData=e.InitializeTreeClusterData;e.ClusterPass1=e.NothingToDo;e.ClusterPass2=e.NothingToDo;e.DecisionPass=e.treeBasedDecision;e.CheckClusterData=e.NothingToDo;break;default:break}};e.gridClusteringCounting=function(r,a,n,i){var s=n[r];var l=a.clust[r];var o=s.nX;var u=s.nY;var f=e.m_dividerX*n.numTiles/n.completeX;var m=e.m_dividerY*n.numTiles/n.completeX;var d=n.completeX/256;var c,_,g;var v,h;var C=t.th*s.m_BaseX;var p=t.th*s.m_BaseY;var b=l.m_lodOffset;for(var I=0;I<a.base.length;++I){v=a.base[I];for(var D=0;D<v.length;++D){h=v[D];if(h.cI==r){if(h.b2Ignore){v.m_nNumIgnore--;h.b2Ignore=false}c=Math.floor((b*h[0]-C)*f);if(c<0){c+=d}_=Math.floor((b*h[1]-p)*m);if(c>=0&&c<o&&_>=0&&_<u){g=c+o*_;h.sq=g;s[g].numInst++;s[g].bw.push(h)}}}}};e.gridClustergroupCounting=function(e,t,r,a){var n=a[e];var i=n.length;var s=r[e];for(var l=0;l<s.length;++l){var o=0;var u=s[l];u.bLimitExceeded=false;for(var f=0;f<i;++f){var m=n[f].index;var d=r[m];var c=d[l].numInst;o+=c;if(c>=n[f].limit){u.bLimitExceeded=true}}u.numInst=o}};e.distanceBasedDecision=function(r,a,n,i,s,l,o){if(o.lodDiff||o.bDataChanged||o.bClusteringChanged){var u=t.m_Clusters[a];var f=e.doDistClustering(a,n,u.m_distance,i.completeX);e.distFillClusterData(r,f,n,s[a],a)}};e.treeBasedDecision=function(r,a,n,i,s,l,o){if(o.bDataChanged||o.bClusteringChanged){var u=t.m_Clusters[a];var f=e.doTreeClustering(a,n,s[a],u.m_distance,i.completeX);e.treeFillClusterData(r,f,n,s[a],a,r.GetMinLOD())}};e.gridBasedDecision=function(r,a,n,i,s,l,o){n.config.bNeedsShadowLayer=e.fillClusterConfig(n.clust[a],n.config,0,false)||n.config.bNeedsShadowLayer;var u=t.m_Clusters[a];if(!u.m_bPartOfGrp){var f=i[a];var m=l[a];if(m.length){for(var d=m.length;d--;){var c=m[d].index;n.base[s[c].m_index].clusterings.push({i:c,t:0})}}else{n.base[s[a].m_index].clusterings.push({i:a,t:0})}for(var _=0;_<f.nX;++_){for(var g=0;g<f.nY;++g){var v=_+f.nX*g;u.CheckClusterData(n,i,f[v],a,v,_,g,s,m)}}}};e.NothingToDo=function(){};e.ReturnFalse=function(){return false};e.CheckSingleClusterData=function(r,a,n,i,s,l,o,u,f){if(n.numInst>=e.m_limit){var m=a[i];t.m_Clusters[i].FillClusterData(r,m[s],l,o,m,u[i],i,1);return}n.b2Cluster=false;return};e.CheckGroupClusterData=function(r,a,n,i,s,l,o,u,f){var m,d,c=1;if(n.bLimitExceeded||n.numInst>=e.m_limit){for(m=0;m<f.length;++m){var _=f[m].index;d=a[_];c=t.m_Clusters[_].FillClusterData(r,d[s],l,o,d,u[_],_,c)}}else{n.b2Cluster=false;for(m=0;m<f.length;++m){d=a[f[m].index];d[s].b2Cluster=false}}return};e.InitializeGridClusterData=function(t,r,a,n,i,s){var l=[];l.cI=r;l.nX=i;l.nY=s;l.XPerTile=t.m_nWidthCanvas/(t.m_nTilesX*e.m_dividerX);l.YPerTile=t.m_nHeightCanvas/(t.m_nTilesY*e.m_dividerY);var o=0;for(var u=0;u<i;++u){for(var f=0;f<s;++f){var m={};m.numInst=0;m.bw=[];m.sq=o++;l.push(m)}}l.m_BaseX=a;l.m_BaseY=n;return l};e.InitializeDistClusterData=function(t,r,a,n,i,s){var l={};l.numInst=0;l.type=e.m_type;l.cI=r;return l};e.InitializeTreeClusterData=function(t,r,a,n,i,s){var l={};l.numInst=0;l.type=e.m_type;return l};e.FillSquareEdges=function(e,t,r,a,n,i,s){var l=[];l.push([[a,n],[i,n]]);l.push([[i,n],[i,s]]);l.push([[i,s],[a,s]]);l.push([[a,s],[a,n]]);e.e=l;if(t){var o=[];var u=(i-a)/256*Math.abs(r)/2;var f=(s-n)/256*Math.abs(r)/2;o.push([[a+u,n+f],[i-u,n+f]]);o.push([[i-u,n+f],[i-u,s-f]]);o.push([[i-u,s-f],[a+u,s-f]]);o.push([[a+u,s-f],[a+u,n+f]]);e.ei=o}};e.FillClusterData=function(r,a,n,i,s,l,o,u){var f=r.clust[o];var m=s.XPerTile;var d=s.YPerTile;var c=t.th*s.m_BaseX;var _=t.th*s.m_BaseY;if(e.m_omitEmpties&&!a.numInst){a.b2Cluster=false;return u}a.b2Cluster=true;var g=i*d;var v=g+d;var h=n*m;var C=h+m;var p=m/2;var b=d/2;var I=[(c+h+p+e.m_dispOffsetX)/f.m_lodOffset,(_+g+b+e.m_dispOffsetY)/f.m_lodOffset,0,0];e.FillSquareEdges(I,f.config.b2Times,f.config.bSize,(c+h)/f.m_lodOffset,(_+g)/f.m_lodOffset,(c+C)/f.m_lodOffset,(_+v)/f.m_lodOffset);I.sq=a.sq;I.cI=s.cI;I.h=I.s=false;I.im=l.m_image;I.sc=l.m_scale;I.hscale=l.m_hotscale;I.hcol=l.m_hotcol;I.al=l.m_alignment;I.cnt=a.numInst;if(e.m_textfont!=undefined){I.f=e.m_textfont;I.fc=e.m_textcolor;I.fs=e.m_textfontscale;I.fz=e.m_textfontsize;I.fo=e.m_textoffset;I.foy=e.m_textoffsetY}I.isCl=1;I.nJ=f.length;I.grI=u;I.bw=a.bw;f.push(I);return u+1};e.doDistClustering=function(e,t,r,a){var n,i,s,l,o;var u=[];var f={};var m=t.clust[e].m_lodOffset;var d=r/m;for(n=0;n<t.base.length;++n){f=t.base[n];for(i=0;i<f.length;++i){if(f[i].cI==e){u.push(f[i]);if(f[i].b2Ignore){f.m_nNumIgnore--;f[i].b2Ignore=false}f[i].isGrouped=false}}}if(!u.length){return[]}u.sort(function(e,t){return e[0]-t[0]});var c=u.length-1;var _=0;var g=u[0],v=u[c];var h=g[0]-v[0]+a;if(h<=d){for(n=0;n<c;++n){s=u[n];l=u[n+1];o=l[0]-s[0];if(o>d){_=n+1;break}}}var C=[];var p,b,I,D,x,G;var S=u.length+_;var M=u.length;for(n=_;n<S;++n){x=n%M;s=u[x];if(s.isGrouped){continue}I=s[0];if(n>M-1){I+=a}for(i=n+1;i<S;++i){G=i%M;l=u[G];if(l.isGrouped){continue}D=l[0];if(i>M-1){D+=a}if(D-I<=d){if(s.isGrouped&&C.length>0){p=C[s.nGrp].minY;b=C[s.nGrp].maxY}else{p=s[1];b=s[1]}if(Math.abs(l[1]-p)<=d&&Math.abs(l[1]-b)<=d){if(s.isGrouped){C[s.nGrp].push(l);l.isGrouped=true;l.nGrp=s.nGrp;l.b2Ignore=true;t.base[l.vI].m_nNumIgnore++;if(l[1]<C[s.nGrp].minY){C[s.nGrp].minY=l[1]}if(l[1]>C[s.nGrp].maxY){C[s.nGrp].maxY=l[1]}if(D<C[s.nGrp].minX){C[s.nGrp].minX=D}if(D>C[s.nGrp].maxX){C[s.nGrp].maxX=D}if(C[s.nGrp].sumX==undefined){C[s.nGrp].sumX=D}else{C[s.nGrp].sumX+=D}if(C[s.nGrp].sumY==undefined){C[s.nGrp].sumY=l[1]}else{C[s.nGrp].sumY+=l[1]}}else{var V=[];V.push(s);V.push(l);C.push(V);var N=C.length-1;s.isGrouped=true;s.nGrp=N;s.b2Ignore=true;t.base[s.vI].m_nNumIgnore++;l.isGrouped=true;l.nGrp=N;l.b2Ignore=true;t.base[l.vI].m_nNumIgnore++;if(s[1]<l[1]){C[N].minY=s[1];C[N].maxY=l[1]}else{C[N].minY=l[1];C[N].maxY=s[1]}if(I<D){C[N].minX=I;C[N].maxX=D}else{C[N].minX=D;C[N].maxX=I}if(C[N].sumX==undefined){C[N].sumX=I+D}else{C[N].sumX+=I+D}if(C[N].sumY==undefined){C[N].sumY=s[1]+l[1]}else{C[N].sumY+=s[1]+l[1]}}}}else{break}}}return C};e.distFillClusterData=function(t,r,a,n,i){for(var s=0;s<r.length;++s){var l=r[s];var o=l.length;var u=l.sumX/o;var f=l.sumY/o;var m=[u,f,0,0];m.bo=[l.minX,l.minY,l.maxX,l.maxY];m.h=false;m.hscale=n.m_hotscale;m.hcol=n.m_hotcol;m.al=n.m_alignment;m.s=false;m.im=n.m_image;m.sc=n.m_scale;m.cnt=o;if(e.m_textfont!=undefined){m.f=e.m_textfont;m.fc=e.m_textcolor;m.fs=e.m_textfontscale;m.fz=e.m_textfontsize;m.fo=e.m_textoffset;m.foy=e.m_textoffsetY}m.bw=l;m.isCl=3;m.nJ=a.clust[i].length;a.clust[i].push(m);m.grI=1;m.cI=i}a.config.bNeedsShadowLayer=e.fillDistConfig(a.clust[i],a.config,a)||a.config.bNeedsShadowLayer;a.base[n.m_index].clusterings.push({i:i,t:1});return true};e.AddEdgeChain=function(e){var t=[];var r=e[0],a,n;var i=e.length;for(var s=1;s<i;++s){a=e[s];n=Math.max(Math.abs(r[0]-a[0]),Math.abs(r[1]-a[1]));t.push({s:r[2],d:a[2],l:n,c:undefined});r=a}return t};e.doTreeClustering=function(a,n,i,s,l){var o=[];var u={};var f,m;for(f=0;f<n.base.length;++f){u=n.base[f];for(m=0;m<u.length;++m){if(u[m].cI==a){var d=u[m];while(d[0]<0){d[0]+=l}while(d[0]>l){d[0]-=l}d.lod=30;d.cnt=1;d.e=[];o.push(d);d.b2Ignore=true;u.m_nNumIgnore++;d.vo=f}}}var c,_,g;o.sort(function(e,t){return e[0]!=t[0]?e[0]-t[0]:e[1]-t[1]});if(n.m_SelectedVOs.length){for(var v=0;v<o.length;++v){if(o[v].s){for(var h=0;h<n.m_SelectedVOs.length;h++){if(o[v].nI==n.m_SelectedVOs[h].m_dataIndex){n.m_SelectedVOs[h].m_index=v;n.m_SelectedVOs[h].cI=a}}}}}var C=o.length-1;if(C<0){return[]}var p=0;var b=[];var I=o[0],D=o[C];var x=I[0]-D[0]+l;var G=s*l/t.tw;if(x<G){for(f=0;f<C;++f){c=o[f];g=o[f+1];_=g[0]-c[0];if(_>x){p=f+1;x=_;if(x>G){break}}}}VBI.Trace("iGap is "+p);var S=o.length;var M=p+S;var V=-1,N;var T=[];var y,P;for(f=p;f<M;++f){if(f>=S){m=f-S;o[m][0]+=l}else{m=f}c=o[m];c.bo=[c[0],c[1],c[0],c[1]];y=c[0];P=c[1];if(V!=-1&&y===N[0]&&P===N[1]){T.push({s:V,d:m,l:0,z:1,zero:true})}else{b.push([y,P,m]);V=m;N=c}}var O=r.triangulate(b);var w=O[0];var Y=O[1];if(w.length==0){w=e.AddEdgeChain(b)}w.sort(function(e,t){var r=e.l-t.l;if(r){return r}r=e.s-t.s;if(r){return r}r=e.d-t.d;return r?r:t.v-e.v});var X=T.concat(w);var z=1<<n.config.m_BaseLod;for(m=0;m<o.length;m++){o[m].nJ=m}e.clcnt=o.length;n.config.m_0ref=e.buildTree(o,a,X,i,s,l);n.config.m_ref=n.config.m_0ref/z;e.determineClusterPositions(o.m_TreeFatherNode);e.assembleAreaInfo(o,X,Y);o.m_edges=X;return o};e.determineClusterPositions=function(t){if(t.isCl){var r=0,a=0,n=t.bw,i;for(var s=n.length;s--;){i=e.determineClusterPositions(n[s]);r+=i[0]*i[2];a+=i[1]*i[2]}t[0]=r/t.cnt;t[1]=a/t.cnt}return[t[0],t[1],t.cnt]};e.AddVirtuals=function(e,t,r){var a=r[t];if(a.executed==undefined){var n=a.v0,i;if(n){for(var s=0;s<a.length;++s){i=a[s];e.e.push([[n.c[0],n.c[1]],[i.c[0],i.c[1]]])}}else{n=a[0];i=a[1];e.e.push([[n.c[0],n.c[1]],[i.c[0],i.c[1]]])}}};e.AddEdge=function(t,r,a,n,i,s,l){if(!i||!s){t.e.push(l)}if(r.v){if(i){e.AddVirtuals(t,r.s,n)}if(s){e.AddVirtuals(t,r.d,n)}}return t.c};e.MarkVirtuals=function(e,t,r){r[e].executed=true;r[t].executed=true};e.assembleAreaInfo=function(t,r,a){var n,i,s,l;var o=r.length-1;for(var u=0;u<=o;++u){var f=false;n=r[u];i=u<o?r[u+1]:undefined;if(n.l&&n.s>=0&&n.d>=0){s=t[n.s];l=t[n.d];if(u<o&&n.s===i.s&&n.d===i.d){while(s!=undefined&&f==false){if(s.lod<l.lod){l=e.AddEdge(l,n,i,a,false,true,u)}else if(s.lod>l.lod){s=e.AddEdge(s,n,i,a,true,false,u)}else if(s.nJ===l.nJ){if(n.v){s=e.AddEdge(s,n,i,a,true,true,u);l=l.c}else{f=true}}else{s=e.AddEdge(s,n,i,a,true,false,u);l=e.AddEdge(l,n,i,a,false,true,u)}}u++}}if(n.v){a[n.s].executed=true;a[n.d].executed=true}}};e.recCheck=function(t,r,a,n,i,s,l,o,u,f,m,d,c){var _=[];var g=[0,0];var v=i[s];var h,C,p,b;var I=e.analyzePath(_,r,a,v,o,m,d);if(I.nLod==o){return g}var D=r[I.i];if(I.nLod==I.oLod){if(e.NodeMerge(I.nLod,i,s,r,I.i)&&s){g=e.recCheck(t,r,I.i-1,I.i-1,i,s-1,s-1,I.nLod,u,f,m,d,c+1)}}else if(v.lod>I.nLod){e.Merge2NewNode(t,I.nLod,r[I.i],v,r,I.i+1,u);g[1]=1}else{g=e.recCheck(t,i,s,l,r,I.i,n,v.lod-1,u,f,m,d,c+1);if(_.length>1){var x=I.i+1+g[0];var G=r[x];var S=a+g[0];e.NodeMerge(G.lod,i,s+g[1],r,x);for(p=x;p<=n+g[0];p++){b=r[p];if(p<S){b.bo=_[a+g[0]-p]}else{h=b.bo;C=v.bo;b.bo=[Math.min(h[0],C[0]),Math.min(h[1],C[1]),Math.max(h[2],C[2]),Math.max(h[3],C[3])]}b.cnt+=v.cnt-D.cnt}}return[g[1],g[0]]}for(p=I.i;p<=n;p++){b=r[p+g[1]];b.cnt+=v.cnt;if(p<=a){b.bo=_[a-p]}else{h=b.bo;C=v.bo;b.bo=[Math.min(h[0],C[0]),Math.min(h[1],C[1]),Math.max(h[2],C[2]),Math.max(h[3],C[3])]}}return g};e.buildTree=function(r,a,n,i,s,l){var o=1/Math.log(2);e.dLog2=o;var u=o*Math.log(l/t.tw)+4;var f,m,d,c;var _,g,v,h,C;for(v=0;v<n.length;++v){var p=n[v];if(f&&p.s==f.s&&p.d==f.d){continue}f=p;d=p.l;var b=Math.floor(Math.min(24,o*Math.log(s/d)+u));var I=[r[p.s]];for(c=0;I[c].c!=undefined;++c){I[c+1]=I[c].c}_=I[c];var D=[r[p.d]];for(c=0;D[c].c!=undefined;++c){D[c+1]=D[c].c}g=D[c];m=false;if(I.length==1&&D.length>1){m=true}else if(D.length>1){if(g.lod<_.lod||g.lod==_.lod&&g.cnt>_.cnt){m=true}}h=I.length-1;C=D.length-1;var x=-1e3;if(_.nJ==g.nJ){do{x=_.lod;_=I[--h];g=D[--C]}while(_.nJ==g.nJ)}if(m){e.recCheck(r,D,C,C,I,h,h,x,i,b,u,s,0)}else{e.recCheck(r,I,h,h,D,C,C,x,i,b,u,s,0)}}if(r.length){var G=r[0];while(G.c!=undefined){G=G.c}G.cI=a;r.m_TreeFatherNode=G}return s/(2*Math.exp(-u/o))};e.Merge2NewNode=function(t,r,a,n,i,s,l){var o=a.c;var u=n.c;var f={lod:r,nJ:e.clcnt++,isCl:4,cnt:a.cnt,e:[],h:false,hscale:l.m_hotscale,hcol:l.m_hotcol,s:false,im:l.m_image,sc:l.m_scale,f:e.m_textfont,fc:e.m_textcolor,fs:e.m_textfontscale,fz:e.m_textfontsize,fo:e.m_textoffset,foy:e.m_textoffsetY,al:l.m_alignment,grI:1};f.bw=[a,n];a.c=f;n.c=f;i.splice(s,0,f);if(o!=undefined){f.c=o;e.ReplaceBWE(o.bw,a.nJ,f)}if(u!=undefined){e.RemoveBWE(u.bw,n.nJ)}t.push(f);return f};e.NodeMerge=function(t,r,a,n,i){var s=false;var l=n[i];var o=r[a];var u=o.c;if(t<o.lod){l.bw.push(o);o.c=l}else{var f;for(var m=o.bw.length;m--;){f=o.bw[m];f.c=l;l.bw.push(f);o.bw[m]=undefined}o.bInvalid=true;s=true}if(u!=undefined){e.RemoveBWE(u.bw,o.nJ)}return s};e.ReplaceBWE=function(e,t,r){for(var a=e.length;a--;){if(e[a].nJ==t){if(r==-1){e.splice(a,1)}else{e[a]=r}}}};e.RemoveBWE=function(e,t){for(var r=e.length;r--;){if(e[r].nJ==t){e.splice(r,1)}}};e.analyzePath=function(t,r,a,n,i,s,l){var o=r[a];var u=o.bo,f=n.bo;var m=[Math.min(u[0],f[0]),Math.min(u[1],f[1]),Math.max(u[2],f[2]),Math.max(u[3],f[3])];var d=Math.max(m[2]-m[0],m[3]-m[1]);var c=Math.floor(Math.min(24,e.dLog2*Math.log(l/d)+s));if(c<=i){return{i:a+1,nLod:i,oLod:i}}t.push(m);if(a==0||c<o.lod){return{i:a,nLod:c,oLod:o.lod}}return e.analyzePath(t,r,a-1,n,c,s,l)};e.fillClusterConfig=function(t,r,a,n){var i={};i.bCol=e.m_bordercol;i.bSize=Math.abs(e.m_bordersize);if(e.m_bordersize<0){i.b2Times=true}i.fCol=e.m_fillcol;i.permArea=e.m_permanentArea;if(e.m_bordercol2){i.bCol2=e.m_bordercol2}if(e.m_bordercol3){i.bCol3=e.m_bordercol3}if(e.m_fillcol2){i.fCol2=e.m_fillcol2}if(e.m_fillcol3){i.fCol3=e.m_fillcol3}i.sCol=e.m_spotcol;i.sSize=e.m_spotsize;i.anim=!n?undefined:e.m_animated;i.animLow=Math.ceil(a);i.baseConf=r;t.config=i;return i.bCol!=undefined||i.sCol&&i.sSize};e.fillDistConfig=function(t,r,a){var n={};n.baseConf=r;t.config=n;if(e.m_spotsize!=undefined&&e.m_spotsize!=0&&e.m_spotcol!=undefined){n.sCol=e.m_spotcol;n.sSize=e.m_spotsize;n.base=a.base;return true}return false};e.treeFillClusterData=function(t,r,a,n,i,s){a.clust[i]=r;a.clust[i].hotItem=a.hotItem;a.clust[i].cI=i;a.clust[i].m_lodOffset=1;a.clust[i].m_nRecalcs=0;a.base[n.m_index].clusterings.push({i:i,t:2});a.config.bNeedsShadowLayer=e.fillClusterConfig(a.clust[i],a.config,s,true)||a.config.bNeedsShadowLayer;return true};return e};r={supertriangle:function(e){var t=Number.POSITIVE_INFINITY,r=Number.POSITIVE_INFINITY,a=Number.NEGATIVE_INFINITY,n=Number.NEGATIVE_INFINITY,i,s,l,o,u,f;for(i=e.length;i--;){if(e[i][0]<t){t=e[i][0]}if(e[i][0]>a){a=e[i][0]}if(e[i][1]<r){r=e[i][1]}if(e[i][1]>n){n=e[i][1]}}s=a-t;l=n-r;o=Math.max(s,l);u=t+s*.5;f=r+l*.5;return[[u-40*o,f-o,-1],[u,f+40*o,-2],[u+40*o,f-o,-3]]},circumcircle:function(e,t,r,n){var i=e[t][0],s=e[t][1],l=e[r][0],o=e[r][1],u=e[n][0],f=e[n][1],m=Math.abs(s-o),d=Math.abs(o-f),c,_,g,v,h,C,p,b,I,D;if(m<a){v=-((u-l)/(f-o));C=(l+u)/2;b=(o+f)/2;c=(l+i)/2;_=v*(c-C)+b}else if(d<a){g=-((l-i)/(o-s));h=(i+l)/2;p=(s+o)/2;c=(u+l)/2;_=g*(c-h)+p}else{g=-((l-i)/(o-s));v=-((u-l)/(f-o));h=(i+l)/2;C=(l+u)/2;p=(s+o)/2;b=(o+f)/2;c=(g*h-v*C+b-p)/(g-v);_=m>d?g*(c-h)+p:v*(c-C)+b}I=l-c;D=o-_;return{i:t,j:r,k:n,x:c,y:_,r:I*I+D*D}},dedup:function(e){var t,r,a,n,i,s;for(r=e.length;r;){n=e[--r];a=e[--r];for(t=r;t;){s=e[--t];i=e[--t];if(a===i&&n===s||a===s&&n===i){e.splice(r,2);e.splice(t,2);break}}}},assemble:function(e,t,r,a,n){e.length=0;var i;for(i=t.length;i--;){var s=(t[i].i>=n)+(t[i].j>=n)+(t[i].k>=n);var l=[t[i].i,t[i].j,t[i].k];l.sort();var o=a[l[0]],u=a[l[1]],f=a[l[2]];var m=Math.max(Math.abs(o[0]-u[0]),Math.abs(o[1]-u[1]));var d=Math.max(Math.abs(o[0]-f[0]),Math.abs(o[1]-f[1]));var c=Math.max(Math.abs(f[0]-u[0]),Math.abs(f[1]-u[1]));var _=[t[i].x,t[i].y];var g=a[l[0]][2],v=a[l[1]][2],h=a[l[2]][2];if(g>=0&&v>=0){e.push({s:g,d:v,l:m,c:_,v:s})}if(g>=0&&h>=0){e.push({s:g,d:h,l:d,c:_,v:s})}if(v>=0&&h>=0){e.push({s:v,d:h,l:c,c:_,v:s})}if(s){if(g>=0){this.addToVirtual(r,g,v,h,_,s)}if(v>=0){this.addToVirtual(r,v,g,h,_,s)}if(h>=0){this.addToVirtual(r,h,g,v,_,s)}}}return e},triangulate:function(e,t){var r=e.length,n,i,s,l,o,u,f,m,d,c,_,g,v;if(r<1){return[]}e=e.slice(0);if(t){for(n=r;n--;){e[n]=e[n][t]}}s=new Array(r);for(n=r;n--;){s[n]=n}s.sort(function(t,r){return e[r][0]-e[t][0]});l=this.supertriangle(e);e.push(l[0],l[1],l[2]);o=[this.circumcircle(e,r+0,r+1,r+2)];u=[];f=[];m=[];for(n=s.length;n--;f.length=0){v=s[n];for(i=o.length;i--;){d=e[v][0]-o[i].x;if(d>0&&d*d>o[i].r){u.push(o[i]);o.splice(i,1);continue}c=e[v][1]-o[i].y;if(d*d+c*c-o[i].r>a){continue}f.push(o[i].i,o[i].j,o[i].j,o[i].k,o[i].k,o[i].i);o.splice(i,1)}this.dedup(f);for(i=f.length;i;){g=f[--i];_=f[--i];o.push(this.circumcircle(e,_,g,v))}}for(n=o.length;n--;){u.push(o[n])}o=this.assemble(o,u,m,e,r);return[o,m]},addToVirtual:function(e,t,r,a,n,i){var s={n1:r,n2:a,c:n,v:i};if(e[t]==undefined){e[t]=[]}if(r<0&&a<0){e[t].v0=s}else{e[t].push(s)}},contains:function(e,t){if(t[0]<e[0][0]&&t[0]<e[1][0]&&t[0]<e[2][0]||t[0]>e[0][0]&&t[0]>e[1][0]&&t[0]>e[2][0]||t[1]<e[0][1]&&t[1]<e[1][1]&&t[1]<e[2][1]||t[1]>e[0][1]&&t[1]>e[1][1]&&t[1]>e[2][1]){return null}var r=e[1][0]-e[0][0],a=e[2][0]-e[0][0],n=e[1][1]-e[0][1],i=e[2][1]-e[0][1],s=r*i-a*n;if(s===0){return null}var l=(i*(t[0]-e[0][0])-a*(t[1]-e[0][1]))/s,o=(r*(t[1]-e[0][1])-n*(t[0]-e[0][0]))/s;if(l<0||o<0||l+o>1){return null}return[l,o]}};return t}});
/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5) (c) Copyright 2009-2012 SAP AG. All rights reserved
 */
sap.ui.predefine("sap/ui/vbm/lib/sapvbi", function(){"use strict";(function(){var e=typeof VBI=="object"||window.VBI;if(e){return}window.VBI={m_bIsMyChromeTest:/chrome/gi.test(navigator.appVersion),m_bIsIDevice:sap.ui.Device.os.ios,m_bIsAndroid:sap.ui.Device.os.android,m_bIsMobile:sap.ui.Device.system.phone||sap.ui.Device.system.tablet&&!sap.ui.Device.system.combi,m_bIsPhone:jQuery.device.is.phone,m_bIsRtl:document.dir=="rtl"?true:false,m_ctrlKey:false,m_shiftKey:false,m_dwRefKeyboardHook:0,GetGeoLocationService:function(){if(this.GeoLocationService){return this.GeoLocationService}this.GeoLocationService=new VBI.GeoLocation;return this.GeoLocationService},Events:function(){var e={};var n=e.hasOwnProperty;return{subscribe:function(o,t){if(!n.call(e,o)){e[o]=new Set}e[o].add(t);return{unsubscribe:function(){e[o].delete(t)}}},fire:function(o,t){if(!n.call(e,o)){return}e[o].forEach(function(e){e(t||{})})}}},m_DndTarget:null,m_Log:"",m_bTrace:function(){var e=document.getElementById("VBITrace");return e!=null?true:false}(),Trace:function(e){if(typeof console!="undefined"){jQuery.sap.log.info(e+"\r\n")}var n=document.getElementById("VBITrace");if(n==null){return}VBI.m_Log=VBI.m_Log+jQuery.sap.encodeHTML(e)+"<br>";n.innerHTML=VBI.m_Log},RegisterKeyboardHook:function(){++window.VBI.m_dwRefKeyboardHook;if(window.VBI.m_dwRefKeyboardHook>1){return}window.VBI.onkeydown=function(e){if(e.keyCode==16){VBI.m_shiftKey=true}else if(e.keyCode==17){VBI.m_ctrlKey=true}};window.VBI.onkeyup=function(e){if(e.keyCode==16){VBI.m_shiftKey=false}else if(e.keyCode==17){VBI.m_ctrlKey=false}};document.addEventListener("keydown",window.VBI.onkeydown);document.addEventListener("keyup",window.VBI.onkeyup)},UnRegisterKeyboardHook:function(){--window.VBI.m_dwRefKeyboardHook;if(window.VBI.m_dwRefKeyboardHook>0){return}document.removeEventListener("keydown",window.VBI.onkeydown);document.removeEventListener("keyup",window.VBI.onkeyup);window.VBI.onkeydown=null;window.VBI.onkeyup=null}}})();(function(){if(!window.DataTransfer){return}if(typeof window.DataTransfer.prototype.setDragImage!=="function"){VBI.Utilities.SetDragImage=function(e,n,o){var t,i,r,a,d;t="setdragimage-ie-dragging-"+Math.round(Math.random()*Math.pow(10,5))+"-"+Date.now();i=["."+t,"{",'background: url("'+e.src+'") no-repeat #fff 0 0 !important;',"width: "+e.width+"px !important;","height: "+e.height+"px !important;","text-indent: -9999px !important;","border: 0 !important;","outline: 0 !important;","}","."+t+" * {","display: none !important;","}"];r=document.createElement("style");r.innerText=i.join("");a=document.getElementsByTagName("head")[0];a.appendChild(r);d=VBI.m_DndTarget;d.classList.add(t);setTimeout(function(){a.removeChild(r);d.classList.remove(t)},0)}}})()});
/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5) (c) Copyright 2009-2012 SAP AG. All rights reserved
 */
sap.ui.predefine("sap/ui/vbm/lib/sapvbicontext", ["./sapvbi"],function(){"use strict";VBI.VBIContext=function(e){var n={};n.vbiclass="VBIContext";n.m_bLoaded=false;n.m_Resources=null;n.m_Config=null;n.m_DataTypeProvider=null;n.m_DataProvider=null;n.m_SceneManager=null;n.m_MapProviders=null;n.m_MapLayerStackManager=null;n.m_Windows=null;n.m_Actions=null;n.m_Automations=null;n.m_Menus=null;n.m_Control=e;n.m_deltacolTable=[];var i=new Date;n.m_StartupTime=i.getTime();n.clear=function(){if(n.m_Resources){n.m_Resources.clear()}if(n.m_Config){n.m_Config.clear()}if(n.m_DataTypeProvider){n.m_DataTypeProvider.clear()}if(n.m_DataProvider){n.m_DataProvider.clear()}if(n.m_SceneManager){n.m_SceneManager.clear()}if(n.m_MapProviders){n.m_MapProviders.clear()}if(n.m_MapLayerStackManager){n.m_MapLayerStackManager.clear()}if(n.m_Windows){n.m_Windows.clear()}if(n.m_Actions){n.m_Actions.clear()}if(n.m_Automations){n.m_Automations.clear()}if(n.m_Menus){n.m_Menus.clear()}n.m_Control=null;n.m_Resources=null;n.m_Config=null;n.m_DataTypeProvider=null;n.m_DataProvider=null;n.m_SceneManager=null;n.m_MapProviders=null;n.m_MapLayerStackManager=null;n.m_Windows=null;n.m_Actions=null;n.m_Automations=null;n.m_Menus=null};n.GetResources=function(){if(!n.m_Resources){n.m_Resources=new VBI.Resources}return n.m_Resources};n.GetConfig=function(){if(!n.m_Config){n.m_Config=new VBI.Configurations}return n.m_Config};n.GetMainScene=function(){if(n.m_Windows){var e=n.m_Windows.GetMainWindow();if(e){var i=e.GetScene();if(i){return i}}}return null};n.FireAction=function(e,i,t,r,a,o,l,m){var s=null;if(jQuery.type(t)=="object"){s=t.m_ID}else if(jQuery.type(t)=="string"){s=t}var u={};var c=u["SAPVB"]={};c["version"]="2.0";c["xmlns:VB"]="VB";var d=c["Action"]={};d.name=e.m_name;d.object=s;d.id=e.m_id;if(o!=undefined){d.instance=o}else if(r){d.instance=r.GetPath()}var h=0;var _=0;var f=false;if(a){d.Params={};d.Params.Param=[];for(var g in a){var v={};v["name"]=g;v["#"]=a[g];d.Params.Param.push(v);if(g=="x"){h=a[g];f=true}if(g=="y"){_=a[g];f=true}}}if(t=="Thumbnail"){h*=i.GetInternalDivWidth()/i.m_Div.clientWidth;_*=i.GetInternalDivHeight()/i.m_Div.clientHeight}if(n.m_DataProvider){n.m_DataProvider.store(c)}var b;if(e.m_additionalProperties&&(b=e.m_additionalProperties.length)){var p=d.AddActionProperties={};var C=p.AddActionProperty=[];for(var W=0;W<b;++W){var P,M;switch(e.m_additionalProperties[W]){case"zoom":C.push({name:"zoom","#":i.GetCurrentZoomlevel().toString()});break;case"pieitem":if(t instanceof VBI.VisualObjects.Pie&&m){C.push({name:"pieitem","#":m.m_Detail.m_slice})}break;case"centerpoint":P=VBI.MathLib.RadToDeg(i.GetCenterPos());C.push({name:"centerpoint","#":P[0].toString()+";"+P[1].toString()+";0.0"});break;case"vos":C.push({name:"vos","#":r.cnt});break;case"subclusters":M=r.isCl==4&&r.bw!=undefined?r.bw.length:-1;C.push({name:"subclusters","#":M});break;case"clustersnextlod":if(r.isCl==4&&r.bw!=undefined){M=i.GetCurrentZoomlevel()==r.lod?r.bw.length:1}else{M=-1}C.push({name:"clustersnextlod","#":M});break;case"clusterarea":var T="";if(r.isCl==4&&r.bo!=undefined){T=this.m_Clustering.getClusterArea(i,r)}C.push({name:"clusterarea","#":T});break;case"pos":if(f){P=i.GetPosFromVPPoint([h,_,0]);C.push({name:"pos","#":P[0].toString()+";"+P[1].toString()+";0.0"})}break;case"pitch":C.push({name:"pitch","#":"0.0"});break;case"yaw":C.push({name:"yaw","#":"0.0"});break;default:break}}}var H=JSON.stringify(c,null,"  ");if(n.m_Control){if(l){return n.m_Control.fireEvent("submit",{data:H},true)}n.m_Control.fireSubmit({data:H})}};n.onRenderLayer=function(e){n.m_Control.fireRender({canvas:e})};n.onMoveLayer=function(e){n.m_Control.fireMove({canvas:e})};n.onZoomLayer=function(e){n.m_Control.fireZoom({canvas:e})};n.onOpenWindow=function(e,i){n.m_Control.fireOpenWindow({id:e,contentarea:i})};n.onCloseWindow=function(e,i){n.m_Control.fireCloseWindow({id:e,contentarea:i})};n.onOpenContainer=function(e,i){n.m_Control.fireContainerCreated({id:e,contentarea:i})};n.onCloseContainer=function(e,i){n.m_Control.fireContainerDestroyed({id:e,contentarea:i})};n.onChangeTrackingMode=function(e,i){n.m_Control.fireChangeTrackingMode({mode:e,bSet:i})};n.DoMinimize=function(e){var i=n.moThumbnail;var t=this.m_Control;var r;if(!i.bThumbnailed){i.strOrgWidth=this.m_Control.getWidth();i.strOrgHeight=this.m_Control.getHeight();i.nOrgWidth=i.nFullWidth?i.nFullWidth:e.m_nDivWidth;i.nOrgHeight=i.nFullHeight?i.nFullHeight:e.m_nDivHeight;i.bThumbnailed=true;r=i.nThumbWidth===e.m_nDivWidth&&i.nThumbHeight===e.m_nDivHeight}else{r=i.nThumbWidth===parseInt(t.getWidth(),10)&&i.nThumbHeight===parseInt(t.getHeight(),10);if(i.nFullWidth&&i.nOrgWidth!=i.nFullWidth){i.nOrgWidth=i.nFullWidth;r=true}if(i.nFullHeight&&i.nOrgHeight!=i.nFullHeight){i.nOrgHeight=i.nFullHeight;r=true}}if(i.nThumbWidth<=0&&i.nOrgHeight>0){i.nThumbWidth=i.nOrgWidth/i.nOrgHeight*i.nThumbHeight}if(i.nThumbHeight<=0&&i.nOrgWidth>0){i.nThumbHeight=i.nOrgHeight/i.nOrgWidth*i.nThumbWidth}t.setWidth(i.nThumbWidth);t.setHeight(i.nThumbHeight);if(r){e.resizeCanvas(0)}};return n}});
/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5) (c) Copyright 2009-2012 SAP AG. All rights reserved
 */
sap.ui.predefine("sap/ui/vbm/lib/sapvbmenu", ["sap/ui/unified/Menu","sap/ui/unified/MenuItem","./sapvbi"],function(e,n){"use strict";VBI.Menus=function(){var t={};t.m_menus=[];t.clear=function(){for(var e=t.m_menus.length-1;e>=0;--e){t.m_menus[e].destroy();t.m_menus.pop()}t.m_menus=[]};t.loadMainMenu=function(n,i){var a=new e;t.loadMenu(a,n,i,a.getId());a.vbi_data={};a.vbi_data.menuRef=n.id;a.vbi_data.VBIName=n.name;a.attachItemSelect(function(e){var n={};n.refid=e.mParameters.item.vbi_data.refid;n.menu=a;t.OnSelected(n)});t.m_menus.push(a);return a};t.loadMenu=function(i,a,u,r){var m=jQuery.type(a.MenuItem)=="object";var d=m?1:a.MenuItem.length;for(var f=0;f<d;++f){var o=m?a.MenuItem:a.MenuItem[f];if(o.active=="false"){continue}var _;_=r+"_"+f;var c=o.Separator==undefined?o.text:"---------------------------";var s=new n("vbimi_"+_,{text:c});s.vbi_data={};if(o.disabled=="true"||o.Separator!=undefined){s.setEnabled(false)}i.addItem(s);if(o.icon){s.setIcon(o.icon)}if(VBI.m_bTrace){VBI.Trace("Adding Menuitem: menuitem_"+_+" with text "+c)}if(o.MenuItem!=undefined){var v=new e("vbim_"+_);s.setSubmenu(v);t.loadMenu(v,o,u,_)}else if(o.id!=""){s.vbi_data.refid=o.id}}};t.deleteMenu=function(e){var n=t.findMenuIdxByName(e);if(n>=0){var i=t.m_menus.length-1;t.m_menus[n].destroy();if(n!=i){t.m_menus[n]=t.m_menus[i]}t.m_menus.pop();return n}return-1};t.getMainScene=function(e){if(e.m_SceneManager.m_SceneArray.length==1){return e.m_SceneManager.m_SceneArray[0].m_ID}return undefined};t.load=function(e,n){sap.ui.getCore().loadLibrary("sap.ui.unified");t.m_context=n;if(e.Set){if(e.Set.name!=undefined){t.deleteMenu(e.Set.name)}else{t.clear()}if(jQuery.type(e.Set)=="object"){if(e.Set.Menu){t.loadMainMenu(e.Set.Menu,n)}}else if(jQuery.type(e.Set)=="array"){for(var i=0;i<e.Set.length;++i){if(e.Set[i].Menu){t.loadMainMenu(e.Set[i].Menu,n)}}}}};t.findMenuByID=function(e){if(t.m_menus){for(var n=0;n<t.m_menus.length;++n){if(t.m_menus[n].vbi_data.menuRef==e){return t.m_menus[n]}}}return null};t.findMenuIdxByName=function(e){if(t.m_menus){for(var n=0;n<t.m_menus.length;++n){if(t.m_menus[n].vbi_data.VBIName==e){return n}}}return-1};t.OnSelected=function(e){var n=e.menu.vbi_data.object;if(e.refid==undefined){return}var i=t.m_context.m_SceneManager.GetSceneByName(e.menu.vbi_data.scene);var a=t.m_context.m_Actions;if(a){if(a.findAction("ContextMenu",i,n)){var u=new VBI.Actions.Action;u.m_name="FCODE_SELECT";u.m_id=e.refid;i.m_Ctx.FireAction(u,i,n,null,null,e.menu.vbi_data.instance)}}};return t}});
/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5) (c) Copyright 2009-2012 SAP AG. All rights reserved
 */
sap.ui.predefine("sap/ui/vbm/lib/sapvobase", ["sap/ui/core/IconPool","./sapvbi"],function(t){"use strict";VBI.VisualObjects=function(){VBI.EMHandle=0;VBI.EMBox=1;VBI.HTHANDLE=0;VBI.HTBOX=1;VBI.HTBOXHANDLE=2;var e={};e.vbiclass="VisualObjects";e.Factory={"{00100000-2012-0004-B001-64592B8DB964}":function(){return new VBI.VisualObjects.Spot},"{00100000-2012-0004-B001-C46BD7336A1A}":function(){return new VBI.VisualObjects.Route},"{00100000-2013-0004-B001-7EB3CCC039C4}":function(){return new VBI.VisualObjects.Circle},"{00100000-2013-0004-B001-686F01B57873}":function(){return new VBI.VisualObjects.CircleDist},"{00100000-2012-0004-B001-383477EA1DEB}":function(){return new VBI.VisualObjects.Pie},"{00100000-2012-0004-B001-BFED458C3076}":function(){return new VBI.VisualObjects.Box},"{00100000-2012-0004-B001-F311DE491C77}":function(){return new VBI.VisualObjects.Area},"{00100000-2012-0004-B001-E180770E8A12}":function(){return new VBI.VisualObjects.HeatMap},"{00100000-2012-0070-1000-35762CF28B6B}":function(){return new VBI.VisualObjects.Dummy},"{388951f5-a66b-4423-a5ad-e0ee13c2246f}":function(){return new VBI.VisualObjects.Dummy},"{00100000-2014-0004-B001-9F1B43BE944A}":function(){return new VBI.VisualObjects.Route},"{00100000-2014-0004-BDA8-87B904609063}":function(){return new VBI.VisualObjects.Area},"{00100000-2012-0004-B001-2297943F0CE6}":function(){return new VBI.VisualObjects.Container},"{00100000-2013-1000-1100-50059A6A47FA}":function(){return new VBI.VisualObjects.Caption},"{00100000-2013-1000-3700-AD84DDBBB31B}":function(){return new VBI.VisualObjects.Label},"{00100000-2013-1000-2400-D305F7942B98}":function(){return new VBI.VisualObjects.Link},"{00100000-2013-1000-2200-6B060A330B2C}":function(){return new VBI.VisualObjects.Image},"{00100000-2013-1000-1200-855B919BB0E9}":function(){return new VBI.VisualObjects.Button}};e.Factory3D={"{00100000-2012-0004-B001-BFED458C3076}":function(){return new VBI.VisualObjects.Box3D},"{00100000-2012-0070-1000-35762CF28B6B}":function(){return new VBI.VisualObjects.Dummy}};e.Factory.CreateInstance=function(t){return e.Factory[t]()};e.Factory3D.CreateInstance=function(t){return e.Factory3D[t]()};VBI.VisualObjects.Base={m_Scene:null,m_BB:[],m_IO:[],m_colorHot:"rgba( 240, 171, 0, 0.5 )",m_defaultColor:"rgba( 255, 0, 0, 1.0 )",m_defaultTooltip:"",m_defaultLabeltext:"",m_defaultLabelBgCol:"rgba(200,200,200,1.0)",m_DH:[],m_szHandle:6,m_Track:null,m_tt:"",m_pos:"",m_clientX:0,m_clientY:0,m_nActiveSelections:0,SetRichTooltip:function(t){var e=this.m_Scene;var i=this.m_Scene.m_Ctx;var r=this.m_Pos!=null?this.m_Pos.GetValueVector(i):this.m_PosM.GetValueVector(i);if(this.m_tt instanceof sap.ui.core.TooltipBase){if(t){if(this.m_tt!=""&&this.m_pos==""){e.SetToolTip(this.m_tt,true,this.m_clientX,this.m_clientY);this.m_pos=r}}else if(JSON.stringify(this.m_pos)==JSON.stringify(r)){e.SetToolTip(this.m_tt,false);this.m_pos=""}}},SetClusteredRichTooltip:function(t){var e=this.m_Scene;var i=[t[0],t[1]];if(this.m_tt instanceof sap.ui.core.TooltipBase){if(t.h){if(this.m_tt!=""&&t.m_pos==undefined){e.SetToolTip(this.m_tt,true,this.m_clientX,this.m_clientY);t.m_pos=i}}else if(JSON.stringify(t.m_pos)==JSON.stringify(i)){e.SetToolTip(this.m_tt,false);t.m_pos=undefined}}},LoadDragDropInfo:function(t,e,i){if(t.DragSource&&t.DragSource.DragItem){i.m_DragSourceInfo=new VBI.DnDInfo;i.m_DragSourceInfo.load(t.DragSource.DragItem,e,i)}if(t.DropTarget&&t.DropTarget.DropItem){i.m_DropTargetInfo=new VBI.DnDInfo;i.m_DropTargetInfo.load(t.DropTarget.DropItem,e,i)}},BaseLoad:function(t,e,i){if(VBI.m_bTrace){VBI.Trace("BaseLoad")}i.m_Props.push(i.m_HotScale=new VBI.AttributeProperty(t,"hotScale",i.m_DataSource,e,[1,1,1]));i.m_Props.push(i.m_HotDeltaColor=new VBI.AttributeProperty(t,"hotDeltaColor",i.m_DataSource,e,null));i.m_Props.push(i.m_SelectColor=new VBI.AttributeProperty(t,"selectColor",i.m_DataSource,e,null));i.m_Props.push(i.m_NonSelectColor=new VBI.AttributeProperty(t,"nonSelectColor",i.m_DataSource,e,null));i.m_Props.push(i.m_FxSize=new VBI.AttributeProperty(t,"fxsize",i.m_DataSource,e,true));i.m_Props.push(i.m_FxDir=new VBI.AttributeProperty(t,"fxdir",i.m_DataSource,e));i.m_Props.push(i.m_Entity=new VBI.AttributeProperty(t,"entity",i.m_DataSource,e,null));i.m_Props.push(i.m_Labeltext=new VBI.AttributeProperty(t,"labelText",i.m_DataSource,e,i.m_defaultLabeltext));i.m_Props.push(i.m_LabelBgCol=new VBI.AttributeProperty(t,"labelBgColor",i.m_DataSource,e,i.m_defaultLabelBgCol));i.m_Props.push(i.m_LabelBrdrCol=new VBI.AttributeProperty(t,"labelBorderColor",i.m_DataSource,e,null));i.m_Props.push(i.m_LabelArrow=new VBI.AttributeProperty(t,"labelArrow",i.m_DataSource,e,false));i.m_Props.push(i.m_LabelRounded=new VBI.AttributeProperty(t,"labelRounded",i.m_DataSource,e,false));i.m_Props.push(i.m_LabelPos=new VBI.AttributeProperty(t,"labelPos",i.m_DataSource,e));i.m_Props.push(i.m_LabelOffset=new VBI.AttributeProperty(t,"labelOffset",i.m_DataSource,e,[0,0]));i.m_Props.push(i.m_LabelIcon=new VBI.AttributeProperty(t,"labelIcon",i.m_DataSource,e));i.m_Props.push(i.m_LabelIcBgrdCol=new VBI.AttributeProperty(t,"labelIconBgrdCol",i.m_DataSource,e));i.m_Props.push(i.m_LabelIcTextCol=new VBI.AttributeProperty(t,"labelIconTextCol",i.m_DataSource,e));i.m_Props.push(i.m_DragData=new VBI.AttributeProperty(t,"dragdata",i.m_DataSource,e,null));if(!VBI.m_bIsMobile){this.LoadDragDropInfo(t,e,i)}},BaseMousemove:function(t){if(VBI.m_bTrace){VBI.Trace("BaseMousemove")}if(this.m_Track){return false}if(!this.GetHitArray){return false}if(this.m_Scene.vbiclass=="3DScene"){return false}var e=this.GetHitArray(t.offsetX,t.offsetY);var i=this.m_Scene;if(e.length>0){i.SetCursor("pointer");if(i.InternalSetHotItem(this,e[0])){if(!e[0].m_Design&&this.m_Tooltip){this.m_tt=this.getTooltip(i.m_Ctx,e[0]);if(VBI.m_bIsRtl){var r=i.GetEventVPCoords(t);this.m_clientX=r[0]}else{this.m_clientX=t.clientX}this.m_clientY=t.clientY;var a=this.m_tt.split("#");if(a[0]=="rtt"){var s=a[1];this.m_tt=sap.ui.vbm.VBI.RttMap[s]}else{i.SetToolTip(this.m_tt)}}var n;if(n=this.DetailCursor(t,e[0])){i.SetCursor(n)}}if(this.m_DragSourceInfo){i.m_Canvas[i.m_nLabelIndex].draggable=true}}else if(i.m_Canvas[i.m_nLabelIndex].draggable==true){i.m_Canvas[i.m_nLabelIndex].draggable=false}return e.length>0?true:false},BaseContextmenu:function(t){if(VBI.m_bTrace){VBI.Trace("BaseContextmenu")}if(!this.GetHitArray){return false}var e=this.m_Scene;if(e.vbiclass=="3DScene"){return false}if(t.hitTests){t.hitTests=t.hitTests.concat(this.GetHitArray(t.offsetX,t.offsetY,true));return t.hitTests.length>0}var i=t.hitCached?t.hitCached:this.GetHitArray(t.offsetX,t.offsetY,false)[0];if(!i){return false}var r=this.GetDataIndex(i.m_Index);var a,s=e.m_Ctx.m_Actions;var n;var o=this.m_DataSource.GetIndexedElement(e.m_Ctx,r);if(o){if(s&&i.m_Design&&i.m_Hit==VBI.HTHANDLE){if(a=s.findAction("HandleContextMenu",e,this)){var l=e.GetEventVPCoordsObj(t);l.handle=i.m_Handle.toString();e.m_Ctx.FireAction(a,e,this,o,l);t.preventDefault();return true}}if(this.DetailContextmenu(t,o,i)){t.preventDefault();return true}}else{var h=this.m_BBRefs[i.m_Index];n=e.m_Ctx.m_Clustering.getClusterIdent(e.m_PreassembledData,h.cI,h.i);o=this.GetPreassembledElement(i.m_Index)}if(s){if(a=s.findAction("ContextMenu",e,this)){e.m_Ctx.FireAction(a,e,this,o,e.GetEventVPCoordsObjWithScene(t),n,null,i);t.preventDefault();return true}}t.preventDefault();return false},BaseFindAction:function(t){var e=this.m_Scene,i=e.m_Ctx.m_Actions;return i?i.findAction(t,e,this):null},BaseClick:function(t){if(VBI.m_bTrace){VBI.Trace("BaseClick")}if(!this.GetHitArray){return false}var e=this.m_Scene;if(e.vbiclass=="3DScene"){return false}if(t.hitTests){t.hitTests=t.hitTests.concat(this.GetHitArray(t.offsetX,t.offsetY,true));return t.hitTests.length>0}var i=t.hitCached?t.hitCached:this.GetHitArray(t.offsetX,t.offsetY,false)[0];if(!i){return false}var r=this.GetDataIndex(i.m_Index);e.RenderAsync(false);var a;var s;if(r>=0&&(a=this.m_DataSource.GetIndexedElement(e.m_Ctx,r))){this.m_DataSource.Select(r);if(t.type.indexOf("touch")>=0||(t.type.indexOf("pointer")>=0||(t.ctrlKey||t.metaKey)&&!t.shiftKey)){this.Select(a,e.m_Ctx,this.IsSelected(e.m_Ctx)?false:true)}else if(t.shiftKey){if(!this.IsSelected(e.m_Ctx)){this.Select(a,e.m_Ctx,true)}}else{this.m_nActiveSelections=a.GlobalSingleSelect()}if(e.m_PreassembledData){e.UpdatePreData4Selected(this.m_nPreDataIndex,this.GetInternalIndex(i.m_Index))}if(i.m_Handle>=0){t.preventDefault();return true}else if(this.IsPosChangeable(e.m_Ctx)){var n=this.m_DataSource.GetEditMode(e.m_Ctx)==VBI.EMHandle?VBI.EMBox:VBI.EMHandle;if(VBI.m_bTrace){VBI.Trace("SetEditMode: "+n)}this.m_DataSource.SetEditMode(e.m_Ctx,n);t.preventDefault();return true}if(this.DetailClick(t,a,i)){t.preventDefault();return true}}else{var o=this.m_BBRefs[i.m_Index];s=e.m_Ctx.m_Clustering.getClusterIdent(e.m_PreassembledData,o.cI,o.i);a=this.GetPreassembledElement(i.m_Index)}var l;if(l=e.m_Ctx.m_Actions){var h;if(h=l.findAction("Click",e,this)){this.m_Scene.m_Ctx.FireAction(h,e,this,a,e.GetEventVPCoordsObj(t),s,null,i);t.preventDefault();return true}}return false},GetPreassembledElement:function(t){return undefined},BaseHitTest:function(t,e,i){var r=[];var a={};if(this.BaseDesignHitTest(t,e,a)){r.push(a);return r}var s=new Map;var n=this.getLabelData(false);if(n){for(var o=n.length-1;o>=0;--o){var l=n[o];var h=VBI.Types.string2rgba(l.m_BgColor);if(h[3]<.1&&h[4]==1){continue}for(var m=0;m<l.m_Pos.length;++m){for(var u=0;u<l.m_Pos[m].length;++u){var _=[t,e];var c=l.m_Pos[m][u][0];var f=l.m_Pos[m][u][1];var d=l.m_Pos[m][u].tri;var v=l.m_Pos[m][u].rc;var p=[c,f,c+l.m_Width,f+l.m_Height];if(VBI.Utilities.PtInRect(_,p)||d&&VBI.Utilities.pointInTriangle(d,_)||v&&VBI.Utilities.PtInRect(_,v)){var I={m_Vo:this,m_Index:l.mIndex,m_Entity:this.GetEntity(l.mIndex,this.m_Scene.m_Ctx)};if(i.m_All){s.set(I.m_Index,I)}else{r.push(I)}if(!i.m_All){return r}}}}}}for(var o=this.m_BB.length-1;o>=0;--o){var B=this.m_BB[o];if(B){for(var m=this.m_IO[o].length-1;m>=0;--m){var g=this.m_IO[o][m];if(!VBI.Utilities.PtInRect([t-g,e],B)){continue}if(i){var S=i.m_cb(i,o,t-g,e);if(S&&S.m_hit>0){var I={m_Vo:this,m_Index:o,m_Entity:this.GetEntity(o,this.m_Scene.m_Ctx),m_Detail:S,m_IO:g};if(i.m_All){s.set(I.m_Index,I)}else{r.push(I)}if(!i.m_All&&S.m_hit==1){return r}}}}}}if(i.m_All){s.forEach(function(t){r.push(t)})}return r},clear:function(){var t;if(this.m_Props){for(t=0;t<this.m_Props.length;++t){this.m_Props[t].clear()}this.m_Props=null}if(this.m_DragSourceInfo){this.m_DragSourceInfo.clear();this.m_DragSourceInfo=null}if(this.m_DropTargetInfo){this.m_DropTargetInfo.clear();this.m_DropTargetInfo=null}this.m_Scene=null;this.m_Track=null;this.m_BB=null;this.m_IO=null;this.m_DH=null;if(this.m_Label){for(t=0;t<this.m_Label.length;++t){this.m_Label[t].clear()}this.m_Label=[]}},load:function(t,e){if(t.id){this.m_ID=t.id}this.m_Props=[];this.m_DragSourceInfo=null;this.m_DropTargetInfo=null},NotifyDataChange:function(t){if(this.m_Props){for(var e=0,i=this.m_Props.length;e<i;++e){this.m_Props[e].NotifyDataChange(t)}}this.m_bChanged=true;this.m_nActiveSelections=undefined},IsPosChangeable:function(t){if(VBI.m_bMouseSupported&&this.m_Pos){return this.m_Pos.IsChangeable(t)}return false},IsSelected:function(t){if(this.m_DataSource){return this.m_DataSource.IsElementSelected(t)}return false},GetNumActiveSelections:function(t){if(this.m_nActiveSelections===undefined){this.m_nActiveSelections=0;var e=this.m_DataSource.m_nCurElement;var i=this.m_DataSource.GetCurrentNode(t);if(i){for(var r=0,a=i.m_dataelements.length;r<a;++r){this.m_DataSource.Select(r);if(this.IsSelected(t)){this.m_nActiveSelections++}}}this.m_DataSource.Select(e)}return this.m_nActiveSelections},Select:function(t,e,i){this.m_nActiveSelections=t.Select(i,this.GetNumActiveSelections(e))},IsHandleMode:function(){return this.m_DataSource.GetEditMode(this.m_Scene.m_Ctx)==VBI.EMHandle?true:false},IsBoxMode:function(){return this.m_DataSource.GetEditMode(this.m_Scene.m_Ctx)==VBI.EMBox?true:false},IsDataAccepted:function(t){var e=this.m_Scene;if(this.m_Track){if(VBI.m_bTrace){VBI.Trace("Error: Track object should be already gone")}return false}if(!this.GetHitArray){return false}var i,r=this.GetHitArray(t.offsetX,t.offsetY);if(r.length&&(i=r[0]).m_Design){return false}if(r.length&&e.m_DragInfo){this.m_DataSource.Select(i.m_Index);if(this.m_DropTargetInfo){var a=e.m_Ctx;var s=this.m_DropTargetInfo.getItemArray(a);var n=e.m_DragInfo.aItems;for(var o=0;o<s.length;++o){if(n.indexOf(s[o])!=-1){try{t.dataTransfer.dropEffect="copy";t.stopPropagation();t.preventDefault()}catch(t){if(VBI.m_bTrace){VBI.Trace("Warning: sapvobase.IsDataAccepted exception occured: "+t.message)}}return i}}}}return false},GetEntity:function(t,e){this.m_DataSource.Select(t);return this.m_Entity.GetValueString(e)},IsHot:function(t){var e=this.m_Scene,i=e.m_HotItem;if(i.m_Entity&&i.m_Entity==this.m_Entity.GetValueString(e.m_Ctx)){return true}if(!i.m_HitObj||i.m_Index!=t){return false}if(i.m_Design){return false}if(i.m_VO!=this){return false}return true},InternalChangeHotItem:function(t,e){},IsClusterable:function(){return false},GetDataIndex:function(t){return t},GetInternalIndex:function(t){return t},getTooltip:function(t,e){this.m_DataSource.Select(e.m_Index);return this.m_Tooltip.GetValueString(t)},getLabelText:function(t,e){this.m_DataSource.Select(e.m_Index);return this.m_Labeltext.GetValueString(t)},getLabelData:function(t){if(!this.m_Label){return null}if(t){for(var e=0;e<this.m_Label.length;e++){var i=this.m_Label[e];if(i.CalculateLabelPos&&i.m_PosArray.pa.length>0){i.m_Pos=[];for(var r=0;r<i.m_aIO.length;r++){var a=this.CalculateLabelPos(this.m_Scene,i.m_PosArray,i.m_aIO[r]);if(a&&a.length>0){i.m_Pos.push(a)}}i.m_bAligned=false}}}return this.m_Label},SwitchPreDataRendering:function(t){if(this.bUsePreData!=t){this.bUsePreData=t;if(t){this.IsHot=this.PreDataIsHot;this.GetEntity=this.PreDataGetEntity}else{this.IsHot=this.BaseIsHot;this.GetEntity=this.BaseGetEntity}}},GetAnimClusterDistance:function(t,e){var i=this.m_Scene;var r=t-e;if(r&&i.m_bNonIntPosStable){var a=1e3*r;var s=Date.now()-i.m_bNonIntPosStable;r*=s<a?(a-s)/a:0}i.m_bLineAnimationRunning=r>0;return r},RenderTree:function(t,e,i,r,a,s,n,o,l,h,m,u,_){var c=[h*t.bo[0]-m,h*t.bo[1]-u,h*t.bo[2]-m,h*t.bo[3]-u];var f=this.m_Scene.GetInstanceOffsets(c);if(f.length){if(t.lod<s){for(var d=0;d<t.bw.length;++d){a=this.RenderTree(t.bw[d],e,i,r,a,s,n,o,l,h,m,u,_)}}else if(t.isCl){if(this.RenderThisInstance(t,e,i,r,a,t.nJ,o,l,s,n,h,m,u,false)){a++}}else if(!_){var v=this.m_Scene.m_VOS[t.vo];v.RenderThisInstance(t,e,i,r,v.m_BB.length,t.nJ,o,l,s,n,h,m,u,true);v.SetClusteredRichTooltip(t)}}return a},Init4Render:function(){},StandardInit:function(){this.m_BB=[];this.m_IO=[];this.m_DH=[]},StandardInitWithLPs:function(){this.m_BB=[];this.m_IO=[];this.m_DH=[];this.m_LP=[]},BaseRender:function(t,e){var i=this.m_DH.length;if(!i){return}var r,a,s;var n=this.m_szHandle,o=n/2,l=1.5*n*n;var h=e.fillStyle;var m="rgba(232,205,30,0.7)";var u="rgba(188,54,24,0.7)";var _="rgba(229, 66, 30, 1.0 )";var c=this.m_Scene.m_HotItem;var f,d,v=false;for(var p=0;p<i;++p){if(!(f=this.m_DH[p])){continue}for(var I=0,B=this.m_IO[p].length;I<B;++I){e.setTransform(1,0,0,1,this.m_IO[p][I],0);if(f.m_EditMode==VBI.EMBox){if(f.length==1){d=f[0];VBI.Utilities.DrawDesignRect(e,this.DesignGetActiveBoxHandles(p),d)}}else{e.fillStyle=u;e.lineWidth=1;r=null;if(v){e.fillStyle=u;v=false}for(var g=0,S=f.length;g<S;++g){d=f[g];var b=c.m_VO==this&&c.m_Index==p&&c.m_Design&&c.m_HitObj&&c.m_HitObj.m_Handle==g;if(r&&(a=r[0]-d[0])*a+(s=r[1]-d[1])*s<l){if(!v){v=true;e.fillStyle=b?_:m;e.fill()}continue}if(v){e.fillStyle=u;v=false}if(b){e.fillStyle=_}e.beginPath();e.rect(d[0]-o,d[1]-o,n,n);e.closePath();e.fill();if(b){e.fillStyle=u}r=d}}}}e.fillStyle=h;e.setTransform(1,0,0,1,0,0)},BaseDesignHitTest:function(t,e,i){if(VBI.m_bTrace){VBI.Trace("BaseDesignHitTest nsx:"+t+" nsy:"+e+" instance:"+this.m_ID)}var r=this.m_DH.length;if(!r){return false}var a=this.m_szHandle+2,s=a/2;var n=VBI.Utilities.PtInRect;if(i.m_Handle){delete i.m_Handle}var o,l;for(var h=r;h>=0;--h){if(!(o=this.m_DH[h])){continue}for(var m=0;m<this.m_IO[h].length;++m){var u=this.m_IO[h][m];if(o.m_EditMode==VBI.EMHandle){if(VBI.m_bTrace){VBI.Trace("BaseDesignHitTest Handle")}for(var _=0,c=o.length;_<c;++_){l=o[_];if(n([t-u,e],[l[0]-s,l[1]-s,l[0]+s,l[1]+s])){if(VBI.m_bTrace){VBI.Trace("BaseDesignHitTest Handle Hit! Index:"+h+" Handle: "+_)}i.m_Index=h;i.m_Design=true;i.m_Hit=VBI.HTHANDLE;i.m_Handle=_;i.m_NsX=t;i.m_NsY=e;i.m_IO=u;return true}}}else if(o.m_EditMode==VBI.EMBox){if(VBI.m_bTrace&&(o.length>1||o.length==0)){VBI.Trace("Error: Box edit mode must fill one rectangle only")}l=o[0];if(VBI.m_bTrace){VBI.Trace("BaseDesignHitTest Box")}var f=9;var d=l[2]-l[0];var v=l[3]-l[1];var p=d/2;var I=v/2;var B=this.DesignGetActiveBoxHandles(h);for(var g=0;g<3;++g){for(var S=0;S<3;++S){if(g==1&&S==1){continue}if(!B[S*3+g]){continue}var b=l[0]+g*p-(t-u);var V=l[1]+S*I-e;if(b*b+V*V<f){i.m_Index=h;i.m_Handle=S*3+g;i.m_Design=true;i.m_Hit=VBI.HTBOXHANDLE;i.m_NsX=t;i.m_NsY=e;i.m_IO=u;return true}}}if(n([t-u,e],l)){if(VBI.m_bTrace){VBI.Trace("BaseDesignHitTest Box Hit! Index:"+h)}i.m_Index=h;i.m_Handle=-1;i.m_Design=true;i.m_Hit=VBI.HTBOX;i.m_NsX=t;i.m_NsY=e;i.m_IO=u;return true}}}}return false},DesignHandleDrag:function(t,e){var i=this.m_Scene;if(VBI.m_bTrace){VBI.Trace("DesignHandleDrag")}if(VBI.m_bTrace&&i.m_nInputMode!=VBI.InputModeTrackObject){VBI.Trace("Error: DesignHandleDrag wrong input mode: "+i.m_nInputMode)}if(t.m_ClientX!=t.m_ClientStartX||t.m_ClientY!=t.m_ClientStartY){t.m_bDragStart=true}if(t.m_bDragStart){this.m_DataSource.Select(t.m_Index);var r=i.GetPosFromPoint([t.m_ClientX-t.m_IO,t.m_ClientY,0]);var a=i.GetPosFromPoint([t.m_ClientStartX-t.m_IO,t.m_ClientStartY,0]);if(this.IsPosChangeable(i.m_Ctx)){var s=this.m_Pos.GetValueVector(i.m_Ctx).slice(0);var n=t.m_PosOrig;var o;if(t.hasOwnProperty("m_Handle")){if(VBI.m_bTrace){VBI.Trace("DesignHandleDrag Handle")}if(t.m_Hit==VBI.HTHANDLE){o=t.m_Handle*3;s[o]=r[0];s[o+1]=r[1];this.m_Pos.SetValueVector(i.m_Ctx,s)}else if(t.m_Hit==VBI.HTBOXHANDLE){if(this.DesignBoxSize){this.DesignBoxSize(t)}}else if(t.m_Hit==VBI.HTBOX){if(VBI.m_bTrace){VBI.Trace("DesignHandleDrag Box")}var l=r[0]-a[0];var h=r[1]-a[1];for(var m=0,u=s.length/3;m<u;++m){o=m*3;s[o]=n[o]+l;s[o+1]=n[o+1]+h}this.m_Pos.SetValueVector(i.m_Ctx,s)}}}}i.RenderAsync(true)},DesignHandleDrop:function(t,e){var i=this.m_Scene;if(VBI.m_bTrace&&i.m_nInputMode!=VBI.InputModeTrackObject){VBI.Trace("Error: DesignHandleDrop wrong input mode: "+i.m_nInputMode)}var r,a=i.m_Ctx.m_Actions;if(a&&t.m_Design&&(t.m_Handle>-1||t.m_Hit===VBI.HTBOX)){var s=t.m_bDragStart?"HandleMoved":"HandleClick";if(r=a.findAction(s,i,this)){var n;if(n=this.m_DataSource.GetIndexedElement(i.m_Ctx,t.m_Index)){var o=i.GetEventVPCoordsObj(e);o.handle=t.m_Handle.toString();o.mode=t.m_Hit.toString();i.m_Ctx.FireAction(r,i,this,n,o)}}}i.SetInputMode(VBI.InputModeDefault);i.RenderAsync(true);return true},DesignHandleEnd:function(t,e){this.m_Track.UnHook();this.m_Track=null},DesignGetActiveBoxHandles:function(t){return[1,1,1,1,0,1,1,1,1]},onsapsecclick:function(t){return this.BaseContextmenu(t)},onsapclick:function(t){return this.BaseClick(t)},onsapmove:function(t){return this.BaseMousemove(t)},onsapup:function(t){if(!this.m_Track){return false}this.m_Track.UnHook();this.m_Track=null},onsapdrop:function(t){if(VBI.m_bTrace){VBI.Trace("onsapdrop in base "+t.type)}var e;if(e=this.IsDataAccepted(t)){var i=this.m_Scene;var r=this.GetDataIndex(e.m_Index);var a=this.m_DataSource.GetIndexedElement(i.m_Ctx,r);var s,n=i.m_Ctx.m_Actions;if(n){if(s=n.findAction("Drop",i,this)){this.m_Scene.m_Ctx.FireAction(s,i,this,a,i.GetEventDropObjWithScene(t));t.preventDefault();return true}}return false}return false},onsapdrag:function(t){if(VBI.m_bTrace){VBI.Trace("onsapdrag in base "+t.type)}if(this.IsDataAccepted(t)){return true}return false},onsapdown:function(t){if(VBI.m_bTrace){VBI.Trace("onsapdown in base "+t.type)}var e=this.m_Scene;if(this.m_Track){if(VBI.m_bTrace){VBI.Trace("Error: Track object should be already gone")}return true}if(e.vbiclass=="3DScene"){return false}if(!this.GetHitArray){return false}var i,r=this.GetHitArray(t.offsetX,t.offsetY);if(r.length&&(i=r[0]).m_Design){if(VBI.m_bTrace){VBI.Trace("Start Tracking on "+this.m_ID+" caused by "+t.type)}this.m_DataSource.Select(i.m_Index);i.m_CBDrag=this.DesignHandleDrag.bind(this);i.m_CBDrop=this.DesignHandleDrop.bind(this);i.m_CBEnd=this.DesignHandleEnd.bind(this);i.m_ClientStartX=t.offsetX;i.m_ClientStartY=t.offsetY;i.m_bDragStart=false;i.m_PosOrig=e.GetNearestPosArray(this.m_Pos.GetValueVector(e.m_Ctx).slice(0));e.SetInputMode(VBI.InputModeTrackObject);e.SetCursor(this.DetailCursor(t,i));if(this.DesignBeginDrag){this.DesignBeginDrag(i)}this.m_Track=new e.DesignTrack(i);t.stopPropagation();t.preventDefault();return true}if(r.length){this.m_DataSource.Select(i.m_Index);if(this.m_DragSourceInfo&&!this.m_Pos.IsChangeable(e.m_Ctx)){var a=e.m_Ctx;var s=this.m_DragSourceInfo.getItemArray(a);if(s.length){e.m_DragInfo={};e.m_DragInfo.aItems=s;e.m_DragInfo.strInstance=this.m_DataSource.m_Path+"."+this.m_DataSource.GetCurrentElement().GetKeyValue();e.m_DragInfo.strScene=this.m_Scene.m_ID;e.m_DragInfo.strID=this.m_ID;e.m_DragInfo.strExtData=this.m_DragData.GetValueString(e.m_Ctx);e.m_DragInfo.bDragStart=false;return true}}}return false},DetailClick:function(t,e,i){return false},DetailContextmenu:function(t,e,i){return false},DetailCursor:function(t,e){if(e.m_Design){if(e.m_Hit==VBI.HTBOXHANDLE){var i=["nw-resize","n-resize","ne-resize","w-resize","","e-resize","sw-resize","s-resize","se-resize"];return i[e.m_Handle]}else if(e.m_Hit==VBI.HTBOX){return"move"}}return"pointer"},GetSelectColor:function(t,e){var i;if(i=this.m_SelectColor.GetValueString(t)){return this.ApplyDeltaColor(t,e,i)}else{return e}},GetNonSelectColor:function(t,e){var i;if(i=this.m_NonSelectColor.GetValueString(t)){return this.ApplyDeltaColor(t,e,i)}else{return e}},GetHotColor:function(t,e){var i;if(i=this.m_HotDeltaColor.GetValueString(t)){return this.ApplyDeltaColor(t,e,i)}else{return this.m_colorHot}},GetAltBorderColor:function(t,e){var i;if(i=this.m_AltColorBorder.GetValueString(t)){return this.ApplyDeltaColor(t,e,i)}else{return this.GetHotColor(t,e)}},ApplyDeltaColor:function(t,e,i){var r;var a=e+i;if(t.m_deltacolTable[a]==undefined){if(r=VBI.Types.string2rhls(i)){var s;if(s=VBI.Types.color2array(e)){var n=VBI.Utilities.RGB2HLS(s[0],s[1],s[2]);var o=VBI.Utilities.HLS2RGB(n[0]+r[0],n[1]*r[1],n[2]*r[2]);t.m_deltacolTable[a]="rgba("+Math.min(Math.round(o[0]),255)+","+Math.min(Math.round(o[1]),255)+","+Math.min(Math.round(o[2]),255)+","+Math.min((r[3]*s[3]).toString(),1)+")"}}else{t.m_deltacolTable[a]=VBI.Types.string2color(i)}}return t.m_deltacolTable[a]},GetHotScale:function(t){var e;if(e=this.m_HotScale.GetValueVector(t)){return e}return[1,1,1]},RectSelect:function(t,e,i){var r,a,s=false;for(var n=this.m_BB.length-1;n>=0;--n){if(r=this.m_BB[n]){for(var o=this.m_IO[n].length-1;o>=0;--o){var l=this.m_IO[n][o];a=[t[0]-l,t[1],t[2]-l,t[3]];if(r[0]>=a[0]&&r[1]>=a[1]&&r[2]<=a[2]&&r[3]<=a[3]){i.push(n);e.push(this.GetDataIndex(n));s=true}}}}return s},LassoSelectCircle:function(t,e,i){var r=[];var a,s;var n=false;for(var o=this.m_BB.length-1;o>=0;--o){var l=[];var h=this.m_BB[o].m_Pos;var m=this.m_BB[o].m_Radius;var u=20;for(var _=0;_<u;++_){s=_*2*Math.PI/u;r=[h[0]+m*Math.sin(s),h[1]+m*Math.cos(s)];l.push(r)}a=this.m_IO[o];if(VBI.Utilities.polyInPolygon(t,l,a)){e.push(o);i.push(o);n=true}}return n},LassoSelect:function(t,e,i){var r;var a=false,s=false;var n,o;for(var l=this.m_BB.length-1;l>=0;--l){if(r=this.m_BB[l]){a=false;for(var h=this.m_IO[l].length-1;h>=0&&!a;--h){var m=this.m_IO[l][h];var u=[[r[0]+m,r[1]],[r[2]+m,r[1]],[r[2]+m,r[3]],[r[0]+m,r[3]]];if(VBI.Utilities.pointInPolygon(t,u[0][0],u[0][1])){a=true;for(n=0;n<u.length&&a;n+=2){var _=u[n];var c=u[n+1];for(o=0;o<t.length&&a;++o){var f=t[o];var d=o+1==t.length?t[0]:t[o+1];VBI.Utilities.LineLineIntersection(_,c,f,d,true);if(VBI.Utilities.LineLineIntersection(_,c,f,d,true)){a=false}}}}}if(a){i.push(l);e.push(this.GetDataIndex(l));s=true}}}return s},GetLabel:function(t){var e={};var i=this.m_Labeltext.GetValueString(t);var r=this.m_LabelIcon.GetValueString(t);if(i||r){e.text=i;e.icon=r;e.icColor=this.m_LabelIcBgrdCol.GetValueColor(t);e.icTextColor=this.m_LabelIcTextCol.GetValueColor(t);e.bgColor=this.m_LabelBgCol.GetValueColor(t);e.brdrCol=this.m_LabelBrdrCol.GetValueColor(t);e.arrow=this.m_LabelArrow.GetValueBool(t);e.rounded=this.m_LabelRounded.GetValueBool(t);e.offset=this.m_LabelOffset.GetValueVector(t);e.Align=this.m_LabelPos.GetValueLong(t);return e}else{return null}},RenderShadowDot:function(t,e,i,r,a,s,n){if(e.isCl){for(var o=e.bw.length;o--;){this.RenderShadowDot(t,e.bw[o],i,r,a,s,n)}}else{t.beginPath();t.moveTo(n[0]*(i*e[0]-r-s),n[1]*(i*e[1]-a-s));t.lineTo(n[0]*(i*e[0]-r+s),n[1]*(i*e[1]-a-s));t.lineTo(n[0]*(i*e[0]-r+s),n[1]*(i*e[1]-a+s));t.lineTo(n[0]*(i*e[0]-r-s),n[1]*(i*e[1]-a+s));t.closePath();t.stroke()}},GetRefBorders:function(t,e,i,r){var a=this.m_Scene.m_Canvas[0].m_nExactLOD;var s=a==Math.floor(a)?1:.5;var n,o,l=e;var h=i;if(t.isCl==1){var m=t.e[0][0],u=t.e[2][0];n=(m[0]+u[0])/2;o=(m[1]+u[1])/2;l=1.2*r*Math.max(u[0]-m[0],u[1]-m[1])}else{n=(t.bo[0]+t.bo[2])/2;o=(t.bo[1]+t.bo[3])/2}var _=s*l/r;var c=[n-_,n+_,o-_,o+_];var f=t;while(f.c!=undefined){l*=1<<h-f.c.lod;h=f.c.lod;f=f.c;n=(f.bo[0]+f.bo[2])/2;o=(f.bo[1]+f.bo[3])/2;_=l/r;c=[Math.max(c[0],n-_),Math.min(c[1],n+_),Math.max(c[2],o-_),Math.min(c[3],o+_)]}return c},GetNextPoint:function(t,e,i,r,a){var s,n;if(r!=0){var o=r<0?0:1;s=(t[0]-i[o])/(t[0]-e[0]);var l=t[1]+s*(e[1]-t[1]);if(a==0||l>=i[2]&&l<=i[3]){return[i[o],l,true]}n=a<0?2:3;s=(t[1]-i[n])/(t[1]-e[1]);return[t[0]+s*(e[0]-t[0]),i[n],false]}if(a!=0){n=a<0?2:3;s=(t[1]-i[n])/(t[1]-e[1]);return[t[0]+s*(e[0]-t[0]),i[n],false]}},CheckNextLinePoint:function(t,e,i,r){var a=r<2;var s=a?0:1;var n=1-s;var o=(t[s]-i[r])/(t[s]-e[s]);if(o<=0||o>1){return undefined}var l=t[n]+o*(e[n]-t[n]);if(l<i[2*n]||l>i[2*n+1]){return undefined}return a?[i[r],l]:[l,i[r]]},paintLineList:function(t,e,i,r,a,s){var n;for(var o=0;o<4;++o){var l=e[o];for(var h=0;h<l.length;++h){if(n==undefined){t.moveTo(s[0]*(i*l[h][0]-r),s[1]*(i*l[h][1]-a));n=true}else{t.lineTo(s[0]*(i*l[h][0]-r),s[1]*(i*l[h][1]-a))}}}},GetNextLinePoint:function(t,e,i,r,a){var s;var n=a?0:1;var o=1-n;var l=2*n+(r<0?0:1);var h=(t[n]-i[l])/(t[n]-e[n]);var m=t[o]+h*(e[o]-t[o]);if(a){s=m<i[2]||m>=i[3];return[i[l],Math.max(Math.min(m,i[3]),i[2]),!s]}s=m<i[0]||m>=i[1];return[Math.max(Math.min(m,i[1]),i[0]),i[l],s]},doCornerConnection:function(t,e,i,r,a,s,n,o,l,h,m,u,_){var c=this.GetNextLinePoint(a,s,n,o,u);t.lineTo(_[0]*(r*c[0]-e),_[1]*(r*c[1]-i));if(m&&c[2]==u){c=this.GetNextLinePoint(a,s,n,m,!u);t.lineTo(_[0]*(r*c[0]-e),_[1]*(r*c[1]-i))}if(h&&(m==0||m==-l)){c=this.GetNextLinePoint(a,s,n,h,u);c[2]=!c[2];t.lineTo(_[0]*(r*c[0]-e),_[1]*(r*c[1]-i))}return c},RenderAreaFromBox:function(t,e,i,r,a,s,n,o){var l=this.m_Scene.m_Ctx.m_Clustering;var h;var m=[[[r[1],r[2]]],[[r[1],r[3]]],[[r[0],r[3]]],[[r[0],r[2]]]];var u=r[1]-r[0],_=r[3]-r[2];var c=[3,1,0,2];var f=[1,1,0,0];var d=[2,3,3,2];var v,p;var I=e;for(var B=0;B<e.e.length;++B){var g=l.getEdge(e.e[B],i);var S=[],b=[];for(var V=0;V<4;++V){if((h=this.CheckNextLinePoint(g[0],g[1],r,V))!=undefined){b.push(c[V]);S.push(h)}}if(S.length==2){while(I.bw!=undefined){I=I.bw[0]}var P=(4+b[1]-b[0])%4;if(P%2==1){var D=P==1?0:1;var C=1-D;var G=m[b[D]];if(b[D]%2){v=S[C][0];p=S[D][1]}else{v=S[D][0];p=S[C][1]}var x=[r[f[b[D]]],r[d[b[D]]]];var y=Math.abs(x[0]-v);var T=Math.abs(x[1]-p);var A=Math.abs(x[0]-I[0]);var O=Math.abs(x[1]-I[1]);if(!y||!T||A/y+O/T>1){G.splice(G.length-1,1,S[D],S[C])}else{var w=m[(b[D]+1)%4];w.splice(w.length-1,1,S[C]);w=m[(b[D]+2)%4];w.splice(0,1,S[C]);w=m[(b[D]-1)%4];w.splice(0,1,S[D])}}if(P==2){while(I.bw!=undefined){I=I.bw[0]}var L;if(b[0]%2){var M=b[0]==1?0:1,H=1-M;L=(I[0]-r[0])/u;var R=(1-L)*S[M][1]+L*S[H][1];if(R>I[1]){m[1].splice(m[1].length-1,1,S[M]);m[2]=[S[H]]}else{m[3].splice(m[3].length-1,1,S[H]);m[0]=[S[M]]}}else{var E=b[0]==0?0:1,F=1-E;L=(I[1]-r[2])/_;var k=(1-L)*S[F][0]+L*S[E][0];if(k>I[0]){m[0].splice(m[0].length-1,1,S[E]);m[1]=[S[F]]}else{m[2].splice(m[2].length-1,1,S[F]);m[3]=[S[E]]}}}}}this.paintLineList(t,m,a,s,n,o)},RenderAreaFromEdges:function(t,e,i,r,a,s,n,o,l){var h,m,u,_,c,f=i;var d=0,v=0;t.moveTo(l[0]*(s*i[0]-n),l[1]*(s*i[1]-o));var p=false;var I,B;var g=e.e.length-1;for(var S=g;S--;){h=i.ot;B=(h[0]>a[1])-(h[0]<a[0]);I=(h[1]>a[3])-(h[1]<a[2]);if(p){if(B==0&&I==0){if(d&&v){if(c=this.GetNextLinePoint(i,f,a,_[2]?d:v,_[2])){t.lineTo(l[0]*(s*c[0]-n),l[1]*(s*c[1]-o))}}c=this.GetNextPoint(h,i,a,d,v);t.lineTo(l[0]*(s*c[0]-n),l[1]*(s*c[1]-o));t.lineTo(l[0]*(s*h[0]-n),l[1]*(s*h[1]-o));p=false}else{if(_[2]){if(d!=B){_=this.doCornerConnection(t,n,o,s,i,h,a,d,v,B,I,true,l)}}else if(v!=I){_=this.doCornerConnection(t,n,o,s,i,h,a,v,d,I,B,false,l)}d=B;v=I}}else if(B==0&&I==0){t.lineTo(l[0]*(s*h[0]-n),l[1]*(s*h[1]-o))}else{_=this.GetNextPoint(i,h,a,B,I);t.lineTo(l[0]*(s*_[0]-n),l[1]*(s*_[1]-o));p=true}u=h.li;m=r[u.ot];i=m.p;d=B;v=I}if(p){if(d&&v){if(c=this.GetNextLinePoint(i,f,a,_[2]?B:I,_[2])){t.lineTo(l[0]*(s*c[0]-n),l[1]*(s*c[1]-o))}}c=this.GetNextPoint(f,i,a,d,v);t.lineTo(l[0]*(s*c[0]-n),l[1]*(s*c[1]-o))}},FindEndPointInBorders:function(t,e,i,r){var a=t.e.length;var s,n,o;while(a){if(i[0]>=r[0]&&i[0]<=r[1]&&i[1]>=r[2]&&i[1]<=r[3]){return i}s=i.ot;n=s.li;o=e[n.ot];i=o.p;a--}return undefined},RenderShadowArea:function(t,e,i,r,a,s,n,o,l,h,m,u,_){var c=this.m_Scene.m_Ctx.m_Clustering;var f;if(e.ei!=undefined&&!_){this.RenderShadowArea(t,e,i,r,a,s,n,o,l,h,m,u,true);f=c.createEdgeIndex(i,e.ei);t.strokeStyle="rgba(0,0,0,0)"}else{f=c.createEdgeIndex(i,e.e);t.strokeStyle=n}var d=this.GetRefBorders(e,r,a,l);t.lineWidth=s;t.beginPath();var v=this.FindEndPointInBorders(e,f,f[0].p,d);if(v==undefined){this.RenderAreaFromBox(t,e,i,d,l,h,m,u)}else{this.RenderAreaFromEdges(t,e,v,f,d,l,h,m,u)}t.closePath();if(!_&&o!=undefined){t.fillStyle=o;t.fill()}t.stroke()},RenderShadow:function(t,e,i,r,a,s,n,o){var l=this.m_Scene.GetZoomFactor4Mode();if(r.sCol){t.strokeStyle=r.sCol;t.lineWidth=2;t.lineCap="round";var h=r.sSize;if(h==-1){if(e.cnt>100){h=1}else if(e.cnt>30){h=2}else{h=3}}if(h){this.RenderShadowDot(t,e,s,n,o,h,l)}}if(r.permArea&&e.grI>1||e.e==undefined||a<e.lod-4&&e.c==undefined){return}if(r.bCol){var m=r.baseConf.m_ref;var u=r.baseConf.m_lod;if(r.bCol3){if(e.c&&e.c.lod==u-1){this.RenderShadowArea(t,e.c,i,m*2,u-1,1,r.bCol3,r.fCol3,s,n,o,l)}else{this.RenderShadowArea(t,e,i,m*2,u-1,1,r.bCol3,r.fCol3,s,n,o,l)}}this.RenderShadowArea(t,e,i,m,u,r.bSize,r.bCol,r.fCol,s,n,o,l);if(r.bCol2&&e.bw){if(a==e.lod){for(var _=0;_<e.bw.length;_++){var c=e.bw[_];if(c.e.length>0){this.RenderShadowArea(t,c,i,m/2,u+1,1,r.bCol2,r.fCol2,s,n,o,l)}}}else{this.RenderShadowArea(t,e,i,m/2,u+1,1,r.bCol2,r.fCol2,s,n,o,l)}}}}};VBI.VisualObjects.Spot=function(){this.m_fHotScale=1.2;this.load=function(t,e){Object.getPrototypeOf(this).load.call(this,t,e);this.m_Props.push(this.m_DataSource=new VBI.NodeProperty(t,"datasource",null,e));this.m_Props.push(this.m_Pos=new VBI.AttributeProperty(t,"pos",this.m_DataSource,e));this.m_Props.push(this.m_Image=new VBI.AttributeProperty(t,"image",this.m_DataSource,e));this.m_Props.push(this.m_ImageSelected=new VBI.AttributeProperty(t,"imageSelected",this.m_DataSource,e,null));this.m_Props.push(this.m_Icon=new VBI.AttributeProperty(t,"icon",this.m_DataSource,e));this.m_Props.push(this.m_Text=new VBI.AttributeProperty(t,"text",this.m_DataSource,e));this.m_Props.push(this.m_Tooltip=new VBI.AttributeProperty(t,"tooltip",this.m_DataSource,e,this.m_defaultTooltip));this.m_Props.push(this.m_Scale=new VBI.AttributeProperty(t,"scale",this.m_DataSource,e,[1,1,1]));this.m_Props.push(this.m_Alignment=new VBI.AttributeProperty(t,"alignment",this.m_DataSource,e,"5"));this.m_Props.push(this.m_ContentColor=new VBI.AttributeProperty(t,"contentColor",this.m_DataSource,e,"rgb(0,0,0)"));this.m_Props.push(this.m_ContentOffset=new VBI.AttributeProperty(t,"contentOffset",this.m_DataSource,e,[0,0,0]));this.m_Props.push(this.m_ContentFont=new VBI.AttributeProperty(t,"contentFont",this.m_DataSource,e,"arial"));this.m_Props.push(this.m_ContentSize=new VBI.AttributeProperty(t,"contentSize",this.m_DataSource,e,null));this.BaseLoad(t,e,this)};this.DetailHitTest=function(t,e,i,r){var a,s,n;var o=t.m_Ctx;var l=e;var h=null;var m=null;s=this.IsHot(l,o);if(this.bUsePreData){var u=this.m_Scene.m_PreassembledData.base[this.m_nPreDataIndex];var _=this.m_BBRefs[e];if(_.cI!=undefined){u=this.m_Scene.m_PreassembledData.clust[_.cI]}var c=u[_.i];a=c.im;if(s){h=c.hcol}n=c.s}else{this.m_DataSource.Select(l);a=this.m_Image.GetValueString(o);if(s){h=this.m_HotDeltaColor.GetValueString(o)}n=this.IsSelected(o);if(n){m=this.m_HotDeltaColor.GetValueString(o)}}var f,d=0;if(f=o.GetResources().GetImageBits(a,h,m)){var v=f[0];var p=this.m_BB[e];var I=p[2]-p[0];var B=p[3]-p[1];var g=Math.floor((i-p[0])/I*f[1]);var S=Math.floor((r-p[1])/B*f[2]);d=v[(S*f[1]+g)*4+3]}return d>0?{m_hit:d==255?1:2}:null};this.MatchIcon=function(e){var i={};if(e){switch(e){case"A8":i.i="";i.f="SAP-icons";break;case"7T":i.i="";i.f="SAP-icons";break;case"7R":i.i="";i.f="SAP-icons";break;case"7Q":i.i="";i.f="SAP-icons";break;case"13":i.i="";i.f="SAP-icons";break;case"89":i.i="";i.f="SAP-icons";break;case"5X":i.i="";i.f="VBI-Icons";break;case"7S":i.i="";i.f="VBI-Icons";break;default:i.f="SAP-icons";if(e.charCodeAt(0)>255){i.i=e}else{var r=t.getIconInfo(e);if(r){i.i=r.content;i.f=r.fontFamily}}break}}return i};this.GetHitArray=function(t,e,i){var r=this.m_Scene.GetStretchFactor4Mode();var a=t/r[0];var s=e/r[0];var n={m_cb:this.DetailHitTest.bind(this),m_Ctx:this.m_Scene.m_Ctx,m_All:i};return this.BaseHitTest(a,s,n)};this.GetLabelPos=function(t,e,i,r){var a=parseInt(r!=undefined?r:"5",10);switch(a){case 0:return{left:t[0]-e/2,top:t[1]-i/2};case 8:return{left:t[0],top:t[1]};case 1:return{left:t[0]-e/2,top:t[1]};case 2:return{left:t[0]-e,top:t[1]};case 3:return{left:t[0]-e,top:t[1]-i/2};case 4:return{left:t[0]-e,top:t[1]-i};case 6:return{left:t[0],top:t[1]-i};case 7:return{left:t[0],top:t[1]-i/2};case 5:default:return{left:t[0]-e/2,top:t[1]-i}}};this.RenderThisInstance=function(t,e,i,r,a,s,n,o,l,h,m,u,_,c){if(VBI.m_bTrace){VBI.Trace("Spot: RenderThisInstance")}var f;var d=this.m_Scene;var v=d.GetZoomFactor4Mode();if(t.c!=undefined&&i.anim&&l>i.animLow&&h&&t.c!=undefined&&t.c.lod==l-1){var p=t.c;var I=h*h;f=[v[0]*(m*(t[0]*(1-I)+p[0]*I)-u),v[1]*(m*(t[1]*(1-I)+p[1]*I)-_)];if(i.anim==2){var B=[v[0]*(m*p[0]-u),v[1]*(m*p[1]-_)];var g=2*Math.abs(.5-h);var S=""+(1-g);n.strokeStyle="rgba(110,110,110,"+S+")";n.lineWidth=2;n.lineCap="round";n.beginPath();n.moveTo(f[0],f[1]);n.lineTo(B[0],B[1]);n.stroke()}}else{f=[v[0]*(m*t[0]-u),v[1]*(m*t[1]-_)]}var b=d.m_Ctx.GetResources().GetImage(t.s&&t.simag?t.simag:t.im,t.s?t.scol:null,t.h?t.hcol:null,d.RenderAsync.bind(d));var V=t.sc;var P=t.tx;var D=t.ic;var C=t.ctfont;if(!b){return false}var G=t.fs&&t.fz&&(t.cnt!=undefined?""+t.cnt:undefined);var x=d.GetStretchFactor4Mode();var y=b.naturalWidth*V[0]/x[0];var T=b.naturalHeight*V[1]/x[1],A=T;if(t.h){if(t.hscale!=undefined){y=y*t.hscale[0];T=T*t.hscale[1]}}var O=this.GetLabelPos(f,y,T,t.al);var w=this.m_IO[a]=d.GetCorrectedInstanceOffsets(this.m_BB[a]=[O.left,O.top,O.left+y,O.top+T],v);if(!w.length){return false}this.m_BBRefs.push({cI:r,i:s});if(t.h){d.VerifyHotItem(this,this.m_BBRefs.length-1)}this.m_BB[a].nI=s;if(this.IsPosChangeable(d.m_Ctx)){var L=this.m_DH[a]=[];if(this.IsHandleMode()){L.m_EditMode=VBI.EMHandle;L.push(f)}else if(this.IsBoxMode()){L.m_EditMode=VBI.EMBox;L.push(this.m_BB[a])}}var M,H;if(P){H=Math.floor((t.ctsz?t.ctsz:12)*T/b.naturalHeight);VBI.Utilities.SetTextAttributes(n,H.toString()+"px "+C,t.ctcol,t.ctcol,"center","middle");M=P}else if(D){var R=this.MatchIcon(D);if(R&&R.i&&R.f){H=Math.floor((t.ctsz?t.ctsz:16)*T/b.naturalHeight);VBI.Utilities.SetTextAttributes(n,(H?H:16).toString()+"px "+R.f,t.ctcol,t.ctcol,"center","middle");M=R.i}}var E,F;for(F=0;F<w.length;++F){E=w[F];if(i&&(t.h||i.permArea)){this.RenderShadow(o,t,e,i,l,m,u-E,_)}n.drawImage(b,O.left+E,O.top,y,T);if(M){var k=[0,0,0];if(t.ctoffs&&t.ctoffs.length){k=t.ctoffs}var j=k[0]*V[0]/x[0];var N=k[1]*V[1]/x[1];if(t.h&&t.hscale!=undefined){j*=t.hscale[0];N*=t.hscale[1]}n.fillText(M,O.left+E+j+y/2,O.top+N+T/2)}}if(G){var U=t.fz?t.fz*T/b.naturalHeight:Math.floor(A/t.fs);VBI.Utilities.SetTextAttributes(n,U.toString()+"px "+t.f,t.fc,t.fc,"left","alphabetic");for(F=0;F<w.length;++F){E=w[F];n.fillText(G,y+O.left+E+t.fo/x[0],O.top+t.foy/x[1]+(T+U/1.5)/2)}}if(c==true){if(t.label&&w.length){var W={pa:[f[0],f[1],f[2]],bb:null};this.m_Label.push(new VBI.Label(t.label,a,this.CalculateLabelPos,W,this.m_BB[a],w))}}return true};this.RenderInstance=function(t,e,i,r,a,s,n,o,l){if(VBI.m_bTrace){VBI.Trace("Spot: RenderInstance")}if(!r){return}var h=this.m_Scene;var m=h.GetZoomFactor4Mode();var u=h.GetStretchFactor4Mode();var _=h.GetPointFromPos(i,true);var c=r.naturalWidth*s[0]/u[0];var f=r.naturalHeight*s[1]/u[1];var d=this.GetHotScale(h.m_Ctx);if(n){c=Math.round(c*d[0]);f=Math.round(f*d[1])}var v=this.GetLabelPos(_,c,f,this.m_Alignment.GetValueString(h.m_Ctx));var p=this.m_IO[t]=h.GetCorrectedInstanceOffsets(this.m_BB[t]=[v.left,v.top,v.left+c,v.top+f],m);if(this.IsPosChangeable(h.m_Ctx)){var I=this.m_DH[t]=[];if(this.IsHandleMode()){I.m_EditMode=VBI.EMHandle;I.push(_)}else if(this.IsBoxMode()){I.m_EditMode=VBI.EMBox;I.push(this.m_BB[t])}}var B=this.m_ContentColor.GetValueString(h.m_Ctx);var g=this.m_ContentOffset.GetValueVector(h.m_Ctx);var S=this.m_ContentFont.GetValueString(h.m_Ctx);var b=this.m_ContentSize.GetValueLong(h.m_Ctx);var V;if(a){if(!b){b=12}b=b*f/r.naturalHeight;VBI.Utilities.SetTextAttributes(e,Math.floor(b).toString()+"px "+S,B,B,"center","middle");V=a}else if(l){if(!b){b=16}b=b*f/r.naturalHeight;var P=this.MatchIcon(l);if(P&&P.i&&P.f){VBI.Utilities.SetTextAttributes(e,Math.floor(b).toString()+"px "+P.f,B,B,"center","middle");V=P.i}}for(var D=0;D<p.length;++D){var C=p[D];e.drawImage(r,v.left+C,v.top,c,f);if(V){var G=g[0]*s[0]/u[0];var x=g[1]*s[1]/u[1];if(n){G*=d[0];x*=d[1]}e.fillText(V,v.left+C+c/2+G,v.top+f/2+x)}}if(o&&p.length){var y={pa:[_[0],_[1],_[2]],bb:null};this.m_Label.push(new VBI.Label(o,t,this.CalculateLabelPos,y,this.m_BB[t],p))}};this.CalculateLabelPos=function(t,e,i){var r=Math.floor(e.pa.length/3)*3,a=[],s=t.GetViewport();for(var n=0;n<r;n+=3){var o=[e.pa[n]+i,e.pa[n+1]];if(o[0]>s[0]&&o[0]<s[2]&&o[1]>s[1]&&o[1]<s[3]){a.push(o)}}return a.length?a:null};this.Init4Render=function(){this.m_BB=[];this.m_IO=[];this.m_DH=[];this.m_BBRefs=[]};this.Render=function(t,e,i,r,a,s){var n=this.m_Scene;this.SwitchPreDataRendering(i!=undefined);var o;if(this.bUsePreData){if(i.m_nNumIgnore!=undefined&&i.m_nNumIgnore==i.length){return 0}var l=s?false:true;o=this.m_BB.length;var h=n.m_Canvas[0].m_nExactLOD;var m=n.m_Canvas[0].m_nCurrentX*n.m_MapManager.m_tileWidth;var u=n.m_Canvas[0].m_nCurrentY*n.m_MapManager.m_tileHeight;var _=i.config;var c=i.cI;var f=i.m_TreeFatherNode;var d;if(f){d=Math.ceil(h);var v=this.GetAnimClusterDistance(d,h);o=this.RenderTree(f,i.m_edges,_,c,o,d,v,e,a,i.m_lodOffset,m,u,false)}else{d=n.m_Canvas[0].m_nCurrentLOD;var p=i.length;var I=i.m_lodOffset;for(var B=0;B<p;++B){var g=i[B];if(!g.b2Ignore){if(this.RenderThisInstance(g,i.m_edges,_,c,o,B,e,a,d,0,I,m,u,l)){this.SetClusteredRichTooltip(g);o++}}}}}else{var S=n.m_Ctx;var b,V;if(b=this.m_DataSource.GetCurrentNode(S)){var P=b.m_dataelements.length;for(var D=0;D<P;++D){this.m_DataSource.Select(D);var C=this.IsHot(D);var G=this.IsSelected(S);var x=this.m_Pos.GetValueVector(S);var y=this.m_Image.GetValueString(S);if(G&&(V=this.m_ImageSelected.GetValueString(S))){y=V}var T=this.m_Text.GetValueString(S);var A=this.m_Icon.GetValueString(S);var O=this.m_Scale.GetValueVector(S);var w=S.GetResources().GetImage(y,G?this.m_SelectColor.GetValueString(S):null,C?this.m_HotDeltaColor.GetValueString(S):null,n.RenderAsync.bind(n));this.RenderInstance(D,e,x,w,T,O,C,this.GetLabel(S),A);this.SetRichTooltip(C)}}}this.BaseRender(t,e);return o};this.DesignBeginDrag=function(t){t.m_ScaleOrig=this.m_Scale.GetValueVector(this.m_Scene.m_Ctx).slice(0);t.m_DhOrig=this.m_DH[t.m_Index].slice(0);if(t.m_IO){t.m_DhOrig[0][0]+=t.m_IO;t.m_DhOrig[0][2]+=t.m_IO}};this.DesignGetActiveBoxHandles=function(t){return[1,1,1,1,0,1,0,0,0]};this.InternalChangeHotItem=function(t,e,i){if(this.bUsePreData){var r=this.m_BBRefs[t];if(r!=undefined){var a=r.cI!=undefined?this.m_Scene.m_PreassembledData.clust[r.cI]:this.m_Scene.m_PreassembledData.base[this.m_nPreDataIndex];if(a[r.i]!=undefined){a[r.i].h=e;this.m_HotClusterVO=e&&a[r.i].isCl?a[r.i]:undefined}if(i){i.cI=e?r.cI:undefined;i.nI=e?r.i:undefined}}}};this.BaseIsHot=this.IsHot;this.PreDataIsHot=function(t,e){var i=this.m_BBRefs[t];var r=i.cI!=undefined?this.m_Scene.m_PreassembledData.clust[i.cI]:this.m_Scene.m_PreassembledData.base[this.m_nPreDataIndex];return r[i.i].h};this.BaseGetEntity=this.GetEntity;this.PreDataGetEntity=function(t,e){this.m_DataSource.Select(t);return this.m_Entity.GetValueString(e)};this.SwitchHotItemToStandard=function(){var t=this.m_Scene;var e=this.m_BBRefs[t.m_HotItem.m_Index];var i=e.cI!=undefined?this.m_Scene.m_PreassembledData.clust[e.cI]:this.m_Scene.m_PreassembledData.base[this.m_nPreDataIndex];var r=i[e.i];if(r){if(r.isCl==true){t.InternalSetHotItem(null,null);return r}else{t.m_HotItem.m_Index=r.nI;if(t.m_HotItem.m_HitObj){t.m_HotItem.m_HitObj.m_Index=r.nI}return undefined}}};this.IsClusterable=function(){return true};this.GetDataIndex=function(t){if(this.bUsePreData){var e=this.m_BBRefs[t];if(e!=undefined){var i=e.cI==undefined?this.m_Scene.m_PreassembledData.base[this.m_nPreDataIndex]:this.m_Scene.m_PreassembledData.clust[e.cI];var r=i[e.i];if(r!=undefined){return r.nI}}}return t};this.GetPreassembledElement=function(t){var e=this.m_BBRefs[t];if(e==undefined){return undefined}var i=e.cI==undefined?this.m_Scene.m_PreassembledData.base[this.m_nPreDataIndex]:this.m_Scene.m_PreassembledData.clust[e.cI];return i[e.i]};this.GetInternalIndex=function(t){if(this.bUsePreData){return this.m_BBRefs[t]}return t};this.getTooltip=function(t,e){this.m_DataSource.Select(this.GetDataIndex(e.m_Index));return this.m_Tooltip.GetValueString(t)};this.DesignBoxSize=VBI.Utilities.SceneBindDesignSpotBoxSize.bind(this)};VBI.VisualObjects.Spot.prototype=VBI.VisualObjects.Base;VBI.VisualObjects.Route=function(){this.m_LP=[];this.load=function(t,e){Object.getPrototypeOf(this).load.call(this,t,e);this.m_Props.push(this.m_DataSource=new VBI.NodeProperty(t,"datasource",null,e));this.m_Props.push(this.m_Pos=new VBI.AttributeProperty(t,"posarray",this.m_DataSource,e));this.m_Props.push(this.m_Scale=new VBI.AttributeProperty(t,"scale",this.m_DataSource,e));this.m_Props.push(this.m_Color=new VBI.AttributeProperty(t,"color",this.m_DataSource,e,this.m_defaultColor));this.m_Props.push(this.m_Start=new VBI.AttributeProperty(t,"start",this.m_DataSource,e,0));this.m_Props.push(this.m_End=new VBI.AttributeProperty(t,"end",this.m_DataSource,e,0));this.m_Props.push(this.m_Tooltip=new VBI.AttributeProperty(t,"tooltip",this.m_DataSource,e,this.m_defaultTooltip));this.m_Props.push(this.m_LineWidth=new VBI.AttributeProperty(t,"linewidth",this.m_DataSource,e,6));this.m_Props.push(this.m_DotColor=new VBI.AttributeProperty(t,"dotcolor",this.m_DataSource,e,this.m_defaultColor));this.m_Props.push(this.m_DotBorderColor=new VBI.AttributeProperty(t,"dotbordercolor",this.m_DataSource,e,this.m_defaultColor));this.m_Props.push(this.m_ColorBorder=new VBI.AttributeProperty(t,"colorBorder",this.m_DataSource,e,null));this.m_Props.push(this.m_LineDash=new VBI.AttributeProperty(t,"lineDash",this.m_DataSource,e,null));this.m_Props.push(this.m_DotWidth=new VBI.AttributeProperty(t,"dotwidth",this.m_DataSource,e,0));this.m_Props.push(this.m_Tri=new VBI.AttributeProperty(t,"directionIndicator",this.m_DataSource,e,0));this.BaseLoad(t,e,this)};this.DrawArrow=function(t,e,i,r,a,s,n){if(e.length<3||Math.max(e[0][0],e[1][0],e[2][0])<a||Math.max(e[0][1],e[1][1],e[2][1])<0||Math.min(e[0][0],e[1][0],e[2][0])>s||Math.min(e[0][1],e[1][1],e[2][1])>n){return}t.beginPath();t.moveTo(e[0][0],e[0][1]);t.lineTo(e[1][0],e[1][1]);t.lineTo(e[2][0],e[2][1]);t.lineTo(e[0][0],e[0][1]);t.closePath();if(r){t.strokeStyle=r;t.lineWidth=2;t.stroke()}t.fillStyle=i;t.fill()};this.CalcTriangle=function(t,e,i,r,a,s,n,o){var l=e[0]-t[0];var h=e[1]-t[1];while(Math.abs(l)>1e3&&Math.abs(h)>1e3){l/=1e3;h/=1e3}var m=Math.sqrt(l*l+h*h);var u=l*i/m;var _=h*i/m;var c=l*r/2/m;var f=h*r/2/m;var d,v;if(n){d=l*o/2/m;v=h*o/2/m}var p=t[0]+u;var I=t[1]+_;if(!s){a.ta=[[t[0],t[1]],[p+f,I-c],[p-f,I+c]];a.pt=[p,I,0];if(n){a.int=[[p+v,I-d],[p-v,I+d]]}}else{a.ta=[[p,I,0],[t[0]+f,t[1]-c],[t[0]-f,t[1]+c]];a.pt=[t[0],t[1]];if(n){a.int=[[t[0]+v,t[1]-d],[t[0]-v,t[1]+d]]}}};this.getArrowLength=function(t){return Math.min(15,t*5)};this.getArrowWidth=function(t){return Math.min(Math.max(8,t*3),t+8)};this.CalcArrowIntermediate=function(t,e,i,r,a,s,n){var o=e;var l=false;var h=i;var m=this.getArrowWidth(r);var u=this.getArrowLength(r);var _=u*u;var c=0;var f,d,v;var p=[0,0,0];var I;var B;v=0;if(a){I={};c=0;for(B=h;B<t.length;++B){p=t[B];f=o[0]-p[0];d=o[1]-p[1];v=f*f+d*d;if(v>_){this.CalcTriangle(o,p,u,m,I,false,n,r);t.m_aArrows.push(I);l=true;break}else{c++}}if(I.pt){t.splice(h,c,o,I.pt);h=h+2;o=I.pt}}if(s){var g=true;var S=o;var b=t[h];var V=this.getArrowWidth(r);var P=0;var D;o=[];while(g&&h<t.length){f=b[0]-S[0];d=b[1]-S[1];D=Math.sqrt(f*f+d*d);if(P+D>V){g=false;var C=f/(P+D)*V;var G=d/(P+D)*V;o=[S[0]+C,S[1]+G,0]}else{P+=D;h++;S=b;b=t[h]}}if(o.length){I={};c=0;for(B=h;B<t.length;++B){p=t[B];f=o[0]-p[0];d=o[1]-p[1];v=f*f+d*d;if(v>_){this.CalcTriangle(o,p,u,m,I,true,n,r);t.m_aArrows.push(I);l=true;break}else{c++}}if(I.pt){t.splice(h,c,o,[I.ta[0][0],I.ta[0][1],0]);h=h+2}}}if(l){return h-1}return-1};this.CalcArrow=function(t,e,i,r,a,s){var n=this.getArrowWidth(r);var o=this.getArrowLength(r);var l=t.length/3;var h,m,u=o*o;if((h=e[0]-i[0])*h+(m=e[1]-i[1])*m<u){return false}var _,c;var f,d=[0,0,0];var v=false;c=a?3*(l-1):0;f=[t[c],t[c+1],0];var p=3*l;for(_=3;_<p;_+=3){c=a?p-3-_:_;d=[t[c],t[c+1],0];if((h=f[0]-d[0])*h+(m=f[1]-d[1])*m>u){v=true;break}}if(!v){return false}this.CalcTriangle(f,d,o,n,s,false,false,0);s.idx=c;return true};this.CalculateLabelPos=function(t,e,i){var r=VBI.Utilities.GetMidpointsForLine(e.pa,i,t.GetViewport());return r.aPos};this.LassoSelect=function(t,e,i){var r,a,s;var n=false;for(var o=this.m_LP.length-1;o>=0;--o){r=this.m_LP[o];s=this.m_IO[o];var l=false;for(var h=0;h<s.length;++h){if(l){break}for(var m=0;m<r.length;++m){a=r[m];if(!(l=VBI.Utilities.pointInPolygon(t,a[0]+s[h],a[1]))){break}}}if(l){e.push(o);i.push(o);n=true}}return n};this.RenderInstance=function(t,e,i,r){var a=this.m_Scene.GetZoomFactor4Mode();this.m_LP[t]=[];var s;if(this.IsPosChangeable(r)){this.m_DH[t]=[];if(this.IsHandleMode()){s=VBI.EMHandle}else if(this.IsBoxMode()){s=VBI.EMBox}}var n=this.IsSelected(r);var o=this.m_Pos.GetValueVector(r);var l=this.m_Scene;if(o.cache==undefined){l.FillPositionCache(o)}var h=this.m_Color.GetValueColor(r);if(n){h=this.GetSelectColor(r,h)}if(i){h=this.GetHotColor(r,h)}var m=this.m_Start.GetValueLong(r);var u=this.m_End.GetValueLong(r);var _=this.m_Tri.GetValueLong(r);var c=this.m_LineWidth.GetValueFloat(r);if(i){c*=this.GetHotScale(r)[0]}var f=this.m_DotColor.GetValueColor(r);if(n){f=this.GetSelectColor(r,f)}if(i){f=this.GetHotColor(r,f)}var d=this.m_DotBorderColor.GetValueColor(r);var v=this.m_ColorBorder.GetValueColor(r);if(n){d=this.GetSelectColor(r,d);v=this.GetSelectColor(r,v)}if(i){d=this.GetHotColor(r,d);v=this.GetHotColor(r,v)}var p=this.m_LineDash.GetValueString(r);var I=this.m_DotWidth.GetValueFloat(r);var B=this.GetLabel(r);var g=l.GetNearestPosArray(o);var S=l.GetPointFromPos([g.m_MinX,g.m_MaxY,0],false);var b=l.GetPointFromPos([g.m_MaxX,g.m_MinY,0],false);var V=Math.max(c,I/2);var P=this.m_IO[t]=l.GetCorrectedInstanceOffsets(this.m_BB[t]=[S[0]-V,S[1]-V,b[0]+V,b[1]+V],a);if(P.length){var D=l.GetPointArrayFromUCSArray(o.cache.data);if(s!=undefined){this.m_DH[t]=this.FillDesignHandles(D,s,t)}for(var C=0,G=P.length;C<G;++C){e.setTransform(1,0,0,1,P[C],0);this.RenderRoute(t,e,D,S,b,h,m,u,_,c,f,d,v,p,I,P[C]);if(VBI.m_bTrace){VBI.Utilities.DrawFrameRect(e,"red",this.m_BB[t])}}e.setTransform(1,0,0,1,0,0);if(B){var x={pa:D,bb:[S,b]};this.m_Label.push(new VBI.Label(B,t,this.CalculateLabelPos,x,null,P))}}};this.FillDesignHandles=function(t,e,i){var r=[];if(e==VBI.EMHandle){var a=t.length;for(var s=0;s<a;s+=3){r.push([t[s],t[s+1]])}}else if(e==VBI.EMBox){r.push(this.m_BB[i])}r.m_EditMode=e;return r};this.RenderRoute=function(t,e,i,r,a,s,n,o,l,h,m,u,_,c,f,d){if(i.length<6){return}var v=-d,p=e.canvas.m_pixelWidth-d,I=e.canvas.m_pixelHeight;var B=r[0]>v&&r[1]>0&&a[0]<p&&a[1]<I;var g=this.m_LP[t];var S=3,b=i.length-3;var V=g.length?false:true;var P={},D={};if(h&&n&&this.CalcArrow(i,r,a,h,false,P)){this.DrawArrow(e,P.ta,s,_,v,p,I);S=P.idx;if(V){g.m_RS=P}}if(h&&o&&this.CalcArrow(i,r,a,h,true,D)){this.DrawArrow(e,D.ta,s,_,v,p,I);b=D.idx;if(V){g.m_RE=D}}if(V){this.CollectLinePoints(i,g,S,b,n,o,l,P,D,h,d,_?true:false)}var C=this.CheckLineDashing(c,e);if(h){this.DrawActualRoute(e,g,s,_,h,B,v,p,I)}if(f){this.DrawRouteDots(e,g,n,o,m,u,f/2,B,v,p,I)}if(C){e.setLineDash([])}if(g.m_aArrows&&g.m_aArrows.length){for(var G=0;G<g.m_aArrows.length;++G){this.DrawArrow(e,g.m_aArrows[G].ta,s,_,v,p,I);if(g.m_aArrows[G].int){var x=g.m_aArrows[G].int;e.beginPath();e.moveTo(x[0][0],x[0][1]);e.lineTo(x[1][0],x[1][1]);e.strokeStyle=s;e.lineWidth=2;e.stroke()}}}};this.CollectLinePoints=function(t,e,i,r,a,s,n,o,l,h,m,u){var _=Math.min(h*h/2,4);var c=this.m_Scene.GetViewport();e.m_aArrows=[];var f=o.pt?[o.pt[0],o.pt[1],0]:[t[0],t[1],0];var d=l.pt?[l.pt[0],l.pt[1],0]:[t[r],t[r+1],0];var v,p,I,B=f;e.push(B);for(var g=i;g<=r;g+=3){I=[t[g],t[g+1],0];if((v=B[0]-I[0])*v+(p=B[1]-I[1])*p>_){e.push(I);B=I}}if(l.pt){e.push(l.pt)}if((a||s)&&n&&h&&this.CheckTriangleRendering()){if(!(f[0]>=c[0]&&f[0]<=c[2]&&f[1]>=c[1]&&f[1]<=c[3]&&d[0]>=c[0]&&d[0]<=c[2]&&d[1]>=c[1]&&d[1]<=c[3])){this.CalculateRouteArrows(e,a,s,h,m,u)}}};this.CheckTriangleRendering=function(){var t=this.m_Scene;var e=t.m_Canvas[0].m_nExactLOD;return t.m_bNonIntPosStable||e==Math.floor(e)||e<=t.m_CacheVars.minLOD+.01};this.CheckLineDashing=function(t,e){var i=this.m_Scene;var r=i.m_Canvas[0].m_nExactLOD;if(t&&e.setLineDash&&(i.m_bNonIntPosStable||r==Math.floor(r)||r<=i.m_CacheVars.minLOD+.01)){var a=t.split(";");e.setLineDash(a);return true}return false};this.DrawActualRoute=function(t,e,i,r,a,s,n,o,l){if(r){t.strokeStyle=r;t.lineWidth=a+2;t.lineJoin="round";t.lineCap="butt"}else{t.strokeStyle=i;t.lineWidth=a;t.lineJoin=t.lineCap="round"}var h=true;if(s){t.beginPath();h=false;t.moveTo(e[0][0],e[0][1]);for(var m=1;m<e.length;++m){t.lineTo(e[m][0],e[m][1])}}else{var u,_;var c=this.m_Scene.m_TransitionTable;var f;var d=true;var v,p=e[0];if(p[1]<0){u=3}else{u=p[1]>l?6:0}if(p[0]<n){u++}else{u+=p[0]>o?2:0}for(var I=1;I<e.length;++I){v=e[I];if(v[1]<0){_=3}else{_=v[1]>l?6:0}if(v[0]<n){_++}else{_+=v[0]>o?2:0}f=c[u+9*_];if(f==1||f>1&&this.Check4Intersect(p,v,f,n,o,0,l)){if(h){t.beginPath();h=false}if(d){t.moveTo(p[0],p[1])}t.lineTo(v[0],v[1]);d=false}else{d=true;p=v}u=_}}if(!h){t.stroke();if(r){t.strokeStyle=i;t.lineWidth=a;t.stroke()}}};this.Check4Intersect=function(t,e,i,r,a,s,n){var o,l,h;var m=e[0]-t[0];var u=e[1]-t[1];if(i&20){h=i&4?n:s;l=(e[1]-h)/u;o=e[0]-m*l;if(o>=r&&o<=a){return true}}if(i&10){h=i&2?r:a;o=(e[0]-h)/m;l=e[1]-u*o;if(l>=s&&l<=n){return true}}return false};this.DrawRouteDots=function(t,e,i,r,a,s,n,o,l,h,m){t.fillStyle=a;t.strokeStyle=s;t.lineWidth=1;var u=i?1:0;var _=e.length-(r?2:1);var c=2*Math.PI;for(var f=u;f<=_;++f){var d=e[f];if(o||d[0]-n>l&&d[0]+n<h&&d[1]-n>0&&d[1]+n<m){t.beginPath();t.arc(d[0],d[1],n,0,c);t.closePath();t.fill();t.stroke()}}};this.CalculateRouteArrows=function(t,e,i,r,a,s){var n=250;var o=0;var l=0;var h,m,u,_;var c=this.m_Scene.m_Canvas[this.m_Scene.m_nOverlayIndex].width;var f=this.m_Scene.m_Canvas[this.m_Scene.m_nOverlayIndex].height;var d=[-a,0,-a+c,f];var v=false;var p=false;var I=true;var B=t[0];var g=t[1];u=1;while(I){if(B==undefined||g==undefined){if(VBI.m_bTrace){VBI.Trace("Wrong offset in CalculateRouteArrows")}break}v=VBI.Utilities.LineIntersectRect(B[0],B[1],g[0],g[1],d);if(v.bReturn==false){p=false;o=0;u++;if(u<t.length){B=g;g=t[u]}else{I=false}}else{if(v.x0!=B[0]||v.y0!=B[1]){B=[v.x0,v.y0,0];t.splice(u,0,B);u++;p=false}if(v.x1!=g[0]||v.y1!=g[1]){if(v.x1==B[0]&&v.y1==B[1]&&p){u+=2;if(u<t.length){B=t[u-1];g=t[u];p=false}else{I=false}}else{g=[v.x1,v.y1,0];t.splice(u,0,g);p=true}}h=g[0]-B[0];m=g[1]-B[1];_=Math.sqrt(h*h+m*m);l+=_;if(o+_>n){var S=h/_*(n-o);var b=m/_*(n-o);var V=[B[0]+S,B[1]+b,0];var P=this.CalcArrowIntermediate(t,V,u,r,e,i,s);if(P>=0){u=P+1;B=t[P];g=t[u];o=0}else{I=false}}else{o+=_;u++;if(u<t.length){B=g;g=t[u]}else{I=false}}}}};this.Init4Render=this.StandardInitWithLPs;this.Render=function(t,e,i){var r=this.m_Scene;var a=r.m_Ctx;var s;var n;if(s=this.m_DataSource.GetCurrentNode(a)){for(var o=0,l=s.m_dataelements.length;o<l;++o){this.m_DataSource.Select(o);if(this.IsHot(o)){n=o}else{this.RenderInstance(o,e,false,a)}this.SetRichTooltip(this.IsHot(o))}}if(n!=undefined){this.m_DataSource.Select(n);this.RenderInstance(n,e,true,a)}this.BaseRender(t,e)};this.DetailHitDot=function(t,e,i,r,a){var s,n;return(s=i-t)*s+(n=r-e)*n<a?true:false};this.DetailHitTest=function(t,e,i,r){var a,s,n,o;this.m_DataSource.Select(e);var l=this.m_LineWidth.GetValueLong(this.m_Scene.m_Ctx)/2;var h=this.m_DotWidth.GetValueLong(this.m_Scene.m_Ctx)/2;var m=l*l;var u=h*h;var _=this.m_LP[e];a=_[0][0];s=_[0][1];if(u&&this.DetailHitDot(i,r,a,s,u)){return{m_hit:1,m_dot:0}}var c=_.length;var f;for(f=1;f<c;++f){n=_[f][0];o=_[f][1];if(l&&!(i<Math.min(a,n)-l||i>Math.max(a,n)+l||r<Math.min(s,o)-l||r>Math.max(s,o)+l)&&m>VBI.Utilities.sqDistance(a,s,n,o,i,r)){if(VBI.m_bTrace){VBI.Trace("VBI.VisualObjects.Route hit line "+e)}return{m_hit:1}}if(u&&this.DetailHitDot(i,r,n,o,u)){if(VBI.m_bTrace){VBI.Trace("VBI.VisualObjects.Route hit dot "+e)}return{m_hit:1,m_dot:f}}a=n;s=o}if(_.m_aArrows){c=_.m_aArrows.length;for(f=0;f<c;++f){if(VBI.Utilities.pointInTriangle(_.m_aArrows[f].ta,[i,r])){return{m_hit:1}}}}if(_.m_RS&&VBI.Utilities.pointInTriangle(_.m_RS.ta,[i,r])){return{m_hit:1,m_arrow:0}}if(_.m_RE&&VBI.Utilities.pointInTriangle(_.m_RE.ta,[i,r])){return{m_hit:1,m_arrow:1}}return null};this.GetHitArray=function(t,e,i){var r={m_cb:this.DetailHitTest.bind(this),m_All:i};var a=this.m_Scene.GetStretchFactor4Mode();var s=t/a[0];var n=e/a[1];return this.BaseHitTest(s,n,r)};this.DesignBoxSize=VBI.Utilities.SceneBindPosArrayDesignBoxSize.bind(this)};VBI.VisualObjects.Route.prototype=VBI.VisualObjects.Base;VBI.VisualObjects.Circle=function(){this.load=function(t,e){Object.getPrototypeOf(this).load.call(this,t,e);this.m_Props.push(this.m_DataSource=new VBI.NodeProperty(t,"datasource",null,e));this.m_Props.push(this.m_Pos=new VBI.AttributeProperty(t,"pos",this.m_DataSource,e));this.m_Props.push(this.m_ColorBorder=new VBI.AttributeProperty(t,"colorBorder",this.m_DataSource,e,this.m_defaultColor));this.m_Props.push(this.m_Radius=new VBI.AttributeProperty(t,"radius",this.m_DataSource,e,5));this.m_Props.push(this.m_Tooltip=new VBI.AttributeProperty(t,"tooltip",this.m_DataSource,e,this.m_defaultTooltip));this.m_Props.push(this.m_Color=new VBI.AttributeProperty(t,"color",this.m_DataSource,e,this.m_defaultColor));this.m_Props.push(this.m_Slices=new VBI.AttributeProperty(t,"slices",this.m_DataSource,e,10));this.m_Props.push(this.m_AltColorBorder=new VBI.AttributeProperty(t,"altBorderDeltaColor",this.m_DataSource,e,null));this.BaseLoad(t,e,this)};this.CalculateLabelPos=function(t,e,i){var r=VBI.Utilities.GetMidpointForPolygon(e.pa,e.bb,i,t.GetViewport());if(r&&r.aPos){return r.aPos}return null};this.LassoSelect=this.LassoSelectCircle;this.RenderInstance=function(t,e,i,r,a,s,n,o){var l=this.m_Scene;var h;var m=l.GetStretchFactor4Mode();var u=l.GetZoomFactor4Mode();var _=s/m[0];var c=l.GetPointFromPos(i,false);var f;var d=this.m_IO[t]=l.GetCorrectedInstanceOffsets(f=this.m_BB[t]=[c[0]-_,c[1]-_,c[0]+_,c[1]+_],u);f.m_Radius=_;f.m_Pos=c;if(this.IsPosChangeable(l.m_Ctx)){var v=this.m_DH[t]=[];if(this.IsHandleMode()){v.m_EditMode=VBI.EMHandle;v.push(c)}else if(this.IsBoxMode()){v.m_EditMode=VBI.EMBox;v.push(f)}}e.lineWidth=1;e.fillStyle=r;for(h=0;h<d.length;++h){e.setTransform(1,0,0,1,d[h],0);e.beginPath();e.arc(c[0],c[1],_,0,2*Math.PI);e.closePath();e.fill();e.strokeStyle=a;e.stroke();if(VBI.m_bTrace){VBI.Utilities.DrawFrameRect(e,"red",this.m_BB[t])}}e.setTransform(1,0,0,1,0,0);if(o&&d.length){var p=[];var I=20;for(h=0;h<I;++h){var B=h*2*Math.PI/I;var g=c[0]+_*Math.sin(B);var S=c[1]+_*Math.cos(B);p.push(g,S)}var b={pa:p,bb:[[f[0],f[1]],[f[2],f[3]]]};this.m_Label.push(new VBI.Label(o,t,this.CalculateLabelPos,b,null,d))}};this.Init4Render=this.StandardInit;this.Render=function(t,e,i){var r=this.m_Scene.m_Ctx;var a=0;var s;if(s=this.m_DataSource.GetCurrentNode(r)){a=s.m_dataelements.length;for(var n=0;n<a;++n){this.m_DataSource.Select(n);var o=this.IsHot(n);var l=this.IsSelected(r);var h=this.m_Pos.GetValueVector(r);var m=this.m_Color.GetValueColor(r);if(l){m=this.GetSelectColor(r,m)}if(o){m=this.GetHotColor(r,m)}var u=this.m_ColorBorder.GetValueColor(r);if(l){u=this.GetSelectColor(r,u)}if(o){u=this.GetAltBorderColor(r,u)}var _=this.m_Radius.GetValueFloat(r);if(o){_=this.GetHotScale(r)[0]*_}var c=this.m_Slices.GetValueLong(r);this.RenderInstance(n,e,h,m,u,_,c,this.GetLabel(r));this.SetRichTooltip(o)}}this.BaseRender(t,e);return a};this.DetailHitTest=function(t,e,i,r){var a=this.m_BB[e];var s=a.m_Radius;var n=a.m_Pos;var o,l;if((o=n[0]-i)*o+(l=n[1]-r)*l<s*s){return{m_hit:1}}return null};this.GetHitArray=function(t,e,i){var r=this.m_Scene.GetStretchFactor4Mode();var a={m_cb:this.DetailHitTest.bind(this),m_zf:r,m_All:i};var s=t/r[0];var n=e/r[1];return this.BaseHitTest(s,n,a)};this.DesignGetActiveBoxHandles=function(t){var e=this.m_Scene;this.m_DataSource.Select(t);return this.m_Radius.IsChangeable(e.m_Ctx)?[0,1,0,1,0,1,0,1,0]:[0,0,0,0,0,0,0,0,0]};this.DesignBoxSize=VBI.Utilities.SceneBindRadiusDesignBoxSize.bind(this)};VBI.VisualObjects.Circle.prototype=VBI.VisualObjects.Base;VBI.VisualObjects.CircleDist=function(){this.load=function(t,e){Object.getPrototypeOf(this).load.call(this,t,e);this.m_Props.push(this.m_DataSource=new VBI.NodeProperty(t,"datasource",null,e));this.m_Props.push(this.m_Pos=new VBI.AttributeProperty(t,"midpoint",this.m_DataSource,e));this.m_Props.push(this.m_ColBorder=new VBI.AttributeProperty(t,"colorBorder",this.m_DataSource,e,this.m_defaultColor));this.m_Props.push(this.m_Radius=new VBI.AttributeProperty(t,"radius",this.m_DataSource,e,10));this.m_Props.push(this.m_Tooltip=new VBI.AttributeProperty(t,"tooltip",this.m_DataSource,e,this.m_defaultTooltip));this.m_Props.push(this.m_ColFill=new VBI.AttributeProperty(t,"color",this.m_DataSource,e,this.m_defaultColor));this.m_Props.push(this.m_Slices=new VBI.AttributeProperty(t,"slices",this.m_DataSource,e,10));this.m_Props.push(this.m_AltColorBorder=new VBI.AttributeProperty(t,"altBorderDeltaColor",this.m_DataSource,e,null));this.BaseLoad(t,e,this)};this.CalculateLabelPos=function(t,e,i){var r=VBI.Utilities.GetMidpointForPolygon(e.pa,e.bb,i,t.GetViewport());if(r&&r.aPos){return r.aPos}return null};this.LassoSelect=function(t,e,i){var r=[];var a,s;var n=false;for(var o=this.m_LP.length-1;o>=0;--o){var l=[];if(this.m_BB[o].m_bArcCircle){var h=this.m_BB[o].m_Pos;var m=this.m_BB[o].m_Radius;var u=20;for(var _=0;_<u;++_){s=_*2*Math.PI/u;r=[h[0]+m*Math.sin(s),h[1]+m*Math.cos(s)];l.push(r)}}else{l=this.m_LP[o]}a=this.m_IO[o];if(VBI.Utilities.polyInPolygon(t,l,a)){i.push(o);e.push(o);n=true}}return n};this.RenderCircleDist=function(t,e,i,r,a){var s=this.m_Scene;var n=this.m_LP[t];if(n.length){n=null}var o,l,h,m=s.GetPointFromGeo(i[0],false);var u=false;var _,c;var f=this.m_Scene.m_Ctx;var d=this.m_Pos.GetValueVector(f);var v=this.m_Radius.GetValueFloat(f);u=Math.abs(d[1]-45)<=10&&v<=1e4?true:false;if(u){var p=0;_=s.GetPointFromGeo(VBI.MathLib.DegToRad(d),false);for(var I=0;I<i.length;++I){h=s.GetPointFromGeo(i[I],false);p+=Math.sqrt((h[0]-_[0])*(h[0]-_[0])+(h[1]-_[1])*(h[1]-_[1]))}c=p/i.length;var B=this.m_BB[t];B[1]=_[1]-c;B[3]=_[1]+c;B.m_Radius=c;B.m_Pos=_;B.m_bArcCircle=true}e.strokeStyle=a;e.fillStyle=r;e.lineWidth=1;e.beginPath();if(!u){e.moveTo(m[0],m[1]);if(n){n.push(m)}for(var g=1;g<i.length;++g){h=s.GetPointFromGeo(i[g],false);if((o=m[0]-h[0])*o+(l=m[1]-h[1])*l<9){continue}if(n){n.push(h)}e.lineTo(h[0],h[1]);m=h}e.closePath()}else{e.arc(_[0],_[1],c,0,2*Math.PI)}e.stroke();e.fill()};this.RenderInstance=function(t,e,i,r,a,s,n,o){var l,h=this.m_Scene;var m=h.GetZoomFactor4Mode();var u=this.m_Scene.m_Canvas[0].m_nExactLOD;var _=Math.sqrt(u);var c=Math.log(s);var f=1/c;var d=2*Math.PI/f;n=d>n?d:n;var v=n*_;v=v<7?7:v;v=v>500?500:v;var p=VBI.MathLib.EquidistantLonLat(VBI.MathLib.DegToRad(i),s,v);if(this.m_Pos.IsChangeable(h.m_Ctx)){this.m_DH[t]=[h.GetPointFromPos(i,false)]}var I=h.GetPointFromGeo([p.m_MinX,p.m_MaxY,0],false);var B=h.GetPointFromGeo([p.m_MaxX,p.m_MinY,0],false);var g=this.m_IO[t]=h.GetCorrectedInstanceOffsets(l=this.m_BB[t]=[I[0],I[1],B[0],B[1]],m);if(this.IsPosChangeable(h.m_Ctx)){var S=this.m_DH[t]=[];if(this.IsHandleMode()){S.m_EditMode=VBI.EMHandle;S.push(h.GetPointFromPos(i,false))}else if(this.IsBoxMode()){S.m_EditMode=VBI.EMBox;S.push(l)}}for(var b=0;b<g.length;++b){e.setTransform(1,0,0,1,g[b],0);this.RenderCircleDist(t,e,p,r,a);if(VBI.m_bTrace){VBI.Utilities.DrawFrameRect(e,"red",this.m_BB[t])}}e.setTransform(1,0,0,1,0,0);if(o&&g.length){var V=[];for(var P=0;P<this.m_LP[t].length;++P){V.push(this.m_LP[t][P][0],this.m_LP[t][P][1])}var D={pa:V,bb:[I,B]};this.m_Label.push(new VBI.Label(o,t,this.CalculateLabelPos,D,null,g))}};this.Init4Render=this.StandardInitWithLPs;this.Render=function(t,e,i){var r=this.m_Scene.m_Ctx;var a;if(a=this.m_DataSource.GetCurrentNode(r)){for(var s=0,n=a.m_dataelements.length;s<n;++s){this.m_DataSource.Select(s);var o=this.IsHot(s);var l=this.IsSelected(r);var h=this.m_Pos.GetValueVector(r);var m=this.m_ColBorder.GetValueColor(r);if(l){m=this.GetSelectColor(r,m)}if(o){m=this.GetAltBorderColor(r,m)}var u=this.m_Radius.GetValueFloat(r);if(o){u=this.GetHotScale(r)[0]*u}var _=this.m_Slices.GetValueLong(r);var c=this.m_ColFill.GetValueColor(r);if(l){c=this.GetSelectColor(r,c)}if(o){c=this.GetHotColor(r,c)}this.m_LP[s]=[];this.RenderInstance(s,e,h,c,m,u,_,this.GetLabel(r));this.SetRichTooltip(o)}}this.BaseRender(t,e)};this.DetailHitTest=function(t,e,i,r){var a=this.m_BB[e];if(a.m_bArcCircle){var s=a.m_Radius;var n=a.m_Pos;var o,l;if((o=n[0]-i)*o+(l=n[1]-r)*l<s*s){return{m_hit:1}}return null}else{return VBI.Utilities.pointInPolygon(this.m_LP[e],i,r)?{m_hit:1}:null}};this.GetHitArray=function(t,e,i){var r=this.m_Scene.GetStretchFactor4Mode();var a=t/r[0];var s=e/r[1];var n={m_cb:this.DetailHitTest.bind(this),m_zf:r,m_All:i};return this.BaseHitTest(a,s,n)};this.DesignGetActiveBoxHandles=function(t){var e=this.m_Scene;this.m_DataSource.Select(t);return this.m_Radius.IsChangeable(e.m_Ctx)?[0,1,0,1,0,1,0,1,0]:[0,0,0,0,0,0,0,0,0]};this.DesignBoxSize=VBI.Utilities.SceneBindMeterRadiusDesignBoxSize.bind(this)};VBI.VisualObjects.CircleDist.prototype=VBI.VisualObjects.Base;VBI.VisualObjects.m_AC=["rgba(0,143,211,1.0)","rgba(153,209,1,1.0)","rgba(243,155,2,1.0)","rgba(159,207,236,1.0)","rgba(75,167,7,1.0)","rgba(246,209,51,1.0)","rgba(203,77,44,1.0)","rgba(202,199,186,1.0)","rgba(13,134,156,1.0)","rgba(205,215,46,1.0)","rgba(36,114,48,1.0)","rgba(108,222,220,1.0)","rgba(235,115,0,1.0)","rgba(185,187,209,1.0)","rgba(0,109,211,1.0)","rgba(61,185,127,1.0)","rgba(165,84,148,1.0)","rgba(1,88,43,1.0)","rgba(77,182,239,1.0)","rgba(175,43,23,1.0)","rgba(212,153,18,1.0)","rgba(187,204,210,1.0)","rgba(48,146,13,1.0)","rgba(29,169,193,1.0)","rgba(42,71,201,1.0)","rgba(209,153,194,1.0)","rgba(204,88,38,1.0)","rgba(114,191,68,1.0)","rgba(10,72,157,1.0)","rgba(151,156,163,1.0)","rgba(14,145,144,1.0)","rgba(97,32,154,1.0)"];VBI.VisualObjects.Pie=function(){this.load=function(t,e){Object.getPrototypeOf(this).load.call(this,t,e);this.m_Props.push(this.m_DataSource=new VBI.NodeProperty(t,"datasource",null,e));this.m_Props.push(this.m_Series=new VBI.NodeProperty(t,"series",this.m_DataSource,e));this.m_Props.push(this.m_Scale=new VBI.AttributeProperty(t,"scale",this.m_DataSource,e,[1,1,1]));this.m_Props.push(this.m_Pos=new VBI.AttributeProperty(t,"pos",this.m_DataSource,e));this.m_Props.push(this.m_Values=new VBI.AttributeProperty(t,"value",this.m_Series,e));this.m_Props.push(this.m_Texts=new VBI.AttributeProperty(t,"text",this.m_Series,e));this.m_Props.push(this.m_SliceColor=new VBI.AttributeProperty(t,"slicecolor",this.m_Series,e));this.m_Props.push(this.m_Tooltips=new VBI.AttributeProperty(t,"extooltip",this.m_Series,e,this.m_defaultTooltip));this.m_Props.push(this.m_Tooltip=new VBI.AttributeProperty(t,"tooltip",this.m_DataSource,e,this.m_defaultTooltip));this.m_Props.push(this.m_StartColor=new VBI.AttributeProperty(t,"startcolor",this.m_DataSource,e,0));this.BaseLoad(t,e,this)};this.LassoSelect=this.LassoSelectCircle;this.RenderInstance=function(t,e,i,r,a,s,n,o,l){var h=this.m_Scene;var m=h.GetZoomFactor4Mode();var u=h.m_Ctx;var _=0;var c;for(c=0;c<a.length;++c){_+=a[c]}this.m_SUM[t]=_;var f=h.GetPointFromPos(i,false);var d;var v=this.m_IO[t]=h.GetCorrectedInstanceOffsets(d=this.m_BB[t]=[f[0]-r,f[1]-r,f[0]+r,f[1]+r],m);d.m_Radius=r;d.m_Pos=f;if(this.IsPosChangeable(u)){var p=this.m_DH[t]=[];if(this.IsHandleMode()){p.m_EditMode=VBI.EMHandle;p.push(f)}else if(this.IsBoxMode()){p.m_EditMode=VBI.EMBox;p.push(d)}}this.m_ARC[t]=[3*Math.PI/2];var I=this.m_StartColor.GetValueLong(u);var B=VBI.VisualObjects.m_AC.length;for(var g=0;g<v.length;++g){e.setTransform(1,0,0,1,v[g],0);var S=3*Math.PI/2;for(c=0;c<a.length;++c){var b=e.createRadialGradient(f[0],f[1],0,f[0],f[1],r);var V=n[c];if(!V){V=VBI.VisualObjects.m_AC[(c+I)%B]}if(l){V=this.GetSelectColor(u,V)}if(c==o){V=this.GetHotColor(u,V)}b.addColorStop(0,V);b.addColorStop(.95,V);b.addColorStop(1,"rgba(255,255,255,0.0 )");e.fillStyle=b;e.beginPath();e.moveTo(f[0],f[1]);var P=Math.PI*2*(a[c]/_);e.arc(f[0],f[1],r,S,S+P,false);e.lineTo(f[0],f[1]);e.closePath();e.fill();S+=P;if(!g){this.m_ARC[t].push(S)}}}e.setTransform(1,0,0,1,0,0)};this.Init4Render=function(){this.m_BB=[];this.m_IO=[];this.m_DH=[];this.m_ARC=[];this.m_SUM=[]};this.Render=function(t,e,i){var r=this.m_Scene;var a=r.m_Ctx;var s=0;var n,o;if(n=this.m_DataSource.GetCurrentNode(a)){s=n.m_dataelements.length;for(var l=0;l<s;++l){this.m_DataSource.Select(l);var h=this.m_Pos.GetValueVector(a);var m=this.m_Scale.GetValueVector(a);var u=16*m[0];var _=this.IsHot(l);var c=this.IsSelected(a);if(_){u=this.GetHotScale(a)[0]*u}var f=[],d=[],v=[];if(o=this.m_Series.GetCurrentNode(a)){for(var p=0;p<o.m_dataelements.length;++p){this.m_Series.Select(p);f.push(this.m_Values.GetValueFloat(a));d.push(this.m_Texts.GetValueString(a));var I=this.m_SliceColor.GetValueString(a);v.push(I?this.m_SliceColor.GetValueColor(a):I)}}var B,g=_&&(B=r.m_HotItem.m_HitObj)&&(B=B.m_Detail)?B.m_slice:-1;this.RenderInstance(l,e,h,u,f,d,v,g,c);this.SetRichTooltip(_)}}this.BaseRender(t,e);return s};this.DetailHitTest=function(t,e,i,r){var a=this.m_BB[e];var s=a.m_Radius;var n=a.m_Pos;var o,l;if((o=n[0]-i)*o+(l=n[1]-r)*l<s*s){var h=Math.acos(l/Math.sqrt(o*o+l*l));var m=o<=0?3*Math.PI/2+h:7*Math.PI/2-h;var u=this.m_ARC[e];var _=0,c=u.length-1,f;while(c>_+1){f=Math.round((_+c)/2);if(u[f]>m){c=f}else{_=f}}return{m_hit:1,m_slice:_}}return null};this.GetHitArray=function(t,e,i){var r=this.m_Scene.GetStretchFactor4Mode();var a=t/r[0];var s=e/r[1];var n={m_cb:this.DetailHitTest.bind(this),m_All:i};return this.BaseHitTest(a,s,n)};this.doFormatedReplaces=function(t,e,i,r){var a=e.length;var s;while((s=t.indexOf(e))>=0){var n=s+t.substring(s+a).indexOf(i)+a+1;var o=t.substring(s+a,n-1);var l=false,h;if((h=o.indexOf(","))>=0){l=true}else{h=o.indexOf(".")}var m=Math.min(10,h>=0?parseInt(o.substring(h+1),10):0);var u=t.substring(s,n);var _=""+r.toFixed(m);if(l){_=_.replace(".",",")}t=t.replace(u,_)}return t};this.getTooltip=function(t,e){var i=e.m_Index;var r=e.m_Detail.m_slice;this.m_DataSource.Select(i);this.m_Series.Select(r);var a=this.m_Tooltips.GetValueString(t);if(a==""){a=this.m_Tooltip.GetValueString(t)}if(a===null||a===""){return""}a=a.replace(/%MAIN%/,this.m_Tooltip.GetValueString(t));a=a.replace(/%NUM%/g,r+1);a=a.replace(/%ONUM%/g,r+1);a=a.replace(/%NAME%/g,this.m_Texts.GetValueString(t));var s=parseFloat(this.m_Values.GetValueString(t));a=this.doFormatedReplaces(a,"%VALUE","%",s);a=this.doFormatedReplaces(a,"%PERCENTAGE","%",100*s/this.m_SUM[i]);return a};this.DesignBeginDrag=function(t){t.m_ScaleOrig=this.m_Scale.GetValueVector(this.m_Scene.m_Ctx).slice(0);t.m_DhOrig=this.m_DH[t.m_Index].slice(0);if(t.m_IO){t.m_DhOrig[0][0]+=t.m_IO;t.m_DhOrig[0][2]+=t.m_IO}};this.DesignBoxSize=VBI.Utilities.SceneBindDesignBoxBoxSize.bind(this,true)};VBI.VisualObjects.Pie.prototype=VBI.VisualObjects.Base;VBI.VisualObjects.Box=function(){this.load=function(t,e){Object.getPrototypeOf(this).load.call(this,t,e);this.m_Props.push(this.m_DataSource=new VBI.NodeProperty(t,"datasource",null,e));this.m_Props.push(this.m_Pos=new VBI.AttributeProperty(t,"pos",this.m_DataSource,e,[0,0,0]));this.m_Props.push(this.m_Scale=new VBI.AttributeProperty(t,"scale",this.m_DataSource,e,[1,1,1]));this.m_Props.push(this.m_Tooltip=new VBI.AttributeProperty(t,"tooltip",this.m_DataSource,e,this.m_defaultTooltip));this.m_Props.push(this.m_Color=new VBI.AttributeProperty(t,"color",this.m_DataSource,e,this.m_defaultColor));this.m_Props.push(this.m_ColorBorder=new VBI.AttributeProperty(t,"colorBorder",this.m_DataSource,e,this.m_defaultColor));this.m_Props.push(this.m_AltColorBorder=new VBI.AttributeProperty(t,"altBorderDeltaColor",this.m_DataSource,e,null));this.BaseLoad(t,e,this)};this.RenderInstance=function(t,e,i,r,a,s,n){var o,l=this.m_Scene;var h=l.GetZoomFactor4Mode();var m=l.GetStretchFactor4Mode();if(!r){r=[1,1,1]}if(!a){a="#6f6f7a"}var u=l.GetPointFromPos(i,false);var _=1;var c=1;if(this.IsHot(t)){var f=this.GetHotScale(l.m_Ctx);_=f[0];c=f[1]}var d=370;var v=d*r[0]*_/m[0];var p=d*r[1]*c/m[1];if(!n){var I=Math.pow(2,l.GetCurrentZoomlevel())/14.6;v*=I;p*=I}var B=u[0]-v/2;var g=u[1]-p/2;var S=u[0]+v/2;var b=u[1]+p/2;var V=this.m_IO[t]=l.GetCorrectedInstanceOffsets(o=this.m_BB[t]=[B,g,S,b],h);if(this.IsPosChangeable(l.m_Ctx)){var P=this.m_DH[t]=[];if(this.IsHandleMode()){P.m_EditMode=VBI.EMHandle;P.push(u)}else if(this.IsBoxMode()){P.m_EditMode=VBI.EMBox;P.push(o)}}for(var D=0;D<V.length;++D){e.setTransform(1,0,0,1,V[D],0);e.fillStyle=a;e.fillRect(B,g,v,p);e.lineWidth=1;e.strokeStyle=s;e.strokeRect(B,g,v,p);if(VBI.m_bTrace){VBI.Utilities.DrawFrameRect(e,"red",this.m_BB[t])}}e.setTransform(1,0,0,1,0,0)};this.Init4Render=this.StandardInit;this.Render=function(t,e,i){var r=this.m_Scene,a=r.m_Ctx;var s=0;var n;if(n=this.m_DataSource.GetCurrentNode(a)){s=n.m_dataelements.length;for(var o=0;o<s;++o){this.m_DataSource.Select(o);var l=this.IsHot(o);var h=this.IsSelected(a);var m=this.m_Pos.GetValueVector(a);var u=this.m_Scale.GetValueVector(a);var _=this.m_Color.GetValueColor(a);if(h){_=this.GetSelectColor(a,_)}if(l){_=this.GetHotColor(a,_)}var c=this.m_ColorBorder.GetValueColor(a);if(h){c=this.GetSelectColor(a,c)}if(l){c=this.GetAltBorderColor(a,c)}var f=this.m_FxSize.GetValueBool(a);this.RenderInstance(o,e,m,u,_,c,f);this.SetRichTooltip(l)}}this.BaseRender(t,e);return s};this.DetailHitTest=function(t,e,i,r){return{m_hit:1}};this.GetHitArray=function(t,e,i){var r=this.m_Scene.GetStretchFactor4Mode();var a=t/r[0];var s=e/r[1];var n={m_cb:this.DetailHitTest.bind(this),m_All:i};return this.BaseHitTest(a,s,n)};this.DesignBeginDrag=function(t){t.m_ScaleOrig=this.m_Scale.GetValueVector(this.m_Scene.m_Ctx).slice(0);t.m_DhOrig=this.m_DH[t.m_Index].slice(0);if(t.m_IO){t.m_DhOrig[0][0]+=t.m_IO;t.m_DhOrig[0][2]+=t.m_IO}};this.DesignBoxSize=VBI.Utilities.SceneBindDesignBoxBoxSize.bind(this,false)};VBI.VisualObjects.Box.prototype=VBI.VisualObjects.Base;VBI.VisualObjects.Area=function(){this.m_LineWidth=1;this.load=function(t,e){Object.getPrototypeOf(this).load.call(this,t,e);this.m_Props.push(this.m_DataSource=new VBI.NodeProperty(t,"datasource",null,e));if(typeof t["posarraymulti.bind"]==="string"||typeof t["posarraymulti"]==="string"){this.m_Props.push(this.m_PosM=new VBI.AttributeProperty(t,"posarraymulti",this.m_DataSource,e));this.m_Pos=null}else{this.m_Props.push(this.m_Pos=new VBI.AttributeProperty(t,"posarray",this.m_DataSource,e));this.m_PosM=null}this.m_Props.push(this.m_Scale=new VBI.AttributeProperty(t,"scale",this.m_DataSource,e));this.m_Props.push(this.m_Color=new VBI.AttributeProperty(t,"color",this.m_DataSource,e,this.m_defaultColor));this.m_Props.push(this.m_ColorBorder=new VBI.AttributeProperty(t,"colorBorder",this.m_DataSource,e,null));this.m_Props.push(this.m_BorderDash=new VBI.AttributeProperty(t,"borderDash",this.m_DataSource,e,null));this.m_Props.push(this.m_Tooltip=new VBI.AttributeProperty(t,"tooltip",this.m_DataSource,e,this.m_defaultTooltip));this.m_Props.push(this.m_AltColorBorder=new VBI.AttributeProperty(t,"altBorderDeltaColor",this.m_DataSource,e,null));this.BaseLoad(t,e,this)};this.LassoSelect=function(t,e,i){var r=false;var a,s;var n=false;for(var o=this.m_LP.length-1;o>=0;--o){a=this.m_LP[o];r=false;for(var l=0;l<a.length;++l){s=a[l];if(jQuery.type(s[0])=="array"&&jQuery.type(s[0][0])=="array"){s=s[0]}if(!(r=VBI.Utilities.polyInPolygon(t,s,this.m_IO[o]))){break}}if(r){e.push(o);i.push(o);n=true}}return n};this.RenderArea=function(t,e,i,r,a,s,n,o){var l=n*n/2;var h,m,u,_;var c=this.m_Scene;var f=c.m_CacheVars;if(i[0].length<6){return}var d=this.m_LP[t];if(d.length){d=null}var v=e.setLineDash?true:false;var p=false;var I=this.m_Scene.m_Canvas[0].m_nExactLOD;if(v&&s&&(VBI.m_bIsIDevice||VBI.m_bIsAndroid||I==Math.floor(I)||I<=this.m_Scene.m_CacheVars.minLOD+.01)){var B=s.split(";");e.setLineDash(B);p=true}e.strokeStyle=a?a:r;e.fillStyle=r;e.lineWidth=o>-1?2:n;e.lineCap="round";var g=f.factX;var S=f.factY;var b=f.addX;var V=f.addY;e.beginPath();for(var P=0,D=i.length;P<D;++P){var C=[i[P][0]*g+b,i[P][1]*S+V];if(d){d.push([]);d[P].push(C)}e.moveTo(C[0],C[1]);var G=i[P].length;for(h=3;h<G;h+=3){m=[i[P][h]*g+b,i[P][h+1]*S+V,0];if((u=C[0]-m[0])*u+(_=C[1]-m[1])*_<l){continue}e.lineTo(m[0],m[1]);if(d){d[P].push(m)}C=m}}e.closePath();e.fill();e.stroke();if(p){e.setLineDash([])}};this.CalculateLabelPos=function(t,e,i){var r=t.GetStretchFactor4Mode();var a=t.GetInternalDivClientRect();var s=a.width/r[0];var n=a.height/r[1];var o=t.m_Canvas[0].getPixelLeft()/r[0];var l=t.m_Canvas[0].getPixelTop()/r[1];var h=[-o,-l,-o+s,-l+n];var m=VBI.Utilities.GetMidpointsForPolygon(e.pa,e.bb,i,h);if(m&&m.aPos){return m.aPos}return null};this.ExtendBB=function(t,e){if(t[0]>e[0]){t[0]=e[0]}if(t[1]>e[1]){t[1]=e[1]}if(t[2]<e[2]){t[2]=e[2]}if(t[3]<e[3]){t[3]=e[3]}};this.IsPosChangeable=function(t){if(!VBI.m_bMouseSupported){return false}if(this.m_PosM){return this.m_PosM.IsChangeable(t)}else{return Object.getPrototypeOf(this).IsPosChangeable.call(this,t)}};this.CalcExcludeAreaMinLod=function(t,e,i,r){var a=t.GetNearestPosArray(e);var s=t.GetPointFromPos([a.m_MinX,a.m_MaxY,0],false);var n=t.GetPointFromPos([a.m_MaxX,a.m_MinY,0],false);return this.CalcAreaMinLod(s,n,i,r)};this.RenderShape=function(t,e,i,r,a,s,n,o,l,h){var m=this.m_Scene;var u=false,_;if(typeof i[0]==="number"){_=i}else{_=i[0];u=true}var c=m.GetZoomFactor4Mode();var f=m.m_CacheVars;if(_.cache==undefined){m.FillPositionCache(_)}var d=2.1;if(_.cache.minLod>h-d){return}var v=[(_.cache.lt[0]*f.completeX-f.ox)*f.fx,(_.cache.lt[1]*f.completeY-f.oy)*f.fy];var p=[(_.cache.rb[0]*f.completeX-f.ox)*f.fx,(_.cache.rb[1]*f.completeY-f.oy)*f.fy];var I,B=m.GetCorrectedInstanceOffsets(I=[v[0]-n,v[1]-n,p[0]+n,p[1]+n],c);if(this.m_BB[t]){this.ExtendBB(this.m_BB[t],I);this.m_IO[t]=m.GetCorrectedInstanceOffsets(this.m_BB[t],c)}else{this.m_IO[t]=B;this.m_BB[t]=I}var g;var S=null;if(B.length){S=[];S.push(_.cache.data);if(u){for(var b=1,V=i.length;b<V;++b){var P=i[b];if(P.cache==undefined){m.FillPositionCache(P)}if(P.cache.minLod<=h+d){S.push(P.cache.data)}}}if(this.IsPosChangeable(m.m_Ctx)){var D=this.m_DH[t]=[];if(this.IsHandleMode()){D.m_EditMode=VBI.EMHandle;var C=S[0].length/3;for(g=0;g<C;++g){D.push([(S[0][g*3]*f.completeX-f.ox)*f.fx,(S[0][g*3+1]*f.completeY-f.oy)*f.fy])}}else if(this.IsBoxMode()){D.m_EditMode=VBI.EMBox;D.push(this.m_BB[t])}}for(g=0;g<B.length;++g){e.setTransform(1,0,0,1,B[g],0);this.RenderArea(t,e,S,r,a,s,n,o);if(VBI.m_bTrace){VBI.Utilities.DrawFrameRect(e,"red",this.m_BB[t])}}e.setTransform(1,0,0,1,0,0);if(l){var G=m.GetShortPointArrayFromUCSArray(_.cache.data);var x={pa:G,bb:[v,p]};this.m_Label.push(new VBI.Label(l,t,this.CalculateLabelPos,x,null,B))}}};this.RenderInstance=function(t,e,i,r,a,s){this.m_LP[t]=[];var n=this.m_Scene;var o=-1;var l=this.m_Color.GetValueColor(r);var h=this.m_ColorBorder.GetValueColor(r);var m=this.m_BorderDash.GetValueString(r);if(a){l=this.GetSelectColor(r,l);h=this.GetAltBorderColor(r,h)}else if(this.GetNumActiveSelections(r)){l=this.GetNonSelectColor(r,l)}if(i){var u=n.m_HotItem.m_HitObj.m_Detail;if(u&&u.m_edge>=0&&(this.BaseFindAction("EdgeClick")||this.BaseFindAction("EdgeContextMenu"))){o=u.m_edge}else{l=this.GetHotColor(r,l)}h=this.GetAltBorderColor(r,h)}var _;if(this.m_Pos){_=this.m_Pos.GetValueVector(r);this.RenderShape(t,e,_,l,h,m,this.m_LineWidth,o,this.GetLabel(r),s)}else if(this.m_PosM){var c=this.m_PosM.GetValueVector(r);var f=[];for(var d=0,v=c.length;d<v;++d){this.RenderShape(t,e,c[d],l,h,m,this.m_LineWidth,o,this.GetLabel(r),s);if(this.m_LP[t].length){f.push(this.m_LP[t]);this.m_LP[t]=[]}}this.m_LP[t]=f}};this.Init4Render=this.StandardInitWithLPs;this.Render=function(t,e,i){var r=this.m_Scene.m_Ctx;var a=[];var s,n;var o;var l=this.m_Scene.m_Canvas[0].m_nExactLOD;if(s=this.m_DataSource.GetCurrentNode(r)){n=s.m_dataelements.length;for(var h=0;h<n;++h){this.m_DataSource.Select(h);var m=this.IsHot(h);if(m){o=h}else if(this.IsSelected(r)){a.push(h)}else{this.RenderInstance(h,e,false,r,false,l)}this.SetRichTooltip(m)}}n=a.length;for(var u=0;u<n;u++){this.m_DataSource.Select(a[u]);this.RenderInstance(a[u],e,false,r,true,l)}if(o!=undefined){this.m_DataSource.Select(o);this.RenderInstance(o,e,true,r,this.IsSelected(r),l)}this.BaseRender(t,e)};this.DetailHitTest=function(t,e,i,r){var a=false;var s;var n=this.m_LP[e];if(jQuery.type(n[0])=="array"&&jQuery.type(n[0][0])=="array"&&jQuery.type(n[0][0][0])=="array"){s=n.length;for(var o=0;!a&&o<s;++o){n=this.m_LP[e][o];a=VBI.Utilities.pointInPolygon(n,i,r)}}else{a=VBI.Utilities.pointInPolygon(n,i,r)}if(a){var l={m_hit:1};var h;if((h=VBI.Utilities.pointOnLine(n[0],i,r,5,true))&&h.m_edge>=0){l.m_edge=h.m_edge;l.m_node=h.m_node}return l}return null};this.GetHitArray=function(t,e,i){var r=this.m_Scene.GetStretchFactor4Mode();var a=t/r[0];var s=e/r[1];var n={m_cb:this.DetailHitTest.bind(this),m_All:i};return this.BaseHitTest(a,s,n)};this.ProcessDetailNodeEdgeEvent=function(t,e,i,r){var a=this.m_Scene,s=a.m_Ctx.m_Actions;if(s){var n;if(n=s.findAction(r,a,this)){var o=a.GetEventVPCoordsObj(t);o.edge=i.m_Detail.m_edge.toString();o.node=i.m_Detail.m_node.toString();this.m_Scene.m_Ctx.FireAction(n,a,this,e,o);return true}}return false};this.DetailClick=function(t,e,i){if(i.m_Detail&&i.m_Detail.m_edge>=0){return this.ProcessDetailNodeEdgeEvent(t,e,i,"EdgeClick")}return false};this.DetailContextmenu=function(t,e,i){if(i.m_Detail&&i.m_Detail.m_edge>=0){return this.ProcessDetailNodeEdgeEvent(t,e,i,"EdgeContextMenu")}return false};this.DesignBoxSize=VBI.Utilities.SceneBindPosArrayDesignBoxSize.bind(this)};VBI.VisualObjects.Area.prototype=VBI.VisualObjects.Base;VBI.VisualObjects.HeatMap=function(){this.load=function(t,e){Object.getPrototypeOf(this).load.call(this,t,e);this.m_Props.push(this.m_DataSource=new VBI.NodeProperty(t,"datasource",null,e));this.m_Props.push(this.m_Pos=new VBI.AttributeProperty(t,"pos",this.m_DataSource,e));this.m_Props.push(this.m_Value=new VBI.AttributeProperty(t,"value",this.m_DataSource,e,1));this.m_Props.push(this.m_Opacity=new VBI.AttributeProperty(t,"opacity",this.m_DataSource,e,.5));this.m_Props.push(this.m_Gradient=new VBI.AttributeProperty(t,"gradient",this.m_DataSource,e,""));this.m_Props.push(this.m_Radius=new VBI.AttributeProperty(t,"radius",this.m_DataSource,e,5));this.m_Props.push(this.m_Behavior=new VBI.AttributeProperty(t,"behavior",this.m_DataSource,e,2));this.m_Props.push(this.m_RScale=new VBI.AttributeProperty(t,"radiusScale",this.m_DataSource,e,1));this.m_Props.push(this.m_VScale=new VBI.AttributeProperty(t,"valueScale",this.m_DataSource,e,1));this.m_Props.push(this.m_AExp=new VBI.AttributeProperty(t,"alphaExponent",this.m_DataSource,e,1));this.m_Props.push(this.m_CExp=new VBI.AttributeProperty(t,"colorExponent",this.m_DataSource,e,1));var i=jQuery.type(this.m_Gradient.m_Value)=="array";this.GradientImage=new Image;this.GradientImage.onload=function(){this.GradientImage.IsLoaded=true}.bind(this);if(i){this.m_GeneratedGradient=this.GenerateGradient(this.m_Gradient.m_Value);this.GradientImage.src=this.m_GeneratedGradient}else{this.GradientImage.src=e.GetResources().GetData(this.m_Gradient.GetValueString(e))}this.cache=undefined;this.BaseLoad(t,e,this)};this.SetColor=function(t,e,i,r,a,s){var n=4*e;t[n]=r[0]*i+s[0]*a;t[n+1]=r[1]*i+s[1]*a;t[n+2]=r[2]*i+s[2]*a;t[n+3]=r[3]*i+s[3]*a};this.SetColor1=function(t,e,i){var r=4*e;t[r]=i[0];t[r+1]=i[1];t[r+2]=i[2];t[r+3]=255};this.GenerateGradient=function(t){var e=t.length/2;var i=t[2*(e-1)];var r=this.m_Scene.m_TargetName+"-"+this.m_Scene.m_ID+"-";var a=VBI.Utilities.CreateGeoSceneCanvas(r+"temporary",i,1,0,false);var s=a.getContext("2d");var n=[];s.lineWidth=1;var o;for(o=0;o<e;++o){s.fillStyle=t[2*o+1];s.fillRect(t[2*o],0,1,1);var l=s.getImageData(t[2*o],0,1,1);n.push(l.data)}var h=s.getImageData(0,0,i,1);for(o=1;o<e;++o){var m=n[o-1];var u=VBI.Utilities.RGB2HLS(m[0],m[1],m[2]);var _=u[0];var c=u[1];var f=u[2];var d=t[2*(o-1)],v=t[2*o],p=v-d;var I=n[o];var B=VBI.Utilities.RGB2HLS(I[0],I[1],I[2]);var g=B[0];var S=(g-_)/p;for(var b=d;b<=v;++b){var V=VBI.Utilities.HLS2RGB(_+(b-d)*S,c,f);this.SetColor1(h.data,b,V)}}s.putImageData(h,0,0);return a.toDataURL("png")};this.CollectData=function(t){var e=this.m_Scene;var i,r=[],a=[],s=[];var n=[];var o=0;if(i=this.m_DataSource.GetCurrentNode(t)){for(var l=0,h=i.m_dataelements.length;l<h;++l){this.m_DataSource.Select(l);var m=this.m_Pos.GetValueVector(t);n.push({x:m[0],y:m[1],r:this.m_Radius.GetValueFloat(t),v:this.m_Value.GetValueFloat(t)})}n.sort(function(t,e){return t.x-e.x});for(var u=0;u<n.length;++u){var _=n[u];r.push(_.v);a.push(_.r);s.push(_.x,_.y,0);if(_.r>o){o=_.r}}}e.FillPositionCache(s,true);this.cache=s.cache;this.cache.val=r;this.cache.rad=a;this.cache.maxRad=o};this.Init4Render=function(){this.m_IO=[]};this.AddPoints2Heatmap=function(t,e,i,r,a){var s=t.m_V;var n=this.m_Scene;t.Clear();var o,l;var h=t.m_W;var m=t.m_H;var u=i*e.maxRad/r/2;var _=n.GetPointArrayFromUCSArray(e.data);for(var c=0;c<this.m_IO.length;++c){var f=e.data.length;var d=this.m_IO[c];var v=_[0]+d,p=_[f-3]+d;var I=0,B=f/3,g=0,S=0,b;if(v<=-u&&p>-u){I=f/3;while(I>g+1){b=Math.floor((g+I)/2);if(_[3*b]+d<=-u){g=b}else{I=b}}}if(v>m+u&&p<=m+u){while(B>S+1){b=Math.floor((S+B)/2);if(_[3*b]+d<=m+u){S=b}else{B=b}}}for(var V=3*I,P=I;P<B;V+=3,P++){var D=_[V]+d;var C=_[V+1];l=i*e.rad[P]/r/2;if(C>-l&&D<h+l){o=a*e.val[P]/50;s.AddPoint(D,C,o,l)}}}s.m_PointsSet=true};this.Render=function(t,e){var i=this.m_Scene;var r=i.m_Ctx;var a=t.clientWidth;var s=t.clientHeight;var n=i.m_nWidthCanvas;var o=i.m_nHeightCanvas;var l=this.m_GeneratedGradient?this.m_GeneratedGradient:r.GetResources().GetData(this.m_Gradient.GetValueString(r));if(this.HeatmapWidth!=n||this.HeatmapHeight!=o){var h=document.createElement("canvas");h.width=2*n;h.height=2*o;this.Heatmap=VBI.CreateHM({canvas:h,colorTexture:l,colorTex:this.GradientImage,alpha:true,width:2*n,height:2*o,scene:this.m_Scene,aFunc:this.m_AExp.GetValueFloat(r),cFunc:this.m_CExp.GetValueFloat(r)});this.HeatmapWidth=n;this.HeatmapHeight=o}var m=this.Heatmap;if(!this.cache){this.CollectData(r)}var u=i.GetPointFromUCSPoint([this.cache.lt[0],this.cache.lt[1]]);var _=i.GetPointFromUCSPoint([this.cache.rb[0],this.cache.rb[1]]);var c=i.GetZoomFactor4Mode();this.m_IO=i.GetCorrectedInstanceOffsets([u[0],u[1],_[0],_[1]],c);var f=this.m_RScale.GetValueFloat(r);var d=this.m_VScale.GetValueFloat(r);var v=this.m_Behavior.GetValueFloat(r);var p=i.m_Canvas[0].m_nExactLOD;var I=Math.floor(p);var B=(i.m_bObjCanvasMode==0?Math.pow(2,p-I):1)/f;var g=1;if(v>0){g=1+i.m_Canvas[0].m_nExactLOD;if(v==2){g=Math.pow(2,g)}}this.AddPoints2Heatmap(m,this.cache,g,B,d);m.Render();var S=e.globalAlpha;e.globalAlpha=this.m_Opacity.GetValueFloat(r);e.drawImage(m.m_Canv,0,0,a,s,0,0,a,s);e.globalAlpha=S};this.DetailHitTest=function(t,e,i,r){return null};this.GetHitArray=function(t,e){var i=this.m_Scene.GetStretchFactor4Mode();var r=t/i[0];var a=e/i[1];var s={m_cb:this.DetailHitTest.bind(this)};return this.BaseHitTest(r,a,s)};this.DesignBeginDrag=function(t){t.m_ScaleOrig=this.m_Scale.GetValueVector(this.m_Scene.m_Ctx).slice(0);t.m_DhOrig=this.m_DH[t.m_Index].slice(0);if(t.m_IO){t.m_DhOrig[0][0]+=t.m_IO;t.m_DhOrig[0][2]+=t.m_IO}};this.DesignBoxSize=VBI.Utilities.SceneBindDesignBoxBoxSize.bind(this,true)};VBI.VisualObjects.HeatMap.prototype=VBI.VisualObjects.Base;VBI.VisualObjects.Container=function(){this.m_Sub=[];this.m_bContainer=true;this.m_openWin=[];this.m_Marker=1;this.load=function(t,e){Object.getPrototypeOf(this).load.call(this,t,e);this.m_Props.push(this.m_DataSource=new VBI.NodeProperty(t,"datasource",null,e));this.m_Props.push(this.m_Pos=new VBI.AttributeProperty(t,"pos",this.m_DataSource,e));this.m_Props.push(this.m_Key=new VBI.AttributeProperty(t,"key",this.m_DataSource,e,""));this.m_Props.push(this.m_Tooltip=new VBI.AttributeProperty(t,"tooltip",this.m_DataSource,e,""));this.m_Props.push(this.m_Alignment=new VBI.AttributeProperty(t,"alignment",this.m_DataSource,e,"0"));this.m_Sub.push(this.m_Scene.m_EvtCont.subscribe("onMove",this.onLayout.bind(this)));this.m_bChanged=true};this.clear=function(){for(var t=0,e=this.m_Sub.length;t<e;++t){this.m_Sub[t].unsubscribe()}this.m_Sub=[];this.m_Marker++;this.sweepContainers(this.m_Scene.m_Ctx);Object.getPrototypeOf(this).clear.call(this)};this.getParentDiv=function(){return this.m_Scene.m_MapsLayerDiv};this.sweepContainers=function(t){for(var e in this.m_openWin){if(this.m_openWin[e].Marker!=this.m_Marker){var i=this.m_openWin[e];t.onCloseContainer(i.id,i);var r=this.getParentDiv();r.removeChild(i);delete this.m_openWin[e]}}};this.updateContainers=function(t,e,i){var r=this.getParentDiv();var a=t.getPixelLeft();var s=t.getPixelTop();var n,o;var l;if(l=this.m_DataSource.GetCurrentNode(i)){n=l.m_dataelements.length;for(o=0;o<n;++o){this.m_DataSource.Select(o);var h=this.m_Pos.GetValueVector(i);var m=this.m_Key.GetValueString(i);var u=this.m_Tooltip.GetValueString(i);var _=e.GetPointFromPos(h,false);var c=this.m_openWin[m];if(c){if(!c.children.length){i.onOpenContainer(m,c)}}else{c=VBI.Utilities.CreateContainer("vbi_"+m,m,a+(_[0]|0),s+(_[1]|0),"50px","30px",u);c.addEventListener("mouseover",this.onMouseOverDiv.bind(c));c.addEventListener("mouseout",this.onMouseOutDiv.bind(c));c.m_ID=this.m_ID;this.m_openWin[m]=c;this.m_openWin[m].index=o;r.appendChild(c);i.onOpenContainer(m,c)}this.m_openWin[m].Marker=this.m_Marker}}this.sweepContainers(i)};this.onMouseOverDiv=function(){this.bIsHot=true};this.onMouseOutDiv=function(){this.bIsHot=false};this.onLayout=function(t){var e=this.m_Scene;var i=e.m_Canvas[e.m_nOverlayIndex];this.clusterParams=this.GetClusterPosParameters();var r=e.m_Canvas[0].m_nExactLOD;if(!this.m_LastCanvasPos||this.m_LastCanvasPos[2]!=r){return}var a=[i.getPixelLeft()-this.m_LastCanvasPos[0],i.getPixelTop()-this.m_LastCanvasPos[1]];for(var s in this.m_openWin){var n=this.m_openWin[s];if(a[0]){var o=parseFloat(n.style.left)+a[0];o+=this.findRoundWorldOffset(o);n.style.left=o+"px"}if(a[1]){n.style.top=parseInt(n.style.top,10)+a[1]+"px"}}this.m_LastCanvasPos=[i.getPixelLeft(),i.getPixelTop(),e.m_Canvas[0].m_nExactLOD]};this.ContainerAlign=function(t,e){var i=this.m_Alignment.GetValueString(e);var r=t.style;switch(i){case"0":r.msTransform=r.transform=r.webkitTransform="translate( -50%, -50%)";break;case"1":r.msTransform=r.transform=r.webkitTransform="translate( -50%,   0%)";break;case"2":r.msTransform=r.transform=r.webkitTransform="translate(-100%,   0%)";break;case"3":r.msTransform=r.transform=r.webkitTransform="translate(-100%, -50%)";break;case"4":r.msTransform=r.transform=r.webkitTransform="translate(-100%,-100%)";break;case"5":r.msTransform=r.transform=r.webkitTransform="translate( -50%,-100%)";break;case"6":r.msTransform=r.transform=r.webkitTransform="translate(   0%,-100%)";break;case"7":r.msTransform=r.transform=r.webkitTransform="translate(   0%, -50%)";break;default:case"8":r.msTransform=r.transform=r.webkitTransform="translate(0%, 0%)";break}};this.RenderInstances=function(t,e){var i=this.m_Scene;var r=i.m_Ctx;if(this.m_bChanged){this.updateContainers(t,i,r);this.m_bChanged=false}var a=t.getPixelLeft();var s=t.getPixelTop();if(this.m_DataSource.GetCurrentNode(r)){for(var n in this.m_openWin){var o=this.m_openWin[n];if(o.index==undefined){continue}this.m_DataSource.Select(o.index);var l=this.m_Pos.GetValueVector(r);var h=i.GetPointFromPos(l,true);var m=Math.round(a+(h[0]|0)*e[0]);m=m+this.findRoundWorldOffset(m);o.style.left=m+"px";o.style.top=Math.round(s+(h[1]|0)*e[1])+"px";this.ContainerAlign(o,r)}}};this.GetClusterPosParameters=function(){var t={};var e=this.m_Scene;var i=e.m_Canvas[0].m_nExactLOD;t.worldPxOnLOD=Math.pow(2,i)*e.m_nWidthCanvas/e.m_nTilesX*e.m_Proj.m_nXYRatio;t.nLeftBorder=e.m_nDivWidth-t.worldPxOnLOD;t.nRightBorder=e.m_nDivWidth-t.nLeftBorder;return t};this.findRoundWorldOffset=function(t){var e=0;var i=this.clusterParams;while(t+e<i.nLeftBorder){e+=i.worldPxOnLOD}while(t+e>i.nRightBorder){e-=i.worldPxOnLOD}return e};this.GetClusterPosition=function(t,e,i,r,a,s,n,o){var l;var h=this.m_Scene;var m=t.canvas.getPixelLeft();var u=t.canvas.getPixelTop();var _=h.GetCurrentZoomFactors();l=[m+_[0]*(s*e[0]-n),u+_[1]*(s*e[1]-o)];var c=this.findRoundWorldOffset(l[0]);var f=this.m_Scene.GetZoomFactor4Mode();l[0]+=c;l[2]=c/f[0];if(e.c!=undefined&&i.anim&&r>i.animLow&&a&&e.c!=undefined&&e.c.lod==r-1){var d=this.m_Scene.GetStretchFactor4Mode();var v=e.c;var p=a*a;l=[m+c+_[0]*(s*(e[0]*(1-p)+v[0]*p)-n),u+_[1]*(s*(e[1]*(1-p)+v[1]*p)-o),c/f[0]];if(i.anim==2){var I=[c+f[0]*(s*v[0]-n),f[1]*(s*v[1]-o)];var B=2*Math.abs(.5-a);var g=""+(1-B);t.strokeStyle="rgba(110,110,110,"+g+")";t.lineWidth=2;t.lineCap="round";t.beginPath();t.moveTo((l[0]-m)/d[0],(l[1]-u)/d[0]);t.lineTo(I[0],I[1]);t.stroke()}}return l};this.RenderThisInstance=function(t,e,i,r,a,s,n,o,l,h,m,u,_,c){var f=this.m_Scene;var d=this.m_Scene.m_Ctx;var v=this.getParentDiv();var p=this.GetClusterPosition(n,t,i,l,h,m,u,_);var I=f.m_Ctx.m_Clustering.getClusterIdent(f.m_PreassembledData,r,s);var B=this.m_openWin[I];if(B==undefined){B=VBI.Utilities.CreateContainer("vbi_"+I,I,p[0],p[1],"50px","30px","",true);B.addEventListener("mouseover",this.onMouseOverDiv.bind(B));B.addEventListener("mouseout",this.onMouseOutDiv.bind(B));B.m_ID=this.m_ID;B.index=t.nJ;v.appendChild(B);this.m_openWin[I]=B;d.onOpenContainer(I,B);this.ContainerAlign(B,d)}else{if(B.bIsHot){this.RenderShadow(o,t,e,i,l,m,u-p[2],_)}B.style.left=Math.round(p[0])+"px";B.style.top=Math.round(p[1])+"px"}this.m_openWin[I].Marker=this.m_Marker};this.Render=function(t,e,i,r,a,s){var n=this.m_Scene;var o=this.m_Scene.m_Ctx;var l=n.m_Canvas[0].m_nExactLOD;this.m_Marker++;this.clusterParams=this.GetClusterPosParameters();if(s){var h=0;var m=n.m_Canvas[0].m_nCurrentX*n.m_MapManager.m_tileWidth;var u=n.m_Canvas[0].m_nCurrentY*n.m_MapManager.m_tileHeight;var _=i.config;var c=i.cI;var f=i.m_TreeFatherNode;var d=Math.ceil(l);if(f){var v=this.GetAnimClusterDistance(d,l);h=this.RenderTree(f,i.m_edges,_,c,h,d,v,e,a,i.m_lodOffset,m,u,false)}else{var p=i.m_lodOffset;var I=i.length;for(var B=0;B<I;++B){var g=i[B];if(!g.b2Ignore){if(this.RenderThisInstance(g,i.m_edges,_,c,h,B,e,a,d,0,p,m,u,false)){h++}}}}this.sweepContainers(o)}else if(this.m_DataSource.GetCurrentNode(o)){var S=this.m_Scene.GetStretchFactor4Mode();this.RenderInstances(t,[S[0],S[1]])}var b=n.m_Canvas[n.m_nOverlayIndex];this.m_LastCanvasPos=[b.getPixelLeft(),b.getPixelTop(),l]};this.GetHitArray=function(t,e){var i=[];for(var r in this.m_openWin){var a=this.m_openWin[r];if(a&&a.bIsHot){i.push({m_Index:a.index,m_Entity:null,m_Detail:{m_hit:2},m_IO:0})}}return i};this.onclick=function(t){return this.BaseClick(t)}};VBI.VisualObjects.Container.prototype=VBI.VisualObjects.Base;VBI.VisualObjects.Base2D=function(){this.m_DOMElement=null;this.m_paddingLeft=5;this.m_paddingTop=5;this.m_paddingRight=5;this.m_paddingBottom=5;this.IsValid=function(){if(this.m_DOMElement&&this.m_Scene.m_Div){if(this.m_DOMElement.parentNode==this.m_Scene.m_Div){return true}}return false};this.load=function(t,e,i){Object.getPrototypeOf(this).load.call(t,e,i);t.m_Props.push(t.m_Left=new VBI.AttributeProperty(e,"left",null,i));t.m_Props.push(t.m_Top=new VBI.AttributeProperty(e,"top",null,i));t.m_Props.push(t.m_Right=new VBI.AttributeProperty(e,"right",null,i));t.m_Props.push(t.m_Bottom=new VBI.AttributeProperty(e,"bottom",null,i));t.m_Props.push(t.m_Align=new VBI.AttributeProperty(e,"align",null,i,1))};this.clear=function(){Object.getPrototypeOf(Object.getPrototypeOf(this)).clear.call(this);this.m_DOMElement=null};this.BaseClick=function(t){var e=this.m_Scene;var i;if(i=e.m_Ctx.m_Actions){var r;if(r=i.findAction("Click",e,this)){e.m_Ctx.FireAction(r,e,this,null,e.GetEventVPCoordsObj(t));t.preventDefault();return true}}return false}};VBI.VisualObjects.Base2D.prototype=VBI.VisualObjects.Base;VBI.VisualObjects.Caption=function(){this.m_LineWidth=1;this.load=function(t,e){Object.getPrototypeOf(this).load(this,t,e);this.m_Props.push(this.m_Text=new VBI.AttributeProperty(t,"text",null,e,""));this.m_Props.push(this.m_Design=new VBI.AttributeProperty(t,"design",null,e,"0"));this.m_Props.push(this.m_Level=new VBI.AttributeProperty(t,"level",null,e,0));this.m_Props.push(this.m_Tooltip=new VBI.AttributeProperty(t,"tooltip",null,e,""))};this.Render=function(t,e,i){if(this.IsValid()){return}var r=this.m_Scene.m_Ctx;var a=this.m_Left.GetValueLong(r);var s=this.m_Top.GetValueLong(r);var n=this.m_Right.GetValueLong(r);var o=this.m_Bottom.GetValueLong(r);var l=this.m_Align.GetValueLong(r);var h=this.m_Text.GetValueString(r);var m=this.m_Design.GetValueLong(r);var u=this.m_Level.GetValueLong(r);var _=this.m_Tooltip.GetValueString(r);this.m_DOMElement=VBI.Utilities.CreateCaption(this.m_ID,h,a+this.m_paddingLeft,s+this.m_paddingTop,n+this.m_paddingLeft,o+this.m_paddingTop,_,m,u,l);this.m_Scene.m_Div.appendChild(this.m_DOMElement)}};VBI.VisualObjects.Caption.prototype=new VBI.VisualObjects.Base2D;VBI.VisualObjects.Label=function(){this.m_LineWidth=1;this.load=function(t,e){Object.getPrototypeOf(this).load(this,t,e);this.m_Props.push(this.m_Text=new VBI.AttributeProperty(t,"text",null,e,""));this.m_Props.push(this.m_Design=new VBI.AttributeProperty(t,"design",null,e,"0"))};this.Render=function(t,e,i){if(this.IsValid()){return}var r=this.m_Scene.m_Ctx;var a=this.m_Left.GetValueLong(r);var s=this.m_Top.GetValueLong(r);var n=this.m_Right.GetValueLong(r);var o=this.m_Align.GetValueLong(r);var l=this.m_Bottom.GetValueLong(r);var h=this.m_Text.GetValueString(r);this.m_DOMElement=VBI.Utilities.CreateLabel(this.m_ID,h,a+this.m_paddingLeft,s+this.m_paddingTop,n+this.m_paddingLeft,l+this.m_paddingTop,0,o);this.m_Scene.m_Div.appendChild(this.m_DOMElement)}};VBI.VisualObjects.Label.prototype=new VBI.VisualObjects.Base2D;VBI.VisualObjects.Link=function(){this.m_LineWidth=1;this.load=function(t,e){Object.getPrototypeOf(this).load(this,t,e);this.m_Props.push(this.m_Reference=new VBI.AttributeProperty(t,"reference",null,""));this.m_Props.push(this.m_Autoexecute=new VBI.AttributeProperty(t,"autoexecute",null,e,false));this.m_Props.push(this.m_Tooltip=new VBI.AttributeProperty(t,"tooltip",null,e,""));this.m_Props.push(this.m_Text=new VBI.AttributeProperty(t,"text",null,e,""))};this.clear=function(){if(this.m_DOMElement){this.m_DOMElement.onclick=null}Object.getPrototypeOf(this).clear.call(this)};this.Render=function(t,e,i){if(this.IsValid()){return}var r=this.m_Scene.m_Ctx;var a=this.m_Left.GetValueLong(r);var s=this.m_Top.GetValueLong(r);var n=this.m_Right.GetValueLong(r);var o=this.m_Bottom.GetValueLong(r);var l=this.m_Align.GetValueLong(r);var h=this.m_Text.GetValueString(r);var m=this.m_Reference.GetValueString(r);var u=this.m_Autoexecute.GetValueBool(r);var _=this.m_Tooltip.GetValueString(r);this.m_DOMElement=VBI.Utilities.CreateLink(this.m_ID,h,a+this.m_paddingLeft,s+this.m_paddingTop,n+this.m_paddingLeft,o+this.m_paddingTop,u?m:null,_,l);this.m_Scene.m_Div.appendChild(this.m_DOMElement);this.m_DOMElement.onclick=this.onclick.bind(this)};this.onclick=function(t){return this.BaseClick(t)}};VBI.VisualObjects.Link.prototype=new VBI.VisualObjects.Base2D;VBI.VisualObjects.Image=function(){this.load=function(t,e){Object.getPrototypeOf(this).load(this,t,e);this.m_Props.push(this.m_Image=new VBI.AttributeProperty(t,"image",null,e));this.m_Props.push(this.m_Tooltip=new VBI.AttributeProperty(t,"tooltip",null,e,""))};this.Render=function(t,e,i){if(this.IsValid()){return}var r=this.m_Scene.m_Ctx;var a=this.m_Left.GetValueLong(r);var s=this.m_Top.GetValueLong(r);var n=this.m_Right.GetValueLong(r);var o=this.m_Bottom.GetValueLong(r);var l=this.m_Align.GetValueLong(r);var h=this.m_Image.GetValueString(r);var m=this.m_Tooltip.GetValueString(r);var u;if(u=r.GetResources().GetImage(h)){this.m_DOMElement=VBI.Utilities.CreateImage(this.m_ID,u,a+this.m_paddingLeft,s+this.m_paddingTop,n+this.m_paddingLeft,o+this.m_paddingTop,m,l);this.m_Scene.m_Div.appendChild(this.m_DOMElement)}}};VBI.VisualObjects.Image.prototype=new VBI.VisualObjects.Base2D;VBI.VisualObjects.Button=function(){this.load=function(t,e){Object.getPrototypeOf(this).load(this,t,e);this.m_Props.push(this.m_Tooltip=new VBI.AttributeProperty(t,"tooltip",null,e,""));this.m_Props.push(this.m_Text=new VBI.AttributeProperty(t,"text",null,e,""))};this.clear=function(){if(this.m_DOMElement){this.m_DOMElement.onclick=null}Object.getPrototypeOf(this).clear.call(this)};this.Render=function(t,e,i){if(this.IsValid()){return}var r=this.m_Scene.m_Ctx;var a=this.m_Left.GetValueLong(r);var s=this.m_Top.GetValueLong(r);var n=this.m_Right.GetValueLong(r);var o=this.m_Bottom.GetValueLong(r);var l=this.m_Text.GetValueString(r);var h=this.m_Tooltip.GetValueString(r);this.m_DOMElement=VBI.Utilities.CreateButton(this.m_ID,l,a+this.m_paddingLeft,s+this.m_paddingTop,n+this.m_paddingLeft,o+this.m_paddingTop,h);this.m_Scene.m_Div.appendChild(this.m_DOMElement);this.m_DOMElement.onclick=this.onclick.bind(this)};this.onclick=function(t){return this.BaseClick(t)}};VBI.VisualObjects.Button.prototype=new VBI.VisualObjects.Base2D;VBI.VisualObjects.Dummy=function(){this.load=function(t,e){Object.getPrototypeOf(this).load.call(this,t,e)};this.RenderInstance=function(t,e,i,r,a){};this.Render=function(t,e,i){this.BaseRender(t,e)};this.RenderShadow=function(t,e,i,r,a,s){}};VBI.VisualObjects.Dummy.prototype=VBI.VisualObjects.Base;VBI.VisualObjects.Box3D=function(){this.load=function(t,e){Object.getPrototypeOf(this).load.call(this,t,e);this.m_Props.push(this.m_DataSource=new VBI.NodeProperty(t,"datasource",null,e));this.m_Props.push(this.m_Pos=new VBI.AttributeProperty(t,"pos",this.m_DataSource,e,[0,0,0]));this.m_Props.push(this.m_Scale=new VBI.AttributeProperty(t,"scale",this.m_DataSource,e,[1,1,1]));this.m_Props.push(this.m_Tooltip=new VBI.AttributeProperty(t,"tooltip",this.m_DataSource,e,this.m_defaultTooltip));this.m_Props.push(this.m_Color=new VBI.AttributeProperty(t,"color",this.m_DataSource,e,this.m_defaultColor));this.m_Props.push(this.m_ColorBorder=new VBI.AttributeProperty(t,"colorBorder",this.m_DataSource,e,this.m_defaultColor));this.BaseLoad(t,e,this)};this.RenderInstance=function(t,e,i,r,a,s){if(!i){i=[1,1,1]}if(!r){r="#6f6f7a"}};this.Render=function(t){var e=this.m_Scene;if(!e.m_bMainSceneInitialized){return 0}var i=e.m_Ctx;var r=0;var a;if(a=this.m_DataSource.GetCurrentNode(i)){r=a.m_dataelements.length;for(var s=0;s<r;++s){this.m_DataSource.Select(s);var n=this.IsHot(s);var o=this.IsSelected(i);var l=this.m_Pos.GetValueVector(i);var h=this.m_Scale.GetValueVector(i);var m=this.m_Color.GetValueColor(i);if(o){m=this.GetSelectColor(i,m)}if(n){m=this.GetHotColor(i,m)}var u=this.m_ColorBorder.GetValueColor(i);if(o){u=this.GetSelectColor(i,u)}if(n){u=this.GetHotColor(i,u)}var _=this.m_FxSize.GetValueBool(i);this.RenderInstance(s,l,h,m,u,_)}}return r};this.DetailHitTest=function(t,e,i,r){};this.GetHitArray=function(t,e){}};VBI.VisualObjects.Box3D.prototype=VBI.VisualObjects.Base;return e}});
/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5) (c) Copyright 2009-2012 SAP AG. All rights reserved
 */
sap.ui.predefine("sap/ui/vbm/lib/sapvoutils", ["./sapvbi"],function(){"use strict";VBI.Utilities.SceneBindDesignSpotBoxSize=function(t){var e=this.m_Scene;if(t.m_Design&&t.m_Hit==VBI.HTBOXHANDLE&&this.m_Scale.IsChangeable(e.m_Ctx)){if(t.m_Handle>6){return}var i=e.GetStretchFactor4Mode();var a=t.m_ClientX/i[0];var r=t.m_ClientY/i[0];var s=t.m_DhOrig[0];var n=(s[0]+s[2])/2;var m=(s[2]-s[0])/2;var l=s[3]-s[1];var _=1,u=1;switch(t.m_Handle){case 1:u=Math.abs(r-s[3])/l;break;case 2:case 5:if(t.m_Handle==2){u=Math.abs(r-s[3])/l}_=Math.abs(a-n)/m;break;case 0:case 3:if(t.m_Handle==0){u=Math.abs(r-s[3])/l}_=Math.abs(a-n)/m;break;default:break}var o=t.m_ScaleOrig.slice(0);o[0]*=_;o[1]*=u;this.m_Scale.SetValueVector(e.m_Ctx,o)}};VBI.Utilities.SceneBindDesignBoxBoxSize=function(t,e){var i=this.m_Scene;if(e.m_Design&&e.m_Hit==VBI.HTBOXHANDLE&&this.m_Scale.IsChangeable(i.m_Ctx)){var a=i.GetStretchFactor4Mode();var r=e.m_ClientX/a[0];var s=e.m_ClientY/a[0];var n=e.m_DhOrig[0];var m=(n[0]+n[2])/2;var l=(n[1]+n[3])/2;var _=(n[2]-n[0])/2;var u=(n[3]-n[1])/2;var o=1,h=1;switch(e.m_Handle){case 0:case 2:case 6:case 8:o=Math.abs(r-m)/_;h=Math.abs(s-l)/u;if(t){o=h=Math.max(o,h)}break;case 1:case 7:h=Math.abs(s-l)/u;if(t){o=h}break;case 3:case 5:o=Math.abs(r-m)/_;if(t){h=o}break;default:break}var f=e.m_ScaleOrig.slice(0);f[0]*=o;f[1]*=h;this.m_Scale.SetValueVector(i.m_Ctx,f)}};VBI.Utilities.SceneBindMeterRadiusDesignBoxSize=function(t){var e=this.m_Scene;if(t.m_Design){var i=this.m_Pos.GetValueVector(e.m_Ctx);var a=e.GetPosFromPoint([t.m_ClientX,t.m_ClientY,0]);var r=0;switch(t.m_Handle){case 1:case 7:r=VBI.MathLib.Distance(VBI.MathLib.DegToRad(i),VBI.MathLib.DegToRad([i[0],a[1]]));break;case 3:case 5:r=VBI.MathLib.Distance(VBI.MathLib.DegToRad(i),VBI.MathLib.DegToRad([a[0],i[1]]));break;default:break}this.m_Radius.SetValueFloat(e.m_Ctx,Math.abs(r))}};VBI.Utilities.SceneBindRadiusDesignBoxSize=function(t){var e=this.m_Scene;if(t.m_Design){var i=this.m_Pos.GetValueVector(e.m_Ctx);var a=e.GetPointFromPos(i);a[0]+=t.m_IO;var r=0;switch(t.m_Handle){case 1:case 7:r=a[1]-t.m_ClientY;break;case 3:case 5:r=a[0]-t.m_ClientX;break;default:break}this.m_Radius.SetValueFloat(e.m_Ctx,Math.abs(r))}};VBI.Utilities.SceneBindPosArrayDesignBoxSize=function(t){var e=this.m_Scene;if(t.m_Design){var i=e.GetPosFromPoint([t.m_ClientX-t.m_IO,t.m_ClientY,0]);var a=Number.MAX_VALUE;var r=-Number.MAX_VALUE;var s=Number.MAX_VALUE;var n=-Number.MAX_VALUE;var m=t.m_PosOrig.slice(0);var l,_=m.length/3,u;for(l=0;l<_;++l){u=l*3;if(a>m[u]){a=m[u]}if(r<m[u]){r=m[u]}if(s>m[u+1]){s=m[u+1]}if(n<m[u+1]){n=m[u+1]}}var o=0,h=1;var f=0,c=1;switch(t.m_Handle){case 0:case 1:if(t.m_Handle==0){o=r;h=(i[0]-r)/(a-r)}f=s;c=(i[1]-s)/(n-s);break;case 2:case 5:if(t.m_Handle==2){f=s;c=(i[1]-s)/(n-s)}o=a;h=(i[0]-a)/(r-a);break;case 6:case 3:if(t.m_Handle==6){f=n;c=(i[1]-n)/(s-n)}o=r;h=(i[0]-r)/(a-r);break;case 8:case 7:if(t.m_Handle==8){o=a;h=(i[0]-a)/(r-a)}f=n;c=(i[1]-n)/(s-n);break;default:break}for(l=0;l<_;++l){u=l*3;m[u]=o+(m[u]-o)*h;m[u+1]=f+(m[u+1]-f)*c}this.m_Pos.SetValueVector(e.m_Ctx,m)}};VBI.Utilities.BackupFont=function(t){t.m_BackupFont=[];t.m_BackupFont.m_font=t.m_font=t.font;t.m_BackupFont.m_fillStyle=t.fillStyle;t.m_BackupFont.m_strokeStyle=t.strokeStyle;t.m_BackupFont.m_textAlign=t.textAlign;t.m_BackupFont.m_textBaseline=t.textBaseline};VBI.Utilities.RestoreFont=function(t){t.m_font=t.font=t.m_BackupFont.m_font;t.fillStyle=t.m_BackupFont.m_fillStyle;t.strokeStyle=t.m_BackupFont.m_strokeStyle;t.textAlign=t.m_BackupFont.m_textAlign;t.textBaseline=t.m_BackupFont.m_textBaseline};VBI.Utilities.SetTextAttributes=function(t,e,i,a,r,s){if(e!=undefined&&t.m_font!=e){t.m_font=t.font=e}var n;if(i){n=VBI.Types.string2rgba(i);t.fillStyle=VBI.Utilities.RgbToHex(n[0],n[1],n[2])}if(a){n=VBI.Types.string2rgba(a);t.strokeStyle=VBI.Utilities.RgbToHex(n[0],n[1],n[2])}t.textAlign=r;t.textBaseline=s};VBI.Utilities.SetFont=function(t,e){if(e!=undefined&&t.m_font!=e){t.m_font=t.font=e}};VBI.DnDInfo=function(){var t={};t.m_datasource=null;t.m_boundtype=null;t.m_type=[];t.clear=function(){for(var e=0;e<t.m_type.length;++e){t.m_type[e].clear()}if(t.m_boundtype){t.m_boundtype.clear()}if(t.m_datasource){t.m_datasource.clear()}t.m_datasource=null;t.m_boundtype=null;t.m_type=[]};t.load=function(e,i,a){if(e){if(jQuery.type(e)=="array"){for(var r=0;r<e.length;++r){if(jQuery.type(e[r])=="object"){if(e[r].datasource){t.m_datasource=new VBI.NodeProperty(e[r],"datasource",a.m_DataSource,i);t.m_boundtype=new VBI.AttributeProperty(e[r],"type",t.m_datasource,i)}else{t.m_type.push(new VBI.AttributeProperty(e[r],"type",null,i))}}}}else if(jQuery.type(e)=="object"){if(e.datasource){t.m_datasource=new VBI.NodeProperty(e,"datasource",a.m_DataSource,i);t.m_boundtype=new VBI.AttributeProperty(e,"type",t.m_datasource,i)}else{t.m_type.push(new VBI.AttributeProperty(e,"type",null,i))}}}};t.getItemArray=function(e){var i=[];var a;if(t.m_datasource){var r=t.m_datasource;var s;if(s=r.GetCurrentNode(e)){for(a=0;a<s.m_dataelements.length;++a){r.Select(a);i.push(t.m_boundtype.GetValueString(e))}}}if(t.m_type.length){for(a=0;a<t.m_type.length;++a){i.push(t.m_type[a].GetValueString(e))}}return i};return t};VBI.NodeProperty=function(t,e,i,a){var r=null;if(!(r=t[e])){r=t[e+".bind"]}var s=r.split("::");var n=s[s.length-1].split(".");s.splice(-1,1);s.push(n[0]);n[0]=s.join("::");this.m_NPath=n;this.m_Path=n;this.m_PNP=i;this.m_nCurElement=0;this.m_CurElement=null;this.m_DTN=a.m_DataTypeProvider.FindTypeNodeFromPath(this.m_Path);var m=this;while(m=m.m_PNP){if(a.m_DataTypeProvider.isParentOf(m.m_DTN,this.m_DTN)){var l,_=m.m_DTN.GetPath();for(l=0;l<_.length;++l){if(this.m_NPath[0]==_[l]){this.m_NPath.splice(0,1)}else{break}}break}}this.m_PNP=m;this.NotifyDataChange=function(t){this.m_CurElement=null;this.m_DTN=t.m_DataTypeProvider.FindTypeNodeFromPath(this.m_Path)};this.clear=function(){this.m_PNP=null;this.m_CurElement=null;this.m_DTN=null;this.m_NPath=null;this.m_Path=null};this.GetCurrentElement=function(t){if(this.m_CurElement){return this.m_CurElement}var e=this.GetCurrentNode(t);if(!e){return null}this.m_CurElement=e.m_dataelements[this.m_nCurElement];return this.m_CurElement};this.GetIndexedElement=function(t,e){var i=this.GetCurrentNode(t);if(!i){return null}return i.m_dataelements[e]};this.GetCurrentNode=function(t){var e=null;if(this.m_PNP){var i=this.m_PNP.GetCurrentElement(t);e=i.FindNodeFromPath(this.m_NPath)}else{e=t.m_DataProvider.FindNodeFromPath(this.m_NPath)}return e};this.Select=function(t){this.m_CurElement=null;this.m_nCurElement=t};this.SetEditMode=function(t,e){var i;if(i=this.GetCurrentElement(t)){i.m_EditMode=e}};this.GetEditMode=function(t){var e;if((e=this.GetCurrentElement(t))&&e.m_EditMode!=undefined){return e.m_EditMode}return VBI.EMHandle};this.IsElementSelected=function(t){var e;if(e=this.GetCurrentElement(t)){return e.IsSelected()}return false};this.SetSelected=function(t,e){return};return this};VBI.AttributeProperty=function(t,e,i,a,r){var s;this.m_DefaultValue=r;if(s=t[e]){this.m_Name=e;this.m_Value=s}else if(s=t[e+".bind"]){this.m_PNP=i;this.m_Name=e;var n=s.split("::");var m=n[n.length-1].split(".");n.splice(-1,1);n.push(m[0]);m[0]=n.join("::");this.m_RelBind=m;this.m_AbsBind=m;this.m_DTA=a.m_DataTypeProvider.FindTypeAttributeFromPath(this.m_AbsBind);var l=this;while(l=l.m_PNP){if(a.m_DataTypeProvider.isParentOf(l.m_DTN,this.m_DTA)){var _,u=l.m_DTN.GetPath();for(_=0;_<u.length;++_){if(this.m_RelBind[0]==u[_]){this.m_RelBind.splice(0,1)}else{break}}break}}this.m_PNP=l}this.NotifyDataChange=function(t){if(this.m_AbsBind){this.m_DTA=t.m_DataTypeProvider.FindTypeAttributeFromPath(this.m_AbsBind)}};this.clear=function(){this.m_PNP=null;this.m_DTA=null;this.m_DefaultValue=null;if(this.m_Name){this.m_Name=null}if(this.m_Value){this.m_Value=null}if(this.m_PNP){this.m_PNP=null}if(this.m_RelBind){this.m_RelBind=null}if(this.m_AbsBind){this.m_AbsBind=null}};this.IsChangeable=function(t){var e;if(e=this.GetAttributeObject(t)){return e.IsChangeable()}return false};this.GetAttributeObject=function(t){if(this.m_RelBind){if(this.m_PNP){return this.m_PNP.GetCurrentElement(t).FindAttributeFromPath(this.m_RelBind)}else{return t.m_DataProvider.FindAttributeFromPath(this.m_RelBind)}}return null};this.GetValueFloat=function(t){if(this.m_Value){return VBI.Types.string2float(this.m_Value)}if(this.m_RelBind){var e;if(e=this.GetAttributeObject(t)){if(e.m_dta.m_Type==VBI.Types.st_float){return e.m_Value}if(e.m_dta.m_Type==VBI.Types.st_string){return VBI.Types.string2float(e.m_Value)}if(e.m_dta.m_Type==VBI.Types.st_long){return VBI.Types.long2float(e.m_Value)}if(e.m_dta.m_Type==VBI.Types.st_bool){return e.m_Value?1:0}}}return this.m_DefaultValue};this.GetValueString=function(t){if(this.m_Value){return this.m_Value}if(this.m_RelBind){var e;if(e=this.GetAttributeObject(t)){if(e.m_dta.m_Type==VBI.Types.st_string){return e.m_Value}else{return e.GetStringValue()}}}return this.m_DefaultValue};this.GetValueLong=function(t){if(this.m_Value){return VBI.Types.string2long(this.m_Value)}if(this.m_RelBind){var e;if(e=this.GetAttributeObject(t)){if(e.m_dta.m_Type==VBI.Types.st_long){return e.m_Value}if(e.m_dta.m_Type==VBI.Types.st_bool){return e.m_Value}if(e.m_dta.m_Type==VBI.Types.st_string){return VBI.Types.string2long(e.m_Value)}if(e.m_dta.m_Type==VBI.Types.st_float){return VBI.Types.float2long(e.m_Value)}}}return this.m_DefaultValue};this.GetValueBool=function(t){if(this.m_Value){return VBI.Types.string2bool(this.m_Value)}if(this.m_RelBind){var e;if(e=this.GetAttributeObject(t)){if(e.m_dta.m_Type==VBI.Types.st_bool){return e.m_Value}if(e.m_dta.m_Type==VBI.Types.st_string){return VBI.Types.string2bool(e.m_Value)}}}return this.m_DefaultValue};this.GetValueVector=function(t){if(this.m_Value){if(typeof this.m_Value==="string"){return VBI.Types.string2vector(this.m_Value)}else{return VBI.Types.stringarray2vectorarray(this.m_Value)}}if(this.m_RelBind){var e;if(e=this.GetAttributeObject(t)){if(e.m_dta.m_Type==VBI.Types.st_vector||e.m_dta.m_Type==VBI.Types.st_vectorarray||e.m_dta.m_Type==VBI.Types.st_vectorarraymulti){return e.m_Value}if(e.m_dta.m_Type==VBI.Types.st_string){return VBI.Types.string2vector(e.m_Value)}}}return this.m_DefaultValue};this.GetValueColor=function(t){var e;if(this.m_Value){e=VBI.Types.string2rgba(this.m_Value);return"rgba("+e[0]+","+e[1]+","+e[2]+","+e[3]+")"}if(this.m_RelBind){var i;if(i=this.GetAttributeObject(t)){if(i.m_dta.m_Type==VBI.Types.st_color){return i.m_Value}if(i.m_dta.m_Type==VBI.Types.st_string){e=VBI.Types.string2rgba(i.m_Value);return"rgba("+e[0]+","+e[1]+","+e[2]+","+e[3]+")"}}}return this.m_DefaultValue};this.SetValueVector=function(t,e){if(this.m_Value){return null}if(this.m_RelBind){var i;if(i=this.GetAttributeObject(t)){if(i.m_dta.m_Type==VBI.Types.st_vector||i.m_dta.m_Type==VBI.Types.st_vectorarray){i.set(e)}if(i.m_dta.m_Type==VBI.Types.st_string){i.set(VBI.Types.float2string(e))}}}return null};this.SetValueFloat=function(t,e){if(this.m_Value){return null}if(this.m_RelBind){var i;if(i=this.GetAttributeObject(t)){if(i.m_dta.m_Type==VBI.Types.st_float){i.set(e)}else if(i.m_dta.m_Type==VBI.Types.st_long){i.set(VBI.Types.float2long(e))}else if(i.m_dta.m_Type==VBI.Types.st_string){i.set(VBI.Types.float2string(e))}}}return null};this.IsBound=function(){return this.m_RelBind?true:false};return this}});
/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5) (c) Copyright 2009-2012 SAP AG. All rights reserved
 */
sap.ui.predefine("sap/ui/vbm/lib/sapwindow", ["./sapvbi"],function(){"use strict";VBI.Windows=function(){var e={};e.vbiclass="Windows";e.m_WindowArray=[];e.find=function(t){for(var n=0,i=e.m_WindowArray.length;n<i;++n){if(e.m_WindowArray[n].m_ID==t){return e.m_WindowArray[n]}}return null};e.clear=function(){for(var t=0;t<e.m_WindowArray.length;++t){e.m_WindowArray[t].clear()}e.m_WindowArray=[]};e.create=function(e,t){var n=null;switch(e.type){case"callout":n=new VBI.CalloutWindow;break;case"legend":n=new VBI.LegendWindow;break;default:n=new VBI.Window;break}if(n){n.load(e,t)}return n};e.load=function(t,n){var i,o,r;if(t.Remove){if(jQuery.type(t.Remove)=="object"){if(t.Remove.name){e.Remove(t.Remove.name)}}else if(jQuery.type(t.Remove)=="array"){for(o=0,r=t.Remove.length;o<r;++o){if(t.Remove[o].name){e.Remove(t.Remove[o].name)}}}}if(t.Set){var a;if(jQuery.type(t.Set)=="object"){if(t.Set.name){a=e.find(t.Set.name);if(a){a.load(t.Set.Window,n);return}else{a=e.create(t.Set.Window,n);e.Add(a);return}}e.clear();if(t.Set.Window){if(jQuery.type(t.Set.Window)=="object"){a=e.create(t.Set.Window,n);e.Add(a)}else if(jQuery.type(t.Set.Window)=="array"){i=t.Set.Window;for(o=0;o<i.length;++o){a=e.create(i[o],n);e.Add(a)}return}}}else if(jQuery.type(t.Set)=="array"){i=t.Set;for(o=0;o<i.length;++o){var l=i[o];if(l.name){a=e.find(l.name);if(a){a.load(l.Window,n)}else{a=e.create(l.Window,n);e.Add(a)}}}}}};e.Add=function(t){e.m_WindowArray.push(t)};e.Remove=function(t){var n=null;for(var i=0,o=e.m_WindowArray.length;i<o;++i){if((n=e.m_WindowArray[i]).m_ID==t){n.clear();e.m_WindowArray.splice(i,1);break}}};e.Awake=function(t){for(var n=0;n<e.m_WindowArray.length;++n){e.m_WindowArray[n].Awake(t)}};e.GetMainWindow=function(){for(var t=0;t<e.m_WindowArray.length;++t){if(e.m_WindowArray[t].m_refParent==null){return e.m_WindowArray[t]}}return null};e.NotifyDataChange=function(){var t=e.m_WindowArray;for(var n=0;n<t.length;++n){t[n].NotifyDataChange()}return null};e.NotifyResize=function(){var t=e.m_WindowArray;for(var n=0;n<t.length;++n){t[n].NotifyResize()}return null};e.NotifySceneMove=function(t){var n=e.m_WindowArray;for(var i=0,o=n.length;i<o;++i){n[i].NotifySceneMove(t)}return null};e.NotifySceneZoom=function(t){var n=e.m_WindowArray;for(var i=0,o=n.length;i<o;++i){n[i].NotifySceneZoom(t)}return null};e.Render=function(){var t=e.m_WindowArray;for(var n=0;n<t.length;++n){t[n].Render()}return null};e.RenderAsync=function(){var t=e.m_WindowArray;for(var n=0;n<t.length;++n){t[n].RenderAsync(true)}return null};return e};VBI.Window=function(){this.vbiclass="Window";this.m_ID="";this.m_Caption="";this.m_Type="";this.m_bModal=true;this.m_refScene=null;this.m_refSceneInstance=null;this.m_refParent=null;this.m_Width=null;this.m_Height=null;this.m_Div=null;this.m_Ctx=null;this.BaseLoad=function(e,t,n){if(t.id){e.m_ID=t.id}if(t.caption){e.m_Caption=t.caption}if(t.refParent){e.m_refParent=t.refParent}if(t.modal){e.m_bModal=t.ref=="true"?true:false}if(t.width){e.m_Width=parseInt(t.width,10)}if(t.height){e.m_Height=parseInt(t.height,10)}e.m_Ctx=n;if(t.refScene){e.m_refScene=t.refScene}else if(VBI.m_bTrace){VBI.Trace("Error: no scene assigned to window")}};this.BaseClear=function(){var e=this.GetScene();if(e){e.m_Parent=null}this.m_refParent=null;this.m_refScene=null;this.m_refSceneInstance=null;this.m_Ctx=null;this.m_Div=null};this.clear=function(){this.BaseClear()};this.load=function(e,t){this.BaseLoad(this,e,t)};this.GetScene=function(){if(this.m_refSceneInstance){return this.m_refSceneInstance}this.m_refSceneInstance=this.m_Ctx&&this.m_Ctx.m_SceneManager?this.m_Ctx.m_SceneManager.GetSceneByName(this.m_refScene):null;if(this.m_refSceneInstance){this.m_refSceneInstance.m_Parent=this}return this.m_refSceneInstance};this.GetHostingScene=function(){if(!this.m_refParent){return null}var e=this.m_Ctx.m_Windows.find(this.m_refParent);if(e){return e.GetScene()}return null};this.NotifyDataChange=function(){var e=this.GetScene();if(e){e.NotifyDataChange()}};this.NotifyResize=function(){return};this.NotifySceneMove=function(e){return};this.NotifySceneZoom=function(e){return};this.Render=function(){var e=this.GetScene();if(e){e.Render()}};this.RenderAsync=function(){var e=this.GetScene();if(e){if(e.RenderAsync){e.RenderAsync(true)}else{e.Render()}}};this.Awake=function(e){var t=this.GetScene();if(t){t.Awake(e)}else if(VBI.m_bTrace){VBI.Trace("Error: Awake no scene assigned to window")}};this.Create=function(e){};this.Destroy=function(){}};VBI.CalloutWindow=function(){var e=new VBI.Window;e.m_oCallout=null;e.load=function(t,n){e.BaseLoad(e,t,n);e.m_Pos=new VBI.AttributeProperty(t,"pos",null,n);e.m_OffsetX=new VBI.AttributeProperty(t,"offsetX",null,n,0);e.m_OffsetY=new VBI.AttributeProperty(t,"offsetY",null,n,0)};e.clear=function(){e.UnRegisterEvents();e.Remove();e.BaseClear();e.m_oCallout=null};e.processclosebuttonclick=function(t){e.m_Ctx.onCloseWindow(e.m_ID,e.m_oCallout.m_Content);e.clear();t.preventDefault();t.stopPropagation()};e.IsValid=function(){return e.m_oCallout&&e.m_oCallout.m_Div?true:false};e.NotifySceneMove=function(t){e.UpdatePosition()};e.NotifySceneZoom=function(t){e.UpdatePosition()};e.CalcDivPosition=function(){if(!e.IsValid()){return undefined}var t=VBI.m_bIsPhone;if(t){return undefined}var n=e.m_OffsetX.GetValueLong();var i=e.m_OffsetY.GetValueLong();var o=e.m_Pos.GetValueVector(e.m_Ctx);var r=e.GetHostingScene();var a=r.m_Canvas[r.m_nOverlayIndex];var l=a.getPixelLeft();var m=a.getPixelTop();var s=r.m_Canvas[0].m_nExactLOD;var _=parseInt(Math.pow(2,s)*r.m_nWidthCanvas/r.m_nTilesX*r.m_Proj.m_nXYRatio,10);var u=(r.m_nDivWidth-_)/2;var c=r.m_nDivWidth-u;var d=[];var f,v;var h;if(o.length>5){var g=a.getPixelWidth();var p=a.getPixelHeight();a.setPixelWidth(r.m_nWidthCanvas);a.setPixelHeight(r.m_nHeightCanvas);r.m_ZoomFactors[0]=g/r.m_nWidthCanvas;r.m_ZoomFactors[1]=p/r.m_nHeightCanvas;var C=r.GetNearestPosArray(o);var y=r.GetPointFromPos([C.m_MinX,C.m_MaxY,0],false);var w=r.GetPointFromPos([C.m_MaxX,C.m_MinY,0],false);h=r.GetInstanceOffsets([y[0],y[1],w[0],w[1]]);var D=h.length?r.GetPointArrayFromPosArray(C,false):null;var L;var b=r.GetInternalDivClientRect();var x=b.width/r.m_ZoomFactors[0];var A=b.height/r.m_ZoomFactors[1];var I=l/r.m_ZoomFactors[0];var P=m/r.m_ZoomFactors[1];var S=[-I,-P,-I+x,-P+A];for(f=0,v=h.length;f<v;++f){L=VBI.Utilities.GetMidpointsForLine(D,h[f],S);if(L.aPos.length>L.max){d=L.aPos[L.max];d[0]*=r.m_ZoomFactors[0];d[1]*=r.m_ZoomFactors[1];break}}a.setPixelWidth(g);a.setPixelHeight(p)}else{d=r.GetPointFromPos(o,true);if(d[0]+l<u){while(d[0]+l<u){d[0]+=_}}else if(d[0]+l>c){while(d[0]+l>c){d[0]-=_}}}if(d.length>1){d[0]+=l;d[1]+=m;d[0]+=n;d[1]+=i;var W=e.m_oCallout.GetAnchorPoint();d[0]-=W[0];d[1]-=W[1]}else{d.push(-1e3,-1e3)}return d};e.UpdatePosition=function(){if(!e.IsValid()){return}var t=e.CalcDivPosition();if(t){e.m_oCallout.m_Div.style.left=Math.round(t[0])+"px";e.m_oCallout.m_Div.style.top=Math.round(t[1])+"px"}else{e.m_oCallout.m_Div.style.top="";e.m_oCallout.m_Div.style.left="0px";e.m_oCallout.m_Div.style.bottom="0px"}e.m_oCallout.m_Div.style.visibility="visible"};e.Create=function(t){if(e.m_refParent&&!e.m_oCallout){var n=e.GetHostingScene();if(n){e.m_oCallout=VBI.Utilities.CreateDetail(t+"-"+e.m_ID,0,0,e.m_Width,e.m_Height,e.m_Caption,5);e.m_oCallout.m_Div.style.visibility="hidden";e.RegisterEvents();n.m_WindowLayerDiv.appendChild(e.m_oCallout.m_Div);e.m_Ctx.onOpenWindow(e.m_ID,e.m_oCallout.m_Content);e.UpdatePosition()}}};e.RegisterEvents=function(){var t=e.processclosebuttonclick.bind(e);e.m_oCallout.m_CloseButton.onclick=t;e.m_oCallout.m_CloseButton.ontouchend=t};e.UnRegisterEvents=function(){if(!e.m_oCallout||!e.m_oCallout.m_CloseButton){return}e.m_oCallout.m_CloseButton.onclick=null;e.m_oCallout.m_CloseButton.ontouchend=null};e.Remove=function(){var t=e.m_oCallout;if(!t||!t.m_Div){return}var n=t.m_Div;while(n.firstChild){n.removeChild(n.firstChild)}if(n.parentElement){n.parentElement.removeChild(n)}e.m_oCallout=null};e.Awake=function(t){if(this.m_refParent){this.Create(t)}var n=this.GetScene();if(n){n.m_Div=e.m_oCallout.m_Content;n.Awake(t)}else if(VBI.m_bTrace){VBI.Trace("Error: Awake no scene assigned to window")}};return e};VBI.LegendWindow=function(){var e=new VBI.Window;e.m_oLegend=null;e.m_Props=[];e.m_Data=[];e.m_bRenew=false;e.m_Position=[];e.m_bCreated=false;e.load=function(t,n){e.BaseLoad(e,t,n);e.m_Props.push(e.m_DataSource=new VBI.NodeProperty(t,"datasource",null,n));e.m_Props.push(e.m_Colors=new VBI.AttributeProperty(t,"colors",e.m_DataSource,n));e.m_Props.push(e.m_Images=new VBI.AttributeProperty(t,"images",e.m_DataSource,n));e.m_Props.push(e.m_Texts=new VBI.AttributeProperty(t,"texts",e.m_DataSource,n));e.m_Props.push(e.m_Tooltips=new VBI.AttributeProperty(t,"tooltips",e.m_DataSource,n));e.m_Position=[];if(t.top&&t.right){e.m_Position.push(parseInt(t.right,10));e.m_Position.push(parseInt(t.top,10))}};e.clear=function(){e.UnRegisterEvents();e.Remove();e.BaseClear();e.m_oLegend=null;if(e.m_Props){for(var t=0;t<e.m_Props.length;++t){e.m_Props[t].clear()}e.m_Props=[]}e.m_Data=[]};e.invalidate=function(){e.m_bRenew=true};e.IsValid=function(){return e.m_oLegend&&e.m_oLegend.m_Div?true:false};e.NotifySceneMove=function(e){};e.NotifySceneZoom=function(e){};e.LegendChanged=function(){var t=e.m_DataSource.GetCurrentNode(e.m_Ctx);if(t){var n=t.m_dataelements.length;if(n!=e.m_Data.length){return true}for(var i=0;i<n;++i){e.m_DataSource.Select(i);var o=e.m_Texts.GetValueString(e.m_Ctx);if(o!=e.m_Data[i].text){return true}if(e.m_Data[i].type==1){if(e.m_Data[i].value!=e.m_Images.GetValueString(e.m_Ctx)){return true}}else if(e.m_Data[i].type==2){if(e.m_Data[i].value!=e.m_Colors.GetValueColor(e.m_Ctx)){return true}}}}else{return true}return false};e.ApplyData=function(){var t=e.m_DataSource.GetCurrentNode(e.m_Ctx);if(t){var n=t.m_dataelements.length;for(var i=0;i<n;++i){var o;var r;var a={};e.m_DataSource.Select(i);a.text=e.m_Texts.GetValueString(e.m_Ctx);if(a.text){a.type=0;r=e.m_Images.GetValueString(e.m_Ctx);if(r){a.type=1;a.value=r}else{o=e.m_Colors.GetValueColor(e.m_Ctx);if(o){a.type=2;a.value=o}}e.m_Data.push(a)}}}};e.NotifyResize=function(){if(e.m_bCreated){e.calcMaxHeight()}};e.NotifyDataChange=function(){if(e.m_Props){for(var t=0,n=e.m_Props.length;t<n;++t){e.m_Props[t].NotifyDataChange(e.m_Ctx)}}if(e.LegendChanged()){e.m_Data=[];if(e.m_oLegend&&e.m_oLegend.m_Table){while(e.m_oLegend.m_Table.rows.length>0){e.m_oLegend.m_Table.deleteRow(-1)}e.ApplyData();e.FillContent();e.calcMaxHeight()}}};e.Create=function(t){var n=e.m_oLegend&&!e.m_oLegend.m_Div.parentNode;if(e.m_bRenew){e.m_Data=[];if(e.m_oLegend&&e.m_oLegend.m_Table){while(e.m_oLegend.m_Table.rows.length>0){e.m_oLegend.m_Table.deleteRow(-1)}e.ApplyData();e.FillContent()}e.m_bRenew=false}else if(e.m_refParent&&!e.m_oLegend||n){var i=e.GetHostingScene();if(i){var o=this.m_Ctx.m_Actions.findAction("Click",i,e.m_ID)?true:false;e.m_oLegend=VBI.Utilities.CreateLegend(t+"-"+e.m_ID,0,e.m_Caption,5,o);if(!n){e.ApplyData()}e.FillContent();e.m_Expanded=true;e.RegisterEvents();e.m_oLegend.m_Div=i.m_LegendLayerDiv.appendChild(e.m_oLegend.m_Div);if(e.m_Position.length==2){if(!isNaN(e.m_Position[0])){e.m_oLegend.m_Div.style.right=e.m_Position[0]+"px";e.m_oLegend.m_Div.style.left=""}if(!isNaN(e.m_Position[1])){e.m_oLegend.m_Div.style.top=e.m_Position[1]+"px"}}e.calcMaxHeight()}}e.m_bCreated=true};e.getId=function(t,n){return e.m_oLegend.m_Table.id+"-"+n+"-"+t};e.FillContent=function(){if(!e.m_Data.length){return}for(var t=0;t<e.m_Data.length;++t){var n=e.m_oLegend.m_Table.insertRow(-1);n.id=e.getId(t,"content-tablerow");n.setAttribute("role",sap.ui.core.AccessibleRole.Row);n.setAttribute("tabindex","-1");var i=n.insertCell(0);i.setAttribute("role",sap.ui.core.AccessibleRole.GridCell);i.setAttribute("tabindex","-1");var o=e.m_Data[t];if(o.type==2){var r=VBI.Utilities.CreateGeoSceneDivCSS(e.getId(t,"content-celldiv"),"vbi-legend-content-celldiv-square");r.setAttribute("role",sap.ui.core.AccessibleRole.GridCell);r.setAttribute("tabindex","-1");r.style.backgroundColor=o.value;i.appendChild(r)}else if(o.type==1){var a=e.m_Ctx.GetResources().GetImage(o.value,null,null,e.invalidate.bind());if(a){var l=a.cloneNode(true);l.setAttribute("role",sap.ui.core.AccessibleRole.Img);l.setAttribute("tabindex","-1");l.className="vbi-legend-content-celldiv";l.id=e.getId(t,"content-celldiv");i.appendChild(l)}}else{i.className="vbi-legend-content-celltext-group";i.setAttribute("role",sap.ui.core.AccessibleRole.ColumnHeader);i.setAttribute("tabindex","0");i.colSpan=2;i.innerHTML=jQuery.sap.encodeHTML(o.text)}if(o.type>0){var m=n.insertCell(1);m.setAttribute("role",sap.ui.core.AccessibleRole.GridCell);m.setAttribute("tabindex","-1");m.className="vbi-legend-content-celltext";m.id=e.getId(t,"content-celltext");m.innerHTML=jQuery.sap.encodeHTML(o.text)}}};e.processtouchend=function(t){document.removeEventListener("touchend",e.processtouchend,true);document.removeEventListener("touchmove",e.processtouchmove,true)};e.processmouseup=function(t){document.removeEventListener("mouseup",e.processmouseup,true);document.removeEventListener("mousemove",e.processmousemove,true)};e.movelegend=function(t){var n=t.slice(0);var i=e.GetHostingScene();if(n[0]<i.m_Div.clientLeft){n[0]=i.m_Div.clientLeft}if(n[0]+e.m_oLegend.m_Div.clientWidth>i.m_Div.clientLeft+i.m_Div.clientWidth){n[0]=i.m_Div.clientLeft+i.m_Div.clientWidth-e.m_oLegend.m_Div.clientWidth}if(n[1]<i.m_Div.clientTop){n[1]=i.m_Div.clientTop}if(n[1]+e.m_oLegend.m_Header.clientHeight>i.m_Div.clientTop+i.m_Div.clientHeight){n[1]=i.m_Div.clientTop+i.m_Div.clientHeight-e.m_oLegend.m_Header.clientHeight}jQuery(e.m_oLegend.m_Div).css("top",n[1]+"px");jQuery(e.m_oLegend.m_Div).css("right",i.m_Div.clientWidth-e.m_oLegend.m_Div.clientWidth-n[0]+"px");jQuery(e.m_oLegend.m_Div).css("left","");e.calcMaxHeight()};e.processtouchmove=function(t){var n=t.changedTouches[0];var i=parseInt(n.pageX,10);var o=parseInt(n.pageY,10);var r=[i-e.m_offset[0],o-e.m_offset[1]];e.movelegend(r)};e.processmousemove=function(t){if(t.which==1){var n=[t.pageX-e.m_offset[0],t.pageY-e.m_offset[1]];e.movelegend(n)}};e.processmousedragstart=function(t){if(t.which==1){e.m_offset=[t.pageX-e.m_oLegend.m_Div.offsetLeft,t.pageY-e.m_oLegend.m_Div.offsetTop];document.addEventListener("mouseup",e.processmouseup,true);document.addEventListener("mousemove",e.processmousemove,true);t.preventDefault();t.stopPropagation()}};e.processtouchdragstart=function(t){var n=t.changedTouches[0];var i=parseInt(n.pageX,10);var o=parseInt(n.pageY,10);e.m_offset=[i-e.m_oLegend.m_Div.offsetLeft,o-e.m_oLegend.m_Div.offsetTop];document.addEventListener("touchend",e.processtouchend,true);document.addEventListener("touchmove",e.processtouchmove,true);t.preventDefault();t.stopPropagation()};e.collapse=function(t){if(e.m_Expanded){e.m_oLegend.m_ButtonCol.style.visibility="hidden";e.m_oLegend.m_ButtonExp.style.visibility="";e.m_oLegend.m_Content.style.display="none";e.m_Expanded=false}};e.calcMaxHeight=function(){var t=e.GetHostingScene().m_Div.clientHeight;if(t){var n=e.m_oLegend.m_Header.clientHeight;var i=parseInt(e.m_oLegend.m_Div.style.top,10);var o=i+n;var r=t-o;e.m_oLegend.m_Content.style.maxHeight=r+"px"}};e.expand=function(t){if(!e.m_Expanded){e.m_oLegend.m_ButtonCol.style.visibility="";e.m_oLegend.m_ButtonExp.style.visibility="hidden";e.m_oLegend.m_Content.style.display="";e.m_Expanded=true}};e.clickTable=function(t){var n=t.target||t.srcElement;var i;var o=n.id.match(/\d+/g);if(o&&o.length){i=o[o.length-1]}else{o=n.parentNode.id.match(/\d+/g);if(o&&o.length){i=o[o.length-1]}}if(i){var r=e.GetHostingScene();var a={row:i,ctrlKey:t.ctrlKey,shiftKey:t.shiftKey,metaKey:t.metaKey,altKey:t.altKey};var l=null,m=this.m_Ctx.m_Actions;if(r&&m){l=this.m_Ctx.m_Actions.findAction("Click",r,e.m_ID)}if(l){this.m_Ctx.FireAction(l,r.m_ID,l.m_refVO,null,a)}}};e.RegisterEvents=function(){var t=e.processmousedragstart.bind(e);e.m_oLegend.m_Header.onmousedown=t;var n=e.processtouchdragstart.bind(e);e.m_oLegend.m_Header.ontouchstart=n;var i=e.collapse.bind(e);e.m_oLegend.m_ButtonCol.onclick=i;var o=e.expand.bind(e);e.m_oLegend.m_ButtonExp.onclick=o;var r=e.clickTable.bind(e);e.m_oLegend.m_Table.onclick=r;e.m_oLegend.m_Header.style.cursor=e.m_oLegend.m_Table.style.cursor="pointer"};e.UnRegisterEvents=function(){if(!e.m_oLegend){return}if(e.m_oLegend.m_Header){e.m_oLegend.m_Header.onmousedown=null;e.m_oLegend.m_Header.ontouchstart=null}if(e.m_oLegend.m_ButtonCol){e.m_oLegend.m_ButtonCol.onclick=null}if(e.m_oLegend.m_ButtonExp){e.m_oLegend.m_ButtonExp.onclick=null}if(e.m_oLegend.m_Table){e.m_oLegend.m_Table.onclick=null}};e.Remove=function(){var t=e.m_oLegend;if(!t||!t.m_Div){return}var n=t.m_Div;while(n.firstChild){n.removeChild(n.firstChild)}if(n.parentElement){n.parentElement.removeChild(n)}e.m_oLegend=null};e.Awake=function(t){if(e.m_refParent){e.Create(t)}var n=this.GetScene();if(n){n.Awake(t)}else if(VBI.m_bTrace){VBI.Trace("Error: Awake no scene assigned to window")}};return e}});
/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5) (c) Copyright 2009-2012 SAP AG. All rights reserved
 */
sap.ui.predefine("sap/ui/vbm/library", ["sap/ui/core/Core","sap/m/library","sap/ui/core/library","sap/ui/unified/library"],function(){"use strict";var e=sap.ui.getCore().initLibrary({name:"sap.ui.vbm",types:["sap.ui.vbm.ClusterInfoType","sap.ui.vbm.SemanticType"],controls:["sap.ui.vbm.AnalyticMap","sap.ui.vbm.GeoMap","sap.ui.vbm.VBI","sap.ui.vbm.Cluster","sap.ui.vbm.Viewport"],elements:["sap.ui.vbm.Area","sap.ui.vbm.Areas","sap.ui.vbm.Box","sap.ui.vbm.Boxes","sap.ui.vbm.Circle","sap.ui.vbm.Circles","sap.ui.vbm.Container","sap.ui.vbm.Containers","sap.ui.vbm.DragSource","sap.ui.vbm.DropTarget","sap.ui.vbm.Feature","sap.ui.vbm.FeatureCollection","sap.ui.vbm.GeoJsonLayer","sap.ui.vbm.GeoCircle","sap.ui.vbm.GeoCircles","sap.ui.vbm.Legend","sap.ui.vbm.LegendItem","sap.ui.vbm.Pie","sap.ui.vbm.PieItem","sap.ui.vbm.Pies","sap.ui.vbm.Region","sap.ui.vbm.Resource","sap.ui.vbm.Route","sap.ui.vbm.Routes","sap.ui.vbm.Spot","sap.ui.vbm.Spots","sap.ui.vbm.VoAggregation","sap.ui.vbm.VoBase","sap.ui.vbm.ClusterBase","sap.ui.vbm.ClusterTree","sap.ui.vbm.ClusterGrid","sap.ui.vbm.ClusterDistance","sap.ui.vbm.Heatmap","sap.ui.vbm.HeatPoint","sap.ui.vbm.ClusterContainer","sap.ui.vbm.Adapter","sap.ui.vbm.Adapter3D"],version:"1.120.0"});sap.ui.loader.config({shim:{"sap/ui/vbm/adapter3d/thirdparty/three":{exports:"THREE",amd:true},"sap/ui/vbm/adapter3d/thirdparty/ColladaLoader":{exports:"THREE.ColladaLoader",deps:["sap/ui/vbm/adapter3d/thirdparty/three"]},"sap/ui/vbm/adapter3d/thirdparty/OrbitControls":{exports:"THREE.OrbitControls",deps:["sap/ui/vbm/adapter3d/thirdparty/three"]},"sap/ui/vbm/adapter3d/thirdparty/DecalGeometry":{exports:"DecalGeometry",deps:["sap/ui/vbm/adapter3d/thirdparty/three"]},"sap/ui/vbm/adapter3d/thirdparty/html2canvas":{exports:"html2canvas",amd:true}}});e.SemanticType={None:"None",Error:"Error",Warning:"Warning",Success:"Success",Default:"Default",Inactive:"Inactive",Hidden:"Hidden"};e.ClusterInfoType={ContainedVOs:0,ChildCluster:1,ParentNode:2,NodeInfo:10,Edges:11};e.RouteType={Straight:"Straight",Geodesic:"Geodesic"};e.getResourceBundle=function(){return sap.ui.getCore().getLibraryResourceBundle("sap.ui.vbm.i18n")};e.findInArray=function(e,a){if(!Array.isArray(e)||typeof a!=="function"){return undefined}for(var r=0,i=e.length;r<i;r++){var s=e[r];if(a(s)){return s}}return undefined};e.findIndexInArray=function(e,a){if(!Array.isArray(e)||typeof a!=="function"){return-1}for(var r=0,i=e.length;r<i;r++){var s=e[r];if(a(s)){return r}}return-1};return e},false);
sap.ui.require.preload({
	"sap/ui/vbm/manifest.json":'{"_version":"1.21.0","sap.app":{"id":"sap.ui.vbm","type":"library","embeds":[],"applicationVersion":{"version":"1.120.0"},"title":"SAP UI library: sap.ui.vbm","description":"SAP UI library: sap.ui.vbm","ach":"CA-GTF-VBZ","resources":"resources.json","offline":true},"sap.ui":{"technology":"UI5","supportedThemes":["base","sap_belize","sap_belize_hcb","sap_belize_hcw","sap_belize_plus","sap_bluecrystal","sap_fiori_3","sap_fiori_3_dark","sap_fiori_3_hcb","sap_fiori_3_hcw","sap_hcb","sap_horizon","sap_horizon_dark","sap_horizon_hcb","sap_horizon_hcw"]},"sap.ui5":{"dependencies":{"minUI5Version":"1.120","libs":{"sap.ui.core":{"minVersion":"1.120.0"},"sap.ui.commons":{"minVersion":"1.120.0","lazy":true},"sap.ui.unified":{"minVersion":"1.120.0","lazy":true}}},"library":{"i18n":false,"content":{"controls":["sap.ui.vbm.AnalyticMap","sap.ui.vbm.GeoMap","sap.ui.vbm.VBI","sap.ui.vbm.Cluster","sap.ui.vbm.Viewport"],"elements":["sap.ui.vbm.Area","sap.ui.vbm.Areas","sap.ui.vbm.Box","sap.ui.vbm.Boxes","sap.ui.vbm.Circle","sap.ui.vbm.Circles","sap.ui.vbm.Container","sap.ui.vbm.Containers","sap.ui.vbm.DragSource","sap.ui.vbm.DropTarget","sap.ui.vbm.Feature","sap.ui.vbm.FeatureCollection","sap.ui.vbm.GeoJsonLayer","sap.ui.vbm.GeoCircle","sap.ui.vbm.GeoCircles","sap.ui.vbm.Legend","sap.ui.vbm.LegendItem","sap.ui.vbm.Pie","sap.ui.vbm.PieItem","sap.ui.vbm.Pies","sap.ui.vbm.Region","sap.ui.vbm.Resource","sap.ui.vbm.Route","sap.ui.vbm.Routes","sap.ui.vbm.Spot","sap.ui.vbm.Spots","sap.ui.vbm.VoAggregation","sap.ui.vbm.VoBase","sap.ui.vbm.ClusterBase","sap.ui.vbm.ClusterTree","sap.ui.vbm.ClusterGrid","sap.ui.vbm.ClusterDistance","sap.ui.vbm.Heatmap","sap.ui.vbm.HeatPoint","sap.ui.vbm.ClusterContainer","sap.ui.vbm.Adapter","sap.ui.vbm.Adapter3D"],"types":["sap.ui.vbm.ClusterInfoType","sap.ui.vbm.SemanticType"],"interfaces":[]}}}}'
});
//# sourceMappingURL=library-preload.js.map
